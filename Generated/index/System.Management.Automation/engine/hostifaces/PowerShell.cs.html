<!DOCTYPE html>
<html><head><title>PowerShell.cs</title><link rel="stylesheet" href="../../../styles.css"><script src="../../../scripts.js"></script></head>
<body class="cB" onload="i(6264);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#System.Management.Automation/engine/hostifaces/PowerShell.cs" target="_top">engine\hostifaces\PowerShell.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#System.Management.Automation" target="_top">src\System.Management.Automation\System.Management.Automation.csproj</a> (System.Management.Automation)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">ObjectModel</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>.<span class="i">CodeAnalysis</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Host</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Internal</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Runspaces</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Runspaces</span>.<span class="i n">Internal</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Runtime</span>.<span class="i">Serialization</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Threading</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Threading</span>.<span class="i">Tasks</span>;
 
<b>using</b> <span class="i n">Microsoft</span>.<span class="i">Management</span>.<span class="i">Infrastructure</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Telemetry</span>;
 
<b>using</b> <span class="t">Dbg</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>;
 
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">disable</span> 1634, 1691 <span class="c">// Stops compiler from warning about unknown warnings</span>
 
<b>namespace</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>
{
    <span class="k preprocess">#</span><span class="k preprocess">region</span> Exceptions
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Defines exception which is thrown when state of the PowerShell is different</span>
    <span class="c">///</span><span class="c"> from the expected state.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    [<span class="i">Serializable</span>]
    <b>public class</b> <a id="2864fc2d24c87a5a" href="../../R/2864fc2d24c87a5a.html" target="n" data-glyph="0,0" class="t t">InvalidPowerShellStateException</a> : <span class="i">SystemException</span>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates a new instance of InvalidPowershellStateException class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public</b> <a id="0e6a4de04218a8c8" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="t constructor">InvalidPowerShellStateException</a>()
        : <b>base</b>
        (<a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">PowerShellStrings</span>.<span class="i">InvalidPowerShellStateGeneral</span>))
        {
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates a new instance of InvalidPowershellStateException class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">message</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The error message that explains the reason for the exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public</b> <a id="cc19d6bea92f9797" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="t constructor">InvalidPowerShellStateException</a>(<b>string</b> <span id="r0 rd" class="r0 r">message</span>)
            : <b>base</b>(<span class="r0 r">message</span>)
        {
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates a new instance of InvalidPowershellStateException class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">message</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The error message that explains the reason for the exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r2 r">innerException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The exception that is the cause of the current exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public</b> <a id="950480513e987c2a" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="t constructor">InvalidPowerShellStateException</a>(<b>string</b> <span id="r1 rd" class="r1 r">message</span>, <span class="i">Exception</span> <span id="r2 rd" class="r2 r">innerException</span>)
            : <b>base</b>(<span class="r1 r">message</span>, <span class="r2 r">innerException</span>)
        {
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initializes a new instance of the InvalidPowerShellStateException and defines value of</span>
        <span class="c">///</span><span class="c"> CurrentState.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r3 r">currentState</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Current state of powershell.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal</b> <a id="bdb2839004600662" href="../../R/bdb2839004600662.html" target="n" data-glyph="74,1" class="t constructor">InvalidPowerShellStateException</a>(<a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a> <span id="r3 rd" class="r3 r">currentState</span>)
        : <b>base</b>
        (<a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">PowerShellStrings</span>.<span class="i">InvalidPowerShellStateGeneral</span>))
        {
            <a href="#e3f0212800465f2a" class="i field">_currState</a> = <span class="r3 r">currentState</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> ISerializable Members
 
        <span class="c">// No need to implement GetObjectData</span>
        <span class="c">// if all fields are static or [NonSerialized]</span>
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initializes a new instance of the InvalidPowerShellStateException</span>
        <span class="c">///</span><span class="c"> class with serialized data.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r4 r">info</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">SerializationInfo</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> that holds the serialized object</span>
        <span class="c">///</span><span class="c"> data about the exception being thrown.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r5 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">StreamingContext</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> that contains contextual information</span>
        <span class="c">///</span><span class="c"> about the source or destination.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>protected</b>
        <a id="ae250e3f64c57f14" href="../../R/../../0000000000.html" target="n" data-glyph="75,1" class="t constructor">InvalidPowerShellStateException</a>(<span class="i">SerializationInfo</span> <span id="r4 rd" class="r4 r">info</span>, <span class="i">StreamingContext</span> <span id="r5 rd" class="r5 r">context</span>)
        : <b>base</b>(<span class="r4 r">info</span>, <span class="r5 r">context</span>)
        {
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets CurrentState of the powershell.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public</b> <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a> <a id="4315e8a808732e44" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">CurrentState</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#e3f0212800465f2a" class="i field">_currState</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> State of powershell when exception was thrown.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">NonSerialized</span>]
        <b>private readonly</b> <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a> <a id="e3f0212800465f2a" href="../../R/e3f0212800465f2a.html" target="n" data-glyph="46,1" class="i field">_currState</a> = 0;
    }
 
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
    <span class="k preprocess">#</span><span class="k preprocess">region</span> PSInvocationState, PSInvocationStateInfo, PSInvocationStateChangedEventArgs
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Enumerated type defining the state of the PowerShell.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public enum</b> <a id="24cc37ccdc118b7a" href="../../R/24cc37ccdc118b7a.html" target="n" data-glyph="18,0" class="t t"><span id="9fca7d69ef27e08c">PSInvocationState</span></a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> PowerShell has not been started.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="3eb81f39bc769d16" href="../../R/3eb81f39bc769d16.html" target="n" data-glyph="24,1" class="i field">NotStarted</a> = 0,
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> PowerShell is executing.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="7142407e9e49cf13" href="../../R/7142407e9e49cf13.html" target="n" data-glyph="24,1" class="i field">Running</a> = 1,
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> PowerShell is stoping execution.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="a9d235bf0dc5bfce" href="../../R/a9d235bf0dc5bfce.html" target="n" data-glyph="24,1" class="i field">Stopping</a> = 2,
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> PowerShell is completed due to a stop request.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="6a6866e7df063875" href="../../R/6a6866e7df063875.html" target="n" data-glyph="24,1" class="i field">Stopped</a> = 3,
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> PowerShell has completed executing a command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="89ec15a2a933a2b6" href="../../R/89ec15a2a933a2b6.html" target="n" data-glyph="24,1" class="i field">Completed</a> = 4,
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> PowerShell completed abnormally due to an error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="35065a8449cad351" href="../../R/35065a8449cad351.html" target="n" data-glyph="24,1" class="i field">Failed</a> = 5,
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> PowerShell is in disconnected state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="55f5ed5d1c0f010a" href="../../R/55f5ed5d1c0f010a.html" target="n" data-glyph="24,1" class="i field">Disconnected</a> = 6
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Enumerated type defining runspace modes for nested pipeline.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public enum</b> <a id="c3c0f0e5e0b337ff" href="../../R/c3c0f0e5e0b337ff.html" target="n" data-glyph="18,0" class="t t"><span id="cd828298bfa80c12">RunspaceMode</span></a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Use current runspace from the current thread of execution.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="75d224de5df87e75" href="../../R/75d224de5df87e75.html" target="n" data-glyph="24,1" class="i field">CurrentRunspace</a> = 0,
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Create new runspace.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="f68a3ef57e70938e" href="../../R/f68a3ef57e70938e.html" target="n" data-glyph="24,1" class="i field">NewRunspace</a> = 1
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Type which has information about InvocationState and Exception</span>
    <span class="c">///</span><span class="c"> associated with InvocationState.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public sealed class</b> <a id="42e325836d1ae967" href="../../R/42e325836d1ae967.html" target="n" data-glyph="0,0" class="t t">PSInvocationStateInfo</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Constructors
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Constructor for state changes with an optional error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r6 r">state</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The new state.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r7 r">reason</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A non-null exception if the state change was</span>
        <span class="c">///</span><span class="c"> caused by an error,otherwise; null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal</b> <a id="db44bd87590c83f5" href="../../R/db44bd87590c83f5.html" target="n" data-glyph="74,1" class="t constructor">PSInvocationStateInfo</a>(<a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a> <span id="r6 rd" class="r6 r">state</span>, <span class="i">Exception</span> <span id="r7 rd" class="r7 r">reason</span>)
        {
            <a href="#d8634fff446712ad" class="i field">_executionState</a> = <span class="r6 r">state</span>;
            <a href="#571871ab4a134f60" class="i field">_exceptionReason</a> = <span class="r7 r">reason</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Construct from PipelineStateInfo.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r8 r">pipelineStateInfo</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal</b> <a id="206b687af8893d07" href="../../R/206b687af8893d07.html" target="n" data-glyph="74,1" class="t constructor">PSInvocationStateInfo</a>(<a href="Pipeline.cs.html#62fb09153673bbf3" class="t t">PipelineStateInfo</a> <span id="r8 rd" class="r8 r">pipelineStateInfo</span>)
        {
            <a href="#d8634fff446712ad" class="i field">_executionState</a> = (<a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>)((<b>int</b>)<span class="r8 r">pipelineStateInfo</span>.<a href="Pipeline.cs.html#2589f8c7203969a0" class="i property">State</a>);
            <a href="#571871ab4a134f60" class="i field">_exceptionReason</a> = <span class="r8 r">pipelineStateInfo</span>.<a href="Pipeline.cs.html#abf480477d10c9b4" class="i property">Reason</a>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Public Properties
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The state of the PowerShell instance.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>public</b> <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a> <a id="7a70ff5163d0f044" href="../../R/7a70ff5163d0f044.html" target="n" data-glyph="102,1" class="i property">State</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#d8634fff446712ad" class="i field">_executionState</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The reason for the state change, if caused by an error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The value of this property is non-null if the state</span>
        <span class="c">///</span><span class="c"> changed due to an error. Otherwise, the value of this</span>
        <span class="c">///</span><span class="c"> property is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>public</b> <span class="i">Exception</span> <a id="5e4f678af21908e8" href="../../R/5e4f678af21908e8.html" target="n" data-glyph="102,1" class="i property">Reason</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#571871ab4a134f60" class="i field">_exceptionReason</a>;
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Clone the current instance.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A copy of the current instance.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal</b> <a href="#42e325836d1ae967" class="t t">PSInvocationStateInfo</a> <a id="919d0448ea5bf72b" href="../../R/919d0448ea5bf72b.html" target="n" data-glyph="74,1" class="i method">Clone</a>()
        {
            <b>return</b> <b>new</b> <a href="#db44bd87590c83f5" class="t constructor">PSInvocationStateInfo</a>(
                <a href="#d8634fff446712ad" class="i field">_executionState</a>,
                <a href="#571871ab4a134f60" class="i field">_exceptionReason</a>
                );
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Private data
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The current execution state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private readonly</b> <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a> <a id="d8634fff446712ad" href="../../R/d8634fff446712ad.html" target="n" data-glyph="46,1" class="i field">_executionState</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Non-null exception if the execution state change was due to an error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private readonly</b> <span class="i">Exception</span> <a id="571871ab4a134f60" href="../../R/571871ab4a134f60.html" target="n" data-glyph="46,1" class="i field">_exceptionReason</a>;
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Event arguments passed to PowerShell state change handlers</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#3d1b346df3be574c" class="t t">PowerShell</a>.<a href="#c66682d1287920a2" class="i">InvocationStateChanged</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> event.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public sealed class</b> <a id="b125d9adbaf88d43" href="../../R/b125d9adbaf88d43.html" target="n" data-glyph="0,0" class="t t">PSInvocationStateChangedEventArgs</a> : <span class="i">EventArgs</span>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Constructors
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Constructs PSInvocationStateChangedEventArgs from PSInvocationStateInfo.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r9 r">psStateInfo</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> state to raise the event with.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal</b> <a id="1cce13d92ef2a0ac" href="../../R/1cce13d92ef2a0ac.html" target="n" data-glyph="74,1" class="t constructor">PSInvocationStateChangedEventArgs</a>(<a href="#42e325836d1ae967" class="t t">PSInvocationStateInfo</a> <span id="r9 rd" class="r9 r">psStateInfo</span>)
        {
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r9 r">psStateInfo</span> != <b>null</b>, <span class="s">&quot;caller should validate the parameter&quot;</span>);
            <a href="#7ec9f6a06e861118" class="i property">InvocationStateInfo</a> = <span class="r9 r">psStateInfo</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Public Properties
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Information about current state of a PowerShell Instance.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public</b> <a href="#42e325836d1ae967" class="t t">PSInvocationStateInfo</a> <a id="7ec9f6a06e861118" href="../../R/7ec9f6a06e861118.html" target="n" data-glyph="102,1" class="i property">InvocationStateInfo</a> { <b>get</b>; }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
    }
 
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Settings to control command invocation.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public sealed class</b> <a id="ce65c0834aa6f0ea" href="../../R/ce65c0834aa6f0ea.html" target="n" data-glyph="0,0" class="t t">PSInvocationSettings</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Private Fields
 
        <b>private</b> <a href="MshHost.cs.html#7b79cd90e035740e" class="t t">PSHost</a> <a id="fe5009060ab6c033" href="../../R/fe5009060ab6c033.html" target="n" data-glyph="46,1" class="i field">_host</a>;
 
        <span class="c">// the following are used to flow the identity to pipeline execution thread</span>
 
        <span class="c">// Invokes a remote command and immediately disconnects, if transport layer</span>
        <span class="c">// supports this operation.</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Constructors
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Default Constructor.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public</b> <a id="3f472392b2d45c15" href="../../R/3f472392b2d45c15.html" target="n" data-glyph="72,1" class="t constructor">PSInvocationSettings</a>()
        {
            <a href="#ce65c0834aa6f0ea" class="k">this</a>.<a href="#2b73a864082de936" class="i property">ApartmentState</a> = <a href="#2b73a864082de936" class="i property">ApartmentState</a>.<span class="i">Unknown</span>;
            <a href="#fe5009060ab6c033" class="i field">_host</a> = <b>null</b>;
            <a href="#87c2af0d02ef881f" class="i property">RemoteStreamOptions</a> = 0;
            <a href="#27a80b1485d6fbda" class="i property">AddToHistory</a> = <b>false</b>;
            <a href="#648c685f4b558fd3" class="i property">ErrorActionPreference</a> = <b>null</b>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> ApartmentState of the thread in which the command</span>
        <span class="c">///</span><span class="c"> is executed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public</b> <span class="i">ApartmentState</span> <a id="2b73a864082de936" href="../../R/2b73a864082de936.html" target="n" data-glyph="102,1" class="i property">ApartmentState</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Host to use with the Runspace when the command is</span>
        <span class="c">///</span><span class="c"> executed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public</b> <a href="MshHost.cs.html#7b79cd90e035740e" class="t t">PSHost</a> <a id="2088d9ba09399d1e" href="../../R/2088d9ba09399d1e.html" target="n" data-glyph="102,1" class="i property">Host</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#fe5009060ab6c033" class="i field">_host</a>;
            }
 
            <b>set</b>
            {
                <b>if</b> (<b>value</b> == <b>null</b>)
                {
                    <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<span class="s">&quot;Host&quot;</span>);
                }
 
                <a href="#fe5009060ab6c033" class="i field">_host</a> = <b>value</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Options for the Error, Warning, Verbose and Debug streams during remote calls.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public</b> <a href="#3a466dc47c692c8e" class="t t">RemoteStreamOptions</a> <a id="87c2af0d02ef881f" href="../../R/87c2af0d02ef881f.html" target="n" data-glyph="102,1" class="i property">RemoteStreamOptions</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Boolean which tells if the command is added to the history of the</span>
        <span class="c">///</span><span class="c"> Runspace the command is executing in. By default this is false.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public bool</b> <a id="27a80b1485d6fbda" href="../../R/27a80b1485d6fbda.html" target="n" data-glyph="102,1" class="i property">AddToHistory</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Determines how errors should be handled during batch command execution.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public</b> <a href="../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>? <a id="648c685f4b558fd3" href="../../R/648c685f4b558fd3.html" target="n" data-glyph="102,1" class="i property">ErrorActionPreference</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Used by Powershell remoting infrastructure to flow identity from calling thread to</span>
        <span class="c">///</span><span class="c"> Pipeline Execution Thread.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Scenario: In the IIS hosting model, the calling thread is impersonated with a different</span>
        <span class="c">///</span><span class="c"> identity than the process identity. However Pipeline Execution Thread always inherits</span>
        <span class="c">///</span><span class="c"> process&#39;s identity and this will create problems related to security. In the IIS hosting</span>
        <span class="c">///</span><span class="c"> model, we should honor calling threads identity.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>public bool</b> <a id="265dd5f8987b7aa1" href="../../R/265dd5f8987b7aa1.html" target="n" data-glyph="102,1" class="i property">FlowImpersonationPolicy</a> { <b>get</b>; <b>set</b>; }
 
        <b>internal</b> <span class="i n">System</span>.<span class="i">Security</span>.<span class="i">Principal</span>.<span class="i">WindowsIdentity</span> <a id="bd693521a0dc1cee" href="../../R/bd693521a0dc1cee.html" target="n" data-glyph="104,1" class="i property">WindowsIdentityToImpersonate</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> When true, allows an unhandled flow control exceptions to</span>
        <span class="c">///</span><span class="c"> propagate to a caller invoking the PowerShell object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public bool</b> <a id="d00e44d52ca41381" href="../../R/d00e44d52ca41381.html" target="n" data-glyph="102,1" class="i property">ExposeFlowControlExceptions</a>
        {
            <b>get</b>;
            <b>set</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invokes a remote command and immediately disconnects, if the transport</span>
        <span class="c">///</span><span class="c"> layer supports this operation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="14c829f9d290d4cc" href="../../R/14c829f9d290d4cc.html" target="n" data-glyph="104,1" class="i property">InvokeAndDisconnect</a> { <b>get</b>; <b>set</b>; }
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Batch execution context.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal class</b> <a id="af059b37dfbedbfb" href="../../R/af059b37dfbedbfb.html" target="n" data-glyph="2,0" class="t t">BatchInvocationContext</a>
    {
        <b>private readonly</b> <span class="i">AutoResetEvent</span> <a id="8049f304f5b53d0f" href="../../R/8049f304f5b53d0f.html" target="n" data-glyph="46,1" class="i field">_completionEvent</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Class constructor.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r10 r">command</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r11 r">output</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal</b> <a id="9a6488f8a55237c1" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="t constructor">BatchInvocationContext</a>(<a href="PSCommand.cs.html#b9f024f73904cf55" class="t t">PSCommand</a> <span id="r10 rd" class="r10 r">command</span>, <a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r11 rd" class="r11 r">output</span>)
        {
            <a href="#770307ebce29365b" class="i property">Command</a> = <span class="r10 r">command</span>;
            <a href="#e0f6b091d2baafbf" class="i property">Output</a> = <span class="r11 r">output</span>;
            <a href="#8049f304f5b53d0f" class="i field">_completionEvent</a> = <b>new</b> <span class="i">AutoResetEvent</span>(<b>false</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invocation output.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <a id="e0f6b091d2baafbf" href="../../R/e0f6b091d2baafbf.html" target="n" data-glyph="104,1" class="i property">Output</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Command to invoke.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="PSCommand.cs.html#b9f024f73904cf55" class="t t">PSCommand</a> <a id="770307ebce29365b" href="../../R/770307ebce29365b.html" target="n" data-glyph="104,1" class="i property">Command</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Waits for the completion event.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="8fe725abeecbf495" href="../../R/8fe725abeecbf495.html" target="n" data-glyph="74,1" class="i method">Wait</a>()
        {
            <a href="#8049f304f5b53d0f" class="i field">_completionEvent</a>.<span class="i">WaitOne</span>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Signals the completion event.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="1369aefa0184a77f" href="../../R/1369aefa0184a77f.html" target="n" data-glyph="74,1" class="i method">Signal</a>()
        {
            <a href="#8049f304f5b53d0f" class="i field">_completionEvent</a>.<span class="i">Set</span>();
        }
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> These flags control whether InvocationInfo is added to items in the Error, Warning, Verbose and Debug</span>
    <span class="c">///</span><span class="c"> streams during remote calls.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    [<span class="i">Flags</span>]
    <b>public enum</b> <a id="3a466dc47c692c8e" href="../../R/3a466dc47c692c8e.html" target="n" data-glyph="18,0" class="t t"><span id="405f205f5a64e4d2">RemoteStreamOptions</span></a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If this flag is set, ErrorRecord will include an instance of InvocationInfo on remote calls.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="3c8f9d90815b10d6" href="../../R/3c8f9d90815b10d6.html" target="n" data-glyph="24,1" class="i field">AddInvocationInfoToErrorRecord</a> = 0x01,
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If this flag is set, WarningRecord will include an instance of InvocationInfo on remote calls.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="6ca41fa7db493957" href="../../R/6ca41fa7db493957.html" target="n" data-glyph="24,1" class="i field">AddInvocationInfoToWarningRecord</a> = 0x02,
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If this flag is set, DebugRecord will include an instance of InvocationInfo on remote calls.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="a7f1a5d0154feae0" href="../../R/a7f1a5d0154feae0.html" target="n" data-glyph="24,1" class="i field">AddInvocationInfoToDebugRecord</a> = 0x04,
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If this flag is set, VerboseRecord will include an instance of InvocationInfo on remote calls.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="8322dcc5699dda06" href="../../R/8322dcc5699dda06.html" target="n" data-glyph="24,1" class="i field">AddInvocationInfoToVerboseRecord</a> = 0x08,
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If this flag is set, ErrorRecord, WarningRecord, DebugRecord, and VerboseRecord will include an instance of InvocationInfo on remote calls.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="4d6d0ddb7d2d677d" href="../../R/4d6d0ddb7d2d677d.html" target="n" data-glyph="24,1" class="i field">AddInvocationInfo</a> = <a href="#3c8f9d90815b10d6" class="i field">AddInvocationInfoToErrorRecord</a>
                          | <a href="#6ca41fa7db493957" class="i field">AddInvocationInfoToWarningRecord</a>
                          | <a href="#a7f1a5d0154feae0" class="i field">AddInvocationInfoToDebugRecord</a>
                          | <a href="#8322dcc5699dda06" class="i field">AddInvocationInfoToVerboseRecord</a>
    }
 
    <span class="k preprocess">#</span><span class="k preprocess">region</span> PowerShell AsyncResult
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Internal Async result type used by BeginInvoke() and BeginStop() overloads.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal sealed class</b> <a id="ba11495f3db79edb" href="../../R/ba11495f3db79edb.html" target="n" data-glyph="2,0" class="t t">PowerShellAsyncResult</a> : <a href="AsyncResult.cs.html#f0fde6334f2a46e1" class="t t">AsyncResult</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Private Data / Properties
 
        <span class="c">// used to track if this AsyncResult is created by a BeginInvoke operation or</span>
        <span class="c">// a BeginStop operation.</span>
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> True if AsyncResult monitors Async BeginInvoke().</span>
        <span class="c">///</span><span class="c"> false otherwise.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="36fee7e835a131cc" href="../../R/36fee7e835a131cc.html" target="n" data-glyph="104,1" class="i property">IsAssociatedWithAsyncInvoke</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The output buffer for the asynchronous invoke.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <a id="df0dcbcd9acb5c6c" href="../../R/df0dcbcd9acb5c6c.html" target="n" data-glyph="104,1" class="i property">Output</a> { <b>get</b>; }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Constructor
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Constructor.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r12 r">ownerId</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Instance Id of the Powershell object creating this instance</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r13 r">callback</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Callback to call when the async operation completes.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r14 r">state</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A user supplied state to call the &quot;callback&quot; with.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r15 r">output</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The output buffer to return from EndInvoke.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r16 r">isCalledFromBeginInvoke</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> true if AsyncResult monitors BeginInvoke.</span>
        <span class="c">///</span><span class="c"> false otherwise</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal</b> <a id="a573e20febced368" href="../../R/a573e20febced368.html" target="n" data-glyph="74,1" class="t constructor">PowerShellAsyncResult</a>(<span class="i">Guid</span> <span id="r12 rd" class="r12 r">ownerId</span>, <span class="i">AsyncCallback</span> <span id="r13 rd" class="r13 r">callback</span>, <b>object</b> <span id="r14 rd" class="r14 r">state</span>, <a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r15 rd" class="r15 r">output</span>,
            <b>bool</b> <span id="r16 rd" class="r16 r">isCalledFromBeginInvoke</span>)
            : <a href="AsyncResult.cs.html#c77594c9ea75fa31" class="k">base</a>(<span class="r12 r">ownerId</span>, <span class="r13 r">callback</span>, <span class="r14 r">state</span>)
        {
            <a href="#36fee7e835a131cc" class="i property">IsAssociatedWithAsyncInvoke</a> = <span class="r16 r">isCalledFromBeginInvoke</span>;
            <a href="#df0dcbcd9acb5c6c" class="i property">Output</a> = <span class="r15 r">output</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
    }
 
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Represents a PowerShell command or script to execute against a</span>
    <span class="c">///</span><span class="c"> Runspace(Pool) if provided, otherwise execute using a default</span>
    <span class="c">///</span><span class="c"> Runspace. Provides access to different result buffers</span>
    <span class="c">///</span><span class="c"> like output, error, debug, verbose, progress, warning, and information.</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c"> Provides a simple interface to execute a powershell command:</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">code</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c">    Powershell.Create().AddScript(&quot;get-process&quot;).Invoke();</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">code</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> The above statement creates a local runspace using default</span>
    <span class="c">///</span><span class="c"> configuration, executes the command and then closes the runspace.</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c"> Using RunspacePool property, the caller can provide the runspace</span>
    <span class="c">///</span><span class="c"> where the command / script is executed.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Naming&quot;</span>, <span class="s">&quot;CA1724:TypeNamesShouldNotMatchNamespaces&quot;</span>, <span class="i">Justification</span> = <span class="s">&quot;PowerShell is a valid type in SMAR namespace.&quot;</span>)]
    <b>public sealed class</b> <a id="3d1b346df3be574c" href="../../R/3d1b346df3be574c.html" target="n" data-glyph="0,0" class="t t">PowerShell</a> : <span class="i">IDisposable</span>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Private Fields
 
        <b>private</b> <a href="PSCommand.cs.html#b9f024f73904cf55" class="t t">PSCommand</a> <a id="f984c2b1a1646528" href="../../R/f984c2b1a1646528.html" target="n" data-glyph="46,1" class="i field">_psCommand</a>;
        <span class="c">// worker object which does the invoke</span>
        <b>private</b> <a href="#436f456ebe703274" class="t t">Worker</a> <a id="1389234891e6cc36" href="../../R/1389234891e6cc36.html" target="n" data-glyph="46,1" class="i field">_worker</a>;
        <b>private</b> <a href="#ba11495f3db79edb" class="t t">PowerShellAsyncResult</a> <a id="aa2e4c96efcd9075" href="../../R/aa2e4c96efcd9075.html" target="n" data-glyph="46,1" class="i field">_invokeAsyncResult</a>;
        <b>private</b> <a href="#ba11495f3db79edb" class="t t">PowerShellAsyncResult</a> <a id="c48e6ad54262904d" href="../../R/c48e6ad54262904d.html" target="n" data-glyph="46,1" class="i field">_stopAsyncResult</a>;
        <b>private</b> <a href="#ba11495f3db79edb" class="t t">PowerShellAsyncResult</a> <a id="23fe95e8a4f70ff4" href="../../R/23fe95e8a4f70ff4.html" target="n" data-glyph="46,1" class="i field">_batchAsyncResult</a>;
        <b>private</b> <a href="#ce65c0834aa6f0ea" class="t t">PSInvocationSettings</a> <a id="55501b58ae0e59d6" href="../../R/55501b58ae0e59d6.html" target="n" data-glyph="46,1" class="i field">_batchInvocationSettings</a>;
        <b>private</b> <a href="PSCommand.cs.html#b9f024f73904cf55" class="t t">PSCommand</a> <a id="ee03a037962ee4ad" href="../../R/ee03a037962ee4ad.html" target="n" data-glyph="46,1" class="i field">_backupPSCommand</a>;
        <b>private object</b> <a id="ccb6c738e7f3c724" href="../../R/ccb6c738e7f3c724.html" target="n" data-glyph="46,1" class="i field">_rsConnection</a>;
 
        <b>private</b> <a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a>&gt; <a id="6b0cd6330b1f780f" href="../../R/6b0cd6330b1f780f.html" target="n" data-glyph="46,1" class="i field">_errorBuffer</a>;
 
        <b>private bool</b> <a id="30ab918a4484ceaa" href="../../R/30ab918a4484ceaa.html" target="n" data-glyph="46,1" class="i field">_isDisposed</a>;
        <b>private readonly object</b> <a id="57ad56a0d8f83c43" href="../../R/57ad56a0d8f83c43.html" target="n" data-glyph="46,1" class="i field">_syncObject</a> = <b>new</b> <b>object</b>();
 
        <span class="c">// client remote powershell if the powershell</span>
        <span class="c">// is executed with a remote runspace pool</span>
 
        <b>private</b> <a href="../remoting/client/RemoteRunspacePoolInternal.cs.html#b586ca980bfda5bc" class="t t">ConnectCommandInfo</a> <a id="1462181f6b1205aa" href="../../R/1462181f6b1205aa.html" target="n" data-glyph="46,1" class="i field">_connectCmdInfo</a>;
        <b>private bool</b> <a id="e9453081966ac388" href="../../R/e9453081966ac388.html" target="n" data-glyph="46,1" class="i field">_commandInvokedSynchronously</a> = <b>false</b>;
        <b>private bool</b> <a id="b3c8b30fb7648387" href="../../R/b3c8b30fb7648387.html" target="n" data-glyph="46,1" class="i field">_isBatching</a> = <b>false</b>;
        <b>private bool</b> <a id="20bc91cc1e81ae6e" href="../../R/20bc91cc1e81ae6e.html" target="n" data-glyph="46,1" class="i field">_stopBatchExecution</a> = <b>false</b>;
 
        <span class="c">// Delegates for asynchronous invocation/termination of PowerShell commands</span>
        <b>private readonly</b> <span class="i">Func</span>&lt;<span class="i">IAsyncResult</span>, <a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;&gt; <a id="e23dd5fd75a4bfb2" href="../../R/e23dd5fd75a4bfb2.html" target="n" data-glyph="46,1" class="i field">_endInvokeMethod</a>;
        <b>private readonly</b> <span class="i">Action</span>&lt;<span class="i">IAsyncResult</span>&gt; <a id="5af65affd7010570" href="../../R/5af65affd7010570.html" target="n" data-glyph="46,1" class="i field">_endStopMethod</a>;
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Internal Constructors
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Constructs PowerShell.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r17 r">command</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A PSCommand.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r18 r">extraCommands</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A list of extra commands to run</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r19 r">rsConnection</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A Runspace or RunspacePool to refer while invoking the command.</span>
        <span class="c">///</span><span class="c"> This can be null in which case a new runspace is created</span>
        <span class="c">///</span><span class="c"> whenever Invoke* method is called.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private</b> <a id="ff10480e08f047ec" href="../../R/ff10480e08f047ec.html" target="n" data-glyph="76,1" class="t constructor">PowerShell</a>(<a href="PSCommand.cs.html#b9f024f73904cf55" class="t t">PSCommand</a> <span id="r17 rd" class="r17 r">command</span>, <span class="i">Collection</span>&lt;<a href="PSCommand.cs.html#b9f024f73904cf55" class="t t">PSCommand</a>&gt; <span id="r18 rd" class="r18 r">extraCommands</span>, <b>object</b> <span id="r19 rd" class="r19 r">rsConnection</span>)
        {
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r17 r">command</span> != <b>null</b>, <span class="s">&quot;command must not be null&quot;</span>);
            <a href="#4cfb6cc82eb60c86" class="i property">ExtraCommands</a> = <span class="r18 r">extraCommands</span> ?? <b>new</b> <span class="i">Collection</span>&lt;<a href="PSCommand.cs.html#b9f024f73904cf55" class="t t">PSCommand</a>&gt;();
            <a href="#90e4778239a93806" class="i property">RunningExtraCommands</a> = <b>false</b>;
            <a href="#f984c2b1a1646528" class="i field">_psCommand</a> = <span class="r17 r">command</span>;
            <a href="#f984c2b1a1646528" class="i field">_psCommand</a>.<a href="PSCommand.cs.html#c72d40210220cf60" class="i property">Owner</a> = <a href="#3d1b346df3be574c" class="k">this</a>;
            <a href="../remoting/client/remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a> <span id="r20 rd" class="r20 r">remoteRunspace</span> = <span class="r19 r">rsConnection</span> <b>as</b> <a href="../remoting/client/remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a>;
            <a href="#ccb6c738e7f3c724" class="i field">_rsConnection</a> = <span class="r20 r">remoteRunspace</span> != <b>null</b> ? <span class="r20 r">remoteRunspace</span>.<a href="../remoting/client/remoterunspace.cs.html#52e4a4fcfd3da6a7" class="i property">RunspacePool</a> : <span class="r19 r">rsConnection</span>;
            <a href="#d8c9867186529e49" class="i property">InstanceId</a> = <span class="i">Guid</span>.<span class="i">NewGuid</span>();
            <a href="#39b81acd3aeb1582" class="i property">InvocationStateInfo</a> = <b>new</b> <a href="#db44bd87590c83f5" class="t constructor">PSInvocationStateInfo</a>(<a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#3eb81f39bc769d16" class="i field">NotStarted</a>, <b>null</b>);
            <a href="#a29e9daed047bb39" class="i property">OutputBuffer</a> = <b>null</b>;
            <a href="#06852585cb89a70d" class="i property">OutputBufferOwner</a> = <b>true</b>;
            <a href="#6b0cd6330b1f780f" class="i field">_errorBuffer</a> = <b>new</b> <a href="PSDataCollection.cs.html#ee85ce3306fe4e5b" class="t constructor">PSDataCollection</a>&lt;<a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a>&gt;();
            <a href="#f2d4fd7d6657647d" class="i property">ErrorBufferOwner</a> = <b>true</b>;
            <a href="#4bb26ab73ebaa6ca" class="i property">InformationalBuffers</a> = <b>new</b> <a href="PSDataCollection.cs.html#ebe3771b7babbbec" class="t constructor">PSInformationalBuffers</a>(<a href="#d8c9867186529e49" class="i property">InstanceId</a>);
            <a href="#622ebeade9b6ada7" class="i property">Streams</a> = <b>new</b> <a href="#8da2a8137e63a66b" class="t constructor">PSDataStreams</a>(<a href="#3d1b346df3be574c" class="k">this</a>);
            <a href="#e23dd5fd75a4bfb2" class="i field">_endInvokeMethod</a> = <span class="i">EndInvoke</span>;
            <a href="#5af65affd7010570" class="i field">_endStopMethod</a> = <span class="i">EndStop</span>;
            <a href="../../utils/Telemetry.cs.html#9832071d08aec551" class="t t">ApplicationInsightsTelemetry</a>.<a href="../../utils/Telemetry.cs.html#a7904dd2d0082ac3" class="i method">SendTelemetryMetric</a>(<a href="../../utils/Telemetry.cs.html#3951f46d9ee8c91d" class="t t">TelemetryType</a>.<a href="../../utils/Telemetry.cs.html#463b1bedf5979814" class="i field">PowerShellCreate</a>, <span class="s">&quot;create&quot;</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Constructs a PowerShell instance in the disconnected start state with</span>
        <span class="c">///</span><span class="c"> the provided remote command connect information and runspace(pool) objects.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r21 r">connectCmdInfo</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Remote command connect information.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r22 r">rsConnection</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Remote Runspace or RunspacePool object.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal</b> <a id="9d89b3548a1395c2" href="../../R/9d89b3548a1395c2.html" target="n" data-glyph="74,1" class="t constructor">PowerShell</a>(<a href="../remoting/client/RemoteRunspacePoolInternal.cs.html#b586ca980bfda5bc" class="t t">ConnectCommandInfo</a> <span id="r21 rd" class="r21 r">connectCmdInfo</span>, <b>object</b> <span id="r22 rd" class="r22 r">rsConnection</span>)
            : <a href="#ff10480e08f047ec" class="k">this</a>(<b>new</b> <a href="PSCommand.cs.html#45c724f1a0c9f07a" class="t constructor">PSCommand</a>(), <b>null</b>, <span class="r22 r">rsConnection</span>)
        {
            <a href="#4cfb6cc82eb60c86" class="i property">ExtraCommands</a> = <b>new</b> <span class="i">Collection</span>&lt;<a href="PSCommand.cs.html#b9f024f73904cf55" class="t t">PSCommand</a>&gt;();
            <a href="#90e4778239a93806" class="i property">RunningExtraCommands</a> = <b>false</b>;
            <a href="#9cc79c297f6cced9" class="i method">AddCommand</a>(<span class="r21 r">connectCmdInfo</span>.<a href="../remoting/client/RemoteRunspacePoolInternal.cs.html#059b4cc2a74508e2" class="i property">Command</a>);
            <a href="#1462181f6b1205aa" class="i field">_connectCmdInfo</a> = <span class="r21 r">connectCmdInfo</span>;
 
            <span class="c">// The command ID is passed to the PSRP layer through the PowerShell instanceID.</span>
            <a href="#d8c9867186529e49" class="i property">InstanceId</a> = <a href="#1462181f6b1205aa" class="i field">_connectCmdInfo</a>.<a href="../remoting/client/RemoteRunspacePoolInternal.cs.html#1060192c0e7cff3a" class="i property">CommandId</a>;
 
            <a href="#39b81acd3aeb1582" class="i property">InvocationStateInfo</a> = <b>new</b> <a href="#db44bd87590c83f5" class="t constructor">PSInvocationStateInfo</a>(<a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#55f5ed5d1c0f010a" class="i field">Disconnected</a>, <b>null</b>);
 
            <b>if</b> (<span class="r22 r">rsConnection</span> <b>is</b> <a href="../remoting/client/remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a>)
            {
                <a href="#d6487a2f72366731" class="i field">_runspace</a> = <span class="r22 r">rsConnection</span> <b>as</b> <a href="Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a>;
                <a href="#fc0d3bf33e2b1469" class="i field">_runspacePool</a> = ((<a href="../remoting/client/remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a>)<span class="r22 r">rsConnection</span>).<a href="../remoting/client/remoterunspace.cs.html#52e4a4fcfd3da6a7" class="i property">RunspacePool</a>;
            }
            <b>else</b> <b>if</b> (<span class="r22 r">rsConnection</span> <b>is</b> <a href="RunspacePool.cs.html#c1948c2f22e6b527" class="t t">RunspacePool</a>)
            {
                <a href="#fc0d3bf33e2b1469" class="i field">_runspacePool</a> = (<a href="RunspacePool.cs.html#c1948c2f22e6b527" class="t t">RunspacePool</a>)<span class="r22 r">rsConnection</span>;
            }
 
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<a href="#fc0d3bf33e2b1469" class="i field">_runspacePool</a> != <b>null</b>, <span class="s">&quot;Invalid rsConnection parameter&gt;&quot;</span>);
            <a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a> = <b>new</b> <a href="../remoting/client/ClientRemotePowerShell.cs.html#963057b3fa7868fe" class="t constructor">ClientRemotePowerShell</a>(<a href="#3d1b346df3be574c" class="k">this</a>, <a href="#fc0d3bf33e2b1469" class="i field">_runspacePool</a>.<a href="RunspacePool.cs.html#ae1c1c4ae8a5c648" class="i property">RemoteRunspacePoolInternal</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r23 r">inputstream</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r24 r">outputstream</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r25 r">errorstream</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r26 r">runspacePool</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal</b> <a id="44ab5d75dd516996" href="../../R/44ab5d75dd516996.html" target="n" data-glyph="74,1" class="t constructor">PowerShell</a>(<a href="../../utils/ObjectStream.cs.html#27e9349816faeecb" class="t t">ObjectStreamBase</a> <span id="r23 rd" class="r23 r">inputstream</span>,
            <a href="../../utils/ObjectStream.cs.html#27e9349816faeecb" class="t t">ObjectStreamBase</a> <span id="r24 rd" class="r24 r">outputstream</span>, <a href="../../utils/ObjectStream.cs.html#27e9349816faeecb" class="t t">ObjectStreamBase</a> <span id="r25 rd" class="r25 r">errorstream</span>, <a href="RunspacePool.cs.html#c1948c2f22e6b527" class="t t">RunspacePool</a> <span id="r26 rd" class="r26 r">runspacePool</span>)
        {
            <a href="#4cfb6cc82eb60c86" class="i property">ExtraCommands</a> = <b>new</b> <span class="i">Collection</span>&lt;<a href="PSCommand.cs.html#b9f024f73904cf55" class="t t">PSCommand</a>&gt;();
            <a href="#90e4778239a93806" class="i property">RunningExtraCommands</a> = <b>false</b>;
            <a href="#ccb6c738e7f3c724" class="i field">_rsConnection</a> = <span class="r26 r">runspacePool</span>;
            <a href="#d8c9867186529e49" class="i property">InstanceId</a> = <span class="i">Guid</span>.<span class="i">NewGuid</span>();
            <a href="#39b81acd3aeb1582" class="i property">InvocationStateInfo</a> = <b>new</b> <a href="#db44bd87590c83f5" class="t constructor">PSInvocationStateInfo</a>(<a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#3eb81f39bc769d16" class="i field">NotStarted</a>, <b>null</b>);
            <a href="#4bb26ab73ebaa6ca" class="i property">InformationalBuffers</a> = <b>new</b> <a href="PSDataCollection.cs.html#ebe3771b7babbbec" class="t constructor">PSInformationalBuffers</a>(<a href="#d8c9867186529e49" class="i property">InstanceId</a>);
            <a href="#622ebeade9b6ada7" class="i property">Streams</a> = <b>new</b> <a href="#8da2a8137e63a66b" class="t constructor">PSDataStreams</a>(<a href="#3d1b346df3be574c" class="k">this</a>);
 
            <a href="../../utils/ObjectStream.cs.html#7277ae0921f30c7a" class="t t">PSDataCollectionStream</a>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r27 rd" class="r27 r">outputdatastream</span> = (<a href="../../utils/ObjectStream.cs.html#7277ae0921f30c7a" class="t t">PSDataCollectionStream</a>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;)<span class="r24 r">outputstream</span>;
            <a href="#a29e9daed047bb39" class="i property">OutputBuffer</a> = <span class="r27 r">outputdatastream</span>.<a href="../../utils/ObjectStream.cs.html#a9e2d90ab43caced" class="i property">ObjectStore</a>;
 
            <a href="../../utils/ObjectStream.cs.html#7277ae0921f30c7a" class="t t">PSDataCollectionStream</a>&lt;<a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a>&gt; <span id="r28 rd" class="r28 r">errordatastream</span> = (<a href="../../utils/ObjectStream.cs.html#7277ae0921f30c7a" class="t t">PSDataCollectionStream</a>&lt;<a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a>&gt;)<span class="r25 r">errorstream</span>;
            <a href="#6b0cd6330b1f780f" class="i field">_errorBuffer</a> = <span class="r28 r">errordatastream</span>.<a href="../../utils/ObjectStream.cs.html#a9e2d90ab43caced" class="i property">ObjectStore</a>;
 
            <b>if</b> (<span class="r26 r">runspacePool</span> != <b>null</b> &amp;&amp; <span class="r26 r">runspacePool</span>.<a href="RunspacePool.cs.html#ae1c1c4ae8a5c648" class="i property">RemoteRunspacePoolInternal</a> != <b>null</b>)
            {
                <a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a> = <b>new</b> <a href="../remoting/client/ClientRemotePowerShell.cs.html#963057b3fa7868fe" class="t constructor">ClientRemotePowerShell</a>(<a href="#3d1b346df3be574c" class="k">this</a>, <span class="r26 r">runspacePool</span>.<a href="RunspacePool.cs.html#ae1c1c4ae8a5c648" class="i property">RemoteRunspacePoolInternal</a>);
            }
 
            <a href="#e23dd5fd75a4bfb2" class="i field">_endInvokeMethod</a> = <span class="i">EndInvoke</span>;
            <a href="#5af65affd7010570" class="i field">_endStopMethod</a> = <span class="i">EndStop</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates a PowerShell object in the disconnected start state and with a ConnectCommandInfo object</span>
        <span class="c">///</span><span class="c"> parameter that specifies what remote command to associate with this PowerShell when it is connected.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r29 r">connectCmdInfo</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r30 r">inputstream</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r31 r">outputstream</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r32 r">errorstream</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r33 r">runspacePool</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal</b> <a id="22790b23b927ed56" href="../../R/22790b23b927ed56.html" target="n" data-glyph="74,1" class="t constructor">PowerShell</a>(<a href="../remoting/client/RemoteRunspacePoolInternal.cs.html#b586ca980bfda5bc" class="t t">ConnectCommandInfo</a> <span id="r29 rd" class="r29 r">connectCmdInfo</span>, <a href="../../utils/ObjectStream.cs.html#27e9349816faeecb" class="t t">ObjectStreamBase</a> <span id="r30 rd" class="r30 r">inputstream</span>, <a href="../../utils/ObjectStream.cs.html#27e9349816faeecb" class="t t">ObjectStreamBase</a> <span id="r31 rd" class="r31 r">outputstream</span>,
            <a href="../../utils/ObjectStream.cs.html#27e9349816faeecb" class="t t">ObjectStreamBase</a> <span id="r32 rd" class="r32 r">errorstream</span>, <a href="RunspacePool.cs.html#c1948c2f22e6b527" class="t t">RunspacePool</a> <span id="r33 rd" class="r33 r">runspacePool</span>)
            : <a href="#44ab5d75dd516996" class="k">this</a>(<span class="r30 r">inputstream</span>, <span class="r31 r">outputstream</span>, <span class="r32 r">errorstream</span>, <span class="r33 r">runspacePool</span>)
        {
            <a href="#4cfb6cc82eb60c86" class="i property">ExtraCommands</a> = <b>new</b> <span class="i">Collection</span>&lt;<a href="PSCommand.cs.html#b9f024f73904cf55" class="t t">PSCommand</a>&gt;();
            <a href="#90e4778239a93806" class="i property">RunningExtraCommands</a> = <b>false</b>;
            <a href="#f984c2b1a1646528" class="i field">_psCommand</a> = <b>new</b> <a href="PSCommand.cs.html#45c724f1a0c9f07a" class="t constructor">PSCommand</a>();
            <a href="#f984c2b1a1646528" class="i field">_psCommand</a>.<a href="PSCommand.cs.html#c72d40210220cf60" class="i property">Owner</a> = <a href="#3d1b346df3be574c" class="k">this</a>;
            <a href="#fc0d3bf33e2b1469" class="i field">_runspacePool</a> = <span class="r33 r">runspacePool</span>;
 
            <a href="#9cc79c297f6cced9" class="i method">AddCommand</a>(<span class="r29 r">connectCmdInfo</span>.<a href="../remoting/client/RemoteRunspacePoolInternal.cs.html#059b4cc2a74508e2" class="i property">Command</a>);
            <a href="#1462181f6b1205aa" class="i field">_connectCmdInfo</a> = <span class="r29 r">connectCmdInfo</span>;
 
            <span class="c">// The command ID is passed to the PSRP layer through the PowerShell instanceID.</span>
            <a href="#d8c9867186529e49" class="i property">InstanceId</a> = <a href="#1462181f6b1205aa" class="i field">_connectCmdInfo</a>.<a href="../remoting/client/RemoteRunspacePoolInternal.cs.html#1060192c0e7cff3a" class="i property">CommandId</a>;
 
            <a href="#39b81acd3aeb1582" class="i property">InvocationStateInfo</a> = <b>new</b> <a href="#db44bd87590c83f5" class="t constructor">PSInvocationStateInfo</a>(<a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#55f5ed5d1c0f010a" class="i field">Disconnected</a>, <b>null</b>);
 
            <a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a> = <b>new</b> <a href="../remoting/client/ClientRemotePowerShell.cs.html#963057b3fa7868fe" class="t constructor">ClientRemotePowerShell</a>(<a href="#3d1b346df3be574c" class="k">this</a>, <span class="r33 r">runspacePool</span>.<a href="RunspacePool.cs.html#ae1c1c4ae8a5c648" class="i property">RemoteRunspacePoolInternal</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Sets the command collection in this powershell.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span><span class="c">This method will be called by RemotePipeline</span>
        <span class="c">///</span><span class="c"> before it begins execution. This method is used to set</span>
        <span class="c">///</span><span class="c"> the command collection of the remote pipeline as the</span>
        <span class="c">///</span><span class="c"> command collection of the underlying powershell</span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="7e4a86af41ca75b0" href="../../R/7e4a86af41ca75b0.html" target="n" data-glyph="74,1" class="i method">InitForRemotePipeline</a>(<a href="Command.cs.html#8276f51c05ad2fa1" class="t t">CommandCollection</a> <span id="r34 rd" class="r34 r">command</span>, <a href="../../utils/ObjectStream.cs.html#27e9349816faeecb" class="t t">ObjectStreamBase</a> <span id="r35 rd" class="r35 r">inputstream</span>,
            <a href="../../utils/ObjectStream.cs.html#27e9349816faeecb" class="t t">ObjectStreamBase</a> <span id="r36 rd" class="r36 r">outputstream</span>, <a href="../../utils/ObjectStream.cs.html#27e9349816faeecb" class="t t">ObjectStreamBase</a> <span id="r37 rd" class="r37 r">errorstream</span>, <a href="#ce65c0834aa6f0ea" class="t t">PSInvocationSettings</a> <span id="r38 rd" class="r38 r">settings</span>, <b>bool</b> <span id="r39 rd" class="r39 r">redirectShellErrorOutputPipe</span>)
        {
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r34 r">command</span> != <b>null</b>, <span class="s">&quot;A command collection need to be specified&quot;</span>);
 
            <a href="#f984c2b1a1646528" class="i field">_psCommand</a> = <b>new</b> <span class="t">PSCommand</span>(<span class="r34 r">command</span>[0]);
            <a href="#f984c2b1a1646528" class="i field">_psCommand</a>.<a href="PSCommand.cs.html#c72d40210220cf60" class="i property">Owner</a> = <a href="#3d1b346df3be574c" class="k">this</a>;
 
            <b>for</b> (<b>int</b> <span id="r40 rd" class="r40 r">i</span> = 1; <span class="r40 r">i</span> &lt; <span class="r34 r">command</span>.<span class="i">Count</span>; <span class="r40 r">i</span>++)
            {
                <span class="i">AddCommand</span>(<span class="r34 r">command</span>[<span class="r40 r">i</span>]);
            }
 
            <a href="#1b4e6f691674a8b2" class="i property">RedirectShellErrorOutputPipe</a> = <span class="r39 r">redirectShellErrorOutputPipe</span>;
 
            <span class="c">// create the client remote powershell for remoting</span>
            <span class="c">// communications</span>
            <b>if</b> (<a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a> == <b>null</b>)
            {
                <a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a> = <b>new</b> <a href="../remoting/client/ClientRemotePowerShell.cs.html#963057b3fa7868fe" class="t constructor">ClientRemotePowerShell</a>(<a href="#3d1b346df3be574c" class="k">this</a>, ((<a href="RunspacePool.cs.html#c1948c2f22e6b527" class="t t">RunspacePool</a>)<a href="#ccb6c738e7f3c724" class="i field">_rsConnection</a>).<a href="RunspacePool.cs.html#ae1c1c4ae8a5c648" class="i property">RemoteRunspacePoolInternal</a>);
            }
 
            <span class="c">// If we get here, we don&#39;t call &#39;Invoke&#39; or any of it&#39;s friends on &#39;this&#39;, instead we serialize &#39;this&#39; in PowerShell.ToPSObjectForRemoting.</span>
            <span class="c">// Without the following two steps, we&#39;ll be missing the &#39;ExtraCommands&#39; on the serialized instance of &#39;this&#39;.</span>
            <span class="c">// This is the last possible chance to call set up for batching as we will indirectly call ToPSObjectForRemoting</span>
            <span class="c">// in the call to ClientRemotePowerShell.Initialize (which happens just below.)</span>
            <a href="#8995adafa9f25650" class="i method">DetermineIsBatching</a>();
 
            <b>if</b> (<a href="#b3c8b30fb7648387" class="i field">_isBatching</a>)
            {
                <a href="#efa3902a0546e8df" class="i method">SetupAsyncBatchExecution</a>();
            }
 
            <a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a>.<a href="../remoting/client/ClientRemotePowerShell.cs.html#86db8930303b5c9a" class="i method">Initialize</a>(<span class="r35 r">inputstream</span>, <span class="r36 r">outputstream</span>,
                <span class="r37 r">errorstream</span>, <a href="#4bb26ab73ebaa6ca" class="i property">InformationalBuffers</a>, <span class="r38 r">settings</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initialize PowerShell object for connection to remote command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r41 r">inputstream</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Input stream.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r42 r">outputstream</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Output stream.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r43 r">errorstream</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Error stream.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r44 r">settings</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Settings information.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r45 r">redirectShellErrorOutputPipe</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Redirect error output.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="c540e09bb34dc15d" href="../../R/c540e09bb34dc15d.html" target="n" data-glyph="74,1" class="i method">InitForRemotePipelineConnect</a>(<a href="../../utils/ObjectStream.cs.html#27e9349816faeecb" class="t t">ObjectStreamBase</a> <span id="r41 rd" class="r41 r">inputstream</span>, <a href="../../utils/ObjectStream.cs.html#27e9349816faeecb" class="t t">ObjectStreamBase</a> <span id="r42 rd" class="r42 r">outputstream</span>,
            <a href="../../utils/ObjectStream.cs.html#27e9349816faeecb" class="t t">ObjectStreamBase</a> <span id="r43 rd" class="r43 r">errorstream</span>, <a href="#ce65c0834aa6f0ea" class="t t">PSInvocationSettings</a> <span id="r44 rd" class="r44 r">settings</span>, <b>bool</b> <span id="r45 rd" class="r45 r">redirectShellErrorOutputPipe</span>)
        {
            <span class="c">// The remotePowerShell and DSHandler cannot be initialized with a disconnected runspace.</span>
            <span class="c">// Make sure the associated runspace is valid and connected.</span>
            <a href="#d345dec335f0fa58" class="i method">CheckRunspacePoolAndConnect</a>();
 
            <b>if</b> (<a href="#39b81acd3aeb1582" class="i property">InvocationStateInfo</a>.<a href="#7a70ff5163d0f044" class="i property">State</a> != <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#55f5ed5d1c0f010a" class="i field">Disconnected</a>)
            {
                <b>throw</b> <b>new</b> <a href="#bdb2839004600662" class="t constructor">InvalidPowerShellStateException</a>(<a href="#39b81acd3aeb1582" class="i property">InvocationStateInfo</a>.<a href="#7a70ff5163d0f044" class="i property">State</a>);
            }
 
            <a href="#1b4e6f691674a8b2" class="i property">RedirectShellErrorOutputPipe</a> = <span class="r45 r">redirectShellErrorOutputPipe</span>;
 
            <b>if</b> (<a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a> == <b>null</b>)
            {
                <a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a> = <b>new</b> <a href="../remoting/client/ClientRemotePowerShell.cs.html#963057b3fa7868fe" class="t constructor">ClientRemotePowerShell</a>(<a href="#3d1b346df3be574c" class="k">this</a>, ((<a href="RunspacePool.cs.html#c1948c2f22e6b527" class="t t">RunspacePool</a>)<a href="#ccb6c738e7f3c724" class="i field">_rsConnection</a>).<a href="RunspacePool.cs.html#ae1c1c4ae8a5c648" class="i property">RemoteRunspacePoolInternal</a>);
            }
 
            <b>if</b> (!<a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a>.<a href="../remoting/client/ClientRemotePowerShell.cs.html#4f8237be57be8c4e" class="i property">Initialized</a>)
            {
                <a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a>.<a href="../remoting/client/ClientRemotePowerShell.cs.html#86db8930303b5c9a" class="i method">Initialize</a>(<span class="r41 r">inputstream</span>, <span class="r42 r">outputstream</span>, <span class="r43 r">errorstream</span>, <a href="#4bb26ab73ebaa6ca" class="i property">InformationalBuffers</a>, <span class="r44 r">settings</span>);
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Construction Factory
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Constructs an empty PowerShell instance; a script or command must be added before invoking this instance.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An instance of PowerShell.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static</b> <a href="#3d1b346df3be574c" class="t t">PowerShell</a> <a id="40345bc4625ff918" href="../../R/40345bc4625ff918.html" target="n" data-glyph="72,1" class="i method">Create</a>()
        {
            <b>return</b> <b>new</b> <a href="#ff10480e08f047ec" class="t constructor">PowerShell</a>(<b>new</b> <a href="PSCommand.cs.html#45c724f1a0c9f07a" class="t constructor">PSCommand</a>(), <b>null</b>, <b>null</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Constructs an empty PowerShell instance; a script or command must be added before invoking this instance.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r46 r">runspace</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Runspace mode.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">An instance of PowerShell.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static</b> <a href="#3d1b346df3be574c" class="t t">PowerShell</a> <a id="1c6a51d3c837bb4d" href="../../R/1c6a51d3c837bb4d.html" target="n" data-glyph="72,1" class="i method">Create</a>(<a href="#c3c0f0e5e0b337ff" class="t t">RunspaceMode</a> <span id="r46 rd" class="r46 r">runspace</span>)
        {
            <a href="#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r47 rd" class="r47 r">result</span> = <b>null</b>;
 
            <b>switch</b> (<span class="r46 r">runspace</span>)
            {
                <b>case</b> <a href="#c3c0f0e5e0b337ff" class="t t">RunspaceMode</a>.<a href="#75d224de5df87e75" class="i field">CurrentRunspace</a>:
                    <b>if</b> (<a href="Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a>.<a href="Connection.cs.html#efcd2ba43103de17" class="i property">DefaultRunspace</a> == <b>null</b>)
                    {
                        <b>throw</b> <b>new</b> <span class="i">InvalidOperationException</span>(<span class="i">PowerShellStrings</span>.<span class="i">NoDefaultRunspaceForPSCreate</span>);
                    }
 
                    <span class="r47 r">result</span> = <b>new</b> <a href="#ff10480e08f047ec" class="t constructor">PowerShell</a>(<b>new</b> <a href="PSCommand.cs.html#45c724f1a0c9f07a" class="t constructor">PSCommand</a>(), <b>null</b>, <a href="Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a>.<a href="Connection.cs.html#efcd2ba43103de17" class="i property">DefaultRunspace</a>);
                    <span class="r47 r">result</span>.<a href="#d1ffd6dcd401bcb5" class="i property">IsChild</a> = <b>true</b>;
                    <span class="r47 r">result</span>.<a href="#32c156c0cba25702" class="i property">IsNested</a> = <b>true</b>;
                    <span class="r47 r">result</span>.<a href="#2d0966000c73a748" class="i property">IsRunspaceOwner</a> = <b>false</b>;
                    <span class="r47 r">result</span>.<a href="#d6487a2f72366731" class="i field">_runspace</a> = <a href="Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a>.<a href="Connection.cs.html#efcd2ba43103de17" class="i property">DefaultRunspace</a>;
                    <b>break</b>;
                <b>case</b> <a href="#c3c0f0e5e0b337ff" class="t t">RunspaceMode</a>.<a href="#f68a3ef57e70938e" class="i field">NewRunspace</a>:
                    <span class="r47 r">result</span> = <b>new</b> <a href="#ff10480e08f047ec" class="t constructor">PowerShell</a>(<b>new</b> <a href="PSCommand.cs.html#45c724f1a0c9f07a" class="t constructor">PSCommand</a>(), <b>null</b>, <b>null</b>);
                    <b>break</b>;
            }
 
            <b>return</b> <span class="r47 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Constructs an empty PowerShell instance; a script or command must be added before invoking this instance.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r48 r">initialSessionState</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">InitialSessionState with which to create the runspace.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">An instance of PowerShell.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static</b> <a href="#3d1b346df3be574c" class="t t">PowerShell</a> <a id="f41a8c4815429c5e" href="../../R/f41a8c4815429c5e.html" target="n" data-glyph="72,1" class="i method">Create</a>(<a href="../InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a> <span id="r48 rd" class="r48 r">initialSessionState</span>)
        {
            <a href="#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r49 rd" class="r49 r">result</span> = <a href="#40345bc4625ff918" class="i method">Create</a>();
 
            <span class="r49 r">result</span>.<a href="#ccf57242c9d46642" class="i property">Runspace</a> = <a href="ConnectionFactory.cs.html#c5fbe142e4e21218" class="t t">RunspaceFactory</a>.<a href="ConnectionFactory.cs.html#19132aa2ac867b76" class="i method">CreateRunspace</a>(<span class="r48 r">initialSessionState</span>);
            <span class="r49 r">result</span>.<a href="#ccf57242c9d46642" class="i property">Runspace</a>.<a href="Connection.cs.html#61f55439fb78f2fe" class="i method">Open</a>();
 
            <b>return</b> <span class="r49 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Constructs an empty PowerShell instance and associates it with the provided</span>
        <span class="c">///</span><span class="c"> Runspace; a script or command must be added before invoking this instance.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r50 r">runspace</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Runspace in which to invoke commands.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">An instance of PowerShell.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The required Runspace argument is accepted no matter what state it is in.</span>
        <span class="c">///</span><span class="c"> Leaving Runspace state management to the caller allows them to open their</span>
        <span class="c">///</span><span class="c"> runspace in whatever manner is most appropriate for their application</span>
        <span class="c">///</span><span class="c"> (in another thread while this instance of the PowerShell class is being</span>
        <span class="c">///</span><span class="c"> instantiated, for example).</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>public static</b> <a href="#3d1b346df3be574c" class="t t">PowerShell</a> <a id="290e867dc338ea54" href="../../R/290e867dc338ea54.html" target="n" data-glyph="72,1" class="i method">Create</a>(<a href="Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a> <span id="r50 rd" class="r50 r">runspace</span>)
        {
            <b>if</b> (<span class="r50 r">runspace</span> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <a href="../../utils/MshArgumentNullException.cs.html#166e605c6cb05157" class="t constructor">PSArgumentNullException</a>(<b>nameof</b>(<span class="r50 r">runspace</span>));
            }
 
            <a href="#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r51 rd" class="r51 r">result</span> = <a href="#40345bc4625ff918" class="i method">Create</a>();
            <span class="r51 r">result</span>.<a href="#ccf57242c9d46642" class="i property">Runspace</a> = <span class="r50 r">runspace</span>;
 
            <b>return</b> <span class="r51 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates a nested powershell within the current instance.</span>
        <span class="c">///</span><span class="c"> Nested PowerShell is used to do simple operations like checking state</span>
        <span class="c">///</span><span class="c"> of a variable while another command is using the runspace.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> Nested PowerShell should be invoked from the same thread as the parent</span>
        <span class="c">///</span><span class="c"> PowerShell invocation thread. So effectively the parent Powershell</span>
        <span class="c">///</span><span class="c"> invocation thread is blocked until nested invoke() operation is</span>
        <span class="c">///</span><span class="c"> complete.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> Implement PSHost.EnterNestedPrompt to perform invoke() operation on the</span>
        <span class="c">///</span><span class="c"> nested powershell.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> 1. State of powershell instance is not valid to create a nested powershell instance.</span>
        <span class="c">///</span><span class="c"> Nested PowerShell should be created only for a running powershell instance.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Naming&quot;</span>, <span class="s">&quot;CA1704:IdentifiersShouldBeSpelledCorrectly&quot;</span>, <span class="i">MessageId</span> = <span class="s">&quot;ps&quot;</span>, <span class="i">Justification</span> = <span class="s">&quot;ps represents PowerShell and is used at many places.&quot;</span>)]
        <b>public</b> <a href="#3d1b346df3be574c" class="t t">PowerShell</a> <a id="fcf31250d944c4b2" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">CreateNestedPowerShell</a>()
        {
            <b>if</b> ((<a href="#1389234891e6cc36" class="i field">_worker</a> != <b>null</b>) &amp;&amp; (<a href="#1389234891e6cc36" class="i field">_worker</a>.<a href="#88b35242d849bc1e" class="i property">CurrentlyRunningPipeline</a> != <b>null</b>))
            {
                <a href="#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r52 rd" class="r52 r">result</span> = <b>new</b> <a href="#ff10480e08f047ec" class="t constructor">PowerShell</a>(<b>new</b> <a href="PSCommand.cs.html#45c724f1a0c9f07a" class="t constructor">PSCommand</a>(),
                    <b>null</b>, <a href="#1389234891e6cc36" class="i field">_worker</a>.<a href="#88b35242d849bc1e" class="i property">CurrentlyRunningPipeline</a>.<a href="Pipeline.cs.html#cefa43f64a3ac790" class="i property">Runspace</a>);
                <span class="r52 r">result</span>.<a href="#32c156c0cba25702" class="i property">IsNested</a> = <b>true</b>;
                <b>return</b> <span class="r52 r">result</span>;
            }
 
            <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(<span class="i">PowerShellStrings</span>.<span class="i">InvalidStateCreateNested</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Method needed when deserializing PowerShell object coming from a RemoteDataObject.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r53 r">isNested</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Indicates if PowerShell object is nested.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r54 r">psCommand</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Commands that the PowerShell pipeline is built of.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r55 r">extraCommands</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Extra commands to run.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private static</b> <a href="#3d1b346df3be574c" class="t t">PowerShell</a> <a id="d1f936bb6ec6fd1a" href="../../R/d1f936bb6ec6fd1a.html" target="n" data-glyph="76,1" class="i method">Create</a>(<b>bool</b> <span id="r53 rd" class="r53 r">isNested</span>, <a href="PSCommand.cs.html#b9f024f73904cf55" class="t t">PSCommand</a> <span id="r54 rd" class="r54 r">psCommand</span>, <span class="i">Collection</span>&lt;<a href="PSCommand.cs.html#b9f024f73904cf55" class="t t">PSCommand</a>&gt; <span id="r55 rd" class="r55 r">extraCommands</span>)
        {
            <a href="#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r56 rd" class="r56 r">powerShell</span> = <b>new</b> <a href="#ff10480e08f047ec" class="t constructor">PowerShell</a>(<span class="r54 r">psCommand</span>, <span class="r55 r">extraCommands</span>, <b>null</b>);
            <span class="r56 r">powerShell</span>.<a href="#32c156c0cba25702" class="i property">IsNested</a> = <span class="r53 r">isNested</span>;
            <b>return</b> <span class="r56 r">powerShell</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Command / Parameter Construction
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Add a cmdlet to construct a command pipeline.</span>
        <span class="c">///</span><span class="c"> For example, to construct a command string &quot;get-process | sort-object&quot;,</span>
        <span class="c">///</span><span class="c">     </span><span class="c">&lt;</span><span class="c">code</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">         PowerShell shell = PowerShell.Create(&quot;get-process&quot;).AddCommand(&quot;sort-object&quot;);</span>
        <span class="c">///</span><span class="c">     </span><span class="c">&lt;/</span><span class="c">code</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r57 r">cmdlet</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A string representing cmdlet.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A PowerShell instance with </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r57 r">cmdlet</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> added.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This method is not thread safe.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> cmdlet is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2864fc2d24c87a5a" class="t t">InvalidPowerShellStateException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Powershell instance cannot be changed in its</span>
        <span class="c">///</span><span class="c"> current state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public</b> <a href="#3d1b346df3be574c" class="t t">PowerShell</a> <a id="9cc79c297f6cced9" href="../../R/9cc79c297f6cced9.html" target="n" data-glyph="72,1" class="i method">AddCommand</a>(<b>string</b> <span id="r57 rd" class="r57 r">cmdlet</span>)
        {
            <b>lock</b> (<a href="#57ad56a0d8f83c43" class="i field">_syncObject</a>)
            {
                <a href="#68c9b1a93a2cdcde" class="i method">AssertChangesAreAccepted</a>();
 
                <a href="#f984c2b1a1646528" class="i field">_psCommand</a>.<a href="PSCommand.cs.html#2a2b7de6778550bd" class="i method">AddCommand</a>(<span class="r57 r">cmdlet</span>);
 
                <b>return</b> <a href="#3d1b346df3be574c" class="k">this</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Add a cmdlet to construct a command pipeline.</span>
        <span class="c">///</span><span class="c"> For example, to construct a command string &quot;get-process | sort-object&quot;,</span>
        <span class="c">///</span><span class="c">     </span><span class="c">&lt;</span><span class="c">code</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">         PowerShell shell = PowerShell.Create(&quot;get-process&quot;).AddCommand(&quot;sort-object&quot;);</span>
        <span class="c">///</span><span class="c">     </span><span class="c">&lt;/</span><span class="c">code</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r58 r">cmdlet</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A string representing cmdlet.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r59 r">useLocalScope</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> if true local scope is used to run the script command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A PowerShell instance with </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r58 r">cmdlet</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> added.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This method is not thread safe.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> cmdlet is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2864fc2d24c87a5a" class="t t">InvalidPowerShellStateException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Powershell instance cannot be changed in its</span>
        <span class="c">///</span><span class="c"> current state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public</b> <a href="#3d1b346df3be574c" class="t t">PowerShell</a> <a id="d799700e3affed7f" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">AddCommand</a>(<b>string</b> <span id="r58 rd" class="r58 r">cmdlet</span>, <b>bool</b> <span id="r59 rd" class="r59 r">useLocalScope</span>)
        {
            <b>lock</b> (<a href="#57ad56a0d8f83c43" class="i field">_syncObject</a>)
            {
                <a href="#68c9b1a93a2cdcde" class="i method">AssertChangesAreAccepted</a>();
 
                <a href="#f984c2b1a1646528" class="i field">_psCommand</a>.<a href="PSCommand.cs.html#26d5b672ae01a0b6" class="i method">AddCommand</a>(<span class="r58 r">cmdlet</span>, <span class="r59 r">useLocalScope</span>);
 
                <b>return</b> <a href="#3d1b346df3be574c" class="k">this</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Add a piece of script to construct a command pipeline.</span>
        <span class="c">///</span><span class="c"> For example, to construct a command string &quot;get-process | foreach { $_.Name }&quot;</span>
        <span class="c">///</span><span class="c">     </span><span class="c">&lt;</span><span class="c">code</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">         PowerShell shell = PowerShell.Create(&quot;get-process&quot;).</span>
        <span class="c">///</span><span class="c">                                     AddCommand(&quot;foreach { $_.Name }&quot;, true);</span>
        <span class="c">///</span><span class="c">     </span><span class="c">&lt;/</span><span class="c">code</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r60 r">script</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A string representing a script.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A PowerShell instance with </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="i">command</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> added.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This method is not thread-safe.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> command is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2864fc2d24c87a5a" class="t t">InvalidPowerShellStateException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Powershell instance cannot be changed in its</span>
        <span class="c">///</span><span class="c"> current state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public</b> <a href="#3d1b346df3be574c" class="t t">PowerShell</a> <a id="c97f8d15a2f93e31" href="../../R/c97f8d15a2f93e31.html" target="n" data-glyph="72,1" class="i method">AddScript</a>(<b>string</b> <span id="r60 rd" class="r60 r">script</span>)
        {
            <b>lock</b> (<a href="#57ad56a0d8f83c43" class="i field">_syncObject</a>)
            {
                <a href="#68c9b1a93a2cdcde" class="i method">AssertChangesAreAccepted</a>();
 
                <a href="#f984c2b1a1646528" class="i field">_psCommand</a>.<a href="PSCommand.cs.html#432fcb03d95e8672" class="i method">AddScript</a>(<span class="r60 r">script</span>);
 
                <b>return</b> <a href="#3d1b346df3be574c" class="k">this</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Add a piece of script to construct a command pipeline.</span>
        <span class="c">///</span><span class="c"> For example, to construct a command string &quot;get-process | foreach { $_.Name }&quot;</span>
        <span class="c">///</span><span class="c">     </span><span class="c">&lt;</span><span class="c">code</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">         PowerShell shell = PowerShell.Create(&quot;get-process&quot;).</span>
        <span class="c">///</span><span class="c">                                     AddCommand(&quot;foreach { $_.Name }&quot;, true);</span>
        <span class="c">///</span><span class="c">     </span><span class="c">&lt;/</span><span class="c">code</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r61 r">script</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A string representing a script.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r62 r">useLocalScope</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> if true local scope is used to run the script command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A PowerShell instance with </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="i">command</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> added.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This method is not thread-safe.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> command is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2864fc2d24c87a5a" class="t t">InvalidPowerShellStateException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Powershell instance cannot be changed in its</span>
        <span class="c">///</span><span class="c"> current state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public</b> <a href="#3d1b346df3be574c" class="t t">PowerShell</a> <a id="4ddddc90a743f172" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">AddScript</a>(<b>string</b> <span id="r61 rd" class="r61 r">script</span>, <b>bool</b> <span id="r62 rd" class="r62 r">useLocalScope</span>)
        {
            <b>lock</b> (<a href="#57ad56a0d8f83c43" class="i field">_syncObject</a>)
            {
                <a href="#68c9b1a93a2cdcde" class="i method">AssertChangesAreAccepted</a>();
 
                <a href="#f984c2b1a1646528" class="i field">_psCommand</a>.<a href="PSCommand.cs.html#9e182be21567358b" class="i method">AddScript</a>(<span class="r61 r">script</span>, <span class="r62 r">useLocalScope</span>);
 
                <b>return</b> <a href="#3d1b346df3be574c" class="k">this</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Add a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="Command.cs.html#b55b68a3bf75e612" class="t t">Command</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> element to the current command</span>
        <span class="c">///</span><span class="c"> pipeline.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r63 r">command</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Command to add.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A PSCommand instance with </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r63 r">command</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> added.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This method is not thread-safe.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> command is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2864fc2d24c87a5a" class="t t">InvalidPowerShellStateException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Powershell instance cannot be changed in its</span>
        <span class="c">///</span><span class="c"> current state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal</b> <a href="#3d1b346df3be574c" class="t t">PowerShell</a> <a id="f68f5b3ba7949aa4" href="../../R/f68f5b3ba7949aa4.html" target="n" data-glyph="74,1" class="i method">AddCommand</a>(<a href="Command.cs.html#b55b68a3bf75e612" class="t t">Command</a> <span id="r63 rd" class="r63 r">command</span>)
        {
            <b>lock</b> (<a href="#57ad56a0d8f83c43" class="i field">_syncObject</a>)
            {
                <a href="#68c9b1a93a2cdcde" class="i method">AssertChangesAreAccepted</a>();
 
                <a href="#f984c2b1a1646528" class="i field">_psCommand</a>.<a href="PSCommand.cs.html#7918d4773753829d" class="i method">AddCommand</a>(<span class="r63 r">command</span>);
 
                <b>return</b> <a href="#3d1b346df3be574c" class="k">this</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> CommandInfo object for the command to add.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r64 r">commandInfo</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The CommandInfo object for the command to add.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A PSCommand instance with the command added.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This method is not thread-safe.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> command is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2864fc2d24c87a5a" class="t t">InvalidPowerShellStateException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Powershell instance cannot be changed in its</span>
        <span class="c">///</span><span class="c"> current state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public</b> <a href="#3d1b346df3be574c" class="t t">PowerShell</a> <a id="cc3df9bf3b89f740" href="../../R/cc3df9bf3b89f740.html" target="n" data-glyph="72,1" class="i method">AddCommand</a>(<a href="../CommandInfo.cs.html#71babe57a99ca852" class="t t">CommandInfo</a> <span id="r64 rd" class="r64 r">commandInfo</span>)
        {
            <b>if</b> (<span class="r64 r">commandInfo</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r64 r">commandInfo</span>));
            }
 
            <a href="Command.cs.html#b55b68a3bf75e612" class="t t">Command</a> <span id="r65 rd" class="r65 r">cmd</span> = <b>new</b> <a href="Command.cs.html#7afd6fbc88a9b688" class="t constructor">Command</a>(<span class="r64 r">commandInfo</span>);
            <a href="#f984c2b1a1646528" class="i field">_psCommand</a>.<a href="PSCommand.cs.html#7918d4773753829d" class="i method">AddCommand</a>(<span class="r65 r">cmd</span>);
            <b>return</b> <a href="#3d1b346df3be574c" class="k">this</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Add a parameter to the last added command.</span>
        <span class="c">///</span><span class="c"> For example, to construct a command string &quot;get-process | select-object -property name&quot;</span>
        <span class="c">///</span><span class="c">     </span><span class="c">&lt;</span><span class="c">code</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">         PowerShell shell = PowerShell.Create(&quot;get-process&quot;).</span>
        <span class="c">///</span><span class="c">                                     AddCommand(&quot;select-object&quot;).AddParameter(&quot;property&quot;,&quot;name&quot;);</span>
        <span class="c">///</span><span class="c">     </span><span class="c">&lt;/</span><span class="c">code</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r66 r">parameterName</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Name of the parameter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r67 r">value</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Value for the parameter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A PowerShell instance with </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r66 r">parameterName</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> added</span>
        <span class="c">///</span><span class="c"> to the parameter list of the last command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This method is not thread safe.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Name is non null and name length is zero after trimming whitespace.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2864fc2d24c87a5a" class="t t">InvalidPowerShellStateException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Powershell instance cannot be changed in its</span>
        <span class="c">///</span><span class="c"> current state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public</b> <a href="#3d1b346df3be574c" class="t t">PowerShell</a> <a id="40674f99a3618f4b" href="../../R/40674f99a3618f4b.html" target="n" data-glyph="72,1" class="i method">AddParameter</a>(<b>string</b> <span id="r66 rd" class="r66 r">parameterName</span>, <b>object</b> <span id="r67 rd" class="r67 r">value</span>)
        {
            <b>lock</b> (<a href="#57ad56a0d8f83c43" class="i field">_syncObject</a>)
            {
                <b>if</b> (<a href="#f984c2b1a1646528" class="i field">_psCommand</a>.<a href="PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>.<span class="i">Count</span> == 0)
                {
                    <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(<span class="i">PowerShellStrings</span>.<span class="i">ParameterRequiresCommand</span>);
                }
 
                <a href="#68c9b1a93a2cdcde" class="i method">AssertChangesAreAccepted</a>();
                <a href="#f984c2b1a1646528" class="i field">_psCommand</a>.<a href="PSCommand.cs.html#247ce643c3f840c8" class="i method">AddParameter</a>(<span class="r66 r">parameterName</span>, <span class="r67 r">value</span>);
                <b>return</b> <a href="#3d1b346df3be574c" class="k">this</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Adds a switch parameter to the last added command.</span>
        <span class="c">///</span><span class="c"> For example, to construct a command string &quot;get-process | sort-object -descending&quot;</span>
        <span class="c">///</span><span class="c">     </span><span class="c">&lt;</span><span class="c">code</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">         PSCommand command = new PSCommand(&quot;get-process&quot;).</span>
        <span class="c">///</span><span class="c">                                     AddCommand(&quot;sort-object&quot;).AddParameter(&quot;descending&quot;);</span>
        <span class="c">///</span><span class="c">     </span><span class="c">&lt;/</span><span class="c">code</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r68 r">parameterName</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Name of the parameter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A PowerShell instance with </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r68 r">parameterName</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> added</span>
        <span class="c">///</span><span class="c"> to the parameter list of the last command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This method is not thread safe.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Name is non null and name length is zero after trimming whitespace.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2864fc2d24c87a5a" class="t t">InvalidPowerShellStateException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Powershell instance cannot be changed in its</span>
        <span class="c">///</span><span class="c"> current state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public</b> <a href="#3d1b346df3be574c" class="t t">PowerShell</a> <a id="ad181c9dec5e4ffa" href="../../R/ad181c9dec5e4ffa.html" target="n" data-glyph="72,1" class="i method">AddParameter</a>(<b>string</b> <span id="r68 rd" class="r68 r">parameterName</span>)
        {
            <b>lock</b> (<a href="#57ad56a0d8f83c43" class="i field">_syncObject</a>)
            {
                <b>if</b> (<a href="#f984c2b1a1646528" class="i field">_psCommand</a>.<a href="PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>.<span class="i">Count</span> == 0)
                {
                    <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(<span class="i">PowerShellStrings</span>.<span class="i">ParameterRequiresCommand</span>);
                }
 
                <a href="#68c9b1a93a2cdcde" class="i method">AssertChangesAreAccepted</a>();
                <a href="#f984c2b1a1646528" class="i field">_psCommand</a>.<a href="PSCommand.cs.html#710a1cf55c2033f3" class="i method">AddParameter</a>(<span class="r68 r">parameterName</span>);
                <b>return</b> <a href="#3d1b346df3be574c" class="k">this</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Adds a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="Parameter.cs.html#4ce3ff8da8a0f8d9" class="t t">CommandParameter</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to the last added command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="#3d1b346df3be574c" class="t t">PowerShell</a> <a id="50e8a7f0e67f9017" href="../../R/50e8a7f0e67f9017.html" target="n" data-glyph="74,1" class="i method">AddParameter</a>(<a href="Parameter.cs.html#4ce3ff8da8a0f8d9" class="t t">CommandParameter</a> <span id="r69 rd" class="r69 r">parameter</span>)
        {
            <b>lock</b> (<a href="#57ad56a0d8f83c43" class="i field">_syncObject</a>)
            {
                <b>if</b> (<a href="#f984c2b1a1646528" class="i field">_psCommand</a>.<a href="PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>.<span class="i">Count</span> == 0)
                {
                    <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(<span class="i">PowerShellStrings</span>.<span class="i">ParameterRequiresCommand</span>);
                }
 
                <a href="#68c9b1a93a2cdcde" class="i method">AssertChangesAreAccepted</a>();
                <a href="#f984c2b1a1646528" class="i field">_psCommand</a>.<a href="PSCommand.cs.html#36a9df84fd6002ec" class="i method">AddParameter</a>(<span class="r69 r">parameter</span>);
                <b>return</b> <a href="#3d1b346df3be574c" class="k">this</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Adds a set of parameters to the last added command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r70 r">parameters</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> List of parameters.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A PowerShell instance with the items in </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r70 r">parameters</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> added</span>
        <span class="c">///</span><span class="c"> to the parameter list of the last command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This method is not thread safe.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/MshArgumentNullException.cs.html#efa3789145f41301" class="t t">PSArgumentNullException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The function was given a null argument.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2864fc2d24c87a5a" class="t t">InvalidPowerShellStateException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Powershell instance cannot be changed in its</span>
        <span class="c">///</span><span class="c"> current state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public</b> <a href="#3d1b346df3be574c" class="t t">PowerShell</a> <a id="31dbe218c029111d" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">AddParameters</a>(<span class="i">IList</span> <span id="r70 rd" class="r70 r">parameters</span>)
        {
            <b>lock</b> (<a href="#57ad56a0d8f83c43" class="i field">_syncObject</a>)
            {
                <b>if</b> (<span class="r70 r">parameters</span> == <b>null</b>)
                {
                    <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r70 r">parameters</span>));
                }
 
                <b>if</b> (<a href="#f984c2b1a1646528" class="i field">_psCommand</a>.<a href="PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>.<span class="i">Count</span> == 0)
                {
                    <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(<span class="i">PowerShellStrings</span>.<span class="i">ParameterRequiresCommand</span>);
                }
 
                <a href="#68c9b1a93a2cdcde" class="i method">AssertChangesAreAccepted</a>();
 
                <b>foreach</b> (<b>object</b> <span id="r71 rd" class="r71 r">p</span> <b>in</b> <span class="r70 r">parameters</span>)
                {
                    <a href="#f984c2b1a1646528" class="i field">_psCommand</a>.<a href="PSCommand.cs.html#247ce643c3f840c8" class="i method">AddParameter</a>(<b>null</b>, <span class="r71 r">p</span>);
                }
 
                <b>return</b> <a href="#3d1b346df3be574c" class="k">this</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Adds a set of parameters to the last added command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r72 r">parameters</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Dictionary of parameters. Each key-value pair corresponds to a parameter name and its value. Keys must strings.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A PowerShell instance with the items in </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r72 r">parameters</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> added</span>
        <span class="c">///</span><span class="c"> to the parameter list of the last command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This method is not thread safe.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/MshArgumentNullException.cs.html#efa3789145f41301" class="t t">PSArgumentNullException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The function was given a null argument.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2864fc2d24c87a5a" class="t t">InvalidPowerShellStateException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Powershell instance cannot be changed in its</span>
        <span class="c">///</span><span class="c"> current state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/MshArgumentException.cs.html#581bd9b947689819" class="t t">PSArgumentException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> One of the dictionary keys is not a string.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public</b> <a href="#3d1b346df3be574c" class="t t">PowerShell</a> <a id="5ef5cc72e628597b" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">AddParameters</a>(<span class="i">IDictionary</span> <span id="r72 rd" class="r72 r">parameters</span>)
        {
            <b>lock</b> (<a href="#57ad56a0d8f83c43" class="i field">_syncObject</a>)
            {
                <b>if</b> (<span class="r72 r">parameters</span> == <b>null</b>)
                {
                    <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r72 r">parameters</span>));
                }
 
                <b>if</b> (<a href="#f984c2b1a1646528" class="i field">_psCommand</a>.<a href="PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>.<span class="i">Count</span> == 0)
                {
                    <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(<span class="i">PowerShellStrings</span>.<span class="i">ParameterRequiresCommand</span>);
                }
 
                <a href="#68c9b1a93a2cdcde" class="i method">AssertChangesAreAccepted</a>();
 
                <b>foreach</b> (<span class="i">DictionaryEntry</span> <span id="r73 rd" class="r73 r">entry</span> <b>in</b> <span class="r72 r">parameters</span>)
                {
                    <b>if</b> (!(<span class="r73 r">entry</span>.<span class="i">Key</span> <b>is string</b> <span id="r74 rd" class="r74 r">parameterName</span>))
                    {
                        <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentException</span>(<b>nameof</b>(<span class="r72 r">parameters</span>), <span class="i">PowerShellStrings</span>.<span class="i">KeyMustBeString</span>);
                    }
 
                    <a href="#f984c2b1a1646528" class="i field">_psCommand</a>.<span class="i">AddParameter</span>(<span class="r74 r">parameterName</span>, <span class="r73 r">entry</span>.<span class="i">Value</span>);
                }
 
                <b>return</b> <a href="#3d1b346df3be574c" class="k">this</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Adds an argument to the last added command.</span>
        <span class="c">///</span><span class="c"> For example, to construct a command string &quot;get-process | select-object name&quot;</span>
        <span class="c">///</span><span class="c">     </span><span class="c">&lt;</span><span class="c">code</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">         PowerShell shell = PowerShell.Create(&quot;get-process&quot;).</span>
        <span class="c">///</span><span class="c">                                     AddCommand(&quot;select-object&quot;).AddParameter(&quot;name&quot;);</span>
        <span class="c">///</span><span class="c">     </span><span class="c">&lt;/</span><span class="c">code</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This will add the value &quot;name&quot; to the positional parameter list of &quot;select-object&quot;</span>
        <span class="c">///</span><span class="c"> cmdlet. When the command is invoked, this value will get bound to positional parameter 0</span>
        <span class="c">///</span><span class="c"> of the &quot;select-object&quot; cmdlet which is &quot;Property&quot;.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r75 r">value</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Value for the parameter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A PSCommand instance parameter value </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r75 r">value</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> added</span>
        <span class="c">///</span><span class="c"> to the parameter list of the last command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This method is not thread safe.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>public</b> <a href="#3d1b346df3be574c" class="t t">PowerShell</a> <a id="b2931353596991a4" href="../../R/b2931353596991a4.html" target="n" data-glyph="72,1" class="i method">AddArgument</a>(<b>object</b> <span id="r75 rd" class="r75 r">value</span>)
        {
            <b>lock</b> (<a href="#57ad56a0d8f83c43" class="i field">_syncObject</a>)
            {
                <b>if</b> (<a href="#f984c2b1a1646528" class="i field">_psCommand</a>.<a href="PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>.<span class="i">Count</span> == 0)
                {
                    <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(<span class="i">PowerShellStrings</span>.<span class="i">ParameterRequiresCommand</span>);
                }
 
                <a href="#68c9b1a93a2cdcde" class="i method">AssertChangesAreAccepted</a>();
                <a href="#f984c2b1a1646528" class="i field">_psCommand</a>.<a href="PSCommand.cs.html#3e40ef7faf8a84f1" class="i method">AddArgument</a>(<span class="r75 r">value</span>);
                <b>return</b> <a href="#3d1b346df3be574c" class="k">this</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Adds an additional statement for execution</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> For example,</span>
        <span class="c">///</span><span class="c">     </span><span class="c">&lt;</span><span class="c">code</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">         Runspace rs = RunspaceFactory.CreateRunspace();</span>
        <span class="c">///</span><span class="c">         PowerShell ps = PowerShell.Create();</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c">         ps.Runspace = rs;</span>
        <span class="c">///</span><span class="c">         ps.AddCommand(&quot;Get-Process&quot;).AddArgument(&quot;idle&quot;);</span>
        <span class="c">///</span><span class="c">         ps.AddStatement().AddCommand(&quot;Get-Service&quot;).AddArgument(&quot;audiosrv&quot;);</span>
        <span class="c">///</span><span class="c">         ps.Invoke();</span>
        <span class="c">///</span><span class="c">     </span><span class="c">&lt;/</span><span class="c">code</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A PowerShell instance with the items in </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="i">parameters</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> added</span>
        <span class="c">///</span><span class="c"> to the parameter list of the last command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public</b> <a href="#3d1b346df3be574c" class="t t">PowerShell</a> <a id="07585d5f95031ec0" href="../../R/07585d5f95031ec0.html" target="n" data-glyph="72,1" class="i method">AddStatement</a>()
        {
            <b>lock</b> (<a href="#57ad56a0d8f83c43" class="i field">_syncObject</a>)
            {
                <span class="c">// for PowerShell.Create().AddStatement().AddCommand(&quot;Get-Process&quot;);</span>
                <span class="c">// we reduce it to PowerShell.Create().AddCommand(&quot;Get-Process&quot;);</span>
                <b>if</b> (<a href="#f984c2b1a1646528" class="i field">_psCommand</a>.<a href="PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>.<span class="i">Count</span> == 0)
                {
                    <b>return</b> <a href="#3d1b346df3be574c" class="k">this</a>;
                }
 
                <a href="#68c9b1a93a2cdcde" class="i method">AssertChangesAreAccepted</a>();
 
                <a href="#f984c2b1a1646528" class="i field">_psCommand</a>.<a href="PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>[<a href="#f984c2b1a1646528" class="i field">_psCommand</a>.<a href="PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>.<span class="i">Count</span> - 1].<span class="i">IsEndOfStatement</span> = <b>true</b>;
 
                <b>return</b> <a href="#3d1b346df3be574c" class="k">this</a>;
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Public Properties
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets current powershell command line.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Cannot set to a null value.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2864fc2d24c87a5a" class="t t">InvalidPowerShellStateException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Powershell instance cannot be changed in its</span>
        <span class="c">///</span><span class="c"> current state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public</b> <a href="PSCommand.cs.html#b9f024f73904cf55" class="t t">PSCommand</a> <a id="7bde27452e045465" href="../../R/7bde27452e045465.html" target="n" data-glyph="102,1" class="i property">Commands</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#f984c2b1a1646528" class="i field">_psCommand</a>;
            }
 
            <b>set</b>
            {
                <b>if</b> (<b>value</b> == <b>null</b>)
                {
                    <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<span class="s">&quot;Command&quot;</span>);
                }
 
                <b>lock</b> (<a href="#57ad56a0d8f83c43" class="i field">_syncObject</a>)
                {
                    <a href="#68c9b1a93a2cdcde" class="i method">AssertChangesAreAccepted</a>();
                    <a href="#f984c2b1a1646528" class="i field">_psCommand</a> = <b>value</b>.<a href="PSCommand.cs.html#644d43eece6a0031" class="i method">Clone</a>();
                    <a href="#f984c2b1a1646528" class="i field">_psCommand</a>.<a href="PSCommand.cs.html#c72d40210220cf60" class="i property">Owner</a> = <a href="#3d1b346df3be574c" class="k">this</a>;
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Streams generated by PowerShell invocations.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public</b> <a href="#616ac435fe95ec2a" class="t t">PSDataStreams</a> <a id="622ebeade9b6ada7" href="../../R/622ebeade9b6ada7.html" target="n" data-glyph="102,1" class="i property">Streams</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the error buffer. Powershell invocation writes</span>
        <span class="c">///</span><span class="c"> the error data into this buffer.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Cannot set to a null value.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2864fc2d24c87a5a" class="t t">InvalidPowerShellStateException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Powershell instance cannot be changed in its</span>
        <span class="c">///</span><span class="c"> current state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Usage&quot;</span>, <span class="s">&quot;CA2227:CollectionPropertiesShouldBeReadOnly&quot;</span>, <span class="i">Justification</span> = <span class="s">&quot;We want to allow callers to change the backing store.&quot;</span>)]
        <b>internal</b> <a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a>&gt; <a id="f93842fee257462c" href="../../R/f93842fee257462c.html" target="n" data-glyph="104,1" class="i property">ErrorBuffer</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#6b0cd6330b1f780f" class="i field">_errorBuffer</a>;
            }
 
            <b>set</b>
            {
                <b>if</b> (<b>value</b> == <b>null</b>)
                {
                    <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<span class="s">&quot;Error&quot;</span>);
                }
 
                <b>lock</b> (<a href="#57ad56a0d8f83c43" class="i field">_syncObject</a>)
                {
                    <a href="#68c9b1a93a2cdcde" class="i method">AssertChangesAreAccepted</a>();
                    <a href="#6b0cd6330b1f780f" class="i field">_errorBuffer</a> = <b>value</b>;
                    <a href="#f2d4fd7d6657647d" class="i property">ErrorBufferOwner</a> = <b>false</b>;
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the progress buffer. Powershell invocation writes</span>
        <span class="c">///</span><span class="c"> the progress data into this buffer. Can be null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2864fc2d24c87a5a" class="t t">InvalidPowerShellStateException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Powershell instance cannot be changed in its</span>
        <span class="c">///</span><span class="c"> current state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Usage&quot;</span>, <span class="s">&quot;CA2227:CollectionPropertiesShouldBeReadOnly&quot;</span>, <span class="i">Justification</span> = <span class="s">&quot;We want to allow callers to change the backing store.&quot;</span>)]
        <b>internal</b> <a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../ProgressRecord.cs.html#d79b27687c6ed8c8" class="t t">ProgressRecord</a>&gt; <a id="532171848f286698" href="../../R/532171848f286698.html" target="n" data-glyph="104,1" class="i property">ProgressBuffer</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#4bb26ab73ebaa6ca" class="i property">InformationalBuffers</a>.<a href="PSDataCollection.cs.html#341f946731d5405f" class="i property">Progress</a>;
            }
 
            <b>set</b>
            {
                <b>if</b> (<b>value</b> == <b>null</b>)
                {
                    <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<span class="s">&quot;Progress&quot;</span>);
                }
 
                <b>lock</b> (<a href="#57ad56a0d8f83c43" class="i field">_syncObject</a>)
                {
                    <a href="#68c9b1a93a2cdcde" class="i method">AssertChangesAreAccepted</a>();
                    <a href="#4bb26ab73ebaa6ca" class="i property">InformationalBuffers</a>.<a href="PSDataCollection.cs.html#341f946731d5405f" class="i property">Progress</a> = <b>value</b>;
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the verbose buffer. Powershell invocation writes</span>
        <span class="c">///</span><span class="c"> the verbose data into this buffer.  Can be null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2864fc2d24c87a5a" class="t t">InvalidPowerShellStateException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Powershell instance cannot be changed in its</span>
        <span class="c">///</span><span class="c"> current state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Usage&quot;</span>, <span class="s">&quot;CA2227:CollectionPropertiesShouldBeReadOnly&quot;</span>, <span class="i">Justification</span> = <span class="s">&quot;We want to allow callers to change the backing store.&quot;</span>)]
        <b>internal</b> <a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="InformationalRecord.cs.html#5d56339940b0040b" class="t t">VerboseRecord</a>&gt; <a id="132c72886803522e" href="../../R/132c72886803522e.html" target="n" data-glyph="104,1" class="i property">VerboseBuffer</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#4bb26ab73ebaa6ca" class="i property">InformationalBuffers</a>.<a href="PSDataCollection.cs.html#f9d116c8a717eb2e" class="i property">Verbose</a>;
            }
 
            <b>set</b>
            {
                <b>if</b> (<b>value</b> == <b>null</b>)
                {
                    <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<span class="s">&quot;Verbose&quot;</span>);
                }
 
                <b>lock</b> (<a href="#57ad56a0d8f83c43" class="i field">_syncObject</a>)
                {
                    <a href="#68c9b1a93a2cdcde" class="i method">AssertChangesAreAccepted</a>();
                    <a href="#4bb26ab73ebaa6ca" class="i property">InformationalBuffers</a>.<a href="PSDataCollection.cs.html#f9d116c8a717eb2e" class="i property">Verbose</a> = <b>value</b>;
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the debug buffer. Powershell invocation writes</span>
        <span class="c">///</span><span class="c"> the debug data into this buffer.  Can be null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2864fc2d24c87a5a" class="t t">InvalidPowerShellStateException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Powershell instance cannot be changed in its</span>
        <span class="c">///</span><span class="c"> current state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Usage&quot;</span>, <span class="s">&quot;CA2227:CollectionPropertiesShouldBeReadOnly&quot;</span>, <span class="i">Justification</span> = <span class="s">&quot;We want to allow callers to change the backing store.&quot;</span>)]
        <b>internal</b> <a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="InformationalRecord.cs.html#8954d4e40287d3de" class="t t">DebugRecord</a>&gt; <a id="f3b597fa5df321ed" href="../../R/f3b597fa5df321ed.html" target="n" data-glyph="104,1" class="i property">DebugBuffer</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#4bb26ab73ebaa6ca" class="i property">InformationalBuffers</a>.<a href="PSDataCollection.cs.html#428f5031eec1ab6d" class="i property">Debug</a>;
            }
 
            <b>set</b>
            {
                <b>if</b> (<b>value</b> == <b>null</b>)
                {
                    <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<span class="s">&quot;Debug&quot;</span>);
                }
 
                <b>lock</b> (<a href="#57ad56a0d8f83c43" class="i field">_syncObject</a>)
                {
                    <a href="#68c9b1a93a2cdcde" class="i method">AssertChangesAreAccepted</a>();
                    <a href="#4bb26ab73ebaa6ca" class="i property">InformationalBuffers</a>.<a href="PSDataCollection.cs.html#428f5031eec1ab6d" class="i property">Debug</a> = <b>value</b>;
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the warning buffer. Powershell invocation writes</span>
        <span class="c">///</span><span class="c"> the warning data into this buffer. Can be null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Cannot set to a null value.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2864fc2d24c87a5a" class="t t">InvalidPowerShellStateException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Powershell instance cannot be changed in its</span>
        <span class="c">///</span><span class="c"> current state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Usage&quot;</span>, <span class="s">&quot;CA2227:CollectionPropertiesShouldBeReadOnly&quot;</span>, <span class="i">Justification</span> = <span class="s">&quot;We want to allow callers to change the backing store.&quot;</span>)]
        <b>internal</b> <a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="InformationalRecord.cs.html#59cd69dde48b9557" class="t t">WarningRecord</a>&gt; <a id="f188cf7388929c96" href="../../R/f188cf7388929c96.html" target="n" data-glyph="104,1" class="i property">WarningBuffer</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#4bb26ab73ebaa6ca" class="i property">InformationalBuffers</a>.<a href="PSDataCollection.cs.html#d0aa35a60e8f5119" class="i property">Warning</a>;
            }
 
            <b>set</b>
            {
                <b>if</b> (<b>value</b> == <b>null</b>)
                {
                    <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<span class="s">&quot;Warning&quot;</span>);
                }
 
                <b>lock</b> (<a href="#57ad56a0d8f83c43" class="i field">_syncObject</a>)
                {
                    <a href="#68c9b1a93a2cdcde" class="i method">AssertChangesAreAccepted</a>();
                    <a href="#4bb26ab73ebaa6ca" class="i property">InformationalBuffers</a>.<a href="PSDataCollection.cs.html#d0aa35a60e8f5119" class="i property">Warning</a> = <b>value</b>;
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the information buffer. Powershell invocation writes</span>
        <span class="c">///</span><span class="c"> the information data into this buffer. Can be null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Cannot set to a null value.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2864fc2d24c87a5a" class="t t">InvalidPowerShellStateException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Powershell instance cannot be changed in its</span>
        <span class="c">///</span><span class="c"> current state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Usage&quot;</span>, <span class="s">&quot;CA2227:CollectionPropertiesShouldBeReadOnly&quot;</span>, <span class="i">Justification</span> = <span class="s">&quot;We want to allow callers to change the backing store.&quot;</span>)]
        <b>internal</b> <a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../InformationRecord.cs.html#508a9dbac37ec093" class="t t">InformationRecord</a>&gt; <a id="9d30dc57a23def37" href="../../R/9d30dc57a23def37.html" target="n" data-glyph="104,1" class="i property">InformationBuffer</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#4bb26ab73ebaa6ca" class="i property">InformationalBuffers</a>.<a href="PSDataCollection.cs.html#b9d573be12d08f30" class="i property">Information</a>;
            }
 
            <b>set</b>
            {
                <b>if</b> (<b>value</b> == <b>null</b>)
                {
                    <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<span class="s">&quot;Information&quot;</span>);
                }
 
                <b>lock</b> (<a href="#57ad56a0d8f83c43" class="i field">_syncObject</a>)
                {
                    <a href="#68c9b1a93a2cdcde" class="i method">AssertChangesAreAccepted</a>();
                    <a href="#4bb26ab73ebaa6ca" class="i property">InformationalBuffers</a>.<a href="PSDataCollection.cs.html#b9d573be12d08f30" class="i property">Information</a> = <b>value</b>;
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the informational buffers.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="PSDataCollection.cs.html#b80567add938623b" class="t t">PSInformationalBuffers</a> <a id="4bb26ab73ebaa6ca" href="../../R/4bb26ab73ebaa6ca.html" target="n" data-glyph="104,1" class="i property">InformationalBuffers</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If this flag is true, the commands in this Pipeline will redirect</span>
        <span class="c">///</span><span class="c"> the global error output pipe to the command&#39;s error output pipe.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> (see the comment in Pipeline.RedirectShellErrorOutputPipe for an</span>
        <span class="c">///</span><span class="c"> explanation of why this flag is needed)</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="1b4e6f691674a8b2" href="../../R/1b4e6f691674a8b2.html" target="n" data-glyph="104,1" class="i property">RedirectShellErrorOutputPipe</a> { <b>get</b>; <b>set</b>; } = <b>true</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Get unique id for this instance of runspace pool. It is primarily used</span>
        <span class="c">///</span><span class="c"> for logging purposes.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public</b> <span class="i">Guid</span> <a id="d8c9867186529e49" href="../../R/d8c9867186529e49.html" target="n" data-glyph="102,1" class="i property">InstanceId</a> { <b>get</b>; <b>private set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the execution state of the current PowerShell instance.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public</b> <a href="#42e325836d1ae967" class="t t">PSInvocationStateInfo</a> <a id="39b81acd3aeb1582" href="../../R/39b81acd3aeb1582.html" target="n" data-glyph="102,1" class="i property">InvocationStateInfo</a> { <b>get</b>; <b>private set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the property which indicates if this PowerShell instance</span>
        <span class="c">///</span><span class="c"> is nested.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public bool</b> <a id="32c156c0cba25702" href="../../R/32c156c0cba25702.html" target="n" data-glyph="102,1" class="i property">IsNested</a> { <b>get</b>; <b>private set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the property which indicates if this PowerShell instance</span>
        <span class="c">///</span><span class="c"> is a child instance.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> IsChild flag makes it possible for the pipeline to differentiate between</span>
        <span class="c">///</span><span class="c"> a true v1 nested pipeline and the cmdlets calling cmdlets case. See bug</span>
        <span class="c">///</span><span class="c"> 211462.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="d1ffd6dcd401bcb5" href="../../R/d1ffd6dcd401bcb5.html" target="n" data-glyph="104,1" class="i property">IsChild</a> { <b>get</b>; <b>private set</b>; } = <b>false</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If an error occurred while executing the pipeline, this will be set to true.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public bool</b> <a id="55e1a13ecd52fcd0" href="../../R/55e1a13ecd52fcd0.html" target="n" data-glyph="102,1" class="i property">HadErrors</a> { <b>get</b>; <b>private set</b>; }
 
        <b>internal void</b> <a id="87033b28ad23f4b2" href="../../R/87033b28ad23f4b2.html" target="n" data-glyph="74,1" class="i method">SetHadErrors</a>(<b>bool</b> <span id="r76 rd" class="r76 r">status</span>)
        {
            <a href="#55e1a13ecd52fcd0" class="i property">HadErrors</a> = <span class="r76 r">status</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Access to the EndInvoke AsyncResult object.  Used by remote</span>
        <span class="c">///</span><span class="c"> debugging to invoke debugger commands on command thread.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="AsyncResult.cs.html#f0fde6334f2a46e1" class="t t">AsyncResult</a> <a id="4f10d51ac16015a7" href="../../R/4f10d51ac16015a7.html" target="n" data-glyph="104,1" class="i property">EndInvokeAsyncResult</a>
        {
            <b>get</b>;
            <b>private set</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Event raised when PowerShell Execution State Changes.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public event</b> <span class="i">EventHandler</span>&lt;<a href="#b125d9adbaf88d43" class="t t">PSInvocationStateChangedEventArgs</a>&gt; <a id="c66682d1287920a2" href="../../R/c66682d1287920a2.html" target="n" data-glyph="30,1" class="i">InvocationStateChanged</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This event gets fired when a Runspace from the RunspacePool is assigned to this PowerShell</span>
        <span class="c">///</span><span class="c"> instance to invoke the commands.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal event</b> <span class="i">EventHandler</span>&lt;<a href="../EventManager.cs.html#03e55926b6f7cfe0" class="t t">PSEventArgs</a>&lt;<a href="Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a>&gt;&gt; <a id="e97b43f065651a57" href="../../R/e97b43f065651a57.html" target="n" data-glyph="32,1" class="i">RunspaceAssigned</a>;
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Public Methods
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Sets an associated Runspace for this PowerShell instance.</span>
        <span class="c">///</span><span class="c"> This can be null in which case a new runspace is created</span>
        <span class="c">///</span><span class="c"> whenever Invoke* method is called.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This property and RunspacePool are mutually exclusive; setting one of them resets the other to null</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2864fc2d24c87a5a" class="t t">InvalidPowerShellStateException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Powershell instance cannot be changed in its</span>
        <span class="c">///</span><span class="c"> current state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Naming&quot;</span>, <span class="s">&quot;CA1704:IdentifiersShouldBeSpelledCorrectly&quot;</span>, <span class="i">MessageId</span> = <span class="s">&quot;Runspace&quot;</span>, <span class="i">Justification</span> = <span class="s">&quot;Runspace is a well-known term in PowerShell.&quot;</span>)]
        <b>public</b> <a href="Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a> <a id="ccf57242c9d46642" href="../../R/ccf57242c9d46642.html" target="n" data-glyph="102,1" class="i property">Runspace</a>
        {
            <b>get</b>
            {
                <b>if</b> (<a href="#d6487a2f72366731" class="i field">_runspace</a> == <b>null</b> &amp;&amp; <a href="#fc0d3bf33e2b1469" class="i field">_runspacePool</a> == <b>null</b>) <span class="c">// create a runspace only if neither a runspace nor a runspace pool have been set</span>
                {
                    <b>lock</b> (<a href="#57ad56a0d8f83c43" class="i field">_syncObject</a>)
                    {
                        <b>if</b> (<a href="#d6487a2f72366731" class="i field">_runspace</a> == <b>null</b> &amp;&amp; <a href="#fc0d3bf33e2b1469" class="i field">_runspacePool</a> == <b>null</b>)
                        {
                            <a href="#68c9b1a93a2cdcde" class="i method">AssertChangesAreAccepted</a>();
                            <a href="#d47455cbca212aaf" class="i method">SetRunspace</a>(<a href="ConnectionFactory.cs.html#c5fbe142e4e21218" class="t t">RunspaceFactory</a>.<a href="ConnectionFactory.cs.html#d1898b5d69d8413b" class="i method">CreateRunspace</a>(), <b>true</b>);
                            <a href="#3d1b346df3be574c" class="k">this</a>.<a href="#ccf57242c9d46642" class="i property">Runspace</a>.<a href="Connection.cs.html#61f55439fb78f2fe" class="i method">Open</a>();
                        }
                    }
                }
 
                <b>return</b> <a href="#d6487a2f72366731" class="i field">_runspace</a>;
            }
 
            <b>set</b>
            {
                <b>lock</b> (<a href="#57ad56a0d8f83c43" class="i field">_syncObject</a>)
                {
                    <a href="#68c9b1a93a2cdcde" class="i method">AssertChangesAreAccepted</a>();
 
                    <b>if</b> (<a href="#d6487a2f72366731" class="i field">_runspace</a> != <b>null</b> &amp;&amp; <a href="#2d0966000c73a748" class="i property">IsRunspaceOwner</a>)
                    {
                        <a href="#d6487a2f72366731" class="i field">_runspace</a>.<a href="Connection.cs.html#47cd985e55a9f99c" class="i method">Dispose</a>();
                        <a href="#d6487a2f72366731" class="i field">_runspace</a> = <b>null</b>;
                        <a href="#2d0966000c73a748" class="i property">IsRunspaceOwner</a> = <b>false</b>;
                    }
 
                    <a href="#d47455cbca212aaf" class="i method">SetRunspace</a>(<b>value</b>, <b>false</b>);
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Internal method to set the Runspace property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private void</b> <a id="d47455cbca212aaf" href="../../R/d47455cbca212aaf.html" target="n" data-glyph="76,1" class="i method">SetRunspace</a>(<a href="Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a> <span id="r77 rd" class="r77 r">runspace</span>, <b>bool</b> <span id="r78 rd" class="r78 r">owner</span>)
        {
            <a href="../remoting/client/remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a> <span id="r79 rd" class="r79 r">remoteRunspace</span> = <span class="r77 r">runspace</span> <b>as</b> <a href="../remoting/client/remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a>;
 
            <b>if</b> (<span class="r79 r">remoteRunspace</span> == <b>null</b>)
            {
                <a href="#ccb6c738e7f3c724" class="i field">_rsConnection</a> = <span class="r77 r">runspace</span>;
            }
            <b>else</b>
            {
                <a href="#ccb6c738e7f3c724" class="i field">_rsConnection</a> = <span class="r79 r">remoteRunspace</span>.<a href="../remoting/client/remoterunspace.cs.html#52e4a4fcfd3da6a7" class="i property">RunspacePool</a>;
 
                <b>if</b> (<a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a> != <b>null</b>)
                {
                    <a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a>.<a href="../remoting/client/ClientRemotePowerShell.cs.html#9622f9b2a2b49e85" class="i method">Clear</a>();
                    <a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a>.<a href="../remoting/client/ClientRemotePowerShell.cs.html#245a7ee35136c31b" class="i method">Dispose</a>();
                }
 
                <a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a> = <b>new</b> <a href="../remoting/client/ClientRemotePowerShell.cs.html#963057b3fa7868fe" class="t constructor">ClientRemotePowerShell</a>(<a href="#3d1b346df3be574c" class="k">this</a>, <span class="r79 r">remoteRunspace</span>.<a href="../remoting/client/remoterunspace.cs.html#52e4a4fcfd3da6a7" class="i property">RunspacePool</a>.<a href="RunspacePool.cs.html#ae1c1c4ae8a5c648" class="i property">RemoteRunspacePoolInternal</a>);
            }
 
            <a href="#d6487a2f72366731" class="i field">_runspace</a> = <span class="r77 r">runspace</span>;
            <a href="#2d0966000c73a748" class="i property">IsRunspaceOwner</a> = <span class="r78 r">owner</span>;
            <a href="#fc0d3bf33e2b1469" class="i field">_runspacePool</a> = <b>null</b>;
        }
 
        <b>private</b> <a href="Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a> <a id="d6487a2f72366731" href="../../R/d6487a2f72366731.html" target="n" data-glyph="46,1" class="i field">_runspace</a> = <b>null</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Sets an associated RunspacePool for this PowerShell instance.</span>
        <span class="c">///</span><span class="c"> A Runspace from this pool is used whenever Invoke* method</span>
        <span class="c">///</span><span class="c"> is called.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> This can be null in which case a new runspace is created</span>
        <span class="c">///</span><span class="c"> whenever Invoke* method is called.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This property and Runspace are mutually exclusive; setting one of them resets the other to null</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2864fc2d24c87a5a" class="t t">InvalidPowerShellStateException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Powershell instance cannot be changed in its</span>
        <span class="c">///</span><span class="c"> current state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Naming&quot;</span>, <span class="s">&quot;CA1704:IdentifiersShouldBeSpelledCorrectly&quot;</span>, <span class="i">MessageId</span> = <span class="s">&quot;Runspace&quot;</span>, <span class="i">Justification</span> = <span class="s">&quot;Runspace is a well-known term in PowerShell.&quot;</span>)]
        <b>public</b> <a href="RunspacePool.cs.html#c1948c2f22e6b527" class="t t">RunspacePool</a> <a id="04184898f9307df6" href="../../R/04184898f9307df6.html" target="n" data-glyph="102,1" class="i property">RunspacePool</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#fc0d3bf33e2b1469" class="i field">_runspacePool</a>;
            }
 
            <b>set</b>
            {
                <b>if</b> (<b>value</b> != <b>null</b>)
                {
                    <b>lock</b> (<a href="#57ad56a0d8f83c43" class="i field">_syncObject</a>)
                    {
                        <a href="#68c9b1a93a2cdcde" class="i method">AssertChangesAreAccepted</a>();
 
                        <b>if</b> (<a href="#d6487a2f72366731" class="i field">_runspace</a> != <b>null</b> &amp;&amp; <a href="#2d0966000c73a748" class="i property">IsRunspaceOwner</a>)
                        {
                            <a href="#d6487a2f72366731" class="i field">_runspace</a>.<a href="Connection.cs.html#47cd985e55a9f99c" class="i method">Dispose</a>();
                            <a href="#d6487a2f72366731" class="i field">_runspace</a> = <b>null</b>;
                            <a href="#2d0966000c73a748" class="i property">IsRunspaceOwner</a> = <b>false</b>;
                        }
 
                        <a href="#ccb6c738e7f3c724" class="i field">_rsConnection</a> = <b>value</b>;
                        <a href="#fc0d3bf33e2b1469" class="i field">_runspacePool</a> = <b>value</b>;
 
                        <b>if</b> (<a href="#fc0d3bf33e2b1469" class="i field">_runspacePool</a>.<a href="RunspacePool.cs.html#6cd4c73a96856bcf" class="i property">IsRemote</a>)
                        {
                            <b>if</b> (<a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a> != <b>null</b>)
                            {
                                <a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a>.<a href="../remoting/client/ClientRemotePowerShell.cs.html#9622f9b2a2b49e85" class="i method">Clear</a>();
                                <a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a>.<a href="../remoting/client/ClientRemotePowerShell.cs.html#245a7ee35136c31b" class="i method">Dispose</a>();
                            }
 
                            <a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a> = <b>new</b>
                                <a href="../remoting/client/ClientRemotePowerShell.cs.html#963057b3fa7868fe" class="t constructor">ClientRemotePowerShell</a>(<a href="#3d1b346df3be574c" class="k">this</a>, <a href="#fc0d3bf33e2b1469" class="i field">_runspacePool</a>.<a href="RunspacePool.cs.html#ae1c1c4ae8a5c648" class="i property">RemoteRunspacePoolInternal</a>);
                        }
 
                        <a href="#d6487a2f72366731" class="i field">_runspace</a> = <b>null</b>;
                    }
                }
            }
        }
 
        <b>private</b> <a href="RunspacePool.cs.html#c1948c2f22e6b527" class="t t">RunspacePool</a> <a id="fc0d3bf33e2b1469" href="../../R/fc0d3bf33e2b1469.html" target="n" data-glyph="46,1" class="i field">_runspacePool</a> = <b>null</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the associated Runspace or RunspacePool for this PowerShell</span>
        <span class="c">///</span><span class="c"> instance. If this is null, PowerShell instance is not associated</span>
        <span class="c">///</span><span class="c"> with any runspace.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal object</b> <a id="503345e404ed0ddb" href="../../R/503345e404ed0ddb.html" target="n" data-glyph="74,1" class="i method">GetRunspaceConnection</a>()
        {
            <b>return</b> <a href="#ccb6c738e7f3c724" class="i field">_rsConnection</a>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Connect Support
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Synchronously connects to a running command on a remote server.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Command output as a PSDataCollection.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public</b> <span class="i">Collection</span>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <a id="fe120d91f29f69f6" href="../../R/fe120d91f29f69f6.html" target="n" data-glyph="72,1" class="i method">Connect</a>()
        {
            <span class="c">// Regardless of how the command was originally invoked, set this member</span>
            <span class="c">// variable to indicate the command is now running synchronously.</span>
            <a href="#e9453081966ac388" class="i field">_commandInvokedSynchronously</a> = <b>true</b>;
 
            <span class="i">IAsyncResult</span> <span id="r80 rd" class="r80 r">asyncResult</span> = <a href="#0ef55487a25fe8f5" class="i method">ConnectAsync</a>();
            <a href="#ba11495f3db79edb" class="t t">PowerShellAsyncResult</a> <span id="r81 rd" class="r81 r">psAsyncResult</span> = <span class="r80 r">asyncResult</span> <b>as</b> <a href="#ba11495f3db79edb" class="t t">PowerShellAsyncResult</a>;
 
            <span class="c">// Wait for command to complete.  If an exception was thrown during command</span>
            <span class="c">// execution (such as disconnect occurring during this synchronous execution)</span>
            <span class="c">// then the exception will be thrown here.</span>
            <a href="#4f10d51ac16015a7" class="i property">EndInvokeAsyncResult</a> = <span class="r81 r">psAsyncResult</span>;
            <span class="r81 r">psAsyncResult</span>.<a href="AsyncResult.cs.html#75f5584cab706e68" class="i method">EndInvoke</a>();
            <a href="#4f10d51ac16015a7" class="i property">EndInvokeAsyncResult</a> = <b>null</b>;
 
            <span class="i">Collection</span>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r82 rd" class="r82 r">results</span> = <b>null</b>;
            <b>if</b> (<span class="r81 r">psAsyncResult</span>.<a href="#df0dcbcd9acb5c6c" class="i property">Output</a> != <b>null</b>)
            {
                <span class="r82 r">results</span> = <span class="r81 r">psAsyncResult</span>.<a href="#df0dcbcd9acb5c6c" class="i property">Output</a>.<a href="PSDataCollection.cs.html#403be942120e2d89" class="i method">ReadAll</a>();
            }
            <b>else</b>
            {
                <span class="c">// Return empty collection.</span>
                <span class="r82 r">results</span> = <b>new</b> <span class="i">Collection</span>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;();
            }
 
            <b>return</b> <span class="r82 r">results</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Asynchronously connects to a running command on a remote server.</span>
        <span class="c">///</span><span class="c"> The returned IAsyncResult object can be used with EndInvoke() method</span>
        <span class="c">///</span><span class="c"> to wait on command and/or get command returned data.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">IAsyncResult.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public</b> <span class="i">IAsyncResult</span> <a id="0ef55487a25fe8f5" href="../../R/0ef55487a25fe8f5.html" target="n" data-glyph="72,1" class="i method">ConnectAsync</a>()
        {
            <b>return</b> <a href="#88136d3e7f560f5d" class="i method">ConnectAsync</a>(<b>null</b>, <b>null</b>, <b>null</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Asynchronously connects to a running command on a remote server.</span>
        <span class="c">///</span><span class="c"> The returned IAsyncResult object can be used with EndInvoke() method</span>
        <span class="c">///</span><span class="c"> to wait on command and/or get command returned data.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r83 r">output</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The output buffer to return from EndInvoke.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r84 r">invocationCallback</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An AsyncCallback to be called once the previous invocation has completed.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r85 r">state</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A user supplied state to call the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r84 r">invocationCallback</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> with.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">IAsyncResult.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public</b> <span class="i">IAsyncResult</span> <a id="88136d3e7f560f5d" href="../../R/88136d3e7f560f5d.html" target="n" data-glyph="72,1" class="i method">ConnectAsync</a>(
            <a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r83 rd" class="r83 r">output</span>,
            <span class="i">AsyncCallback</span> <span id="r84 rd" class="r84 r">invocationCallback</span>,
            <b>object</b> <span id="r85 rd" class="r85 r">state</span>)
        {
            <b>if</b> (<a href="#39b81acd3aeb1582" class="i property">InvocationStateInfo</a>.<a href="#7a70ff5163d0f044" class="i property">State</a> != <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#55f5ed5d1c0f010a" class="i field">Disconnected</a>)
            {
                <b>throw</b> <b>new</b> <a href="#bdb2839004600662" class="t constructor">InvalidPowerShellStateException</a>(<a href="#39b81acd3aeb1582" class="i property">InvocationStateInfo</a>.<a href="#7a70ff5163d0f044" class="i property">State</a>);
            }
 
            <span class="c">// Ensure this is a command invoked on a remote runspace(pool) and connect the</span>
            <span class="c">// runspace if it is currently disconnected.</span>
            <a href="#d345dec335f0fa58" class="i method">CheckRunspacePoolAndConnect</a>();
 
            <b>if</b> (<a href="#1462181f6b1205aa" class="i field">_connectCmdInfo</a> != <b>null</b>)
            {
                <span class="c">//</span>
                <span class="c">// This is a reconstruct/connect scenario and we create new state.</span>
                <span class="c">//</span>
 
                <a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r86 rd" class="r86 r">streamToUse</span> = <a href="#a29e9daed047bb39" class="i property">OutputBuffer</a>;
 
                <span class="c">// The remotePowerShell may have been initialized by InitForRemotePipelineConnect()</span>
                <b>if</b> (!<a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a>.<a href="../remoting/client/ClientRemotePowerShell.cs.html#4f8237be57be8c4e" class="i property">Initialized</a>)
                {
                    <span class="c">// Empty input stream.</span>
                    <a href="../../utils/ObjectStream.cs.html#27e9349816faeecb" class="t t">ObjectStreamBase</a> <span id="r87 rd" class="r87 r">inputStream</span> = <b>new</b> <a href="../../utils/ObjectStream.cs.html#9f848b3587e1f797" class="t constructor">ObjectStream</a>();
                    <span class="r87 r">inputStream</span>.<a href="../../utils/ObjectStream.cs.html#2bbebf10cbee9e83" class="i method">Close</a>();
 
                    <span class="c">// Output stream.</span>
                    <b>if</b> (<span class="r83 r">output</span> != <b>null</b>)
                    {
                        <span class="c">// Use the supplied output buffer.</span>
                        <a href="#a29e9daed047bb39" class="i property">OutputBuffer</a> = <span class="r83 r">output</span>;
                        <a href="#06852585cb89a70d" class="i property">OutputBufferOwner</a> = <b>false</b>;
                    }
                    <b>else</b> <b>if</b> (<a href="#a29e9daed047bb39" class="i property">OutputBuffer</a> == <b>null</b>)
                    {
                        <a href="#a29e9daed047bb39" class="i property">OutputBuffer</a> = <b>new</b> <a href="PSDataCollection.cs.html#ee85ce3306fe4e5b" class="t constructor">PSDataCollection</a>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;();
                        <a href="#06852585cb89a70d" class="i property">OutputBufferOwner</a> = <b>true</b>;
                    }
 
                    <span class="r86 r">streamToUse</span> = <a href="#a29e9daed047bb39" class="i property">OutputBuffer</a>;
 
                    <a href="../../utils/ObjectStream.cs.html#27e9349816faeecb" class="t t">ObjectStreamBase</a> <span id="r88 rd" class="r88 r">outputStream</span> = <b>new</b> <a href="../../utils/ObjectStream.cs.html#472e4f0d3c7801e9" class="t constructor">PSDataCollectionStream</a>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;(<a href="#d8c9867186529e49" class="i property">InstanceId</a>, <span class="r86 r">streamToUse</span>);
 
                    <a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a>.<a href="../remoting/client/ClientRemotePowerShell.cs.html#86db8930303b5c9a" class="i method">Initialize</a>(<span class="r87 r">inputStream</span>, <span class="r88 r">outputStream</span>,
                                                     <b>new</b> <a href="../../utils/ObjectStream.cs.html#472e4f0d3c7801e9" class="t constructor">PSDataCollectionStream</a>&lt;<a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a>&gt;(<a href="#d8c9867186529e49" class="i property">InstanceId</a>, <a href="#6b0cd6330b1f780f" class="i field">_errorBuffer</a>),
                                                     <a href="#4bb26ab73ebaa6ca" class="i property">InformationalBuffers</a>, <b>null</b>);
                }
 
                <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>((<a href="#aa2e4c96efcd9075" class="i field">_invokeAsyncResult</a> == <b>null</b>), <span class="s">&quot;Async result should be null in the reconstruct scenario.&quot;</span>);
                <a href="#aa2e4c96efcd9075" class="i field">_invokeAsyncResult</a> = <b>new</b> <a href="#a573e20febced368" class="t constructor">PowerShellAsyncResult</a>(<a href="#d8c9867186529e49" class="i property">InstanceId</a>, <span class="r84 r">invocationCallback</span>, <span class="r85 r">state</span>, <span class="r86 r">streamToUse</span>, <b>true</b>);
            }
            <b>else</b>
            {
                <span class="c">// If this is not a reconstruct scenario then this must be a PowerShell object that was</span>
                <span class="c">// previously disconnected, and all state should be valid.</span>
                <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>((<a href="#aa2e4c96efcd9075" class="i field">_invokeAsyncResult</a> != <b>null</b> &amp;&amp; <a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a>.<a href="../remoting/client/ClientRemotePowerShell.cs.html#4f8237be57be8c4e" class="i property">Initialized</a>),
                            <span class="s">&quot;AsyncResult and RemotePowerShell objects must be valid here.&quot;</span>);
 
                <b>if</b> (<span class="r83 r">output</span> != <b>null</b> ||
                    <span class="r84 r">invocationCallback</span> != <b>null</b> ||
                    <a href="#aa2e4c96efcd9075" class="i field">_invokeAsyncResult</a>.<a href="AsyncResult.cs.html#8d04b010297eb52a" class="i property">IsCompleted</a>)
                {
                    <span class="c">// A new async object is needed.</span>
                    <a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r89 rd" class="r89 r">streamToUse</span>;
                    <b>if</b> (<span class="r83 r">output</span> != <b>null</b>)
                    {
                        <span class="r89 r">streamToUse</span> = <span class="r83 r">output</span>;
                        <a href="#a29e9daed047bb39" class="i property">OutputBuffer</a> = <span class="r83 r">output</span>;
                        <a href="#06852585cb89a70d" class="i property">OutputBufferOwner</a> = <b>false</b>;
                    }
                    <b>else</b> <b>if</b> (<a href="#aa2e4c96efcd9075" class="i field">_invokeAsyncResult</a>.<a href="#df0dcbcd9acb5c6c" class="i property">Output</a> == <b>null</b> ||
                             !<a href="#aa2e4c96efcd9075" class="i field">_invokeAsyncResult</a>.<a href="#df0dcbcd9acb5c6c" class="i property">Output</a>.<a href="PSDataCollection.cs.html#c160386455270a8f" class="i property">IsOpen</a>)
                    {
                        <a href="#a29e9daed047bb39" class="i property">OutputBuffer</a> = <b>new</b> <a href="PSDataCollection.cs.html#ee85ce3306fe4e5b" class="t constructor">PSDataCollection</a>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;();
                        <a href="#06852585cb89a70d" class="i property">OutputBufferOwner</a> = <b>true</b>;
                        <span class="r89 r">streamToUse</span> = <a href="#a29e9daed047bb39" class="i property">OutputBuffer</a>;
                    }
                    <b>else</b>
                    {
                        <span class="r89 r">streamToUse</span> = <a href="#aa2e4c96efcd9075" class="i field">_invokeAsyncResult</a>.<a href="#df0dcbcd9acb5c6c" class="i property">Output</a>;
                        <a href="#a29e9daed047bb39" class="i property">OutputBuffer</a> = <span class="r89 r">streamToUse</span>;
                        <a href="#06852585cb89a70d" class="i property">OutputBufferOwner</a> = <b>false</b>;
                    }
 
                    <a href="#aa2e4c96efcd9075" class="i field">_invokeAsyncResult</a> = <b>new</b> <span class="t">PowerShellAsyncResult</span>(
                        <a href="#d8c9867186529e49" class="i property">InstanceId</a>,
                        <span class="r84 r">invocationCallback</span> ?? <a href="#aa2e4c96efcd9075" class="i field">_invokeAsyncResult</a>.<a href="AsyncResult.cs.html#1daaea6e8290856d" class="i property">Callback</a>,
                        (<span class="r84 r">invocationCallback</span> != <b>null</b>) ? <span class="r85 r">state</span> : <a href="#aa2e4c96efcd9075" class="i field">_invokeAsyncResult</a>.<a href="AsyncResult.cs.html#90eec6fb5cd1c7c3" class="i property">AsyncState</a>,
                        <span class="r89 r">streamToUse</span>,
                        <b>true</b>);
                }
            }
 
            <b>try</b>
            {
                <span class="c">// Perform the connect operation to the remote server through the PSRP layer.</span>
                <span class="c">// If this.connectCmdInfo is null then a connection will be attempted using current state.</span>
                <span class="c">// If this.connectCmdInfo is non-null then a connection will be attempted with this info.</span>
                <a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a>.<a href="../remoting/client/ClientRemotePowerShell.cs.html#c5b1963ce07409c4" class="i method">ConnectAsync</a>(<a href="#1462181f6b1205aa" class="i field">_connectCmdInfo</a>);
            }
            <b>catch</b> (<span class="i">Exception</span> <span id="r90 rd" class="r90 r">exception</span>)
            {
                <span class="c">// allow GC collection</span>
                <a href="#aa2e4c96efcd9075" class="i field">_invokeAsyncResult</a> = <b>null</b>;
                <a href="#8bc5b0d04eada2b1" class="i method">SetStateChanged</a>(<b>new</b> <a href="#db44bd87590c83f5" class="t constructor">PSInvocationStateInfo</a>(<a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#35065a8449cad351" class="i field">Failed</a>, <span class="r90 r">exception</span>));
 
                <span class="c">// re-throw the exception</span>
                <a href="RunspacePool.cs.html#741ffc1755303d69" class="t t">InvalidRunspacePoolStateException</a> <span id="r91 rd" class="r91 r">poolException</span> = <span class="r90 r">exception</span> <b>as</b> <a href="RunspacePool.cs.html#741ffc1755303d69" class="t t">InvalidRunspacePoolStateException</a>;
                <b>if</b> (<span class="r91 r">poolException</span> != <b>null</b> &amp;&amp; <a href="#d6487a2f72366731" class="i field">_runspace</a> != <b>null</b>) <span class="c">// the pool exception was actually thrown by a runspace</span>
                {
                    <b>throw</b> <span class="r91 r">poolException</span>.<a href="RunspacePool.cs.html#aeea64df1e9df609" class="i method">ToInvalidRunspaceStateException</a>();
                }
 
                <b>throw</b>;
            }
 
            <b>return</b> <a href="#aa2e4c96efcd9075" class="i field">_invokeAsyncResult</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Checks that the current runspace associated with this PowerShell is a remote runspace,</span>
        <span class="c">///</span><span class="c"> and if it is in Disconnected state then to connect it.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private void</b> <a id="d345dec335f0fa58" href="../../R/d345dec335f0fa58.html" target="n" data-glyph="76,1" class="i method">CheckRunspacePoolAndConnect</a>()
        {
            <a href="../remoting/client/RemoteRunspacePoolInternal.cs.html#1aba79be5da56f57" class="t t">RemoteRunspacePoolInternal</a> <span id="r92 rd" class="r92 r">remoteRunspacePoolInternal</span> = <b>null</b>;
            <b>if</b> (<a href="#ccb6c738e7f3c724" class="i field">_rsConnection</a> <b>is</b> <a href="../remoting/client/remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a>)
            {
                <span class="r92 r">remoteRunspacePoolInternal</span> = (<a href="#ccb6c738e7f3c724" class="i field">_rsConnection</a> <b>as</b> <a href="../remoting/client/remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a>).<a href="../remoting/client/remoterunspace.cs.html#52e4a4fcfd3da6a7" class="i property">RunspacePool</a>.<a href="RunspacePool.cs.html#ae1c1c4ae8a5c648" class="i property">RemoteRunspacePoolInternal</a>;
            }
            <b>else</b> <b>if</b> (<a href="#ccb6c738e7f3c724" class="i field">_rsConnection</a> <b>is</b> <a href="RunspacePool.cs.html#c1948c2f22e6b527" class="t t">RunspacePool</a>)
            {
                <span class="r92 r">remoteRunspacePoolInternal</span> = (<a href="#ccb6c738e7f3c724" class="i field">_rsConnection</a> <b>as</b> <a href="RunspacePool.cs.html#c1948c2f22e6b527" class="t t">RunspacePool</a>).<a href="RunspacePool.cs.html#ae1c1c4ae8a5c648" class="i property">RemoteRunspacePoolInternal</a>;
            }
 
            <b>if</b> (<span class="r92 r">remoteRunspacePoolInternal</span> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <span class="i">InvalidOperationException</span>(<span class="i">PowerShellStrings</span>.<span class="i">CannotConnect</span>);
            }
 
            <span class="c">// Connect runspace if needed.</span>
            <b>if</b> (<span class="r92 r">remoteRunspacePoolInternal</span>.<a href="RunspacePoolInternal.cs.html#f220504d3677222f" class="i property">RunspacePoolStateInfo</a>.<a href="../remoting/common/RunspacePoolStateInfo.cs.html#1260ebc06dcda58e" class="i property">State</a> == <a href="RunspacePool.cs.html#b51dd15975151fb4" class="t t">RunspacePoolState</a>.<a href="RunspacePool.cs.html#fb0d368190577383" class="i field">Disconnected</a>)
            {
                <span class="r92 r">remoteRunspacePoolInternal</span>.<a href="../remoting/client/RemoteRunspacePoolInternal.cs.html#a8ae5a36ba4939ef" class="i method">Connect</a>();
            }
 
            <span class="c">// Make sure runspace is in valid state for connection.</span>
            <b>if</b> (<span class="r92 r">remoteRunspacePoolInternal</span>.<a href="RunspacePoolInternal.cs.html#f220504d3677222f" class="i property">RunspacePoolStateInfo</a>.<a href="../remoting/common/RunspacePoolStateInfo.cs.html#1260ebc06dcda58e" class="i property">State</a> != <a href="RunspacePool.cs.html#b51dd15975151fb4" class="t t">RunspacePoolState</a>.<a href="RunspacePool.cs.html#13cbf83371c004e0" class="i field">Opened</a>)
            {
                <b>throw</b> <b>new</b> <span class="t">InvalidRunspacePoolStateException</span>(<span class="i">RunspacePoolStrings</span>.<span class="i">InvalidRunspacePoolState</span>,
                                    <span class="r92 r">remoteRunspacePoolInternal</span>.<a href="RunspacePoolInternal.cs.html#f220504d3677222f" class="i property">RunspacePoolStateInfo</a>.<a href="../remoting/common/RunspacePoolStateInfo.cs.html#1260ebc06dcda58e" class="i property">State</a>, <a href="RunspacePool.cs.html#b51dd15975151fb4" class="t t">RunspacePoolState</a>.<a href="RunspacePool.cs.html#13cbf83371c004e0" class="i field">Opened</a>);
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Script Debugger Support
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This method allows the script debugger first crack at evaluating the</span>
        <span class="c">///</span><span class="c"> command in case it is a debugger command, otherwise the command is</span>
        <span class="c">///</span><span class="c"> evaluated by PowerShell.</span>
        <span class="c">///</span><span class="c"> If the debugger evaluated a command then DebuggerCommand.ResumeAction</span>
        <span class="c">///</span><span class="c"> value will be set appropriately.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r93 r">input</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Input.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r94 r">output</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Output collection.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r95 r">settings</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">PS invocation settings.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r96 r">invokeMustRun</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">True if PowerShell Invoke must run regardless</span>
        <span class="c">///</span><span class="c"> of whether debugger handles the command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">DebuggerCommandResults.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="9bd41eec27acb6ce" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">InvokeWithDebugger</a>(
            <span class="i">IEnumerable</span>&lt;<b>object</b>&gt; <span id="r93 rd" class="r93 r">input</span>,
            <span class="i">IList</span>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r94 rd" class="r94 r">output</span>,
            <a href="#ce65c0834aa6f0ea" class="t t">PSInvocationSettings</a> <span id="r95 rd" class="r95 r">settings</span>,
            <b>bool</b> <span id="r96 rd" class="r96 r">invokeMustRun</span>)
        {
            <a href="../debugger/debugger.cs.html#9e8f0b396592e65c" class="t t">Debugger</a> <span id="r97 rd" class="r97 r">debugger</span> = <a href="#d6487a2f72366731" class="i field">_runspace</a>.<a href="Connection.cs.html#d6610640d00b19f5" class="i property">Debugger</a>;
            <b>bool</b> <span id="r98 rd" class="r98 r">addToHistory</span> = <b>true</b>;
 
            <b>if</b> (<span class="r97 r">debugger</span> != <b>null</b> &amp;&amp;
                <a href="#7bde27452e045465" class="i property">Commands</a>.<a href="PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>.<span class="i">Count</span> &gt; 0)
            {
                <a href="Command.cs.html#b55b68a3bf75e612" class="t t">Command</a> <span id="r99 rd" class="r99 r">cmd</span> = <a href="#3d1b346df3be574c" class="k">this</a>.<a href="#7bde27452e045465" class="i property">Commands</a>.<a href="PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>[0];
 
                <a href="../debugger/debugger.cs.html#bcdf979426ef3d7b" class="t t">DebuggerCommand</a> <span id="r100 rd" class="r100 r">dbgCommandResult</span> = <span class="r97 r">debugger</span>.<a href="../debugger/debugger.cs.html#e8d4b0c08ae40f99" class="i method">InternalProcessCommand</a>(
                    <span class="r99 r">cmd</span>.<a href="Command.cs.html#e67df99c50711b7c" class="i property">CommandText</a>, <span class="r94 r">output</span>);
 
                <b>if</b> (<span class="r100 r">dbgCommandResult</span>.<a href="../debugger/debugger.cs.html#4aad237c27ce8bd0" class="i property">ResumeAction</a> != <b>null</b> ||
                    <span class="r100 r">dbgCommandResult</span>.<a href="../debugger/debugger.cs.html#ed0eefa60321fd1e" class="i property">ExecutedByDebugger</a>)
                {
                    <span class="r94 r">output</span>.<span class="i">Add</span>(<b>new</b> <a href="../MshObject.cs.html#3ee1d75e736c4afc" class="t constructor">PSObject</a>(<span class="r100 r">dbgCommandResult</span>));
                    <a href="#7bde27452e045465" class="i property">Commands</a>.<a href="PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>.<span class="i">Clear</span>();
                    <span class="r98 r">addToHistory</span> = <b>false</b>;
                }
                <b>else</b> <b>if</b> (!<span class="r100 r">dbgCommandResult</span>.<a href="../debugger/debugger.cs.html#cfe86dbfb45868ad" class="i property">Command</a>.<span class="i">Equals</span>(<span class="r99 r">cmd</span>.<a href="Command.cs.html#e67df99c50711b7c" class="i property">CommandText</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <span class="c">// Script debugger will replace commands, e.g., &quot;k&quot; -&gt; &quot;Get-PSCallStack&quot;.</span>
                    <a href="#7bde27452e045465" class="i property">Commands</a>.<a href="PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>[0] = <b>new</b> <a href="Command.cs.html#4f147eb3e5cf10da" class="t constructor">Command</a>(<span class="r100 r">dbgCommandResult</span>.<a href="../debugger/debugger.cs.html#cfe86dbfb45868ad" class="i property">Command</a>, <b>false</b>, <b>true</b>, <b>true</b>);
 
                    <span class="c">// Report that these replaced commands are executed by the debugger.</span>
                    <a href="../debugger/debugger.cs.html#bcdf979426ef3d7b" class="t t">DebuggerCommand</a> <span id="r101 rd" class="r101 r">dbgCommand</span> = <b>new</b> <a href="../debugger/debugger.cs.html#a148408d8489fb6c" class="t constructor">DebuggerCommand</a>(<span class="r100 r">dbgCommandResult</span>.<a href="../debugger/debugger.cs.html#cfe86dbfb45868ad" class="i property">Command</a>, <b>null</b>, <b>false</b>, <b>true</b>);
                    <span class="r94 r">output</span>.<span class="i">Add</span>(<b>new</b> <a href="../MshObject.cs.html#3ee1d75e736c4afc" class="t constructor">PSObject</a>(<span class="r101 r">dbgCommand</span>));
                    <span class="r98 r">addToHistory</span> = <b>false</b>;
                }
            }
 
            <b>if</b> (<span class="r98 r">addToHistory</span> &amp;&amp; (<a href="#7bde27452e045465" class="i property">Commands</a>.<a href="PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>.<span class="i">Count</span> &gt; 0))
            {
                <span class="r98 r">addToHistory</span> = <a href="../debugger/debugger.cs.html#a25b6893c0f6ac59" class="t t">DebuggerUtils</a>.<span class="i">ShouldAddCommandToHistory</span>(
                    <a href="#7bde27452e045465" class="i property">Commands</a>.<a href="PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>[0].<span class="i">CommandText</span>);
            }
 
            <span class="c">// Remote PowerShell Invoke must always run Invoke so that the</span>
            <span class="c">// command can complete.</span>
            <b>if</b> (<a href="#7bde27452e045465" class="i property">Commands</a>.<a href="PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>.<span class="i">Count</span> == 0 &amp;&amp;
                <span class="r96 r">invokeMustRun</span>)
            {
                <a href="#7bde27452e045465" class="i property">Commands</a>.<a href="PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>.<span class="i">AddScript</span>(<b>string</b>.<span class="i">Empty</span>);
            }
 
            <b>if</b> (<a href="#7bde27452e045465" class="i property">Commands</a>.<a href="PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>.<span class="i">Count</span> &gt; 0)
            {
                <b>if</b> (<span class="r98 r">addToHistory</span>)
                {
                    <b>if</b> (<span class="r95 r">settings</span> == <b>null</b>)
                    {
                        <span class="r95 r">settings</span> = <b>new</b> <a href="#3f472392b2d45c15" class="t constructor">PSInvocationSettings</a>();
                    }
 
                    <span class="r95 r">settings</span>.<a href="#27a80b1485d6fbda" class="i property">AddToHistory</a> = <b>true</b>;
                }
 
                <span class="i">Invoke</span>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;(<span class="r93 r">input</span>, <span class="r94 r">output</span>, <span class="r95 r">settings</span>);
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Invoke Overloads
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invoke the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="Command.cs.html#b55b68a3bf75e612" class="t t">Command</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> synchronously and return</span>
        <span class="c">///</span><span class="c"> the output PSObject collection.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> collection of PSObjects.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Cannot perform the operation because the command is</span>
        <span class="c">///</span><span class="c"> already started.Stop the command and try the operation again.</span>
        <span class="c">///</span><span class="c"> (or)</span>
        <span class="c">///</span><span class="c"> No commands are specified.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#fa64ade1e4dc44f8" class="t t">ScriptCallDepthException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The script recursed too deeply into script functions.</span>
        <span class="c">///</span><span class="c"> There is a fixed limit on the depth of recursion.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A CLR security violation occurred.  Typically, this happens</span>
        <span class="c">///</span><span class="c"> because the current CLR permissions do not allow adequate</span>
        <span class="c">///</span><span class="c"> reflection access to a cmdlet assembly.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> PowerShell.Invoke can throw a variety of exceptions derived</span>
        <span class="c">///</span><span class="c"> from RuntimeException. The most likely of these exceptions</span>
        <span class="c">///</span><span class="c"> are listed below.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ParameterBinderExceptions.cs.html#8e3f022461e43e12" class="t t">ParameterBindingException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> One of more parameters or parameter values specified for</span>
        <span class="c">///</span><span class="c"> a cmdlet are not valid, or mandatory parameters for a cmdlet</span>
        <span class="c">///</span><span class="c"> were not specified.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#7b242746a433b370" class="t t">CmdletInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A cmdlet generated a terminating error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#f88a59685dc8d13e" class="t t">CmdletProviderInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A provider generated a terminating error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#f896df45dff24981" class="t t">ActionPreferenceStopException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The ActionPreference.Stop or ActionPreference.Inquire policy</span>
        <span class="c">///</span><span class="c"> triggered a terminating error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The pipeline was terminated asynchronously.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/MetadataExceptions.cs.html#3bf974090c4e60a1" class="t t">MetadataException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If there is an error generating the metadata for dynamic parameters.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public</b> <span class="i">Collection</span>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <a id="184e23c46120523e" href="../../R/184e23c46120523e.html" target="n" data-glyph="72,1" class="i method">Invoke</a>()
        {
            <b>return</b> <a href="#deaaadfa4eaf557e" class="i method">Invoke</a>(<b>null</b>, <b>null</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invoke the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="Command.cs.html#b55b68a3bf75e612" class="t t">Command</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> synchronously and return</span>
        <span class="c">///</span><span class="c"> the output PSObject collection.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r102 r">input</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Input to the command</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Collection of PSObjects representing output.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Cannot perform the operation because the command is</span>
        <span class="c">///</span><span class="c"> already started.Stop the command and try the operation again.</span>
        <span class="c">///</span><span class="c"> (or)</span>
        <span class="c">///</span><span class="c"> No commands are specified.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#fa64ade1e4dc44f8" class="t t">ScriptCallDepthException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The script recursed too deeply into script functions.</span>
        <span class="c">///</span><span class="c"> There is a fixed limit on the depth of recursion.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A CLR security violation occurred.  Typically, this happens</span>
        <span class="c">///</span><span class="c"> because the current CLR permissions do not allow adequate</span>
        <span class="c">///</span><span class="c"> reflection access to a cmdlet assembly.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> PowerShell.Invoke can throw a variety of exceptions derived</span>
        <span class="c">///</span><span class="c"> from RuntimeException. The most likely of these exceptions</span>
        <span class="c">///</span><span class="c"> are listed below.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ParameterBinderExceptions.cs.html#8e3f022461e43e12" class="t t">ParameterBindingException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> One of more parameters or parameter values specified for</span>
        <span class="c">///</span><span class="c"> a cmdlet are not valid, or mandatory parameters for a cmdlet</span>
        <span class="c">///</span><span class="c"> were not specified.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#7b242746a433b370" class="t t">CmdletInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A cmdlet generated a terminating error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#f88a59685dc8d13e" class="t t">CmdletProviderInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A provider generated a terminating error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#f896df45dff24981" class="t t">ActionPreferenceStopException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The ActionPreference.Stop or ActionPreference.Inquire policy</span>
        <span class="c">///</span><span class="c"> triggered a terminating error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The pipeline was terminated asynchronously.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/MetadataExceptions.cs.html#3bf974090c4e60a1" class="t t">MetadataException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If there is an error generating the metadata for dynamic parameters.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public</b> <span class="i">Collection</span>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <a id="4056da8e2d48f152" href="../../R/4056da8e2d48f152.html" target="n" data-glyph="72,1" class="i method">Invoke</a>(<span class="i">IEnumerable</span> <span id="r102 rd" class="r102 r">input</span>)
        {
            <b>return</b> <a href="#deaaadfa4eaf557e" class="i method">Invoke</a>(<span class="r102 r">input</span>, <b>null</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invoke the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="Command.cs.html#b55b68a3bf75e612" class="t t">Command</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> synchronously and return</span>
        <span class="c">///</span><span class="c"> the output PSObject collection.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r103 r">input</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Input to the command</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r104 r">settings</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invocation Settings</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Collection of PSObjects representing output.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Cannot perform the operation because the command is</span>
        <span class="c">///</span><span class="c"> already started.Stop the command and try the operation again.</span>
        <span class="c">///</span><span class="c"> (or)</span>
        <span class="c">///</span><span class="c"> No commands are specified.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#fa64ade1e4dc44f8" class="t t">ScriptCallDepthException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The script recursed too deeply into script functions.</span>
        <span class="c">///</span><span class="c"> There is a fixed limit on the depth of recursion.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A CLR security violation occurred.  Typically, this happens</span>
        <span class="c">///</span><span class="c"> because the current CLR permissions do not allow adequate</span>
        <span class="c">///</span><span class="c"> reflection access to a cmdlet assembly.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> PowerShell.Invoke can throw a variety of exceptions derived</span>
        <span class="c">///</span><span class="c"> from RuntimeException. The most likely of these exceptions</span>
        <span class="c">///</span><span class="c"> are listed below.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ParameterBinderExceptions.cs.html#8e3f022461e43e12" class="t t">ParameterBindingException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> One of more parameters or parameter values specified for</span>
        <span class="c">///</span><span class="c"> a cmdlet are not valid, or mandatory parameters for a cmdlet</span>
        <span class="c">///</span><span class="c"> were not specified.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#7b242746a433b370" class="t t">CmdletInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A cmdlet generated a terminating error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#f88a59685dc8d13e" class="t t">CmdletProviderInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A provider generated a terminating error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#f896df45dff24981" class="t t">ActionPreferenceStopException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The ActionPreference.Stop or ActionPreference.Inquire policy</span>
        <span class="c">///</span><span class="c"> triggered a terminating error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The pipeline was terminated asynchronously.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/MetadataExceptions.cs.html#3bf974090c4e60a1" class="t t">MetadataException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If there is an error generating the metadata for dynamic parameters.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public</b> <span class="i">Collection</span>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <a id="deaaadfa4eaf557e" href="../../R/deaaadfa4eaf557e.html" target="n" data-glyph="72,1" class="i method">Invoke</a>(<span class="i">IEnumerable</span> <span id="r103 rd" class="r103 r">input</span>, <a href="#ce65c0834aa6f0ea" class="t t">PSInvocationSettings</a> <span id="r104 rd" class="r104 r">settings</span>)
        {
            <span class="i">Collection</span>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r105 rd" class="r105 r">result</span> = <b>new</b> <span class="i">Collection</span>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;();
            <a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r106 rd" class="r106 r">listToWriteTo</span> = <b>new</b> <span class="t">PSDataCollection</span>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;(<span class="r105 r">result</span>);
            <a href="#695c3aa5903e6866" class="i method">CoreInvoke</a>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;(<span class="r103 r">input</span>, <span class="r106 r">listToWriteTo</span>, <span class="r104 r">settings</span>);
            <b>return</b> <span class="r105 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invoke the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="Command.cs.html#b55b68a3bf75e612" class="t t">Command</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> synchronously and return</span>
        <span class="c">///</span><span class="c"> the output.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r107 r t">T</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Type of output object(s) expected from the command invocation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Cannot perform the operation because the command is</span>
        <span class="c">///</span><span class="c"> already started.Stop the command and try the operation again.</span>
        <span class="c">///</span><span class="c"> (or)</span>
        <span class="c">///</span><span class="c"> No commands are specified.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#fa64ade1e4dc44f8" class="t t">ScriptCallDepthException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The script recursed too deeply into script functions.</span>
        <span class="c">///</span><span class="c"> There is a fixed limit on the depth of recursion.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A CLR security violation occurred.  Typically, this happens</span>
        <span class="c">///</span><span class="c"> because the current CLR permissions do not allow adequate</span>
        <span class="c">///</span><span class="c"> reflection access to a cmdlet assembly.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> PowerShell.Invoke can throw a variety of exceptions derived</span>
        <span class="c">///</span><span class="c"> from RuntimeException. The most likely of these exceptions</span>
        <span class="c">///</span><span class="c"> are listed below.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ParameterBinderExceptions.cs.html#8e3f022461e43e12" class="t t">ParameterBindingException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> One of more parameters or parameter values specified for</span>
        <span class="c">///</span><span class="c"> a cmdlet are not valid, or mandatory parameters for a cmdlet</span>
        <span class="c">///</span><span class="c"> were not specified.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#7b242746a433b370" class="t t">CmdletInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A cmdlet generated a terminating error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#f88a59685dc8d13e" class="t t">CmdletProviderInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A provider generated a terminating error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#f896df45dff24981" class="t t">ActionPreferenceStopException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The ActionPreference.Stop or ActionPreference.Inquire policy</span>
        <span class="c">///</span><span class="c"> triggered a terminating error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The pipeline was terminated asynchronously.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/MetadataExceptions.cs.html#3bf974090c4e60a1" class="t t">MetadataException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If there is an error generating the metadata for dynamic parameters.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public</b> <span class="i">Collection</span>&lt;<span class="r107 r t">T</span>&gt; <a id="11053e110c66cae7" href="../../R/11053e110c66cae7.html" target="n" data-glyph="72,1" class="i method">Invoke</a>&lt;<span id="r107 rd t" class="r107 r t">T</span>&gt;()
        {
            <span class="c">// We should bind all the results to this instance except</span>
            <span class="c">// for output.</span>
            <span class="i">Collection</span>&lt;<span class="r107 r t">T</span>&gt; <span id="r108 rd" class="r108 r">result</span> = <b>new</b> <span class="i">Collection</span>&lt;<span class="r107 r t">T</span>&gt;();
            <span class="i">Invoke</span>&lt;<span class="r107 r t">T</span>&gt;(<b>null</b>, <span class="r108 r">result</span>, <b>null</b>);
            <b>return</b> <span class="r108 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invoke the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="Command.cs.html#b55b68a3bf75e612" class="t t">Command</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> synchronously and return</span>
        <span class="c">///</span><span class="c"> the output.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r109 r t">T</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Type of output object(s) expected from the command invocation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r110 r">input</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Input to the command</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Cannot perform the operation because the command is</span>
        <span class="c">///</span><span class="c"> already started.Stop the command and try the operation again.</span>
        <span class="c">///</span><span class="c"> (or)</span>
        <span class="c">///</span><span class="c"> No commands are specified.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#fa64ade1e4dc44f8" class="t t">ScriptCallDepthException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The script recursed too deeply into script functions.</span>
        <span class="c">///</span><span class="c"> There is a fixed limit on the depth of recursion.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A CLR security violation occurred.  Typically, this happens</span>
        <span class="c">///</span><span class="c"> because the current CLR permissions do not allow adequate</span>
        <span class="c">///</span><span class="c"> reflection access to a cmdlet assembly.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> PowerShell.Invoke can throw a variety of exceptions derived</span>
        <span class="c">///</span><span class="c"> from RuntimeException. The most likely of these exceptions</span>
        <span class="c">///</span><span class="c"> are listed below.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ParameterBinderExceptions.cs.html#8e3f022461e43e12" class="t t">ParameterBindingException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> One of more parameters or parameter values specified for</span>
        <span class="c">///</span><span class="c"> a cmdlet are not valid, or mandatory parameters for a cmdlet</span>
        <span class="c">///</span><span class="c"> were not specified.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#7b242746a433b370" class="t t">CmdletInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A cmdlet generated a terminating error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#f88a59685dc8d13e" class="t t">CmdletProviderInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A provider generated a terminating error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#f896df45dff24981" class="t t">ActionPreferenceStopException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The ActionPreference.Stop or ActionPreference.Inquire policy</span>
        <span class="c">///</span><span class="c"> triggered a terminating error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The pipeline was terminated asynchronously.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/MetadataExceptions.cs.html#3bf974090c4e60a1" class="t t">MetadataException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If there is an error generating the metadata for dynamic parameters.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public</b> <span class="i">Collection</span>&lt;<span class="r109 r t">T</span>&gt; <a id="dd2b491efda62dc0" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Invoke</a>&lt;<span id="r109 rd t" class="r109 r t">T</span>&gt;(<span class="i">IEnumerable</span> <span id="r110 rd" class="r110 r">input</span>)
        {
            <span class="i">Collection</span>&lt;<span class="r109 r t">T</span>&gt; <span id="r111 rd" class="r111 r">result</span> = <b>new</b> <span class="i">Collection</span>&lt;<span class="r109 r t">T</span>&gt;();
            <span class="i">Invoke</span>&lt;<span class="r109 r t">T</span>&gt;(<span class="r110 r">input</span>, <span class="r111 r">result</span>, <b>null</b>);
            <b>return</b> <span class="r111 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invoke the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="Command.cs.html#b55b68a3bf75e612" class="t t">Command</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> synchronously and return</span>
        <span class="c">///</span><span class="c"> the output.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r112 r t">T</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Type of output object(s) expected from the command invocation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r113 r">input</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Input to the command</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r114 r">settings</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invocation Settings</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Cannot perform the operation because the command is</span>
        <span class="c">///</span><span class="c"> already started.Stop the command and try the operation again.</span>
        <span class="c">///</span><span class="c"> (or)</span>
        <span class="c">///</span><span class="c"> No commands are specified.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#fa64ade1e4dc44f8" class="t t">ScriptCallDepthException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The script recursed too deeply into script functions.</span>
        <span class="c">///</span><span class="c"> There is a fixed limit on the depth of recursion.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A CLR security violation occurred.  Typically, this happens</span>
        <span class="c">///</span><span class="c"> because the current CLR permissions do not allow adequate</span>
        <span class="c">///</span><span class="c"> reflection access to a cmdlet assembly.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> PowerShell.Invoke can throw a variety of exceptions derived</span>
        <span class="c">///</span><span class="c"> from RuntimeException. The most likely of these exceptions</span>
        <span class="c">///</span><span class="c"> are listed below.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ParameterBinderExceptions.cs.html#8e3f022461e43e12" class="t t">ParameterBindingException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> One of more parameters or parameter values specified for</span>
        <span class="c">///</span><span class="c"> a cmdlet are not valid, or mandatory parameters for a cmdlet</span>
        <span class="c">///</span><span class="c"> were not specified.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#7b242746a433b370" class="t t">CmdletInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A cmdlet generated a terminating error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#f88a59685dc8d13e" class="t t">CmdletProviderInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A provider generated a terminating error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#f896df45dff24981" class="t t">ActionPreferenceStopException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The ActionPreference.Stop or ActionPreference.Inquire policy</span>
        <span class="c">///</span><span class="c"> triggered a terminating error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The pipeline was terminated asynchronously.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/MetadataExceptions.cs.html#3bf974090c4e60a1" class="t t">MetadataException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If there is an error generating the metadata for dynamic parameters.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public</b> <span class="i">Collection</span>&lt;<span class="r112 r t">T</span>&gt; <a id="bd533bb108571423" href="../../R/bd533bb108571423.html" target="n" data-glyph="72,1" class="i method">Invoke</a>&lt;<span id="r112 rd t" class="r112 r t">T</span>&gt;(<span class="i">IEnumerable</span> <span id="r113 rd" class="r113 r">input</span>, <a href="#ce65c0834aa6f0ea" class="t t">PSInvocationSettings</a> <span id="r114 rd" class="r114 r">settings</span>)
        {
            <span class="i">Collection</span>&lt;<span class="r112 r t">T</span>&gt; <span id="r115 rd" class="r115 r">result</span> = <b>new</b> <span class="i">Collection</span>&lt;<span class="r112 r t">T</span>&gt;();
            <span class="i">Invoke</span>&lt;<span class="r112 r t">T</span>&gt;(<span class="r113 r">input</span>, <span class="r115 r">result</span>, <span class="r114 r">settings</span>);
            <b>return</b> <span class="r115 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invoke the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="Command.cs.html#b55b68a3bf75e612" class="t t">Command</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> synchronously and collect</span>
        <span class="c">///</span><span class="c"> output data into the buffer </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r116 r">output</span><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r117 r t">T</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Type of output object(s) expected from the command invocation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r118 r">input</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Input to the command</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r116 r">output</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A collection supplied by the user where output is collected.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r116 r">output</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> cannot be null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Cannot perform the operation because the command is</span>
        <span class="c">///</span><span class="c"> already started.Stop the command and try the operation again.</span>
        <span class="c">///</span><span class="c"> (or)</span>
        <span class="c">///</span><span class="c"> No commands are specified.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#fa64ade1e4dc44f8" class="t t">ScriptCallDepthException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The script recursed too deeply into script functions.</span>
        <span class="c">///</span><span class="c"> There is a fixed limit on the depth of recursion.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A CLR security violation occurred.  Typically, this happens</span>
        <span class="c">///</span><span class="c"> because the current CLR permissions do not allow adequate</span>
        <span class="c">///</span><span class="c"> reflection access to a cmdlet assembly.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> PowerShell.Invoke can throw a variety of exceptions derived</span>
        <span class="c">///</span><span class="c"> from RuntimeException. The most likely of these exceptions</span>
        <span class="c">///</span><span class="c"> are listed below.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ParameterBinderExceptions.cs.html#8e3f022461e43e12" class="t t">ParameterBindingException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> One of more parameters or parameter values specified for</span>
        <span class="c">///</span><span class="c"> a cmdlet are not valid, or mandatory parameters for a cmdlet</span>
        <span class="c">///</span><span class="c"> were not specified.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#7b242746a433b370" class="t t">CmdletInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A cmdlet generated a terminating error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#f88a59685dc8d13e" class="t t">CmdletProviderInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A provider generated a terminating error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#f896df45dff24981" class="t t">ActionPreferenceStopException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The ActionPreference.Stop or ActionPreference.Inquire policy</span>
        <span class="c">///</span><span class="c"> triggered a terminating error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The pipeline was terminated asynchronously.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/MetadataExceptions.cs.html#3bf974090c4e60a1" class="t t">MetadataException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If there is an error generating the metadata for dynamic parameters.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public void</b> <a id="052f868110b433bd" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Invoke</a>&lt;<span id="r117 rd t" class="r117 r t">T</span>&gt;(<span class="i">IEnumerable</span> <span id="r118 rd" class="r118 r">input</span>, <span class="i">IList</span>&lt;<span class="r117 r t">T</span>&gt; <span id="r116 rd" class="r116 r">output</span>)
        {
            <a href="#8d90395d6c284160" class="i method">Invoke</a>&lt;<span class="r117 r t">T</span>&gt;(<span class="r118 r">input</span>, <span class="r116 r">output</span>, <b>null</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invoke the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="Command.cs.html#b55b68a3bf75e612" class="t t">Command</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> synchronously and collect</span>
        <span class="c">///</span><span class="c"> output data into the buffer </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r119 r">output</span><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r120 r t">T</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Type of output object(s) expected from the command invocation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r121 r">input</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Input to the command</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r119 r">output</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A collection supplied by the user where output is collected.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r122 r">settings</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invocation Settings to use.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r119 r">output</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> cannot be null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> No commands are specified.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#fa64ade1e4dc44f8" class="t t">ScriptCallDepthException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The script recursed too deeply into script functions.</span>
        <span class="c">///</span><span class="c"> There is a fixed limit on the depth of recursion.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A CLR security violation occurred.  Typically, this happens</span>
        <span class="c">///</span><span class="c"> because the current CLR permissions do not allow adequate</span>
        <span class="c">///</span><span class="c"> reflection access to a cmdlet assembly.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> PowerShell.Invoke can throw a variety of exceptions derived</span>
        <span class="c">///</span><span class="c"> from RuntimeException. The most likely of these exceptions</span>
        <span class="c">///</span><span class="c"> are listed below.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ParameterBinderExceptions.cs.html#8e3f022461e43e12" class="t t">ParameterBindingException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> One of more parameters or parameter values specified for</span>
        <span class="c">///</span><span class="c"> a cmdlet are not valid, or mandatory parameters for a cmdlet</span>
        <span class="c">///</span><span class="c"> were not specified.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#7b242746a433b370" class="t t">CmdletInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A cmdlet generated a terminating error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#f88a59685dc8d13e" class="t t">CmdletProviderInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A provider generated a terminating error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#f896df45dff24981" class="t t">ActionPreferenceStopException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The ActionPreference.Stop or ActionPreference.Inquire policy</span>
        <span class="c">///</span><span class="c"> triggered a terminating error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The pipeline was terminated asynchronously.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/MetadataExceptions.cs.html#3bf974090c4e60a1" class="t t">MetadataException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If there is an error generating the metadata for dynamic parameters.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public void</b> <a id="8d90395d6c284160" href="../../R/8d90395d6c284160.html" target="n" data-glyph="72,1" class="i method">Invoke</a>&lt;<span id="r120 rd t" class="r120 r t">T</span>&gt;(<span class="i">IEnumerable</span> <span id="r121 rd" class="r121 r">input</span>, <span class="i">IList</span>&lt;<span class="r120 r t">T</span>&gt; <span id="r119 rd" class="r119 r">output</span>, <a href="#ce65c0834aa6f0ea" class="t t">PSInvocationSettings</a> <span id="r122 rd" class="r122 r">settings</span>)
        {
            <b>if</b> (<span class="r119 r">output</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r119 r">output</span>));
            }
            <span class="c">// use the above collection as the data store.</span>
            <a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<span class="r120 r t">T</span>&gt; <span id="r123 rd" class="r123 r">listToWriteTo</span> = <b>new</b> <a href="PSDataCollection.cs.html#659c4c13c0945ebf" class="t constructor">PSDataCollection</a>&lt;<span class="r120 r t">T</span>&gt;(<span class="r119 r">output</span>);
            <a href="#695c3aa5903e6866" class="i method">CoreInvoke</a>&lt;<span class="r120 r t">T</span>&gt;(<span class="r121 r">input</span>, <span class="r123 r">listToWriteTo</span>, <span class="r122 r">settings</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invoke the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="Command.cs.html#b55b68a3bf75e612" class="t t">Command</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> synchronously and stream</span>
        <span class="c">///</span><span class="c"> output data into the buffer </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r124 r">output</span><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r125 r t">TInput</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Type of input object(s) expected from the command invocation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r126 r t">TOutput</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Type of output object(s) expected from the command invocation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r127 r">input</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Input to the command</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r124 r">output</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Output of the command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r128 r">settings</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invocation Settings to use.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r124 r">output</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> cannot be null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> No commands are specified.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#fa64ade1e4dc44f8" class="t t">ScriptCallDepthException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The script recursed too deeply into script functions.</span>
        <span class="c">///</span><span class="c"> There is a fixed limit on the depth of recursion.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A CLR security violation occurred.  Typically, this happens</span>
        <span class="c">///</span><span class="c"> because the current CLR permissions do not allow adequate</span>
        <span class="c">///</span><span class="c"> reflection access to a cmdlet assembly.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> PowerShell.Invoke can throw a variety of exceptions derived</span>
        <span class="c">///</span><span class="c"> from RuntimeException. The most likely of these exceptions</span>
        <span class="c">///</span><span class="c"> are listed below.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ParameterBinderExceptions.cs.html#8e3f022461e43e12" class="t t">ParameterBindingException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> One of more parameters or parameter values specified for</span>
        <span class="c">///</span><span class="c"> a cmdlet are not valid, or mandatory parameters for a cmdlet</span>
        <span class="c">///</span><span class="c"> were not specified.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#7b242746a433b370" class="t t">CmdletInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A cmdlet generated a terminating error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#f88a59685dc8d13e" class="t t">CmdletProviderInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A provider generated a terminating error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#f896df45dff24981" class="t t">ActionPreferenceStopException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The ActionPreference.Stop or ActionPreference.Inquire policy</span>
        <span class="c">///</span><span class="c"> triggered a terminating error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The pipeline was terminated asynchronously.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/MetadataExceptions.cs.html#3bf974090c4e60a1" class="t t">MetadataException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If there is an error generating the metadata for dynamic parameters.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public void</b> <a id="5d906d28b2f71955" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Invoke</a>&lt;<span id="r125 rd t" class="r125 r t">TInput</span>, <span id="r126 rd t" class="r126 r t">TOutput</span>&gt;(<a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<span class="r125 r t">TInput</span>&gt; <span id="r127 rd" class="r127 r">input</span>, <a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<span class="r126 r t">TOutput</span>&gt; <span id="r124 rd" class="r124 r">output</span>, <a href="#ce65c0834aa6f0ea" class="t t">PSInvocationSettings</a> <span id="r128 rd" class="r128 r">settings</span>)
        {
            <b>if</b> (<span class="r124 r">output</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r124 r">output</span>));
            }
 
            <a href="#6127ab28885abd3a" class="i method">CoreInvoke</a>&lt;<span class="r125 r t">TInput</span>, <span class="r126 r t">TOutput</span>&gt;(<span class="r127 r">input</span>, <span class="r124 r">output</span>, <span class="r128 r">settings</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invoke the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="Command.cs.html#b55b68a3bf75e612" class="t t">Command</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> asynchronously.</span>
        <span class="c">///</span><span class="c"> Use EndInvoke() to obtain the output of the command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Cannot perform the operation because the command is already started.</span>
        <span class="c">///</span><span class="c"> Stop the command and try the operation again.</span>
        <span class="c">///</span><span class="c"> (or)</span>
        <span class="c">///</span><span class="c"> No command is added.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public</b> <span class="i">IAsyncResult</span> <a id="136b4e9e4079b11f" href="../../R/136b4e9e4079b11f.html" target="n" data-glyph="72,1" class="i method">BeginInvoke</a>()
        {
            <b>return</b> <a href="#ae78ab7180e7c40e" class="i method">BeginInvoke</a>&lt;<b>object</b>&gt;(<b>null</b>, <b>null</b>, <b>null</b>, <b>null</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invoke the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="Command.cs.html#b55b68a3bf75e612" class="t t">Command</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> asynchronously.</span>
        <span class="c">///</span><span class="c"> Use EndInvoke() to obtain the output of the command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> When invoked using BeginInvoke, invocation doesn&#39;t</span>
        <span class="c">///</span><span class="c"> finish until Input is closed. Caller of BeginInvoke must</span>
        <span class="c">///</span><span class="c"> close the input buffer after all input has been written to</span>
        <span class="c">///</span><span class="c"> input buffer. Input buffer is closed by calling</span>
        <span class="c">///</span><span class="c"> Close() method.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> If you want this command to execute as a standalone cmdlet</span>
        <span class="c">///</span><span class="c"> (that is, using command-line parameters only),</span>
        <span class="c">///</span><span class="c"> be sure to call Close() before calling BeginInvoke().  Otherwise,</span>
        <span class="c">///</span><span class="c"> the command will be executed as though it had external input.</span>
        <span class="c">///</span><span class="c"> If you observe that the command isn&#39;t doing anything,</span>
        <span class="c">///</span><span class="c"> this may be the reason.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r129 r t">T</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Type of the input buffer</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r130 r">input</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Input to the command. See remarks for more details.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Cannot perform the operation because the command is already started.</span>
        <span class="c">///</span><span class="c"> Stop the command and try the operation again.</span>
        <span class="c">///</span><span class="c"> (or)</span>
        <span class="c">///</span><span class="c"> No command is added.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public</b> <span class="i">IAsyncResult</span> <a id="7c5852140580c05d" href="../../R/7c5852140580c05d.html" target="n" data-glyph="72,1" class="i method">BeginInvoke</a>&lt;<span id="r129 rd t" class="r129 r t">T</span>&gt;(<a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<span class="r129 r t">T</span>&gt; <span id="r130 rd" class="r130 r">input</span>)
        {
            <b>return</b> <a href="#ae78ab7180e7c40e" class="i method">BeginInvoke</a>&lt;<span class="r129 r t">T</span>&gt;(<span class="r130 r">input</span>, <b>null</b>, <b>null</b>, <b>null</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invoke the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="Command.cs.html#b55b68a3bf75e612" class="t t">Command</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> asynchronously.</span>
        <span class="c">///</span><span class="c"> Use EndInvoke() to obtain the output of the command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> When invoked using BeginInvoke, invocation doesn&#39;t</span>
        <span class="c">///</span><span class="c"> finish until Input is closed. Caller of BeginInvoke must</span>
        <span class="c">///</span><span class="c"> close the input buffer after all input has been written to</span>
        <span class="c">///</span><span class="c"> input buffer. Input buffer is closed by calling</span>
        <span class="c">///</span><span class="c"> Close() method.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> If you want this command to execute as a standalone cmdlet</span>
        <span class="c">///</span><span class="c"> (that is, using command-line parameters only),</span>
        <span class="c">///</span><span class="c"> be sure to call Close() before calling BeginInvoke().  Otherwise,</span>
        <span class="c">///</span><span class="c"> the command will be executed as though it had external input.</span>
        <span class="c">///</span><span class="c"> If you observe that the command isn&#39;t doing anything,</span>
        <span class="c">///</span><span class="c"> this may be the reason.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r131 r t">T</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Type of the input buffer</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r132 r">input</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Input to the command. See remarks for more details.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r133 r">settings</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invocation Settings.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r134 r">callback</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An AsyncCallback to call once the BeginInvoke completes.</span>
        <span class="c">///</span><span class="c"> Note: when using this API in script, don&#39;t pass in a delegate that is cast from a script block.</span>
        <span class="c">///</span><span class="c"> The callback could be invoked from a thread without a default Runspace and a delegate cast from</span>
        <span class="c">///</span><span class="c"> a script block would fail in that case.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r135 r">state</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A user supplied state to call the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r134 r">callback</span><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> with.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Cannot perform the operation because the command is already started.</span>
        <span class="c">///</span><span class="c"> Stop the command and try the operation again.</span>
        <span class="c">///</span><span class="c"> (or)</span>
        <span class="c">///</span><span class="c"> No command is added.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public</b> <span class="i">IAsyncResult</span> <a id="ae78ab7180e7c40e" href="../../R/ae78ab7180e7c40e.html" target="n" data-glyph="72,1" class="i method">BeginInvoke</a>&lt;<span id="r131 rd t" class="r131 r t">T</span>&gt;(<a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<span class="r131 r t">T</span>&gt; <span id="r132 rd" class="r132 r">input</span>, <a href="#ce65c0834aa6f0ea" class="t t">PSInvocationSettings</a> <span id="r133 rd" class="r133 r">settings</span>, <span class="i">AsyncCallback</span> <span id="r134 rd" class="r134 r">callback</span>, <b>object</b> <span id="r135 rd" class="r135 r">state</span>)
        {
            <a href="#8995adafa9f25650" class="i method">DetermineIsBatching</a>();
 
            <b>if</b> (<a href="#a29e9daed047bb39" class="i property">OutputBuffer</a> != <b>null</b>)
            {
                <b>if</b> (<a href="#b3c8b30fb7648387" class="i field">_isBatching</a> || <a href="#4cfb6cc82eb60c86" class="i property">ExtraCommands</a>.<span class="i">Count</span> != 0)
                {
                    <b>return</b> <a href="#ace472d6f18195a0" class="i method">BeginBatchInvoke</a>&lt;<span class="r131 r t">T</span>, <a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;(<span class="r132 r">input</span>, <a href="#a29e9daed047bb39" class="i property">OutputBuffer</a>, <span class="r133 r">settings</span>, <span class="r134 r">callback</span>, <span class="r135 r">state</span>);
                }
 
                <b>return</b> <a href="#82e515b14a72a8b1" class="i method">CoreInvokeAsync</a>&lt;<span class="r131 r t">T</span>, <a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;(<span class="r132 r">input</span>, <a href="#a29e9daed047bb39" class="i property">OutputBuffer</a>, <span class="r133 r">settings</span>, <span class="r134 r">callback</span>, <span class="r135 r">state</span>, <b>null</b>);
            }
            <b>else</b>
            {
                <a href="#a29e9daed047bb39" class="i property">OutputBuffer</a> = <b>new</b> <a href="PSDataCollection.cs.html#ee85ce3306fe4e5b" class="t constructor">PSDataCollection</a>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;();
                <a href="#06852585cb89a70d" class="i property">OutputBufferOwner</a> = <b>true</b>;
 
                <b>if</b> (<a href="#b3c8b30fb7648387" class="i field">_isBatching</a> || <a href="#4cfb6cc82eb60c86" class="i property">ExtraCommands</a>.<span class="i">Count</span> != 0)
                {
                    <b>return</b> <a href="#ace472d6f18195a0" class="i method">BeginBatchInvoke</a>&lt;<span class="r131 r t">T</span>, <a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;(<span class="r132 r">input</span>, <a href="#a29e9daed047bb39" class="i property">OutputBuffer</a>, <span class="r133 r">settings</span>, <span class="r134 r">callback</span>, <span class="r135 r">state</span>);
                }
 
                <b>return</b> <a href="#82e515b14a72a8b1" class="i method">CoreInvokeAsync</a>&lt;<span class="r131 r t">T</span>, <a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;(<span class="r132 r">input</span>, <a href="#a29e9daed047bb39" class="i property">OutputBuffer</a>, <span class="r133 r">settings</span>, <span class="r134 r">callback</span>, <span class="r135 r">state</span>, <a href="#a29e9daed047bb39" class="i property">OutputBuffer</a>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invoke the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="Command.cs.html#b55b68a3bf75e612" class="t t">Command</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> asynchronously.</span>
        <span class="c">///</span><span class="c"> When this method is used EndInvoke() returns a null buffer.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> When invoked using BeginInvoke, invocation doesn&#39;t</span>
        <span class="c">///</span><span class="c"> finish until Input is closed. Caller of BeginInvoke must</span>
        <span class="c">///</span><span class="c"> close the input buffer after all input has been written to</span>
        <span class="c">///</span><span class="c"> input buffer. Input buffer is closed by calling</span>
        <span class="c">///</span><span class="c"> Close() method.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> If you want this command to execute as a standalone cmdlet</span>
        <span class="c">///</span><span class="c"> (that is, using command-line parameters only),</span>
        <span class="c">///</span><span class="c"> be sure to call Close() before calling BeginInvoke().  Otherwise,</span>
        <span class="c">///</span><span class="c"> the command will be executed as though it had external input.</span>
        <span class="c">///</span><span class="c"> If you observe that the command isn&#39;t doing anything,</span>
        <span class="c">///</span><span class="c"> this may be the reason.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r136 r t">TInput</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Type of input object(s) for the command invocation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r137 r t">TOutput</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Type of output object(s) expected from the command invocation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r138 r">input</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Input to the command. See remarks for more details.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r139 r">output</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A buffer supplied by the user where output is collected.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Cannot perform the operation because the command is already started.</span>
        <span class="c">///</span><span class="c"> Stop the command and try the operation again.</span>
        <span class="c">///</span><span class="c"> (or)</span>
        <span class="c">///</span><span class="c"> No command is added.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public</b> <span class="i">IAsyncResult</span> <a id="f6767aa4cf17743a" href="../../R/f6767aa4cf17743a.html" target="n" data-glyph="72,1" class="i method">BeginInvoke</a>&lt;<span id="r136 rd t" class="r136 r t">TInput</span>, <span id="r137 rd t" class="r137 r t">TOutput</span>&gt;(<a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<span class="r136 r t">TInput</span>&gt; <span id="r138 rd" class="r138 r">input</span>, <a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<span class="r137 r t">TOutput</span>&gt; <span id="r139 rd" class="r139 r">output</span>)
        {
            <b>return</b> <a href="#1168e8243b07d8cf" class="i method">BeginInvoke</a>&lt;<span class="r136 r t">TInput</span>, <span class="r137 r t">TOutput</span>&gt;(<span class="r138 r">input</span>, <span class="r139 r">output</span>, <b>null</b>, <b>null</b>, <b>null</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invoke the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="Command.cs.html#b55b68a3bf75e612" class="t t">Command</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> asynchronously and collect</span>
        <span class="c">///</span><span class="c"> output data into the buffer </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r140 r">output</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> When this method is used EndInvoke() returns a null buffer.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> When invoked using BeginInvoke, invocation doesn&#39;t</span>
        <span class="c">///</span><span class="c"> finish until Input is closed. Caller of BeginInvoke must</span>
        <span class="c">///</span><span class="c"> close the input buffer after all input has been written to</span>
        <span class="c">///</span><span class="c"> input buffer. Input buffer is closed by calling</span>
        <span class="c">///</span><span class="c"> Close() method.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> If you want this command to execute as a standalone cmdlet</span>
        <span class="c">///</span><span class="c"> (that is, using command-line parameters only),</span>
        <span class="c">///</span><span class="c"> be sure to call Close() before calling BeginInvoke().  Otherwise,</span>
        <span class="c">///</span><span class="c"> the command will be executed as though it had external input.</span>
        <span class="c">///</span><span class="c"> If you observe that the command isn&#39;t doing anything,</span>
        <span class="c">///</span><span class="c"> this may be the reason.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r141 r t">TInput</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Type of input object(s) for the command invocation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r142 r t">TOutput</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Type of output object(s) expected from the command invocation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r143 r">input</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Input to the command. See remarks for more details.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r140 r">output</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A buffer supplied by the user where output is collected.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r144 r">settings</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invocation Settings.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r145 r">callback</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An AsyncCallback to call once the BeginInvoke completes.</span>
        <span class="c">///</span><span class="c"> Note: when using this API in script, don&#39;t pass in a delegate that is cast from a script block.</span>
        <span class="c">///</span><span class="c"> The callback could be invoked from a thread without a default Runspace and a delegate cast from</span>
        <span class="c">///</span><span class="c"> a script block would fail in that case.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r146 r">state</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A user supplied state to call the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r145 r">callback</span><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> with.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Cannot perform the operation because the command is already started.</span>
        <span class="c">///</span><span class="c"> Stop the command and try the operation again.</span>
        <span class="c">///</span><span class="c"> (or)</span>
        <span class="c">///</span><span class="c"> No command is added.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public</b> <span class="i">IAsyncResult</span> <a id="1168e8243b07d8cf" href="../../R/1168e8243b07d8cf.html" target="n" data-glyph="72,1" class="i method">BeginInvoke</a>&lt;<span id="r141 rd t" class="r141 r t">TInput</span>, <span id="r142 rd t" class="r142 r t">TOutput</span>&gt;(<a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<span class="r141 r t">TInput</span>&gt; <span id="r143 rd" class="r143 r">input</span>, <a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<span class="r142 r t">TOutput</span>&gt; <span id="r140 rd" class="r140 r">output</span>, <a href="#ce65c0834aa6f0ea" class="t t">PSInvocationSettings</a> <span id="r144 rd" class="r144 r">settings</span>, <span class="i">AsyncCallback</span> <span id="r145 rd" class="r145 r">callback</span>, <b>object</b> <span id="r146 rd" class="r146 r">state</span>)
        {
            <b>if</b> (<span class="r140 r">output</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r140 r">output</span>));
            }
 
            <a href="#8995adafa9f25650" class="i method">DetermineIsBatching</a>();
 
            <b>if</b> (<a href="#b3c8b30fb7648387" class="i field">_isBatching</a> || <a href="#4cfb6cc82eb60c86" class="i property">ExtraCommands</a>.<span class="i">Count</span> != 0)
            {
                <b>return</b> <a href="#ace472d6f18195a0" class="i method">BeginBatchInvoke</a>&lt;<span class="r141 r t">TInput</span>, <span class="r142 r t">TOutput</span>&gt;(<span class="r143 r">input</span>, <span class="r140 r">output</span>, <span class="r144 r">settings</span>, <span class="r145 r">callback</span>, <span class="r146 r">state</span>);
            }
 
            <b>return</b> <a href="#82e515b14a72a8b1" class="i method">CoreInvokeAsync</a>&lt;<span class="r141 r t">TInput</span>, <span class="r142 r t">TOutput</span>&gt;(<span class="r143 r">input</span>, <span class="r140 r">output</span>, <span class="r144 r">settings</span>, <span class="r145 r">callback</span>, <span class="r146 r">state</span>, <b>null</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invoke a PowerShell command asynchronously.</span>
        <span class="c">///</span><span class="c"> Use await to wait for the command to complete and obtain the output of the command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The output buffer created to hold the results of the asynchronous invoke.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Cannot perform the operation because the command is already started.</span>
        <span class="c">///</span><span class="c"> Stop the command and try the operation again.</span>
        <span class="c">///</span><span class="c"> (or)</span>
        <span class="c">///</span><span class="c"> No command is added.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The running PowerShell pipeline was stopped.</span>
        <span class="c">///</span><span class="c"> This occurs when </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#3d1b346df3be574c" class="t t">PowerShell</a>.<a href="#417fd1f64732b2ef" class="i method">Stop</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> or </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#3d1b346df3be574c" class="t t">PowerShell</a>.<a href="#41fb9ee3f80cbc1d" class="i method">StopAsync</a>(<span class="i">AsyncCallback</span>, <b>object</b>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is called.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public</b> <span class="i">Task</span>&lt;<a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;&gt; <a id="b2318776d8ca5543" href="../../R/b2318776d8ca5543.html" target="n" data-glyph="72,1" class="i method">InvokeAsync</a>()
            =&gt; <span class="i">Task</span>&lt;<a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;&gt;.<span class="i">Factory</span>.<span class="i">FromAsync</span>(<a href="#136b4e9e4079b11f" class="i method">BeginInvoke</a>(), <a href="#e23dd5fd75a4bfb2" class="i field">_endInvokeMethod</a>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invoke a PowerShell command asynchronously.</span>
        <span class="c">///</span><span class="c"> Use await to wait for the command to complete and obtain the output of the command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> When invoked using InvokeAsync, invocation doesn&#39;t</span>
        <span class="c">///</span><span class="c"> finish until Input is closed. Caller of InvokeAsync must</span>
        <span class="c">///</span><span class="c"> close the input buffer after all input has been written to</span>
        <span class="c">///</span><span class="c"> input buffer. Input buffer is closed by calling</span>
        <span class="c">///</span><span class="c"> Close() method.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">para</span><span class="c">&gt;</span><span class="c">&lt;</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If you want this command to execute as a standalone cmdlet</span>
        <span class="c">///</span><span class="c"> (that is, using command-line parameters only),</span>
        <span class="c">///</span><span class="c"> be sure to call Close() before calling InvokeAsync().  Otherwise,</span>
        <span class="c">///</span><span class="c"> the command will be executed as though it had external input.</span>
        <span class="c">///</span><span class="c"> If you observe that the command isn&#39;t doing anything,</span>
        <span class="c">///</span><span class="c"> this may be the reason.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r147 r t">T</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Type of the input buffer.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r148 r">input</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Input to the command. See remarks for more details.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The output buffer created to hold the results of the asynchronous invoke.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Cannot perform the operation because the command is already started.</span>
        <span class="c">///</span><span class="c"> Stop the command and try the operation again.</span>
        <span class="c">///</span><span class="c"> (or)</span>
        <span class="c">///</span><span class="c"> No command is added.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The running PowerShell pipeline was stopped.</span>
        <span class="c">///</span><span class="c"> This occurs when </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#3d1b346df3be574c" class="t t">PowerShell</a>.<a href="#417fd1f64732b2ef" class="i method">Stop</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> or </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#3d1b346df3be574c" class="t t">PowerShell</a>.<a href="#41fb9ee3f80cbc1d" class="i method">StopAsync</a>(<span class="i">AsyncCallback</span>, <b>object</b>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is called.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public</b> <span class="i">Task</span>&lt;<a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;&gt; <a id="72e5760334517c08" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">InvokeAsync</a>&lt;<span id="r147 rd t" class="r147 r t">T</span>&gt;(<a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<span class="r147 r t">T</span>&gt; <span id="r148 rd" class="r148 r">input</span>)
            =&gt; <span class="i">Task</span>&lt;<a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;&gt;.<span class="i">Factory</span>.<span class="i">FromAsync</span>(<a href="#7c5852140580c05d" class="i method">BeginInvoke</a>&lt;<span class="r147 r t">T</span>&gt;(<span class="r148 r">input</span>), <a href="#e23dd5fd75a4bfb2" class="i field">_endInvokeMethod</a>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invoke a PowerShell command asynchronously.</span>
        <span class="c">///</span><span class="c"> Use await to wait for the command to complete and obtain the output of the command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> When invoked using InvokeAsync, invocation doesn&#39;t</span>
        <span class="c">///</span><span class="c"> finish until Input is closed. Caller of InvokeAsync must</span>
        <span class="c">///</span><span class="c"> close the input buffer after all input has been written to</span>
        <span class="c">///</span><span class="c"> input buffer. Input buffer is closed by calling</span>
        <span class="c">///</span><span class="c"> Close() method.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">para</span><span class="c">&gt;</span><span class="c">&lt;</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If you want this command to execute as a standalone cmdlet</span>
        <span class="c">///</span><span class="c"> (that is, using command-line parameters only),</span>
        <span class="c">///</span><span class="c"> be sure to call Close() before calling InvokeAsync().  Otherwise,</span>
        <span class="c">///</span><span class="c"> the command will be executed as though it had external input.</span>
        <span class="c">///</span><span class="c"> If you observe that the command isn&#39;t doing anything,</span>
        <span class="c">///</span><span class="c"> this may be the reason.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r149 r t">T</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Type of the input buffer.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r150 r">input</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Input to the command. See remarks for more details.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r151 r">settings</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invocation Settings.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r152 r">callback</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An AsyncCallback to call once the command is invoked.</span>
        <span class="c">///</span><span class="c"> Note: when using this API in script, don&#39;t pass in a delegate that is cast from a script block.</span>
        <span class="c">///</span><span class="c"> The callback could be invoked from a thread without a default Runspace and a delegate cast from</span>
        <span class="c">///</span><span class="c"> a script block would fail in that case.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r153 r">state</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A user supplied state to call the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r152 r">callback</span><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> with.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The output buffer created to hold the results of the asynchronous invoke.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Cannot perform the operation because the command is already started.</span>
        <span class="c">///</span><span class="c"> Stop the command and try the operation again.</span>
        <span class="c">///</span><span class="c"> (or)</span>
        <span class="c">///</span><span class="c"> No command is added.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The running PowerShell pipeline was stopped.</span>
        <span class="c">///</span><span class="c"> This occurs when </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#3d1b346df3be574c" class="t t">PowerShell</a>.<a href="#417fd1f64732b2ef" class="i method">Stop</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> or </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#3d1b346df3be574c" class="t t">PowerShell</a>.<a href="#41fb9ee3f80cbc1d" class="i method">StopAsync</a>(<span class="i">AsyncCallback</span>, <b>object</b>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is called.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public</b> <span class="i">Task</span>&lt;<a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;&gt; <a id="74a103593f8e54d6" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">InvokeAsync</a>&lt;<span id="r149 rd t" class="r149 r t">T</span>&gt;(<a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<span class="r149 r t">T</span>&gt; <span id="r150 rd" class="r150 r">input</span>, <a href="#ce65c0834aa6f0ea" class="t t">PSInvocationSettings</a> <span id="r151 rd" class="r151 r">settings</span>, <span class="i">AsyncCallback</span> <span id="r152 rd" class="r152 r">callback</span>, <b>object</b> <span id="r153 rd" class="r153 r">state</span>)
            =&gt; <span class="i">Task</span>&lt;<a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;&gt;.<span class="i">Factory</span>.<span class="i">FromAsync</span>(<a href="#ae78ab7180e7c40e" class="i method">BeginInvoke</a>&lt;<span class="r149 r t">T</span>&gt;(<span class="r150 r">input</span>, <span class="r151 r">settings</span>, <span class="r152 r">callback</span>, <span class="r153 r">state</span>), <a href="#e23dd5fd75a4bfb2" class="i field">_endInvokeMethod</a>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invoke a PowerShell command asynchronously.</span>
        <span class="c">///</span><span class="c"> Use await to wait for the command to complete and obtain the output of the command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> When invoked using InvokeAsync, invocation doesn&#39;t</span>
        <span class="c">///</span><span class="c"> finish until Input is closed. Caller of InvokeAsync must</span>
        <span class="c">///</span><span class="c"> close the input buffer after all input has been written to</span>
        <span class="c">///</span><span class="c"> input buffer. Input buffer is closed by calling</span>
        <span class="c">///</span><span class="c"> Close() method.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">para</span><span class="c">&gt;</span><span class="c">&lt;</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If you want this command to execute as a standalone cmdlet</span>
        <span class="c">///</span><span class="c"> (that is, using command-line parameters only),</span>
        <span class="c">///</span><span class="c"> be sure to call Close() before calling InvokeAsync().  Otherwise,</span>
        <span class="c">///</span><span class="c"> the command will be executed as though it had external input.</span>
        <span class="c">///</span><span class="c"> If you observe that the command isn&#39;t doing anything,</span>
        <span class="c">///</span><span class="c"> this may be the reason.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r154 r t">TInput</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Type of input object(s) for the command invocation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r155 r t">TOutput</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Type of output object(s) expected from the command invocation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r156 r">input</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Input to the command. See remarks for more details.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r157 r">output</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A buffer supplied by the user where output is collected.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The output buffer created to hold the results of the asynchronous invoke,</span>
        <span class="c">///</span><span class="c"> or null if the caller provided their own buffer.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Cannot perform the operation because the command is already started.</span>
        <span class="c">///</span><span class="c"> Stop the command and try the operation again.</span>
        <span class="c">///</span><span class="c"> (or)</span>
        <span class="c">///</span><span class="c"> No command is added.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The running PowerShell pipeline was stopped.</span>
        <span class="c">///</span><span class="c"> This occurs when </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#3d1b346df3be574c" class="t t">PowerShell</a>.<a href="#417fd1f64732b2ef" class="i method">Stop</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> or </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#3d1b346df3be574c" class="t t">PowerShell</a>.<a href="#41fb9ee3f80cbc1d" class="i method">StopAsync</a>(<span class="i">AsyncCallback</span>, <b>object</b>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is called.</span>
        <span class="c">///</span><span class="c"> To collect partial output in this scenario,</span>
        <span class="c">///</span><span class="c"> supply a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>{<span class="r158 r t">T</span>}<span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> for the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r157 r">output</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> parameter,</span>
        <span class="c">///</span><span class="c"> and either add a handler for the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>{<span class="r159 r t">T</span>}.<a href="PSDataCollection.cs.html#43aaeadedbd395cd" class="i">DataAdding</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> event</span>
        <span class="c">///</span><span class="c"> or catch the exception and enumerate the object supplied for </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r157 r">output</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public</b> <span class="i">Task</span>&lt;<a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;&gt; <a id="66366c647607a18a" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">InvokeAsync</a>&lt;<span id="r154 rd t" class="r154 r t">TInput</span>, <span id="r155 rd t" class="r155 r t">TOutput</span>&gt;(<a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<span class="r154 r t">TInput</span>&gt; <span id="r156 rd" class="r156 r">input</span>, <a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<span class="r155 r t">TOutput</span>&gt; <span id="r157 rd" class="r157 r">output</span>)
            =&gt; <span class="i">Task</span>&lt;<a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;&gt;.<span class="i">Factory</span>.<span class="i">FromAsync</span>(<a href="#f6767aa4cf17743a" class="i method">BeginInvoke</a>&lt;<span class="r154 r t">TInput</span>, <span class="r155 r t">TOutput</span>&gt;(<span class="r156 r">input</span>, <span class="r157 r">output</span>), <a href="#e23dd5fd75a4bfb2" class="i field">_endInvokeMethod</a>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invoke a PowerShell command asynchronously and collect</span>
        <span class="c">///</span><span class="c"> output data into the buffer </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r160 r">output</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> Use await to wait for the command to complete and obtain the output of the command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> When invoked using InvokeAsync, invocation doesn&#39;t</span>
        <span class="c">///</span><span class="c"> finish until Input is closed. Caller of InvokeAsync must</span>
        <span class="c">///</span><span class="c"> close the input buffer after all input has been written to</span>
        <span class="c">///</span><span class="c"> input buffer. Input buffer is closed by calling</span>
        <span class="c">///</span><span class="c"> Close() method.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">para</span><span class="c">&gt;</span><span class="c">&lt;</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If you want this command to execute as a standalone cmdlet</span>
        <span class="c">///</span><span class="c"> (that is, using command-line parameters only),</span>
        <span class="c">///</span><span class="c"> be sure to call Close() before calling InvokeAsync().  Otherwise,</span>
        <span class="c">///</span><span class="c"> the command will be executed as though it had external input.</span>
        <span class="c">///</span><span class="c"> If you observe that the command isn&#39;t doing anything,</span>
        <span class="c">///</span><span class="c"> this may be the reason.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r161 r t">TInput</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Type of input object(s) for the command invocation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r162 r t">TOutput</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Type of output object(s) expected from the command invocation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r163 r">input</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Input to the command. See remarks for more details.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r160 r">output</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A buffer supplied by the user where output is collected.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r164 r">settings</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invocation Settings.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r165 r">callback</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An AsyncCallback to call once the command is invoked.</span>
        <span class="c">///</span><span class="c"> Note: when using this API in script, don&#39;t pass in a delegate that is cast from a script block.</span>
        <span class="c">///</span><span class="c"> The callback could be invoked from a thread without a default Runspace and a delegate cast from</span>
        <span class="c">///</span><span class="c"> a script block would fail in that case.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r166 r">state</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A user supplied state to call the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r165 r">callback</span><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> with.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The output buffer created to hold the results of the asynchronous invoke,</span>
        <span class="c">///</span><span class="c"> or null if the caller provided their own buffer.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Cannot perform the operation because the command is already started.</span>
        <span class="c">///</span><span class="c"> Stop the command and try the operation again.</span>
        <span class="c">///</span><span class="c"> (or)</span>
        <span class="c">///</span><span class="c"> No command is added.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The running PowerShell pipeline was stopped.</span>
        <span class="c">///</span><span class="c"> This occurs when </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#3d1b346df3be574c" class="t t">PowerShell</a>.<a href="#417fd1f64732b2ef" class="i method">Stop</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> or </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#3d1b346df3be574c" class="t t">PowerShell</a>.<a href="#41fb9ee3f80cbc1d" class="i method">StopAsync</a>(<span class="i">AsyncCallback</span>, <b>object</b>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is called.</span>
        <span class="c">///</span><span class="c"> To collect partial output in this scenario,</span>
        <span class="c">///</span><span class="c"> supply a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>{<span class="r167 r t">T</span>}<span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> for the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r160 r">output</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> parameter,</span>
        <span class="c">///</span><span class="c"> and either add a handler for the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>{<span class="r168 r t">T</span>}.<a href="PSDataCollection.cs.html#43aaeadedbd395cd" class="i">DataAdding</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> event</span>
        <span class="c">///</span><span class="c"> or catch the exception and use object supplied for </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r160 r">output</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public</b> <span class="i">Task</span>&lt;<a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;&gt; <a id="b18f5de4fbd0495a" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">InvokeAsync</a>&lt;<span id="r161 rd t" class="r161 r t">TInput</span>, <span id="r162 rd t" class="r162 r t">TOutput</span>&gt;(<a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<span class="r161 r t">TInput</span>&gt; <span id="r163 rd" class="r163 r">input</span>, <a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<span class="r162 r t">TOutput</span>&gt; <span id="r160 rd" class="r160 r">output</span>, <a href="#ce65c0834aa6f0ea" class="t t">PSInvocationSettings</a> <span id="r164 rd" class="r164 r">settings</span>, <span class="i">AsyncCallback</span> <span id="r165 rd" class="r165 r">callback</span>, <b>object</b> <span id="r166 rd" class="r166 r">state</span>)
            =&gt; <span class="i">Task</span>&lt;<a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;&gt;.<span class="i">Factory</span>.<span class="i">FromAsync</span>(<a href="#1168e8243b07d8cf" class="i method">BeginInvoke</a>&lt;<span class="r161 r t">TInput</span>, <span class="r162 r t">TOutput</span>&gt;(<span class="r163 r">input</span>, <span class="r160 r">output</span>, <span class="r164 r">settings</span>, <span class="r165 r">callback</span>, <span class="r166 r">state</span>), <a href="#e23dd5fd75a4bfb2" class="i field">_endInvokeMethod</a>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Begins a batch execution.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r169 r t">TInput</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Type of input object(s) for the command invocation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r170 r t">TOutput</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Type of output object(s) expected from the command invocation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r171 r">input</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Input to the command. See remarks for more details.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r172 r">output</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A buffer supplied by the user where output is collected.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r173 r">settings</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invocation Settings.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r174 r">callback</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An AsyncCallback to call once the BeginInvoke completes.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r175 r">state</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A user supplied state to call the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r174 r">callback</span><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> with.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Cannot perform the operation because the command is already started.</span>
        <span class="c">///</span><span class="c"> Stop the command and try the operation again.</span>
        <span class="c">///</span><span class="c"> (or)</span>
        <span class="c">///</span><span class="c"> No command is added.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>private</b> <span class="i">IAsyncResult</span> <a id="ace472d6f18195a0" href="../../R/ace472d6f18195a0.html" target="n" data-glyph="76,1" class="i method">BeginBatchInvoke</a>&lt;<span id="r169 rd t" class="r169 r t">TInput</span>, <span id="r170 rd t" class="r170 r t">TOutput</span>&gt;(<a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<span class="r169 r t">TInput</span>&gt; <span id="r171 rd" class="r171 r">input</span>, <a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<span class="r170 r t">TOutput</span>&gt; <span id="r172 rd" class="r172 r">output</span>, <a href="#ce65c0834aa6f0ea" class="t t">PSInvocationSettings</a> <span id="r173 rd" class="r173 r">settings</span>, <span class="i">AsyncCallback</span> <span id="r174 rd" class="r174 r">callback</span>, <b>object</b> <span id="r175 rd" class="r175 r">state</span>)
        {
            <b>if</b> (!((<b>object</b>)<span class="r172 r">output</span> <b>is</b> <a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r176 rd" class="r176 r">asyncOutput</span>))
            {
                <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#4f3f8175dd33a015" class="i method">NewInvalidOperationException</a>();
            }
 
            <b>if</b> (<a href="#b3c8b30fb7648387" class="i field">_isBatching</a>)
            {
                <a href="#efa3902a0546e8df" class="i method">SetupAsyncBatchExecution</a>();
            }
 
            <a href="RunspacePool.cs.html#c1948c2f22e6b527" class="t t">RunspacePool</a> <span id="r177 rd" class="r177 r">pool</span> = <a href="#ccb6c738e7f3c724" class="i field">_rsConnection</a> <b>as</b> <a href="RunspacePool.cs.html#c1948c2f22e6b527" class="t t">RunspacePool</a>;
            <b>if</b> ((<span class="r177 r">pool</span> != <b>null</b>) &amp;&amp; (<span class="r177 r">pool</span>.<a href="RunspacePool.cs.html#6cd4c73a96856bcf" class="i property">IsRemote</a>))
            {
                <span class="c">// Server supports batch invocation, in this case, we just send everything to the server and return immediately</span>
                <b>if</b> (<a href="#4c6ee695d9a7fe71" class="i method">ServerSupportsBatchInvocation</a>())
                {
                    <b>try</b>
                    {
                        <b>return</b> <a href="#82e515b14a72a8b1" class="i method">CoreInvokeAsync</a>&lt;<span class="r169 r t">TInput</span>, <span class="r170 r t">TOutput</span>&gt;(<span class="r171 r">input</span>, <span class="r172 r">output</span>, <span class="r173 r">settings</span>, <span class="r174 r">callback</span>, <span class="r175 r">state</span>, <span class="r176 r">asyncOutput</span>);
                    }
                    <b>finally</b>
                    {
                        <b>if</b> (<a href="#b3c8b30fb7648387" class="i field">_isBatching</a>)
                        {
                            <a href="#6aa077ee1a01c65e" class="i method">EndAsyncBatchExecution</a>();
                        }
                    }
                }
            }
 
            <span class="c">// Non-remoting case or server does not support batching</span>
            <span class="c">// In this case we execute the cmdlets one by one</span>
 
            <a href="#90e4778239a93806" class="i property">RunningExtraCommands</a> = <b>true</b>;
            <a href="#55501b58ae0e59d6" class="i field">_batchInvocationSettings</a> = <span class="r173 r">settings</span>;
 
            <a href="#23fe95e8a4f70ff4" class="i field">_batchAsyncResult</a> = <b>new</b> <a href="#a573e20febced368" class="t constructor">PowerShellAsyncResult</a>(<a href="#d8c9867186529e49" class="i property">InstanceId</a>, <span class="r174 r">callback</span>, <span class="r175 r">state</span>, <span class="r176 r">asyncOutput</span>, <b>true</b>);
 
            <a href="#82e515b14a72a8b1" class="i method">CoreInvokeAsync</a>&lt;<span class="r169 r t">TInput</span>, <span class="r170 r t">TOutput</span>&gt;(<span class="r171 r">input</span>, <span class="r172 r">output</span>, <span class="r173 r">settings</span>, <b>new</b> <span class="i">AsyncCallback</span>(<span class="i">BatchInvocationCallback</span>), <span class="r175 r">state</span>, <span class="r176 r">asyncOutput</span>);
 
            <b>return</b> <a href="#23fe95e8a4f70ff4" class="i field">_batchAsyncResult</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Batch invocation callback.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r178 r">state</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="c95f4685c803462a" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">BatchInvocationWorkItem</a>(<b>object</b> <span id="r178 rd" class="r178 r">state</span>)
        {
            <span class="i">Debug</span>.<span class="i">Assert</span>(<a href="#4cfb6cc82eb60c86" class="i property">ExtraCommands</a>.<span class="i">Count</span> != 0, <span class="s">&quot;This callback is for batch invocation only&quot;</span>);
 
            <a href="#af059b37dfbedbfb" class="t t">BatchInvocationContext</a> <span id="r179 rd" class="r179 r">context</span> = <span class="r178 r">state</span> <b>as</b> <a href="#af059b37dfbedbfb" class="t t">BatchInvocationContext</a>;
 
            <span class="i">Debug</span>.<span class="i">Assert</span>(<span class="r179 r">context</span> != <b>null</b>, <span class="s">&quot;Context should never be null&quot;</span>);
 
            <a href="PSCommand.cs.html#b9f024f73904cf55" class="t t">PSCommand</a> <span id="r180 rd" class="r180 r">backupCommand</span> = <a href="#f984c2b1a1646528" class="i field">_psCommand</a>;
            <b>try</b>
            {
                <a href="#f984c2b1a1646528" class="i field">_psCommand</a> = <span class="r179 r">context</span>.<a href="#770307ebce29365b" class="i property">Command</a>;
 
                <span class="c">// Last element</span>
                <b>if</b> (<a href="#f984c2b1a1646528" class="i field">_psCommand</a> == <a href="#4cfb6cc82eb60c86" class="i property">ExtraCommands</a>[<a href="#4cfb6cc82eb60c86" class="i property">ExtraCommands</a>.<span class="i">Count</span> - 1])
                {
                    <a href="#90e4778239a93806" class="i property">RunningExtraCommands</a> = <b>false</b>;
                }
 
                <b>try</b>
                {
                    <span class="i">IAsyncResult</span> <span id="r181 rd" class="r181 r">cmdResult</span> = <a href="#82e515b14a72a8b1" class="i method">CoreInvokeAsync</a>&lt;<b>object</b>, <a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;(<b>null</b>, <span class="r179 r">context</span>.<a href="#e0f6b091d2baafbf" class="i property">Output</a>, <a href="#55501b58ae0e59d6" class="i field">_batchInvocationSettings</a>,
                        <b>null</b>, <a href="#23fe95e8a4f70ff4" class="i field">_batchAsyncResult</a>.<a href="AsyncResult.cs.html#90eec6fb5cd1c7c3" class="i property">AsyncState</a>, <span class="r179 r">context</span>.<a href="#e0f6b091d2baafbf" class="i property">Output</a>);
 
                    <a href="#e6f659e0f52c6eca" class="i method">EndInvoke</a>(<span class="r181 r">cmdResult</span>);
                }
                <b>catch</b> (<a href="../../utils/ExecutionExceptions.cs.html#f896df45dff24981" class="t t">ActionPreferenceStopException</a> <span id="r182 rd" class="r182 r">e</span>)
                {
                    <span class="c">// We need to honor the current error action preference here</span>
                    <a href="#20bc91cc1e81ae6e" class="i field">_stopBatchExecution</a> = <b>true</b>;
                    <a href="#23fe95e8a4f70ff4" class="i field">_batchAsyncResult</a>.<span class="i">SetAsCompleted</span>(<span class="r182 r">e</span>);
                    <b>return</b>;
                }
                <b>catch</b> (<span class="i">Exception</span> <span id="r183 rd" class="r183 r">e</span>)
                {
                    <a href="#87033b28ad23f4b2" class="i method">SetHadErrors</a>(<b>true</b>);
 
                    <span class="c">// Stop if necessarily</span>
                    <b>if</b> ((<a href="#55501b58ae0e59d6" class="i field">_batchInvocationSettings</a> != <b>null</b>) &amp;&amp; <a href="#55501b58ae0e59d6" class="i field">_batchInvocationSettings</a>.<a href="#648c685f4b558fd3" class="i property">ErrorActionPreference</a> == <a href="../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="../CommandBase.cs.html#83fefb47b3abc4e7" class="i field">Stop</a>)
                    {
                        <a href="#20bc91cc1e81ae6e" class="i field">_stopBatchExecution</a> = <b>true</b>;
                        <a href="#798d8aa31b53637b" class="i method">AppendExceptionToErrorStream</a>(<span class="r183 r">e</span>);
                        <a href="#23fe95e8a4f70ff4" class="i field">_batchAsyncResult</a>.<a href="AsyncResult.cs.html#2d78c0fa1b51bb6e" class="i method">SetAsCompleted</a>(<b>null</b>);
                        <b>return</b>;
                    }
 
                    <span class="c">// If we get here, then ErrorActionPreference is either Continue,</span>
                    <span class="c">// SilentlyContinue, or Inquire (Continue), so we just continue....</span>
                    <b>if</b> (<a href="#55501b58ae0e59d6" class="i field">_batchInvocationSettings</a> == <b>null</b>)
                    {
                        <a href="../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a> <span id="r184 rd" class="r184 r">preference</span> = (<a href="../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>)<a href="#ccf57242c9d46642" class="i property">Runspace</a>.<a href="Connection.cs.html#c43f0c90447752e8" class="i property">SessionStateProxy</a>.<a href="Connection.cs.html#924ecee19da69970" class="i method">GetVariable</a>(<span class="s">&quot;ErrorActionPreference&quot;</span>);
 
                        <b>switch</b> (<span class="r184 r">preference</span>)
                        {
                            <b>case</b> <a href="../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="../CommandBase.cs.html#e5c6f06e809b81d8" class="i field">SilentlyContinue</a>:
                            <b>case</b> <a href="../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="../CommandBase.cs.html#0d6a3114b77f011d" class="i field">Continue</a>:
                                <a href="#798d8aa31b53637b" class="i method">AppendExceptionToErrorStream</a>(<span class="r183 r">e</span>);
                                <b>break</b>;
                            <b>case</b> <a href="../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="../CommandBase.cs.html#83fefb47b3abc4e7" class="i field">Stop</a>:
                                <a href="#23fe95e8a4f70ff4" class="i field">_batchAsyncResult</a>.<a href="AsyncResult.cs.html#2d78c0fa1b51bb6e" class="i method">SetAsCompleted</a>(<span class="r183 r">e</span>);
                                <b>return</b>;
                            <b>case</b> <a href="../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="../CommandBase.cs.html#acaaaa2f0a580cb4" class="i field">Inquire</a>:
                            <b>case</b> <a href="../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="../CommandBase.cs.html#e7eef70977370b56" class="i field">Ignore</a>:
                                <b>break</b>;
                        }
                    }
                    <b>else</b> <b>if</b> (<a href="#55501b58ae0e59d6" class="i field">_batchInvocationSettings</a>.<a href="#648c685f4b558fd3" class="i property">ErrorActionPreference</a> != <a href="../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="../CommandBase.cs.html#e7eef70977370b56" class="i field">Ignore</a>)
                    {
                        <a href="#798d8aa31b53637b" class="i method">AppendExceptionToErrorStream</a>(<span class="r183 r">e</span>);
                    }
 
                    <span class="c">// Let it continue</span>
                }
 
                <b>if</b> (<a href="#f984c2b1a1646528" class="i field">_psCommand</a> == <a href="#4cfb6cc82eb60c86" class="i property">ExtraCommands</a>[<a href="#4cfb6cc82eb60c86" class="i property">ExtraCommands</a>.<span class="i">Count</span> - 1])
                {
                    <a href="#23fe95e8a4f70ff4" class="i field">_batchAsyncResult</a>.<a href="AsyncResult.cs.html#2d78c0fa1b51bb6e" class="i method">SetAsCompleted</a>(<b>null</b>);
                }
            }
            <b>finally</b>
            {
                <a href="#f984c2b1a1646528" class="i field">_psCommand</a> = <span class="r180 r">backupCommand</span>;
                <span class="r179 r">context</span>.<a href="#1369aefa0184a77f" class="i method">Signal</a>();
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Batch invocation callback.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r185 r">result</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="901fb63667ba50e2" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">BatchInvocationCallback</a>(<span class="i">IAsyncResult</span> <span id="r185 rd" class="r185 r">result</span>)
        {
            <span class="i">Debug</span>.<span class="i">Assert</span>(<a href="#4cfb6cc82eb60c86" class="i property">ExtraCommands</a>.<span class="i">Count</span> != 0, <span class="s">&quot;This callback is for batch invocation only&quot;</span>);
 
            <a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r186 rd" class="r186 r">objs</span> = <b>null</b>;
 
            <b>try</b>
            {
                <span class="r186 r">objs</span> = <a href="#e6f659e0f52c6eca" class="i method">EndInvoke</a>(<span class="r185 r">result</span>) ?? <a href="#23fe95e8a4f70ff4" class="i field">_batchAsyncResult</a>.<a href="#df0dcbcd9acb5c6c" class="i property">Output</a>;
 
                <a href="#0892b09cc45a4a49" class="i method">DoRemainingBatchCommands</a>(<span class="r186 r">objs</span>);
            }
            <b>catch</b> (<a href="../../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a> <span id="r187 rd" class="r187 r">e</span>)
            {
                <span class="c">// PowerShell throws the pipeline stopped exception.</span>
                <a href="#23fe95e8a4f70ff4" class="i field">_batchAsyncResult</a>.<span class="i">SetAsCompleted</span>(<span class="r187 r">e</span>);
                <b>return</b>;
            }
            <b>catch</b> (<a href="../../utils/ExecutionExceptions.cs.html#f896df45dff24981" class="t t">ActionPreferenceStopException</a> <span id="r188 rd" class="r188 r">e</span>)
            {
                <span class="c">// We need to honor the current error action preference here</span>
                <a href="#23fe95e8a4f70ff4" class="i field">_batchAsyncResult</a>.<span class="i">SetAsCompleted</span>(<span class="r188 r">e</span>);
                <b>return</b>;
            }
            <b>catch</b> (<span class="i">Exception</span> <span id="r189 rd" class="r189 r">e</span>)
            {
                <a href="#90e4778239a93806" class="i property">RunningExtraCommands</a> = <b>false</b>;
 
                <a href="#87033b28ad23f4b2" class="i method">SetHadErrors</a>(<b>true</b>);
 
                <a href="../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a> <span id="r190 rd" class="r190 r">preference</span>;
                <b>if</b> (<a href="#55501b58ae0e59d6" class="i field">_batchInvocationSettings</a> != <b>null</b>)
                {
                    <span class="r190 r">preference</span> = <a href="#55501b58ae0e59d6" class="i field">_batchInvocationSettings</a>.<a href="#648c685f4b558fd3" class="i property">ErrorActionPreference</a> ?? <a href="../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="../CommandBase.cs.html#0d6a3114b77f011d" class="i field">Continue</a>;
                }
                <b>else</b>
                {
                    <span class="r190 r">preference</span> = (<a href="#ccf57242c9d46642" class="i property">Runspace</a> != <b>null</b>) ?
                        (<a href="../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>)<a href="#ccf57242c9d46642" class="i property">Runspace</a>.<a href="Connection.cs.html#c43f0c90447752e8" class="i property">SessionStateProxy</a>.<a href="Connection.cs.html#924ecee19da69970" class="i method">GetVariable</a>(<span class="s">&quot;ErrorActionPreference&quot;</span>)
                        : <a href="../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="../CommandBase.cs.html#0d6a3114b77f011d" class="i field">Continue</a>;
                }
 
                <b>switch</b> (<span class="r190 r">preference</span>)
                {
                    <b>case</b> <a href="../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="../CommandBase.cs.html#e5c6f06e809b81d8" class="i field">SilentlyContinue</a>:
                    <b>case</b> <a href="../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="../CommandBase.cs.html#0d6a3114b77f011d" class="i field">Continue</a>:
                        <a href="#798d8aa31b53637b" class="i method">AppendExceptionToErrorStream</a>(<span class="r189 r">e</span>);
                        <b>break</b>;
                    <b>case</b> <a href="../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="../CommandBase.cs.html#83fefb47b3abc4e7" class="i field">Stop</a>:
                        <a href="#23fe95e8a4f70ff4" class="i field">_batchAsyncResult</a>.<a href="AsyncResult.cs.html#2d78c0fa1b51bb6e" class="i method">SetAsCompleted</a>(<span class="r189 r">e</span>);
                        <b>return</b>;
                    <b>case</b> <a href="../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="../CommandBase.cs.html#acaaaa2f0a580cb4" class="i field">Inquire</a>:
                    <b>case</b> <a href="../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="../CommandBase.cs.html#e7eef70977370b56" class="i field">Ignore</a>:
                        <b>break</b>;
                }
 
                <b>if</b> (<span class="r186 r">objs</span> == <b>null</b>)
                {
                    <span class="r186 r">objs</span> = <a href="#23fe95e8a4f70ff4" class="i field">_batchAsyncResult</a>.<a href="#df0dcbcd9acb5c6c" class="i property">Output</a>;
                }
 
                <a href="#0892b09cc45a4a49" class="i method">DoRemainingBatchCommands</a>(<span class="r186 r">objs</span>);
            }
            <b>finally</b>
            {
                <b>if</b> (<a href="#b3c8b30fb7648387" class="i field">_isBatching</a>)
                {
                    <a href="#6aa077ee1a01c65e" class="i method">EndAsyncBatchExecution</a>();
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Executes remaining batch commands.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private void</b> <a id="0892b09cc45a4a49" href="../../R/0892b09cc45a4a49.html" target="n" data-glyph="76,1" class="i method">DoRemainingBatchCommands</a>(<a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r191 rd" class="r191 r">objs</span>)
        {
            <b>if</b> (<a href="#4cfb6cc82eb60c86" class="i property">ExtraCommands</a>.<span class="i">Count</span> &gt; 1)
            {
                <b>for</b> (<b>int</b> <span id="r192 rd" class="r192 r">i</span> = 1; <span class="r192 r">i</span> &lt; <a href="#4cfb6cc82eb60c86" class="i property">ExtraCommands</a>.<span class="i">Count</span>; <span class="r192 r">i</span>++)
                {
                    <b>if</b> (<a href="#20bc91cc1e81ae6e" class="i field">_stopBatchExecution</a>)
                    {
                        <b>break</b>;
                    }
 
                    <a href="#af059b37dfbedbfb" class="t t">BatchInvocationContext</a> <span id="r193 rd" class="r193 r">context</span> = <b>new</b> <span class="t">BatchInvocationContext</span>(<a href="#4cfb6cc82eb60c86" class="i property">ExtraCommands</a>[<span class="r192 r">i</span>], <span class="r191 r">objs</span>);
 
                    <span class="c">// Queue a batch work item here.</span>
                    <span class="c">// Calling CoreInvokeAsync / CoreInvoke here directly doesn&#39;t work and causes the thread to not respond.</span>
                    <span class="i">ThreadPool</span>.<span class="i">QueueUserWorkItem</span>(<b>new</b> <span class="i">WaitCallback</span>(<span class="i">BatchInvocationWorkItem</span>), <span class="r193 r">context</span>);
                    <span class="r193 r">context</span>.<a href="#8fe725abeecbf495" class="i method">Wait</a>();
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private void</b> <a id="8995adafa9f25650" href="../../R/8995adafa9f25650.html" target="n" data-glyph="76,1" class="i method">DetermineIsBatching</a>()
        {
            <b>foreach</b> (<a href="Command.cs.html#b55b68a3bf75e612" class="t t">Command</a> <span id="r194 rd" class="r194 r">command</span> <b>in</b> <a href="#f984c2b1a1646528" class="i field">_psCommand</a>.<a href="PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>)
            {
                <b>if</b> (<span class="r194 r">command</span>.<a href="Command.cs.html#02fce76b562e32ef" class="i property">IsEndOfStatement</a>)
                {
                    <a href="#b3c8b30fb7648387" class="i field">_isBatching</a> = <b>true</b>;
                    <b>return</b>;
                }
            }
 
            <a href="#b3c8b30fb7648387" class="i field">_isBatching</a> = <b>false</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Prepare for async batch execution.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private void</b> <a id="efa3902a0546e8df" href="../../R/efa3902a0546e8df.html" target="n" data-glyph="76,1" class="i method">SetupAsyncBatchExecution</a>()
        {
            <span class="i">Debug</span>.<span class="i">Assert</span>(<a href="#b3c8b30fb7648387" class="i field">_isBatching</a>);
 
            <a href="#ee03a037962ee4ad" class="i field">_backupPSCommand</a> = <a href="#f984c2b1a1646528" class="i field">_psCommand</a>.<a href="PSCommand.cs.html#644d43eece6a0031" class="i method">Clone</a>();
            <a href="#4cfb6cc82eb60c86" class="i property">ExtraCommands</a>.<span class="i">Clear</span>();
 
            <a href="PSCommand.cs.html#b9f024f73904cf55" class="t t">PSCommand</a> <span id="r195 rd" class="r195 r">currentPipe</span> = <b>new</b> <a href="PSCommand.cs.html#45c724f1a0c9f07a" class="t constructor">PSCommand</a>();
            <span class="r195 r">currentPipe</span>.<a href="PSCommand.cs.html#c72d40210220cf60" class="i property">Owner</a> = <a href="#3d1b346df3be574c" class="k">this</a>;
 
            <b>foreach</b> (<a href="Command.cs.html#b55b68a3bf75e612" class="t t">Command</a> <span id="r196 rd" class="r196 r">command</span> <b>in</b> <a href="#f984c2b1a1646528" class="i field">_psCommand</a>.<a href="PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>)
            {
                <b>if</b> (<span class="r196 r">command</span>.<a href="Command.cs.html#02fce76b562e32ef" class="i property">IsEndOfStatement</a>)
                {
                    <span class="r195 r">currentPipe</span>.<a href="PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>.<span class="i">Add</span>(<span class="r196 r">command</span>);
                    <a href="#4cfb6cc82eb60c86" class="i property">ExtraCommands</a>.<span class="i">Add</span>(<span class="r195 r">currentPipe</span>);
                    <span class="r195 r">currentPipe</span> = <b>new</b> <a href="PSCommand.cs.html#45c724f1a0c9f07a" class="t constructor">PSCommand</a>();
                    <span class="r195 r">currentPipe</span>.<a href="PSCommand.cs.html#c72d40210220cf60" class="i property">Owner</a> = <a href="#3d1b346df3be574c" class="k">this</a>;
                }
                <b>else</b>
                {
                    <span class="r195 r">currentPipe</span>.<a href="PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>.<span class="i">Add</span>(<span class="r196 r">command</span>);
                }
            }
 
            <b>if</b> (<span class="r195 r">currentPipe</span>.<a href="PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>.<span class="i">Count</span> != 0)
            {
                <a href="#4cfb6cc82eb60c86" class="i property">ExtraCommands</a>.<span class="i">Add</span>(<span class="r195 r">currentPipe</span>);
            }
 
            <a href="#f984c2b1a1646528" class="i field">_psCommand</a> = <a href="#4cfb6cc82eb60c86" class="i property">ExtraCommands</a>[0];
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Ends an async batch execution.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private void</b> <a id="6aa077ee1a01c65e" href="../../R/6aa077ee1a01c65e.html" target="n" data-glyph="76,1" class="i method">EndAsyncBatchExecution</a>()
        {
            <span class="i">Debug</span>.<span class="i">Assert</span>(<a href="#b3c8b30fb7648387" class="i field">_isBatching</a>);
 
            <a href="#f984c2b1a1646528" class="i field">_psCommand</a> = <a href="#ee03a037962ee4ad" class="i field">_backupPSCommand</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Appends an exception to the error stream.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r197 r">e</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="798d8aa31b53637b" href="../../R/798d8aa31b53637b.html" target="n" data-glyph="76,1" class="i method">AppendExceptionToErrorStream</a>(<span class="i">Exception</span> <span id="r197 rd" class="r197 r">e</span>)
        {
            <a href="../ErrorPackage.cs.html#2d342e12f9600886" class="t t">IContainsErrorRecord</a> <span id="r198 rd" class="r198 r">er</span> = <span class="r197 r">e</span> <b>as</b> <a href="../ErrorPackage.cs.html#2d342e12f9600886" class="t t">IContainsErrorRecord</a>;
 
            <b>if</b> (<span class="r198 r">er</span> != <b>null</b> &amp;&amp; <span class="r198 r">er</span>.<a href="../ErrorPackage.cs.html#cef340f272a30c6b" class="i property">ErrorRecord</a> != <b>null</b>)
            {
                <a href="#3d1b346df3be574c" class="k">this</a>.<a href="#622ebeade9b6ada7" class="i property">Streams</a>.<a href="#ae04a604c26c6f7d" class="i property">Error</a>.<a href="PSDataCollection.cs.html#681501d1e27b76df" class="i method">Add</a>(<span class="r198 r">er</span>.<a href="../ErrorPackage.cs.html#cef340f272a30c6b" class="i property">ErrorRecord</a>);
            }
            <b>else</b>
            {
                <a href="#3d1b346df3be574c" class="k">this</a>.<a href="#622ebeade9b6ada7" class="i property">Streams</a>.<a href="#ae04a604c26c6f7d" class="i property">Error</a>.<a href="PSDataCollection.cs.html#681501d1e27b76df" class="i method">Add</a>(<b>new</b> <a href="../ErrorPackage.cs.html#e9334565e5136f43" class="t constructor">ErrorRecord</a>(<span class="r197 r">e</span>,
                    <span class="s">&quot;InvalidOperation&quot;</span>, <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>, <b>null</b>));
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Waits for the pending asynchronous BeginInvoke to complete.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r199 r">asyncResult</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Instance of IAsyncResult returned by BeginInvoke.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The output buffer created to hold the results of the asynchronous invoke, or null if the caller provided their own buffer.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> asyncResult is a null reference.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> asyncResult object was not created by calling BeginInvoke</span>
        <span class="c">///</span><span class="c"> on this PowerShell instance.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The running PowerShell pipeline was stopped.</span>
        <span class="c">///</span><span class="c"> This occurs when </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#3d1b346df3be574c" class="t t">PowerShell</a>.<a href="#417fd1f64732b2ef" class="i method">Stop</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> or </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#3d1b346df3be574c" class="t t">PowerShell</a>.<a href="#41fb9ee3f80cbc1d" class="i method">StopAsync</a>(<span class="i">AsyncCallback</span>, <b>object</b>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is called.</span>
        <span class="c">///</span><span class="c"> To collect partial output in this scenario,</span>
        <span class="c">///</span><span class="c"> supply a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>{<span class="r200 r t">T</span>}<span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#3d1b346df3be574c" class="t t">PowerShell</a>.<a href="#136b4e9e4079b11f" class="i method">BeginInvoke</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> for the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="i">output</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> parameter</span>
        <span class="c">///</span><span class="c"> and either add a handler for the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>{<span class="r201 r t">T</span>}.<a href="PSDataCollection.cs.html#43aaeadedbd395cd" class="i">DataAdding</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> event</span>
        <span class="c">///</span><span class="c"> or catch the exception and enumerate the object supplied.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public</b> <a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <a id="e6f659e0f52c6eca" href="../../R/e6f659e0f52c6eca.html" target="n" data-glyph="72,1" class="i method">EndInvoke</a>(<span class="i">IAsyncResult</span> <span id="r199 rd" class="r199 r">asyncResult</span>)
        {
            <b>try</b>
            {
                <a href="#e9453081966ac388" class="i field">_commandInvokedSynchronously</a> = <b>true</b>;
 
                <b>if</b> (<span class="r199 r">asyncResult</span> == <b>null</b>)
                {
                    <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r199 r">asyncResult</span>));
                }
 
                <a href="#ba11495f3db79edb" class="t t">PowerShellAsyncResult</a> <span id="r202 rd" class="r202 r">psAsyncResult</span> = <span class="r199 r">asyncResult</span> <b>as</b> <a href="#ba11495f3db79edb" class="t t">PowerShellAsyncResult</a>;
 
                <b>if</b> ((<span class="r202 r">psAsyncResult</span> == <b>null</b>) ||
                    (<span class="r202 r">psAsyncResult</span>.<a href="AsyncResult.cs.html#c8afb8644f9407ba" class="i property">OwnerId</a> != <a href="#d8c9867186529e49" class="i property">InstanceId</a>) ||
                    (!<span class="r202 r">psAsyncResult</span>.<a href="#36fee7e835a131cc" class="i property">IsAssociatedWithAsyncInvoke</a>))
                {
                    <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentException</span>(<b>nameof</b>(<span class="r199 r">asyncResult</span>),
                        <span class="i">PowerShellStrings</span>.<span class="i">AsyncResultNotOwned</span>, <span class="s">&quot;IAsyncResult&quot;</span>, <span class="s">&quot;BeginInvoke&quot;</span>);
                }
 
                <a href="#4f10d51ac16015a7" class="i property">EndInvokeAsyncResult</a> = <span class="r202 r">psAsyncResult</span>;
                <span class="r202 r">psAsyncResult</span>.<a href="AsyncResult.cs.html#75f5584cab706e68" class="i method">EndInvoke</a>();
                <a href="#4f10d51ac16015a7" class="i property">EndInvokeAsyncResult</a> = <b>null</b>;
 
                <span class="c">// PowerShell no longer owns the output buffer when it is passed back to the caller.</span>
                <a href="#6bc67203f49097e8" class="i method">ResetOutputBufferAsNeeded</a>();
                <b>return</b> <span class="r202 r">psAsyncResult</span>.<a href="#df0dcbcd9acb5c6c" class="i property">Output</a>;
            }
            <b>catch</b> (<a href="RunspacePool.cs.html#741ffc1755303d69" class="t t">InvalidRunspacePoolStateException</a> <span id="r203 rd" class="r203 r">exception</span>)
            {
                <a href="#87033b28ad23f4b2" class="i method">SetHadErrors</a>(<b>true</b>);
                <b>if</b> (<a href="#d6487a2f72366731" class="i field">_runspace</a> != <b>null</b>) <span class="c">// the pool exception was actually thrown by a runspace</span>
                {
                    <b>throw</b> <span class="r203 r">exception</span>.<a href="RunspacePool.cs.html#aeea64df1e9df609" class="i method">ToInvalidRunspaceStateException</a>();
                }
 
                <b>throw</b>;
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Stop Overloads
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Stop the currently running command synchronously.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> When used with </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#3d1b346df3be574c" class="t t">PowerShell</a>.<a href="#184e23c46120523e" class="i method">Invoke</a>()<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">, that call will return a partial result.</span>
        <span class="c">///</span><span class="c"> When used with </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#3d1b346df3be574c" class="t t">PowerShell</a>.<a href="#b2318776d8ca5543" class="i method">InvokeAsync</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">, that call will throw a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">. </span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>public void</b> <a id="417fd1f64732b2ef" href="../../R/417fd1f64732b2ef.html" target="n" data-glyph="72,1" class="i method">Stop</a>()
        {
            <b>try</b>
            {
                <span class="i">IAsyncResult</span> <span id="r204 rd" class="r204 r">asyncResult</span> = <a href="#bfcbbffaa4c984b3" class="i method">CoreStop</a>(<b>true</b>, <b>null</b>, <b>null</b>);
                <span class="c">// This is a sync call..Wait for the stop operation to complete.</span>
                <span class="r204 r">asyncResult</span>.<span class="i">AsyncWaitHandle</span>.<span class="i">WaitOne</span>();
 
                <span class="c">// PowerShell no longer owns the output buffer when the pipeline is stopped by caller.</span>
                <a href="#6bc67203f49097e8" class="i method">ResetOutputBufferAsNeeded</a>();
            }
            <b>catch</b> (<span class="i">ObjectDisposedException</span>)
            {
                <span class="c">// If it&#39;s already disposed, then the client doesn&#39;t need to know.</span>
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Stop the currently running command asynchronously. If the command is not started,</span>
        <span class="c">///</span><span class="c"> the state of PowerShell instance is changed to Stopped and corresponding events</span>
        <span class="c">///</span><span class="c"> will be raised.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> The returned IAsyncResult object can be used to wait for the stop operation</span>
        <span class="c">///</span><span class="c"> to complete.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r205 r">callback</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A AsyncCallback to call once the BeginStop completes.</span>
        <span class="c">///</span><span class="c"> Note: when using this API in script, don&#39;t pass in a delegate that is cast from a script block.</span>
        <span class="c">///</span><span class="c"> The callback could be invoked from a thread without a default Runspace and a delegate cast from</span>
        <span class="c">///</span><span class="c"> a script block would fail in that case.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r206 r">state</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A user supplied state to call the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r205 r">callback</span><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> with.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public</b> <span class="i">IAsyncResult</span> <a id="23f9dce20b146f19" href="../../R/23f9dce20b146f19.html" target="n" data-glyph="72,1" class="i method">BeginStop</a>(<span class="i">AsyncCallback</span> <span id="r205 rd" class="r205 r">callback</span>, <b>object</b> <span id="r206 rd" class="r206 r">state</span>)
        {
            <b>return</b> <a href="#bfcbbffaa4c984b3" class="i method">CoreStop</a>(<b>false</b>, <span class="r205 r">callback</span>, <span class="r206 r">state</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Waits for the pending asynchronous BeginStop to complete.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r207 r">asyncResult</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Instance of IAsyncResult returned by BeginStop.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> asyncResult is a null reference.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> asyncResult object was not created by calling BeginStop</span>
        <span class="c">///</span><span class="c"> on this PowerShell instance.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> When used with </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#3d1b346df3be574c" class="t t">PowerShell</a>.<a href="#184e23c46120523e" class="i method">Invoke</a>()<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">, that call will return a partial result.</span>
        <span class="c">///</span><span class="c"> When used with </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#3d1b346df3be574c" class="t t">PowerShell</a>.<a href="#b2318776d8ca5543" class="i method">InvokeAsync</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">, that call will throw a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">. </span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>public void</b> <a id="dfd851f683621820" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">EndStop</a>(<span class="i">IAsyncResult</span> <span id="r207 rd" class="r207 r">asyncResult</span>)
        {
            <b>if</b> (<span class="r207 r">asyncResult</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r207 r">asyncResult</span>));
            }
 
            <a href="#ba11495f3db79edb" class="t t">PowerShellAsyncResult</a> <span id="r208 rd" class="r208 r">psAsyncResult</span> = <span class="r207 r">asyncResult</span> <b>as</b> <a href="#ba11495f3db79edb" class="t t">PowerShellAsyncResult</a>;
 
            <b>if</b> ((<span class="r208 r">psAsyncResult</span> == <b>null</b>) ||
                (<span class="r208 r">psAsyncResult</span>.<a href="AsyncResult.cs.html#c8afb8644f9407ba" class="i property">OwnerId</a> != <a href="#d8c9867186529e49" class="i property">InstanceId</a>) ||
                (<span class="r208 r">psAsyncResult</span>.<a href="#36fee7e835a131cc" class="i property">IsAssociatedWithAsyncInvoke</a>))
            {
                <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentException</span>(<b>nameof</b>(<span class="r207 r">asyncResult</span>),
                    <span class="i">PowerShellStrings</span>.<span class="i">AsyncResultNotOwned</span>, <span class="s">&quot;IAsyncResult&quot;</span>, <span class="s">&quot;BeginStop&quot;</span>);
            }
 
            <span class="r208 r">psAsyncResult</span>.<a href="AsyncResult.cs.html#75f5584cab706e68" class="i method">EndInvoke</a>();
 
            <span class="c">// PowerShell no longer owns the output buffer when the pipeline is stopped by caller.</span>
            <a href="#6bc67203f49097e8" class="i method">ResetOutputBufferAsNeeded</a>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Stop a PowerShell command asynchronously.</span>
        <span class="c">///</span><span class="c"> Use await to wait for the command to stop.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the command is not started, the state of the PowerShell instance</span>
        <span class="c">///</span><span class="c"> is changed to Stopped and corresponding events will be raised.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r209 r">callback</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An AsyncCallback to call once the command is invoked.</span>
        <span class="c">///</span><span class="c"> Note: when using this API in script, don&#39;t pass in a delegate that is cast from a script block.</span>
        <span class="c">///</span><span class="c"> The callback could be invoked from a thread without a default Runspace and a delegate cast from</span>
        <span class="c">///</span><span class="c"> a script block would fail in that case.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r210 r">state</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A user supplied state to call the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r209 r">callback</span><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> with.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The output buffer created to hold the results of the asynchronous invoke,</span>
        <span class="c">///</span><span class="c"> or null if the caller provided their own buffer.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> When used with </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#3d1b346df3be574c" class="t t">PowerShell</a>.<a href="#184e23c46120523e" class="i method">Invoke</a>()<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">, that call will return a partial result.</span>
        <span class="c">///</span><span class="c"> When used with </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#3d1b346df3be574c" class="t t">PowerShell</a>.<a href="#b2318776d8ca5543" class="i method">InvokeAsync</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">, that call will throw a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">. </span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>public</b> <span class="i">Task</span> <a id="41fb9ee3f80cbc1d" href="../../R/41fb9ee3f80cbc1d.html" target="n" data-glyph="72,1" class="i method">StopAsync</a>(<span class="i">AsyncCallback</span> <span id="r209 rd" class="r209 r">callback</span>, <b>object</b> <span id="r210 rd" class="r210 r">state</span>)
            =&gt; <span class="i">Task</span>.<span class="i">Factory</span>.<span class="i">FromAsync</span>(<a href="#23f9dce20b146f19" class="i method">BeginStop</a>(<span class="r209 r">callback</span>, <span class="r210 r">state</span>), <a href="#5af65affd7010570" class="i field">_endStopMethod</a>);
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Event Handlers
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Handler for state changed events for the currently running pipeline.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r211 r">source</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Source of the event.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r212 r">stateEventArgs</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Pipeline State.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="70e84a6d82e5ff5c" href="../../R/70e84a6d82e5ff5c.html" target="n" data-glyph="76,1" class="i method">PipelineStateChanged</a>(<b>object</b> <span id="r211 rd" class="r211 r">source</span>, <a href="Pipeline.cs.html#f088a79047187694" class="t t">PipelineStateEventArgs</a> <span id="r212 rd" class="r212 r">stateEventArgs</span>)
        {
            <span class="c">// we need to process the pipeline event.</span>
            <a href="#42e325836d1ae967" class="t t">PSInvocationStateInfo</a> <span id="r213 rd" class="r213 r">targetStateInfo</span> = <b>new</b> <a href="#206b687af8893d07" class="t constructor">PSInvocationStateInfo</a>(<span class="r212 r">stateEventArgs</span>.<a href="Pipeline.cs.html#90fde3748e993197" class="i property">PipelineStateInfo</a>);
            <a href="#8bc5b0d04eada2b1" class="i method">SetStateChanged</a>(<span class="r213 r">targetStateInfo</span>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> IDisposable Overrides
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Dispose all managed resources. This will suppress finalizer on the object from getting called by</span>
        <span class="c">///</span><span class="c"> calling System.GC.SuppressFinalize(this).</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public void</b> <a id="18cbb6bfae891ee7" href="../../R/18cbb6bfae891ee7.html" target="n" data-glyph="72,1" class="i method">Dispose</a>()
        {
            <a href="#2f21d8689637a0f8" class="i method">Dispose</a>(<b>true</b>);
            <span class="c">// To prevent derived types with finalizers from having to re-implement System.IDisposable to call it,</span>
            <span class="c">// unsealed types without finalizers should still call SuppressFinalize.</span>
            <span class="i n">System</span>.<span class="i">GC</span>.<span class="i">SuppressFinalize</span>(<a href="#3d1b346df3be574c" class="k">this</a>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Internal / Private Methods / Properties
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Indicates if this PowerShell object is the owner of the</span>
        <span class="c">///</span><span class="c"> runspace or RunspacePool assigned to this object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public bool</b> <a id="2d0966000c73a748" href="../../R/2d0966000c73a748.html" target="n" data-glyph="102,1" class="i property">IsRunspaceOwner</a> { <b>get</b>; <b>internal set</b>; } = <b>false</b>;
 
        <b>internal bool</b> <a id="f2d4fd7d6657647d" href="../../R/f2d4fd7d6657647d.html" target="n" data-glyph="104,1" class="i property">ErrorBufferOwner</a> { <b>get</b>; <b>set</b>; } = <b>true</b>;
 
        <b>internal bool</b> <a id="06852585cb89a70d" href="../../R/06852585cb89a70d.html" target="n" data-glyph="104,1" class="i property">OutputBufferOwner</a> { <b>get</b>; <b>set</b>; } = <b>true</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> OutputBuffer.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <a id="a29e9daed047bb39" href="../../R/a29e9daed047bb39.html" target="n" data-glyph="104,1" class="i property">OutputBuffer</a> { <b>get</b>; <b>private set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Reset the output buffer to null if it&#39;s owned by the current powershell instance.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private void</b> <a id="6bc67203f49097e8" href="../../R/6bc67203f49097e8.html" target="n" data-glyph="76,1" class="i method">ResetOutputBufferAsNeeded</a>()
        {
            <b>if</b> (<a href="#06852585cb89a70d" class="i property">OutputBufferOwner</a>)
            {
                <a href="#06852585cb89a70d" class="i property">OutputBufferOwner</a> = <b>false</b>;
                <a href="#a29e9daed047bb39" class="i property">OutputBuffer</a> = <b>null</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Get a steppable pipeline object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A steppable pipeline object.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An attempt was made to use the scriptblock outside of the engine.</span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public</b> <a href="../lang/scriptblock.cs.html#5e20a8a88cfbe6cb" class="t t">SteppablePipeline</a> <a id="acfd8ea8948cec44" href="../../R/acfd8ea8948cec44.html" target="n" data-glyph="72,1" class="i method">GetSteppablePipeline</a>()
        {
            <a href="../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r214 rd" class="r214 r">context</span> = <a href="#ff0cc19559303c1e" class="i method">GetContextFromTLS</a>();
            <a href="../lang/scriptblock.cs.html#5e20a8a88cfbe6cb" class="t t">SteppablePipeline</a> <span id="r215 rd" class="r215 r">spl</span> = <a href="#e709a9a82f9a8fe0" class="i method">GetSteppablePipeline</a>(<span class="r214 r">context</span>, <a href="../SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a>.<a href="../SecurityManagerBase.cs.html#946d8e7ca02acec6" class="i field">Internal</a>);
            <b>return</b> <span class="r215 r">spl</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns the current execution context from TLS, or raises an exception if it is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An attempt was made to use the scriptblock outside of the engine.</span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal</b> <a href="../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <a id="ff0cc19559303c1e" href="../../R/ff0cc19559303c1e.html" target="n" data-glyph="74,1" class="i method">GetContextFromTLS</a>()
        {
            <a href="../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r216 rd" class="r216 r">context</span> = <a href="LocalPipeline.cs.html#4ecb13103c10f113" class="t t">LocalPipeline</a>.<a href="LocalPipeline.cs.html#d3eaa3d3391ed484" class="i method">GetExecutionContextFromTLS</a>();
 
            <span class="c">// If ExecutionContext from TLS is null then we are not in powershell engine thread.</span>
            <b>if</b> (<span class="r216 r">context</span> == <b>null</b>)
            {
                <b>string</b> <span id="r217 rd" class="r217 r">scriptText</span> = <a href="#3d1b346df3be574c" class="k">this</a>.<a href="#7bde27452e045465" class="i property">Commands</a>.<a href="PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>.<span class="i">Count</span> &gt; 0 ? <a href="#3d1b346df3be574c" class="k">this</a>.<a href="#7bde27452e045465" class="i property">Commands</a>.<a href="PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>[0].<span class="i">CommandText</span> : <b>null</b>;
                <a href="../../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r218 rd" class="r218 r">e</span> = <b>null</b>;
 
                <b>if</b> (<span class="r217 r">scriptText</span> != <b>null</b>)
                {
                    <span class="r217 r">scriptText</span> = <a href="../ErrorPackage.cs.html#37830dc92d4ac970" class="t t">ErrorCategoryInfo</a>.<span class="i">Ellipsize</span>(<span class="i n">System</span>.<span class="i">Globalization</span>.<span class="i">CultureInfo</span>.<span class="i">CurrentUICulture</span>, <span class="r217 r">scriptText</span>);
                    <span class="r218 r">e</span> = <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(
                        <span class="i">PowerShellStrings</span>.<span class="i">CommandInvokedFromWrongThreadWithCommand</span>,
                        <span class="r217 r">scriptText</span>);
                }
                <b>else</b>
                {
                    <span class="r218 r">e</span> = <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(
                        <span class="i">PowerShellStrings</span>.<span class="i">CommandInvokedFromWrongThreadWithoutCommand</span>);
                }
 
                <span class="r218 r">e</span>.<a href="../../utils/MshInvalidOperationException.cs.html#06b019caca30c7ed" class="i method">SetErrorId</a>(<span class="s">&quot;CommandInvokedFromWrongThread&quot;</span>);
                <b>throw</b> <span class="r218 r">e</span>;
            }
 
            <b>return</b> <span class="r216 r">context</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the steppable pipeline from the powershell object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r219 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Engine execution context.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r220 r">commandOrigin</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Command origin.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Steppable pipeline object.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private</b> <a href="../lang/scriptblock.cs.html#5e20a8a88cfbe6cb" class="t t">SteppablePipeline</a> <a id="e709a9a82f9a8fe0" href="../../R/e709a9a82f9a8fe0.html" target="n" data-glyph="76,1" class="i method">GetSteppablePipeline</a>(<a href="../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r219 rd" class="r219 r">context</span>, <a href="../SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a> <span id="r220 rd" class="r220 r">commandOrigin</span>)
        {
            <span class="c">// Check for an empty pipeline</span>
            <b>if</b> (<a href="#7bde27452e045465" class="i property">Commands</a>.<a href="PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>.<span class="i">Count</span> == 0)
            {
                <b>return</b> <b>null</b>;
            }
 
            <a href="../pipeline.cs.html#5e576bcabfa5c82b" class="t t">PipelineProcessor</a> <span id="r221 rd" class="r221 r">pipelineProcessor</span> = <b>new</b> <span class="t">PipelineProcessor</span>();
            <b>bool</b> <span id="r222 rd" class="r222 r">failed</span> = <b>false</b>;
 
            <b>try</b>
            {
                <b>foreach</b> (<a href="Command.cs.html#b55b68a3bf75e612" class="t t">Command</a> <span id="r223 rd" class="r223 r">cmd</span> <b>in</b> <a href="#7bde27452e045465" class="i property">Commands</a>.<a href="PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>)
                {
                    <a href="../CommandProcessorBase.cs.html#45a6054a3775cde6" class="t t">CommandProcessorBase</a> <span id="r224 rd" class="r224 r">commandProcessorBase</span> =
                            <span class="r223 r">cmd</span>.<a href="Command.cs.html#c1f16b253f32cbe1" class="i method">CreateCommandProcessor</a>
                            (
                                <a href="Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a>.<a href="Connection.cs.html#efcd2ba43103de17" class="i property">DefaultRunspace</a>.<a href="Connection.cs.html#3a36e24a88649363" class="i property">ExecutionContext</a>,
                                <b>false</b>,
                                <a href="#32c156c0cba25702" class="i property">IsNested</a> ? <a href="../SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a>.<a href="../SecurityManagerBase.cs.html#946d8e7ca02acec6" class="i field">Internal</a> : <a href="../SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a>.<a href="../SecurityManagerBase.cs.html#66a89eb31c003ba5" class="i field">Runspace</a>
                            );
 
                    <span class="r224 r">commandProcessorBase</span>.<a href="../CommandProcessorBase.cs.html#26a87154c49eb3eb" class="i property">RedirectShellErrorOutputPipe</a> = <a href="#1b4e6f691674a8b2" class="i property">RedirectShellErrorOutputPipe</a>;
 
                    <span class="r221 r">pipelineProcessor</span>.<a href="../pipeline.cs.html#b06f99a3f17ecd81" class="i method">Add</a>(<span class="r224 r">commandProcessorBase</span>);
                }
            }
            <b>catch</b> (<a href="../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>)
            {
                <span class="r222 r">failed</span> = <b>true</b>;
                <b>throw</b>;
            }
            <b>catch</b> (<span class="i">Exception</span> <span id="r225 rd" class="r225 r">e</span>)
            {
                <span class="r222 r">failed</span> = <b>true</b>;
                <b>throw</b> <b>new</b> <span class="t">RuntimeException</span>(<span class="i">PipelineStrings</span>.<span class="i">CannotCreatePipeline</span>, <span class="r225 r">e</span>);
            }
            <b>finally</b>
            {
                <b>if</b> (<span class="r222 r">failed</span>)
                {
                    <span class="r221 r">pipelineProcessor</span>.<a href="../pipeline.cs.html#3193eaf8bd4e8783" class="i method">Dispose</a>();
                }
            }
 
            <b>return</b> <b>new</b> <a href="../lang/scriptblock.cs.html#b328e97fca1fbdc8" class="t constructor">SteppablePipeline</a>(<span class="r219 r">context</span>, <span class="r221 r">pipelineProcessor</span>);
        }
 
        <b>internal bool</b> <a id="fe99bb3389416973" href="../../R/fe99bb3389416973.html" target="n" data-glyph="104,1" class="i property">IsGetCommandMetadataSpecialPipeline</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Checks if the command is running.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="3c429fb0d586f022" href="../../R/3c429fb0d586f022.html" target="n" data-glyph="76,1" class="i method">IsCommandRunning</a>()
        {
            <b>if</b> (<a href="#39b81acd3aeb1582" class="i property">InvocationStateInfo</a>.<a href="#7a70ff5163d0f044" class="i property">State</a> == <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#7142407e9e49cf13" class="i field">Running</a>)
            {
                <b>return</b> <b>true</b>;
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Checks if the current state is Disconnected.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="cf1f49ca8845b477" href="../../R/cf1f49ca8845b477.html" target="n" data-glyph="76,1" class="i method">IsDisconnected</a>()
        {
            <b>return</b> (<a href="#39b81acd3aeb1582" class="i property">InvocationStateInfo</a>.<a href="#7a70ff5163d0f044" class="i property">State</a> == <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#55f5ed5d1c0f010a" class="i field">Disconnected</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Checks if the command is already running.</span>
        <span class="c">///</span><span class="c"> If the command is already running, throws an</span>
        <span class="c">///</span><span class="c"> exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Cannot perform the operation because the command is already started.</span>
        <span class="c">///</span><span class="c"> Stop the command and try the operation again.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>private void</b> <a id="3b4d5707d918bf53" href="../../R/3b4d5707d918bf53.html" target="n" data-glyph="76,1" class="i method">AssertExecutionNotStarted</a>()
        {
            <a href="#b05e2e786a1acdee" class="i method">AssertNotDisposed</a>();
            <b>if</b> (<a href="#3c429fb0d586f022" class="i method">IsCommandRunning</a>())
            {
                <b>string</b> <span id="r226 rd" class="r226 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">PowerShellStrings</span>.<span class="i">ExecutionAlreadyStarted</span>);
                <b>throw</b> <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r226 r">message</span>);
            }
 
            <b>if</b> (<a href="#cf1f49ca8845b477" class="i method">IsDisconnected</a>())
            {
                <b>string</b> <span id="r227 rd" class="r227 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">PowerShellStrings</span>.<span class="i">ExecutionDisconnected</span>);
                <b>throw</b> <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r227 r">message</span>);
            }
 
            <b>if</b> (<a href="#39b81acd3aeb1582" class="i property">InvocationStateInfo</a>.<a href="#7a70ff5163d0f044" class="i property">State</a> == <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#a9d235bf0dc5bfce" class="i field">Stopping</a>)
            {
                <b>string</b> <span id="r228 rd" class="r228 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">PowerShellStrings</span>.<span class="i">ExecutionStopping</span>);
                <b>throw</b> <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r228 r">message</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Checks if the current powershell instance can accept changes like</span>
        <span class="c">///</span><span class="c"> changing one of the properties like Output, Command etc.</span>
        <span class="c">///</span><span class="c"> If changes are not allowed, throws an exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2864fc2d24c87a5a" class="t t">InvalidPowerShellStateException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Powershell instance cannot be changed in its</span>
        <span class="c">///</span><span class="c"> current state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="68c9b1a93a2cdcde" href="../../R/68c9b1a93a2cdcde.html" target="n" data-glyph="74,1" class="i method">AssertChangesAreAccepted</a>()
        {
            <b>lock</b> (<a href="#57ad56a0d8f83c43" class="i field">_syncObject</a>)
            {
                <a href="#b05e2e786a1acdee" class="i method">AssertNotDisposed</a>();
                <b>if</b> (<a href="#3c429fb0d586f022" class="i method">IsCommandRunning</a>() || <a href="#cf1f49ca8845b477" class="i method">IsDisconnected</a>())
                {
                    <b>throw</b> <b>new</b> <a href="#bdb2839004600662" class="t constructor">InvalidPowerShellStateException</a>(<a href="#39b81acd3aeb1582" class="i property">InvocationStateInfo</a>.<a href="#7a70ff5163d0f044" class="i property">State</a>);
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Checks if the current powershell instance is disposed.</span>
        <span class="c">///</span><span class="c"> If disposed, throws ObjectDisposedException.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>private void</b> <a id="b05e2e786a1acdee" href="../../R/b05e2e786a1acdee.html" target="n" data-glyph="76,1" class="i method">AssertNotDisposed</a>()
        {
            <b>if</b> (<a href="#30ab918a4484ceaa" class="i field">_isDisposed</a>)
            {
                <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#02739f4db42486af" class="i method">NewObjectDisposedException</a>(<span class="s">&quot;PowerShell&quot;</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Release all the resources.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r229 r">disposing</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> if true, release all the managed objects.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="2f21d8689637a0f8" href="../../R/2f21d8689637a0f8.html" target="n" data-glyph="76,1" class="i method">Dispose</a>(<b>bool</b> <span id="r229 rd" class="r229 r">disposing</span>)
        {
            <b>if</b> (<span class="r229 r">disposing</span>)
            {
                <b>lock</b> (<a href="#57ad56a0d8f83c43" class="i field">_syncObject</a>)
                {
                    <span class="c">// if already disposed return</span>
                    <b>if</b> (<a href="#30ab918a4484ceaa" class="i field">_isDisposed</a>)
                    {
                        <b>return</b>;
                    }
                }
 
                <span class="c">// Stop the currently running command outside of the lock</span>
                <b>if</b> (<a href="#39b81acd3aeb1582" class="i property">InvocationStateInfo</a>.<a href="#7a70ff5163d0f044" class="i property">State</a> == <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#7142407e9e49cf13" class="i field">Running</a> ||
                    <a href="#39b81acd3aeb1582" class="i property">InvocationStateInfo</a>.<a href="#7a70ff5163d0f044" class="i property">State</a> == <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#a9d235bf0dc5bfce" class="i field">Stopping</a>)
                {
                    <a href="#417fd1f64732b2ef" class="i method">Stop</a>();
                }
 
                <b>lock</b> (<a href="#57ad56a0d8f83c43" class="i field">_syncObject</a>)
                {
                    <a href="#30ab918a4484ceaa" class="i field">_isDisposed</a> = <b>true</b>;
                }
 
                <b>if</b> (<a href="#a29e9daed047bb39" class="i property">OutputBuffer</a> != <b>null</b> &amp;&amp; <a href="#06852585cb89a70d" class="i property">OutputBufferOwner</a>)
                {
                    <a href="#a29e9daed047bb39" class="i property">OutputBuffer</a>.<a href="PSDataCollection.cs.html#17fb91187cc003fd" class="i method">Dispose</a>();
                }
 
                <b>if</b> (<a href="#6b0cd6330b1f780f" class="i field">_errorBuffer</a> != <b>null</b> &amp;&amp; <a href="#f2d4fd7d6657647d" class="i property">ErrorBufferOwner</a>)
                {
                    <a href="#6b0cd6330b1f780f" class="i field">_errorBuffer</a>.<a href="PSDataCollection.cs.html#17fb91187cc003fd" class="i method">Dispose</a>();
                }
 
                <b>if</b> (<a href="#2d0966000c73a748" class="i property">IsRunspaceOwner</a>)
                {
                    <a href="#d6487a2f72366731" class="i field">_runspace</a>.<a href="Connection.cs.html#47cd985e55a9f99c" class="i method">Dispose</a>();
                }
 
                <b>if</b> (<a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a> != <b>null</b>)
                {
                    <a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a>.<a href="../remoting/client/ClientRemotePowerShell.cs.html#245a7ee35136c31b" class="i method">Dispose</a>();
                }
 
                <a href="#aa2e4c96efcd9075" class="i field">_invokeAsyncResult</a> = <b>null</b>;
                <a href="#c48e6ad54262904d" class="i field">_stopAsyncResult</a> = <b>null</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Clear the internal elements.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private void</b> <a id="a597838849d3c0e3" href="../../R/a597838849d3c0e3.html" target="n" data-glyph="76,1" class="i method">InternalClearSuppressExceptions</a>()
        {
            <b>lock</b> (<a href="#57ad56a0d8f83c43" class="i field">_syncObject</a>)
            {
                <b>if</b> (<a href="#1389234891e6cc36" class="i field">_worker</a> != <b>null</b>)
                {
                    <a href="#1389234891e6cc36" class="i field">_worker</a>.<a href="#8eef4b09b7e255c9" class="i method">InternalClearSuppressExceptions</a>();
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Raise the execution state change event handlers.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r230 r">stateInfo</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> State Information</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="b2d8b3f6b2e97ff3" href="../../R/b2d8b3f6b2e97ff3.html" target="n" data-glyph="76,1" class="i method">RaiseStateChangeEvent</a>(<a href="#42e325836d1ae967" class="t t">PSInvocationStateInfo</a> <span id="r230 rd" class="r230 r">stateInfo</span>)
        {
            <span class="c">// First update the runspace availability.</span>
            <span class="c">// The Pipeline class takes care of updating local runspaces.</span>
            <span class="c">// Don&#39;t update for RemoteRunspace and nested PowerShell since this is used</span>
            <span class="c">// only internally by the remote debugger.</span>
            <a href="../remoting/client/remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a> <span id="r231 rd" class="r231 r">remoteRunspace</span> = <a href="#d6487a2f72366731" class="i field">_runspace</a> <b>as</b> <a href="../remoting/client/remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a>;
            <b>if</b> (<span class="r231 r">remoteRunspace</span> != <b>null</b> &amp;&amp; !<a href="#3d1b346df3be574c" class="k">this</a>.<a href="#32c156c0cba25702" class="i property">IsNested</a>)
            {
                <a href="#d6487a2f72366731" class="i field">_runspace</a>.<a href="Connection.cs.html#e29c803d055e4ad8" class="i method">UpdateRunspaceAvailability</a>(<a href="#39b81acd3aeb1582" class="i property">InvocationStateInfo</a>.<a href="#7a70ff5163d0f044" class="i property">State</a>, <b>true</b>, <a href="#d8c9867186529e49" class="i property">InstanceId</a>);
            }
 
            <b>if</b> (<span class="r230 r">stateInfo</span>.<a href="#7a70ff5163d0f044" class="i property">State</a> == <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#7142407e9e49cf13" class="i field">Running</a>)
            {
                <a href="#6ddec68b40195c65" class="i method">AddToRemoteRunspaceRunningList</a>();
            }
            <b>else</b> <b>if</b> (<span class="r230 r">stateInfo</span>.<a href="#7a70ff5163d0f044" class="i property">State</a> == <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#89ec15a2a933a2b6" class="i field">Completed</a> || <span class="r230 r">stateInfo</span>.<a href="#7a70ff5163d0f044" class="i property">State</a> == <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#6a6866e7df063875" class="i field">Stopped</a> ||
                     <span class="r230 r">stateInfo</span>.<a href="#7a70ff5163d0f044" class="i property">State</a> == <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#35065a8449cad351" class="i field">Failed</a>)
            {
                <a href="#32f03dec714cfa31" class="i method">RemoveFromRemoteRunspaceRunningList</a>();
            }
 
            <a href="#c66682d1287920a2" class="i">InvocationStateChanged</a>.<span class="i">SafeInvoke</span>(<a href="#3d1b346df3be574c" class="k">this</a>, <b>new</b> <a href="#1cce13d92ef2a0ac" class="t constructor">PSInvocationStateChangedEventArgs</a>(<span class="r230 r">stateInfo</span>));
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Sets the state of this powershell instance.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r232 r">stateInfo</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The state info to set.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="8bc5b0d04eada2b1" href="../../R/8bc5b0d04eada2b1.html" target="n" data-glyph="74,1" class="i method">SetStateChanged</a>(<a href="#42e325836d1ae967" class="t t">PSInvocationStateInfo</a> <span id="r232 rd" class="r232 r">stateInfo</span>)
        {
            <a href="#42e325836d1ae967" class="t t">PSInvocationStateInfo</a> <span id="r233 rd" class="r233 r">copyStateInfo</span> = <span class="r232 r">stateInfo</span>;
            <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a> <span id="r234 rd" class="r234 r">previousState</span>;
 
            <span class="c">// copy pipeline HasdErrors property to PowerShell instance...</span>
            <b>if</b> (<a href="#1389234891e6cc36" class="i field">_worker</a> != <b>null</b> &amp;&amp; <a href="#1389234891e6cc36" class="i field">_worker</a>.<a href="#88b35242d849bc1e" class="i property">CurrentlyRunningPipeline</a> != <b>null</b>)
            {
                <a href="#87033b28ad23f4b2" class="i method">SetHadErrors</a>(<a href="#1389234891e6cc36" class="i field">_worker</a>.<a href="#88b35242d849bc1e" class="i property">CurrentlyRunningPipeline</a>.<a href="Pipeline.cs.html#3a56a8fb6693de23" class="i property">HadErrors</a>);
            }
 
            <span class="c">// win281312: Usig temporary variables to avoid thread</span>
            <span class="c">// synchronization issues between Dispose and transition</span>
            <span class="c">// to Terminal States (Completed/Failed/Stopped)</span>
            <a href="#ba11495f3db79edb" class="t t">PowerShellAsyncResult</a> <span id="r235 rd" class="r235 r">tempInvokeAsyncResult</span>;
            <a href="#ba11495f3db79edb" class="t t">PowerShellAsyncResult</a> <span id="r236 rd" class="r236 r">tempStopAsyncResult</span>;
 
            <b>lock</b> (<a href="#57ad56a0d8f83c43" class="i field">_syncObject</a>)
            {
                <span class="r234 r">previousState</span> = <a href="#39b81acd3aeb1582" class="i property">InvocationStateInfo</a>.<a href="#7a70ff5163d0f044" class="i property">State</a>;
 
                <span class="c">// Check the current state and see if we need to process this pipeline event.</span>
                <b>switch</b> (<a href="#39b81acd3aeb1582" class="i property">InvocationStateInfo</a>.<a href="#7a70ff5163d0f044" class="i property">State</a>)
                {
                    <b>case</b> <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#89ec15a2a933a2b6" class="i field">Completed</a>:
                    <b>case</b> <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#35065a8449cad351" class="i field">Failed</a>:
                    <b>case</b> <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#6a6866e7df063875" class="i field">Stopped</a>:
                        <span class="c">// if the current state is already completed..then no need to process state</span>
                        <span class="c">// change requests. This will happen if another thread calls BeginStop</span>
                        <b>return</b>;
                    <b>case</b> <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#7142407e9e49cf13" class="i field">Running</a>:
                        <b>if</b> (<span class="r232 r">stateInfo</span>.<a href="#7a70ff5163d0f044" class="i property">State</a> == <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#7142407e9e49cf13" class="i field">Running</a>)
                        {
                            <b>return</b>;
                        }
 
                        <b>break</b>;
                    <b>case</b> <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#a9d235bf0dc5bfce" class="i field">Stopping</a>:
                        <span class="c">// We are in stopping state and we should not honor Running state</span>
                        <span class="c">// here.</span>
                        <b>if</b> (<span class="r232 r">stateInfo</span>.<a href="#7a70ff5163d0f044" class="i property">State</a> == <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#7142407e9e49cf13" class="i field">Running</a> ||
                            <span class="r232 r">stateInfo</span>.<a href="#7a70ff5163d0f044" class="i property">State</a> == <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#a9d235bf0dc5bfce" class="i field">Stopping</a>)
                        {
                            <b>return</b>;
                        }
                        <b>else</b> <b>if</b> (<span class="r232 r">stateInfo</span>.<a href="#7a70ff5163d0f044" class="i property">State</a> == <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#89ec15a2a933a2b6" class="i field">Completed</a> ||
                                 <span class="r232 r">stateInfo</span>.<a href="#7a70ff5163d0f044" class="i property">State</a> == <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#35065a8449cad351" class="i field">Failed</a>)
                        {
                            <span class="r233 r">copyStateInfo</span> = <b>new</b> <a href="#db44bd87590c83f5" class="t constructor">PSInvocationStateInfo</a>(<a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#6a6866e7df063875" class="i field">Stopped</a>, <span class="r232 r">stateInfo</span>.<a href="#5e4f678af21908e8" class="i property">Reason</a>);
                        }
 
                        <b>break</b>;
                    <b>default</b>:
                        <b>break</b>;
                }
 
                <span class="r235 r">tempInvokeAsyncResult</span> = <a href="#aa2e4c96efcd9075" class="i field">_invokeAsyncResult</a>;
                <span class="r236 r">tempStopAsyncResult</span> = <a href="#c48e6ad54262904d" class="i field">_stopAsyncResult</a>;
                <a href="#39b81acd3aeb1582" class="i property">InvocationStateInfo</a> = <span class="r233 r">copyStateInfo</span>;
            }
 
            <b>bool</b> <span id="r237 rd" class="r237 r">isExceptionOccured</span> = <b>false</b>;
            <b>switch</b> (<a href="#39b81acd3aeb1582" class="i property">InvocationStateInfo</a>.<a href="#7a70ff5163d0f044" class="i property">State</a>)
            {
                <b>case</b> <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#7142407e9e49cf13" class="i field">Running</a>:
                    <a href="#61b59a5789b769be" class="i method">CloseInputBufferOnReconnection</a>(<span class="r234 r">previousState</span>);
                    <a href="#b2d8b3f6b2e97ff3" class="i method">RaiseStateChangeEvent</a>(<a href="#39b81acd3aeb1582" class="i property">InvocationStateInfo</a>.<a href="#919d0448ea5bf72b" class="i method">Clone</a>());
                    <b>break</b>;
                <b>case</b> <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#a9d235bf0dc5bfce" class="i field">Stopping</a>:
                    <a href="#b2d8b3f6b2e97ff3" class="i method">RaiseStateChangeEvent</a>(<a href="#39b81acd3aeb1582" class="i property">InvocationStateInfo</a>.<a href="#919d0448ea5bf72b" class="i method">Clone</a>());
                    <b>break</b>;
                <b>case</b> <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#89ec15a2a933a2b6" class="i field">Completed</a>:
                <b>case</b> <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#35065a8449cad351" class="i field">Failed</a>:
                <b>case</b> <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#6a6866e7df063875" class="i field">Stopped</a>:
                    <span class="c">// Clear Internal data</span>
                    <a href="#a597838849d3c0e3" class="i method">InternalClearSuppressExceptions</a>();
 
                    <span class="c">// Ensure remote receive queue is not blocked.</span>
                    <b>if</b> (<a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a> != <b>null</b>)
                    {
                        <a href="#d3f59b7e5131db2a" class="i method">ResumeIncomingData</a>();
                    }
 
                    <b>try</b>
                    {
                        <b>if</b> (<a href="#90e4778239a93806" class="i property">RunningExtraCommands</a>)
                        {
                            <b>if</b> (<span class="r235 r">tempInvokeAsyncResult</span> != <b>null</b>)
                            {
                                <span class="r235 r">tempInvokeAsyncResult</span>.<a href="AsyncResult.cs.html#2d78c0fa1b51bb6e" class="i method">SetAsCompleted</a>(<a href="#39b81acd3aeb1582" class="i property">InvocationStateInfo</a>.<a href="#5e4f678af21908e8" class="i property">Reason</a>);
                            }
 
                            <a href="#b2d8b3f6b2e97ff3" class="i method">RaiseStateChangeEvent</a>(<a href="#39b81acd3aeb1582" class="i property">InvocationStateInfo</a>.<a href="#919d0448ea5bf72b" class="i method">Clone</a>());
                        }
                        <b>else</b>
                        {
                            <a href="#b2d8b3f6b2e97ff3" class="i method">RaiseStateChangeEvent</a>(<a href="#39b81acd3aeb1582" class="i property">InvocationStateInfo</a>.<a href="#919d0448ea5bf72b" class="i method">Clone</a>());
 
                            <b>if</b> (<span class="r235 r">tempInvokeAsyncResult</span> != <b>null</b>)
                            {
                                <span class="r235 r">tempInvokeAsyncResult</span>.<a href="AsyncResult.cs.html#2d78c0fa1b51bb6e" class="i method">SetAsCompleted</a>(<a href="#39b81acd3aeb1582" class="i property">InvocationStateInfo</a>.<a href="#5e4f678af21908e8" class="i property">Reason</a>);
                            }
                        }
 
                        <b>if</b> (<span class="r236 r">tempStopAsyncResult</span> != <b>null</b>)
                        {
                            <span class="r236 r">tempStopAsyncResult</span>.<a href="AsyncResult.cs.html#2d78c0fa1b51bb6e" class="i method">SetAsCompleted</a>(<b>null</b>);
                        }
                    }
                    <b>catch</b> (<span class="i">Exception</span>)
                    {
                        <span class="c">// need to release asyncresults if there is an</span>
                        <span class="c">// exception from the eventhandlers.</span>
                        <span class="r237 r">isExceptionOccured</span> = <b>true</b>;
                        <a href="#87033b28ad23f4b2" class="i method">SetHadErrors</a>(<b>true</b>);
                        <b>throw</b>;
                    }
                    <b>finally</b>
                    {
                        <span class="c">// takes care exception occured with invokeAsyncResult</span>
                        <b>if</b> (<span class="r237 r">isExceptionOccured</span> &amp;&amp; (<span class="r236 r">tempStopAsyncResult</span> != <b>null</b>))
                        {
                            <span class="r236 r">tempStopAsyncResult</span>.<a href="AsyncResult.cs.html#112d0ced737442f7" class="i method">Release</a>();
                        }
                    }
 
                    <b>break</b>;
                <b>case</b> <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#55f5ed5d1c0f010a" class="i field">Disconnected</a>:
                    <b>try</b>
                    {
                        <span class="c">// Ensure remote receive queue is not blocked.</span>
                        <b>if</b> (<a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a> != <b>null</b>)
                        {
                            <a href="#d3f59b7e5131db2a" class="i method">ResumeIncomingData</a>();
                        }
 
                        <span class="c">// If this command was disconnected and was also invoked synchronously then</span>
                        <span class="c">// we throw an exception on the calling thread.</span>
                        <b>if</b> (<a href="#e9453081966ac388" class="i field">_commandInvokedSynchronously</a> &amp;&amp; (<span class="r235 r">tempInvokeAsyncResult</span> != <b>null</b>))
                        {
                            <span class="r235 r">tempInvokeAsyncResult</span>.<span class="i">SetAsCompleted</span>(<b>new</b> <span class="t">RuntimeException</span>(<span class="i">PowerShellStrings</span>.<span class="i">DiscOnSyncCommand</span>));
                        }
 
                        <span class="c">// This object can be disconnected even if &quot;BeginStop&quot; was called if it is a remote object</span>
                        <span class="c">// and robust connections is retrying a failed network connection.</span>
                        <span class="c">// In this case release the stop wait handle to prevent not responding.</span>
                        <b>if</b> (<span class="r236 r">tempStopAsyncResult</span> != <b>null</b>)
                        {
                            <span class="r236 r">tempStopAsyncResult</span>.<a href="AsyncResult.cs.html#2d78c0fa1b51bb6e" class="i method">SetAsCompleted</a>(<b>null</b>);
                        }
 
                        <span class="c">// Only raise the Disconnected state changed event if the PowerShell state</span>
                        <span class="c">// actually transitions to Disconnected from some other state.  This condition</span>
                        <span class="c">// can happen when the corresponding runspace disconnects/connects multiple</span>
                        <span class="c">// times with the command remaining in Disconnected state.</span>
                        <b>if</b> (<span class="r234 r">previousState</span> != <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#55f5ed5d1c0f010a" class="i field">Disconnected</a>)
                        {
                            <a href="#b2d8b3f6b2e97ff3" class="i method">RaiseStateChangeEvent</a>(<a href="#39b81acd3aeb1582" class="i property">InvocationStateInfo</a>.<a href="#919d0448ea5bf72b" class="i method">Clone</a>());
                        }
                    }
                    <b>catch</b> (<span class="i">Exception</span>)
                    {
                        <span class="c">// need to release asyncresults if there is an</span>
                        <span class="c">// exception from the eventhandlers.</span>
                        <span class="r237 r">isExceptionOccured</span> = <b>true</b>;
                        <a href="#87033b28ad23f4b2" class="i method">SetHadErrors</a>(<b>true</b>);
                        <b>throw</b>;
                    }
                    <b>finally</b>
                    {
                        <span class="c">// takes care exception occured with invokeAsyncResult</span>
                        <b>if</b> (<span class="r237 r">isExceptionOccured</span> &amp;&amp; (<span class="r236 r">tempStopAsyncResult</span> != <b>null</b>))
                        {
                            <span class="r236 r">tempStopAsyncResult</span>.<a href="AsyncResult.cs.html#112d0ced737442f7" class="i method">Release</a>();
                        }
                    }
 
                    <span class="c">// Make sure the connect command information is null when going to Disconnected state.</span>
                    <span class="c">// This parameter is used to determine reconnect/reconstruct scenarios.  Setting to null</span>
                    <span class="c">// means we have a reconnect scenario.</span>
                    <a href="#1462181f6b1205aa" class="i field">_connectCmdInfo</a> = <b>null</b>;
                    <b>break</b>;
 
                <b>default</b>:
                    <b>return</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Helper function to close the input buffer after command is reconnected.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r238 r">previousState</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Previous state.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="61b59a5789b769be" href="../../R/61b59a5789b769be.html" target="n" data-glyph="76,1" class="i method">CloseInputBufferOnReconnection</a>(<a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a> <span id="r238 rd" class="r238 r">previousState</span>)
        {
            <span class="c">// If the previous state was disconnected and we are now running (reconnected),</span>
            <span class="c">// and we reconnected synchronously with pending input, then we need to close</span>
            <span class="c">// the input buffer to allow the remote command to complete.  Otherwise the</span>
            <span class="c">// synchronous Connect() method will wait indefinitely for the command to complete.</span>
            <b>if</b> (<span class="r238 r">previousState</span> == <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#55f5ed5d1c0f010a" class="i field">Disconnected</a> &amp;&amp;
                <a href="#e9453081966ac388" class="i field">_commandInvokedSynchronously</a> &amp;&amp;
                <a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a>.<a href="../remoting/client/ClientRemotePowerShell.cs.html#0483a730832c385c" class="i property">InputStream</a> != <b>null</b> &amp;&amp;
                <a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a>.<a href="../remoting/client/ClientRemotePowerShell.cs.html#0483a730832c385c" class="i property">InputStream</a>.<a href="../../utils/ObjectStream.cs.html#eff54ee10bba7a56" class="i property">IsOpen</a> &amp;&amp;
                <a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a>.<a href="../remoting/client/ClientRemotePowerShell.cs.html#0483a730832c385c" class="i property">InputStream</a>.<a href="../../utils/ObjectStream.cs.html#01c58f66ddc41629" class="i property">Count</a> &gt; 0)
            {
                <a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a>.<a href="../remoting/client/ClientRemotePowerShell.cs.html#0483a730832c385c" class="i property">InputStream</a>.<a href="../../utils/ObjectStream.cs.html#2bbebf10cbee9e83" class="i method">Close</a>();
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Clear the internal reference to remote powershell.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="451d2223ef6050bb" href="../../R/451d2223ef6050bb.html" target="n" data-glyph="74,1" class="i method">ClearRemotePowerShell</a>()
        {
            <b>lock</b> (<a href="#57ad56a0d8f83c43" class="i field">_syncObject</a>)
            {
                <b>if</b> (<a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a> != <b>null</b>)
                {
                    <a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a>.<a href="../remoting/client/ClientRemotePowerShell.cs.html#9622f9b2a2b49e85" class="i method">Clear</a>();
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Sets if the pipeline is nested, typically used by the remoting infrastructure.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r239 r">isNested</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="ca9abcd81cc054f5" href="../../R/ca9abcd81cc054f5.html" target="n" data-glyph="74,1" class="i method">SetIsNested</a>(<b>bool</b> <span id="r239 rd" class="r239 r">isNested</span>)
        {
            <a href="#68c9b1a93a2cdcde" class="i method">AssertChangesAreAccepted</a>();
 
            <a href="#32c156c0cba25702" class="i property">IsNested</a> = <span class="r239 r">isNested</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Performs the actual synchronous command invocation. The caller</span>
        <span class="c">///</span><span class="c"> should check if it safe to call this method.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r240 r t">TOutput</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Type of objects to return.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r241 r">input</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Input to the command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r242 r">output</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> output from the command</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r243 r">settings</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invocation settings.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> No commands are specified.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#fa64ade1e4dc44f8" class="t t">ScriptCallDepthException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The script recursed too deeply into script functions.</span>
        <span class="c">///</span><span class="c"> There is a fixed limit on the depth of recursion.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A CLR security violation occurred.  Typically, this happens</span>
        <span class="c">///</span><span class="c"> because the current CLR permissions do not allow adequate</span>
        <span class="c">///</span><span class="c"> reflection access to a cmdlet assembly.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> PowerShell.Invoke can throw a variety of exceptions derived</span>
        <span class="c">///</span><span class="c"> from RuntimeException. The most likely of these exceptions</span>
        <span class="c">///</span><span class="c"> are listed below.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ParameterBinderExceptions.cs.html#8e3f022461e43e12" class="t t">ParameterBindingException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> One of more parameters or parameter values specified for</span>
        <span class="c">///</span><span class="c"> a cmdlet are not valid, or mandatory parameters for a cmdlet</span>
        <span class="c">///</span><span class="c"> were not specified.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#7b242746a433b370" class="t t">CmdletInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A cmdlet generated a terminating error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#f88a59685dc8d13e" class="t t">CmdletProviderInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A provider generated a terminating error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#f896df45dff24981" class="t t">ActionPreferenceStopException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The ActionPreference.Stop or ActionPreference.Inquire policy</span>
        <span class="c">///</span><span class="c"> triggered a terminating error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The pipeline was terminated asynchronously.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../utils/MetadataExceptions.cs.html#3bf974090c4e60a1" class="t t">MetadataException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If there is an error generating the metadata for dynamic parameters.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>private void</b> <a id="695c3aa5903e6866" href="../../R/695c3aa5903e6866.html" target="n" data-glyph="76,1" class="i method">CoreInvoke</a>&lt;<span id="r240 rd t" class="r240 r t">TOutput</span>&gt;(<span class="i">IEnumerable</span> <span id="r241 rd" class="r241 r">input</span>, <a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<span class="r240 r t">TOutput</span>&gt; <span id="r242 rd" class="r242 r">output</span>, <a href="#ce65c0834aa6f0ea" class="t t">PSInvocationSettings</a> <span id="r243 rd" class="r243 r">settings</span>)
        {
            <a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<b>object</b>&gt; <span id="r244 rd" class="r244 r">inputBuffer</span> = <b>null</b>;
            <b>if</b> (<span class="r241 r">input</span> != <b>null</b>)
            {
                <span class="r244 r">inputBuffer</span> = <b>new</b> <a href="PSDataCollection.cs.html#ee85ce3306fe4e5b" class="t constructor">PSDataCollection</a>&lt;<b>object</b>&gt;();
                <b>foreach</b> (<b>object</b> <span id="r245 rd" class="r245 r">o</span> <b>in</b> <span class="r241 r">input</span>)
                {
                    <span class="r244 r">inputBuffer</span>.<a href="PSDataCollection.cs.html#681501d1e27b76df" class="i method">Add</a>(<span class="r245 r">o</span>);
                }
 
                <span class="r244 r">inputBuffer</span>.<a href="PSDataCollection.cs.html#0a8262d798e33fc6" class="i method">Complete</a>();
            }
 
            <a href="#6127ab28885abd3a" class="i method">CoreInvoke</a>(<span class="r244 r">inputBuffer</span>, <span class="r242 r">output</span>, <span class="r243 r">settings</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Core invocation helper method.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r246 r t">TInput</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">input type</span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r247 r t">TOutput</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">output type</span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r248 r">input</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Input objects.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r249 r">output</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Output object.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r250 r">settings</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Invocation settings.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="52630c95ed5addd9" href="../../R/52630c95ed5addd9.html" target="n" data-glyph="76,1" class="i method">CoreInvokeHelper</a>&lt;<span id="r246 rd t" class="r246 r t">TInput</span>, <span id="r247 rd t" class="r247 r t">TOutput</span>&gt;(<a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<span class="r246 r t">TInput</span>&gt; <span id="r248 rd" class="r248 r">input</span>, <a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<span class="r247 r t">TOutput</span>&gt; <span id="r249 rd" class="r249 r">output</span>, <a href="#ce65c0834aa6f0ea" class="t t">PSInvocationSettings</a> <span id="r250 rd" class="r250 r">settings</span>)
        {
            <a href="RunspacePool.cs.html#c1948c2f22e6b527" class="t t">RunspacePool</a> <span id="r251 rd" class="r251 r">pool</span> = <a href="#ccb6c738e7f3c724" class="i field">_rsConnection</a> <b>as</b> <a href="RunspacePool.cs.html#c1948c2f22e6b527" class="t t">RunspacePool</a>;
 
            <span class="c">// Prepare the environment...non-remoting case.</span>
            <a href="#3e34300b3e6d0450" class="i method">Prepare</a>&lt;<span class="r246 r t">TInput</span>, <span class="r247 r t">TOutput</span>&gt;(<span class="r248 r">input</span>, <span class="r249 r">output</span>, <span class="r250 r">settings</span>, <b>true</b>);
 
            <b>try</b>
            {
                <span class="c">// Invoke in the same thread as the calling thread.</span>
                <a href="Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a> <span id="r252 rd" class="r252 r">rsToUse</span> = <b>null</b>;
                <b>if</b> (!<a href="#32c156c0cba25702" class="i property">IsNested</a>)
                {
                    <b>if</b> (<span class="r251 r">pool</span> != <b>null</b>)
                    {
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">UNIX</span>
                        <a href="#8fe7da83c3383b8b" class="i method">VerifyThreadSettings</a>(<span class="r250 r">settings</span>, <span class="r251 r">pool</span>.<a href="RunspacePool.cs.html#e96b2efb9719a701" class="i property">ApartmentState</a>, <span class="r251 r">pool</span>.<a href="RunspacePool.cs.html#4d933f8550b5ef22" class="i property">ThreadOptions</a>, <b>false</b>);
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
 
                        <span class="c">// getting the runspace asynchronously so that Stop can be supported from a different</span>
                        <span class="c">// thread.</span>
                        <a href="#1389234891e6cc36" class="i field">_worker</a>.<a href="#a7de1ad695149d22" class="i property">GetRunspaceAsyncResult</a> = <span class="r251 r">pool</span>.<a href="RunspacePool.cs.html#17b1f7059acbf34f" class="i method">BeginGetRunspace</a>(<b>null</b>, <b>null</b>);
                        <a href="#1389234891e6cc36" class="i field">_worker</a>.<a href="#a7de1ad695149d22" class="i property">GetRunspaceAsyncResult</a>.<span class="i">AsyncWaitHandle</span>.<span class="i">WaitOne</span>();
                        <span class="r252 r">rsToUse</span> = <span class="r251 r">pool</span>.<a href="RunspacePool.cs.html#d4a431395039c1d7" class="i method">EndGetRunspace</a>(<a href="#1389234891e6cc36" class="i field">_worker</a>.<a href="#a7de1ad695149d22" class="i property">GetRunspaceAsyncResult</a>);
                    }
                    <b>else</b>
                    {
                        <span class="r252 r">rsToUse</span> = <a href="#ccb6c738e7f3c724" class="i field">_rsConnection</a> <b>as</b> <a href="Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a>;
                        <b>if</b> (<span class="r252 r">rsToUse</span> != <b>null</b>)
                        {
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">UNIX</span>
                            <a href="#8fe7da83c3383b8b" class="i method">VerifyThreadSettings</a>(<span class="r250 r">settings</span>, <span class="r252 r">rsToUse</span>.<a href="Connection.cs.html#7483ec8556438ee9" class="i property">ApartmentState</a>, <span class="r252 r">rsToUse</span>.<a href="Connection.cs.html#bd7dc249cd7abc4e" class="i property">ThreadOptions</a>, <b>false</b>);
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
 
                            <b>if</b> (<span class="r252 r">rsToUse</span>.<a href="Connection.cs.html#01b12fbdab6c561a" class="i property">RunspaceStateInfo</a>.<a href="Connection.cs.html#41627f067662d11c" class="i property">State</a> != <a href="Connection.cs.html#5da9dc65e996a685" class="t t">RunspaceState</a>.<a href="Connection.cs.html#9a99efb0eaa3c3db" class="i field">Opened</a>)
                            {
                                <b>string</b> <span id="r253 rd" class="r253 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">PowerShellStrings</span>.<span class="i">InvalidRunspaceState</span>, <a href="Connection.cs.html#5da9dc65e996a685" class="t t">RunspaceState</a>.<a href="Connection.cs.html#9a99efb0eaa3c3db" class="i field">Opened</a>, <span class="r252 r">rsToUse</span>.<a href="Connection.cs.html#01b12fbdab6c561a" class="i property">RunspaceStateInfo</a>.<a href="Connection.cs.html#41627f067662d11c" class="i property">State</a>);
 
                                <a href="Connection.cs.html#340ccbbd1c6e8b87" class="t t">InvalidRunspaceStateException</a> <span id="r254 rd" class="r254 r">e</span> = <b>new</b> <a href="Connection.cs.html#ff1c45fc227fc3d7" class="t constructor">InvalidRunspaceStateException</a>(<span class="r253 r">message</span>,
                                        <span class="r252 r">rsToUse</span>.<a href="Connection.cs.html#01b12fbdab6c561a" class="i property">RunspaceStateInfo</a>.<a href="Connection.cs.html#41627f067662d11c" class="i property">State</a>,
                                        <a href="Connection.cs.html#5da9dc65e996a685" class="t t">RunspaceState</a>.<a href="Connection.cs.html#9a99efb0eaa3c3db" class="i field">Opened</a>
                                    );
 
                                <b>throw</b> <span class="r254 r">e</span>;
                            }
                        }
                    }
 
                    <span class="c">// perform the work in the current thread</span>
                    <a href="#1389234891e6cc36" class="i field">_worker</a>.<a href="#f112c90c3ad6030e" class="i method">CreateRunspaceIfNeededAndDoWork</a>(<span class="r252 r">rsToUse</span>, <b>true</b>);
                }
                <b>else</b>
                {
                    <span class="r252 r">rsToUse</span> = <a href="#ccb6c738e7f3c724" class="i field">_rsConnection</a> <b>as</b> <a href="Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a>;
                    <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r252 r">rsToUse</span> != <b>null</b>,
                        <span class="s">&quot;Nested PowerShell can only work on a Runspace&quot;</span>);
 
                    <span class="c">// Perform work on the current thread. Nested Pipeline</span>
                    <span class="c">// should be invoked from the same thread that the parent</span>
                    <span class="c">// pipeline is executing in.</span>
                    <a href="#1389234891e6cc36" class="i field">_worker</a>.<a href="#6f66f8240faa3068" class="i method">ConstructPipelineAndDoWork</a>(<span class="r252 r">rsToUse</span>, <b>true</b>);
                }
            }
            <b>catch</b> (<span class="i">Exception</span> <span id="r255 rd" class="r255 r">exception</span>)
            {
                <a href="#8bc5b0d04eada2b1" class="i method">SetStateChanged</a>(<b>new</b> <a href="#db44bd87590c83f5" class="t constructor">PSInvocationStateInfo</a>(<a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#35065a8449cad351" class="i field">Failed</a>, <span class="r255 r">exception</span>));
 
                <span class="c">// re-throw the exception</span>
                <a href="RunspacePool.cs.html#741ffc1755303d69" class="t t">InvalidRunspacePoolStateException</a> <span id="r256 rd" class="r256 r">poolException</span> = <span class="r255 r">exception</span> <b>as</b> <a href="RunspacePool.cs.html#741ffc1755303d69" class="t t">InvalidRunspacePoolStateException</a>;
 
                <b>if</b> (<span class="r256 r">poolException</span> != <b>null</b> &amp;&amp; <a href="#d6487a2f72366731" class="i field">_runspace</a> != <b>null</b>) <span class="c">// the pool exception was actually thrown by a runspace</span>
                {
                    <b>throw</b> <span class="r256 r">poolException</span>.<a href="RunspacePool.cs.html#aeea64df1e9df609" class="i method">ToInvalidRunspaceStateException</a>();
                }
 
                <b>throw</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Core invocation helper method for remoting.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r257 r t">TInput</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">input type</span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r258 r t">TOutput</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">output type</span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r259 r">input</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Input objects.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r260 r">output</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Output object.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r261 r">settings</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Invocation settings.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="5dd740a8b8937daa" href="../../R/5dd740a8b8937daa.html" target="n" data-glyph="76,1" class="i method">CoreInvokeRemoteHelper</a>&lt;<span id="r257 rd t" class="r257 r t">TInput</span>, <span id="r258 rd t" class="r258 r t">TOutput</span>&gt;(<a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<span class="r257 r t">TInput</span>&gt; <span id="r259 rd" class="r259 r">input</span>, <a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<span class="r258 r t">TOutput</span>&gt; <span id="r260 rd" class="r260 r">output</span>, <a href="#ce65c0834aa6f0ea" class="t t">PSInvocationSettings</a> <span id="r261 rd" class="r261 r">settings</span>)
        {
            <a href="RunspacePool.cs.html#c1948c2f22e6b527" class="t t">RunspacePool</a> <span id="r262 rd" class="r262 r">pool</span> = <a href="#ccb6c738e7f3c724" class="i field">_rsConnection</a> <b>as</b> <a href="RunspacePool.cs.html#c1948c2f22e6b527" class="t t">RunspacePool</a>;
 
            <span class="c">// For remote calls..use the infrastructure built in CoreInvokeAsync..</span>
            <span class="i">IAsyncResult</span> <span id="r263 rd" class="r263 r">asyncResult</span> = <a href="#82e515b14a72a8b1" class="i method">CoreInvokeAsync</a>&lt;<span class="r257 r t">TInput</span>, <span class="r258 r t">TOutput</span>&gt;(<span class="r259 r">input</span>, <span class="r260 r">output</span>, <span class="r261 r">settings</span>,
                <b>null</b>, <b>null</b>, <b>null</b>);
            <a href="#e9453081966ac388" class="i field">_commandInvokedSynchronously</a> = <b>true</b>;
            <a href="#ba11495f3db79edb" class="t t">PowerShellAsyncResult</a> <span id="r264 rd" class="r264 r">psAsyncResult</span> = <span class="r263 r">asyncResult</span> <b>as</b> <a href="#ba11495f3db79edb" class="t t">PowerShellAsyncResult</a>;
 
            <span class="c">// Wait for command to complete.  If an exception was thrown during command</span>
            <span class="c">// execution (such as disconnect occurring during this synchronous execution)</span>
            <span class="c">// then the exception will be thrown here.</span>
            <a href="#4f10d51ac16015a7" class="i property">EndInvokeAsyncResult</a> = <span class="r264 r">psAsyncResult</span>;
            <span class="r264 r">psAsyncResult</span>.<a href="AsyncResult.cs.html#75f5584cab706e68" class="i method">EndInvoke</a>();
            <a href="#4f10d51ac16015a7" class="i property">EndInvokeAsyncResult</a> = <b>null</b>;
 
            <b>if</b> ((<a href="#39b81acd3aeb1582" class="i property">InvocationStateInfo</a>.<a href="#7a70ff5163d0f044" class="i property">State</a> == <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#35065a8449cad351" class="i field">Failed</a>) &amp;&amp;
                        (<a href="#39b81acd3aeb1582" class="i property">InvocationStateInfo</a>.<a href="#5e4f678af21908e8" class="i property">Reason</a> != <b>null</b>))
            {
                <b>throw</b> <a href="#39b81acd3aeb1582" class="i property">InvocationStateInfo</a>.<a href="#5e4f678af21908e8" class="i property">Reason</a>;
            }
 
            <b>return</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Core invocation method.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r265 r t">TInput</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">input type</span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r266 r t">TOutput</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">output type</span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r267 r">input</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Input objects.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r268 r">output</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Output object.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r269 r">settings</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Invocation settings.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="6127ab28885abd3a" href="../../R/6127ab28885abd3a.html" target="n" data-glyph="76,1" class="i method">CoreInvoke</a>&lt;<span id="r265 rd t" class="r265 r t">TInput</span>, <span id="r266 rd t" class="r266 r t">TOutput</span>&gt;(<a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<span class="r265 r t">TInput</span>&gt; <span id="r267 rd" class="r267 r">input</span>, <a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<span class="r266 r t">TOutput</span>&gt; <span id="r268 rd" class="r268 r">output</span>, <a href="#ce65c0834aa6f0ea" class="t t">PSInvocationSettings</a> <span id="r269 rd" class="r269 r">settings</span>)
        {
            <b>bool</b> <span id="r270 rd" class="r270 r">isRemote</span> = <b>false</b>;
 
            <a href="#8995adafa9f25650" class="i method">DetermineIsBatching</a>();
 
            <b>if</b> (<a href="#b3c8b30fb7648387" class="i field">_isBatching</a>)
            {
                <a href="#efa3902a0546e8df" class="i method">SetupAsyncBatchExecution</a>();
            }
 
            <a href="#87033b28ad23f4b2" class="i method">SetHadErrors</a>(<b>false</b>);
            <a href="RunspacePool.cs.html#c1948c2f22e6b527" class="t t">RunspacePool</a> <span id="r271 rd" class="r271 r">pool</span> = <a href="#ccb6c738e7f3c724" class="i field">_rsConnection</a> <b>as</b> <a href="RunspacePool.cs.html#c1948c2f22e6b527" class="t t">RunspacePool</a>;
            <b>if</b> ((<span class="r271 r">pool</span> != <b>null</b>) &amp;&amp; (<span class="r271 r">pool</span>.<a href="RunspacePool.cs.html#6cd4c73a96856bcf" class="i property">IsRemote</a>))
            {
                <b>if</b> (<a href="#4c6ee695d9a7fe71" class="i method">ServerSupportsBatchInvocation</a>())
                {
                    <b>try</b>
                    {
                        <a href="#5dd740a8b8937daa" class="i method">CoreInvokeRemoteHelper</a>(<span class="r267 r">input</span>, <span class="r268 r">output</span>, <span class="r269 r">settings</span>);
                    }
                    <b>finally</b>
                    {
                        <b>if</b> (<a href="#b3c8b30fb7648387" class="i field">_isBatching</a>)
                        {
                            <a href="#6aa077ee1a01c65e" class="i method">EndAsyncBatchExecution</a>();
                        }
                    }
 
                    <b>return</b>;
                }
 
                <span class="r270 r">isRemote</span> = <b>true</b>;
            }
 
            <b>if</b> (<a href="#b3c8b30fb7648387" class="i field">_isBatching</a>)
            {
                <b>try</b>
                {
                    <b>foreach</b> (<a href="PSCommand.cs.html#b9f024f73904cf55" class="t t">PSCommand</a> <span id="r272 rd" class="r272 r">command</span> <b>in</b> <a href="#4cfb6cc82eb60c86" class="i property">ExtraCommands</a>)
                    {
                        <span class="c">// Last element</span>
                        <b>if</b> (<a href="#f984c2b1a1646528" class="i field">_psCommand</a> != <a href="#4cfb6cc82eb60c86" class="i property">ExtraCommands</a>[<a href="#4cfb6cc82eb60c86" class="i property">ExtraCommands</a>.<span class="i">Count</span> - 1])
                        {
                            <a href="#90e4778239a93806" class="i property">RunningExtraCommands</a> = <b>true</b>;
                        }
                        <b>else</b>
                        {
                            <a href="#90e4778239a93806" class="i property">RunningExtraCommands</a> = <b>false</b>;
                        }
 
                        <b>try</b>
                        {
                            <a href="#f984c2b1a1646528" class="i field">_psCommand</a> = <span class="r272 r">command</span>;
 
                            <b>if</b> (<span class="r270 r">isRemote</span>)
                            {
                                <a href="#5dd740a8b8937daa" class="i method">CoreInvokeRemoteHelper</a>(<span class="r267 r">input</span>, <span class="r268 r">output</span>, <span class="r269 r">settings</span>);
                            }
                            <b>else</b>
                            {
                                <a href="#52630c95ed5addd9" class="i method">CoreInvokeHelper</a>(<span class="r267 r">input</span>, <span class="r268 r">output</span>, <span class="r269 r">settings</span>);
                            }
                        }
                        <b>catch</b> (<a href="../../utils/ExecutionExceptions.cs.html#f896df45dff24981" class="t t">ActionPreferenceStopException</a>)
                        {
                            <span class="c">// We need to honor the current error action preference here</span>
                            <b>throw</b>;
                        }
                        <b>catch</b> (<span class="i">Exception</span> <span id="r273 rd" class="r273 r">e</span>)
                        {
                            <a href="#87033b28ad23f4b2" class="i method">SetHadErrors</a>(<b>true</b>);
 
                            <span class="c">// Stop if necessarily</span>
                            <b>if</b> ((<span class="r269 r">settings</span> != <b>null</b>) &amp;&amp; <span class="r269 r">settings</span>.<a href="#648c685f4b558fd3" class="i property">ErrorActionPreference</a> == <a href="../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="../CommandBase.cs.html#83fefb47b3abc4e7" class="i field">Stop</a>)
                            {
                                <b>throw</b>;
                            }
 
                            <span class="c">// Ignore the exception if necessary.</span>
                            <b>if</b> ((<span class="r269 r">settings</span> != <b>null</b>) &amp;&amp; <span class="r269 r">settings</span>.<a href="#648c685f4b558fd3" class="i property">ErrorActionPreference</a> == <a href="../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="../CommandBase.cs.html#e7eef70977370b56" class="i field">Ignore</a>)
                            {
                                <b>continue</b>;
                            }
 
                            <span class="c">// If we get here, then ErrorActionPreference is either Continue,</span>
                            <span class="c">// SilentlyContinue, or Inquire (Continue), so we just continue....</span>
 
                            <a href="../ErrorPackage.cs.html#2d342e12f9600886" class="t t">IContainsErrorRecord</a> <span id="r274 rd" class="r274 r">er</span> = <span class="r273 r">e</span> <b>as</b> <a href="../ErrorPackage.cs.html#2d342e12f9600886" class="t t">IContainsErrorRecord</a>;
 
                            <b>if</b> (<span class="r274 r">er</span> != <b>null</b> &amp;&amp; <span class="r274 r">er</span>.<a href="../ErrorPackage.cs.html#cef340f272a30c6b" class="i property">ErrorRecord</a> != <b>null</b>)
                            {
                                <a href="#3d1b346df3be574c" class="k">this</a>.<a href="#622ebeade9b6ada7" class="i property">Streams</a>.<a href="#ae04a604c26c6f7d" class="i property">Error</a>.<a href="PSDataCollection.cs.html#681501d1e27b76df" class="i method">Add</a>(<span class="r274 r">er</span>.<a href="../ErrorPackage.cs.html#cef340f272a30c6b" class="i property">ErrorRecord</a>);
                            }
                            <b>else</b>
                            {
                                <a href="#3d1b346df3be574c" class="k">this</a>.<a href="#622ebeade9b6ada7" class="i property">Streams</a>.<a href="#ae04a604c26c6f7d" class="i property">Error</a>.<a href="PSDataCollection.cs.html#681501d1e27b76df" class="i method">Add</a>(<b>new</b> <a href="../ErrorPackage.cs.html#e9334565e5136f43" class="t constructor">ErrorRecord</a>(<span class="r273 r">e</span>,
                                    <span class="s">&quot;InvalidOperation&quot;</span>, <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>, <b>null</b>));
                            }
 
                            <b>continue</b>;
                        }
                    }
                }
                <b>finally</b>
                {
                    <a href="#90e4778239a93806" class="i property">RunningExtraCommands</a> = <b>false</b>;
                    <a href="#6aa077ee1a01c65e" class="i method">EndAsyncBatchExecution</a>();
                }
            }
            <b>else</b>
            {
                <a href="#90e4778239a93806" class="i property">RunningExtraCommands</a> = <b>false</b>;
 
                <b>if</b> (<span class="r270 r">isRemote</span>)
                {
                    <a href="#5dd740a8b8937daa" class="i method">CoreInvokeRemoteHelper</a>(<span class="r267 r">input</span>, <span class="r268 r">output</span>, <span class="r269 r">settings</span>);
                }
                <b>else</b>
                {
                    <a href="#52630c95ed5addd9" class="i method">CoreInvokeHelper</a>(<span class="r267 r">input</span>, <span class="r268 r">output</span>, <span class="r269 r">settings</span>);
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Performs the actual asynchronous command invocation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r275 r t">TInput</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Type of the input buffer</span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r276 r t">TOutput</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Type of the output buffer</span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r277 r">input</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> input can be null</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r278 r">output</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r279 r">settings</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r280 r">callback</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A AsyncCallback to call once the BeginInvoke completes.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r281 r">state</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A user supplied state to call the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r280 r">callback</span><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> with.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r282 r">asyncResultOutput</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The output buffer to attach to the IAsyncResult returned by this method</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Cannot perform the operation because the command is already started.</span>
        <span class="c">///</span><span class="c"> Stop the command and try the operation again.</span>
        <span class="c">///</span><span class="c"> (or)</span>
        <span class="c">///</span><span class="c"> No command is added.</span>
        <span class="c">///</span><span class="c"> (or)</span>
        <span class="c">///</span><span class="c"> BeginInvoke is called on nested powershell. Nested</span>
        <span class="c">///</span><span class="c"> Powershell cannot be executed Asynchronously.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Maintainability&quot;</span>, <span class="s">&quot;CA1506:AvoidExcessiveClassCoupling&quot;</span>)]
        <b>private</b> <span class="i">IAsyncResult</span> <a id="82e515b14a72a8b1" href="../../R/82e515b14a72a8b1.html" target="n" data-glyph="76,1" class="i method">CoreInvokeAsync</a>&lt;<span id="r275 rd t" class="r275 r t">TInput</span>, <span id="r276 rd t" class="r276 r t">TOutput</span>&gt;(<a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<span class="r275 r t">TInput</span>&gt; <span id="r277 rd" class="r277 r">input</span>,
            <a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<span class="r276 r t">TOutput</span>&gt; <span id="r278 rd" class="r278 r">output</span>, <a href="#ce65c0834aa6f0ea" class="t t">PSInvocationSettings</a> <span id="r279 rd" class="r279 r">settings</span>,
            <span class="i">AsyncCallback</span> <span id="r280 rd" class="r280 r">callback</span>, <b>object</b> <span id="r281 rd" class="r281 r">state</span>, <a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r282 rd" class="r282 r">asyncResultOutput</span>)
        {
            <a href="RunspacePool.cs.html#c1948c2f22e6b527" class="t t">RunspacePool</a> <span id="r283 rd" class="r283 r">pool</span> = <a href="#ccb6c738e7f3c724" class="i field">_rsConnection</a> <b>as</b> <a href="RunspacePool.cs.html#c1948c2f22e6b527" class="t t">RunspacePool</a>;
 
            <span class="c">// We dont need to create worker if pool is remote</span>
            <span class="i">Prepare</span>&lt;<span class="r275 r t">TInput</span>, <span class="r276 r t">TOutput</span>&gt;(<span class="r277 r">input</span>, <span class="r278 r">output</span>, <span class="r279 r">settings</span>, (<span class="r283 r">pool</span> == <b>null</b> || !<span class="r283 r">pool</span>.<a href="RunspacePool.cs.html#6cd4c73a96856bcf" class="i property">IsRemote</a>));
 
            <a href="#aa2e4c96efcd9075" class="i field">_invokeAsyncResult</a> = <b>new</b> <a href="#a573e20febced368" class="t constructor">PowerShellAsyncResult</a>(<a href="#d8c9867186529e49" class="i property">InstanceId</a>, <span class="r280 r">callback</span>, <span class="r281 r">state</span>, <span class="r282 r">asyncResultOutput</span>, <b>true</b>);
 
            <b>try</b>
            {
                <span class="c">// IsNested is true for the icm | % { icm } scenario</span>
                <b>if</b> (!<a href="#32c156c0cba25702" class="i property">IsNested</a> || (<span class="r283 r">pool</span> != <b>null</b> &amp;&amp; <span class="r283 r">pool</span>.<a href="RunspacePool.cs.html#6cd4c73a96856bcf" class="i property">IsRemote</a>))
                {
                    <b>if</b> (<span class="r283 r">pool</span> != <b>null</b>)
                    {
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">UNIX</span>
                        <a href="#8fe7da83c3383b8b" class="i method">VerifyThreadSettings</a>(<span class="r279 r">settings</span>, <span class="r283 r">pool</span>.<a href="RunspacePool.cs.html#e96b2efb9719a701" class="i property">ApartmentState</a>, <span class="r283 r">pool</span>.<a href="RunspacePool.cs.html#4d933f8550b5ef22" class="i property">ThreadOptions</a>, <span class="r283 r">pool</span>.<a href="RunspacePool.cs.html#6cd4c73a96856bcf" class="i property">IsRemote</a>);
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
 
                        <span class="r283 r">pool</span>.<a href="RunspacePool.cs.html#176484eb3e4f94ba" class="i method">AssertPoolIsOpen</a>();
 
                        <span class="c">// for executing in a remote runspace pool case</span>
                        <b>if</b> (<span class="r283 r">pool</span>.<a href="RunspacePool.cs.html#6cd4c73a96856bcf" class="i property">IsRemote</a>)
                        {
                            <a href="#1389234891e6cc36" class="i field">_worker</a> = <b>null</b>;
 
                            <b>lock</b> (<a href="#57ad56a0d8f83c43" class="i field">_syncObject</a>)
                            {
                                <span class="c">// for remoting case, when the state is set to</span>
                                <span class="c">// Running, the message should have been sent</span>
                                <span class="c">// to the server. In order to ensure the same</span>
                                <span class="c">// all of the following are placed inside the</span>
                                <span class="c">// lock</span>
                                <span class="c">//    1. set the state to Running</span>
                                <span class="c">//    2. create remotePowerShell</span>
                                <span class="c">//    3. Send message to server</span>
 
                                <span class="c">// set the execution state to running.. so changes</span>
                                <span class="c">// to the current instance of powershell</span>
                                <span class="c">// are blocked.</span>
                                <a href="#3b4d5707d918bf53" class="i method">AssertExecutionNotStarted</a>();
 
                                <a href="#39b81acd3aeb1582" class="i property">InvocationStateInfo</a> = <b>new</b> <a href="#db44bd87590c83f5" class="t constructor">PSInvocationStateInfo</a>(<a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#7142407e9e49cf13" class="i field">Running</a>, <b>null</b>);
 
                                <a href="../../utils/ObjectStream.cs.html#27e9349816faeecb" class="t t">ObjectStreamBase</a> <span id="r284 rd" class="r284 r">inputStream</span> = <b>null</b>;
 
                                <b>if</b> (<span class="r277 r">input</span> != <b>null</b>)
                                {
                                    <span class="r284 r">inputStream</span> = <b>new</b> <a href="../../utils/ObjectStream.cs.html#472e4f0d3c7801e9" class="t constructor">PSDataCollectionStream</a>&lt;<span class="r275 r t">TInput</span>&gt;(<a href="#d8c9867186529e49" class="i property">InstanceId</a>, <span class="r277 r">input</span>);
                                }
 
                                <b>if</b> (!<a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a>.<a href="../remoting/client/ClientRemotePowerShell.cs.html#4f8237be57be8c4e" class="i property">Initialized</a>)
                                {
                                    <b>if</b> (<span class="r284 r">inputStream</span> == <b>null</b>)
                                    {
                                        <span class="r284 r">inputStream</span> = <b>new</b> <a href="../../utils/ObjectStream.cs.html#9f848b3587e1f797" class="t constructor">ObjectStream</a>();
                                        <span class="r284 r">inputStream</span>.<a href="../../utils/ObjectStream.cs.html#2bbebf10cbee9e83" class="i method">Close</a>();
                                    }
 
                                    <a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a>.<a href="../remoting/client/ClientRemotePowerShell.cs.html#86db8930303b5c9a" class="i method">Initialize</a>(
                                        <span class="r284 r">inputStream</span>, <b>new</b> <a href="../../utils/ObjectStream.cs.html#472e4f0d3c7801e9" class="t constructor">PSDataCollectionStream</a>&lt;<span class="r276 r t">TOutput</span>&gt;(<a href="#d8c9867186529e49" class="i property">InstanceId</a>, <span class="r278 r">output</span>),
                                                <b>new</b> <a href="../../utils/ObjectStream.cs.html#472e4f0d3c7801e9" class="t constructor">PSDataCollectionStream</a>&lt;<a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a>&gt;(<a href="#d8c9867186529e49" class="i property">InstanceId</a>, <a href="#6b0cd6330b1f780f" class="i field">_errorBuffer</a>),
                                                    <a href="#4bb26ab73ebaa6ca" class="i property">InformationalBuffers</a>, <span class="r279 r">settings</span>);
                                }
                                <b>else</b>
                                {
                                    <b>if</b> (<span class="r284 r">inputStream</span> != <b>null</b>)
                                    {
                                        <a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a>.<a href="../remoting/client/ClientRemotePowerShell.cs.html#0483a730832c385c" class="i property">InputStream</a> = <span class="r284 r">inputStream</span>;
                                    }
 
                                    <b>if</b> (<span class="r278 r">output</span> != <b>null</b>)
                                    {
                                        <a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a>.<a href="../remoting/client/ClientRemotePowerShell.cs.html#90c7daa196f501e5" class="i property">OutputStream</a> =
                                            <b>new</b> <a href="../../utils/ObjectStream.cs.html#472e4f0d3c7801e9" class="t constructor">PSDataCollectionStream</a>&lt;<span class="r276 r t">TOutput</span>&gt;(<a href="#d8c9867186529e49" class="i property">InstanceId</a>, <span class="r278 r">output</span>);
                                    }
                                }
 
                                <span class="r283 r">pool</span>.<a href="RunspacePool.cs.html#ae1c1c4ae8a5c648" class="i property">RemoteRunspacePoolInternal</a>.<a href="../remoting/client/RemoteRunspacePoolInternal.cs.html#adc083491fd2d086" class="i method">CreatePowerShellOnServerAndInvoke</a>(<a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a>);
                            }
 
                            <a href="#b2d8b3f6b2e97ff3" class="i method">RaiseStateChangeEvent</a>(<a href="#39b81acd3aeb1582" class="i property">InvocationStateInfo</a>.<a href="#919d0448ea5bf72b" class="i method">Clone</a>());
                        }
                        <b>else</b>
                        {
                            <a href="#1389234891e6cc36" class="i field">_worker</a>.<a href="#a7de1ad695149d22" class="i property">GetRunspaceAsyncResult</a> = <span class="r283 r">pool</span>.<a href="RunspacePool.cs.html#17b1f7059acbf34f" class="i method">BeginGetRunspace</a>(
                                    <b>new</b> <span class="i">AsyncCallback</span>(<a href="#1389234891e6cc36" class="i field">_worker</a>.<span class="i">RunspaceAvailableCallback</span>), <b>null</b>);
                        }
                    }
                    <b>else</b>
                    {
                        <a href="../../P/6fffd57173d247a6.html#6fffd57173d247a6" class="t t">LocalRunspace</a> <span id="r285 rd" class="r285 r">rs</span> = <a href="#ccb6c738e7f3c724" class="i field">_rsConnection</a> <b>as</b> <a href="../../P/6fffd57173d247a6.html#6fffd57173d247a6" class="t t">LocalRunspace</a>;
                        <b>if</b> (<span class="r285 r">rs</span> != <b>null</b>)
                        {
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">UNIX</span>
                            <a href="#8fe7da83c3383b8b" class="i method">VerifyThreadSettings</a>(<span class="r279 r">settings</span>, <span class="r285 r">rs</span>.<a href="Connection.cs.html#7483ec8556438ee9" class="i property">ApartmentState</a>, <span class="r285 r">rs</span>.<a href="LocalConnection.cs.html#f126bf5d2140af0f" class="i property">ThreadOptions</a>, <b>false</b>);
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
 
                            <b>if</b> (<span class="r285 r">rs</span>.<a href="ConnectionBase.cs.html#c834af2e09f636e6" class="i property">RunspaceStateInfo</a>.<a href="Connection.cs.html#41627f067662d11c" class="i property">State</a> != <a href="Connection.cs.html#5da9dc65e996a685" class="t t">RunspaceState</a>.<a href="Connection.cs.html#9a99efb0eaa3c3db" class="i field">Opened</a>)
                            {
                                <b>string</b> <span id="r286 rd" class="r286 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">PowerShellStrings</span>.<span class="i">InvalidRunspaceState</span>, <a href="Connection.cs.html#5da9dc65e996a685" class="t t">RunspaceState</a>.<a href="Connection.cs.html#9a99efb0eaa3c3db" class="i field">Opened</a>, <span class="r285 r">rs</span>.<a href="ConnectionBase.cs.html#c834af2e09f636e6" class="i property">RunspaceStateInfo</a>.<a href="Connection.cs.html#41627f067662d11c" class="i property">State</a>);
 
                                <a href="Connection.cs.html#340ccbbd1c6e8b87" class="t t">InvalidRunspaceStateException</a> <span id="r287 rd" class="r287 r">e</span> = <b>new</b> <a href="Connection.cs.html#ff1c45fc227fc3d7" class="t constructor">InvalidRunspaceStateException</a>(<span class="r286 r">message</span>,
                                        <span class="r285 r">rs</span>.<a href="ConnectionBase.cs.html#c834af2e09f636e6" class="i property">RunspaceStateInfo</a>.<a href="Connection.cs.html#41627f067662d11c" class="i property">State</a>,
                                        <a href="Connection.cs.html#5da9dc65e996a685" class="t t">RunspaceState</a>.<a href="Connection.cs.html#9a99efb0eaa3c3db" class="i field">Opened</a>
                                    );
 
                                <b>throw</b> <span class="r287 r">e</span>;
                            }
 
                            <a href="#1389234891e6cc36" class="i field">_worker</a>.<a href="#f112c90c3ad6030e" class="i method">CreateRunspaceIfNeededAndDoWork</a>(<span class="r285 r">rs</span>, <b>false</b>);
                        }
                        <b>else</b>
                        {
                            <span class="c">// create a new runspace and perform invoke..</span>
                            <span class="i">ThreadPool</span>.<span class="i">QueueUserWorkItem</span>(
                                <b>new</b> <span class="i">WaitCallback</span>(<a href="#1389234891e6cc36" class="i field">_worker</a>.<span class="i">CreateRunspaceIfNeededAndDoWork</span>),
                                <a href="#ccb6c738e7f3c724" class="i field">_rsConnection</a>);
                        }
                    }
                }
                <b>else</b>
                {
                    <span class="c">// Nested PowerShell</span>
                    <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(<span class="i">PowerShellStrings</span>.<span class="i">NestedPowerShellInvokeAsync</span>);
                }
            }
            <b>catch</b> (<span class="i">Exception</span> <span id="r288 rd" class="r288 r">exception</span>)
            {
                <span class="c">// allow GC collection</span>
                <a href="#aa2e4c96efcd9075" class="i field">_invokeAsyncResult</a> = <b>null</b>;
                <a href="#8bc5b0d04eada2b1" class="i method">SetStateChanged</a>(<b>new</b> <a href="#db44bd87590c83f5" class="t constructor">PSInvocationStateInfo</a>(<a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#35065a8449cad351" class="i field">Failed</a>, <span class="r288 r">exception</span>));
                <span class="c">// re-throw the exception</span>
                <a href="RunspacePool.cs.html#741ffc1755303d69" class="t t">InvalidRunspacePoolStateException</a> <span id="r289 rd" class="r289 r">poolException</span> = <span class="r288 r">exception</span> <b>as</b> <a href="RunspacePool.cs.html#741ffc1755303d69" class="t t">InvalidRunspacePoolStateException</a>;
 
                <b>if</b> (<span class="r289 r">poolException</span> != <b>null</b> &amp;&amp; <a href="#d6487a2f72366731" class="i field">_runspace</a> != <b>null</b>) <span class="c">// the pool exception was actually thrown by a runspace</span>
                {
                    <b>throw</b> <span class="r289 r">poolException</span>.<a href="RunspacePool.cs.html#aeea64df1e9df609" class="i method">ToInvalidRunspaceStateException</a>();
                }
 
                <b>throw</b>;
            }
 
            <b>return</b> <a href="#aa2e4c96efcd9075" class="i field">_invokeAsyncResult</a>;
        }
 
        <span class="c">// Apartment thread state does not apply to non-Windows platforms.</span>
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">UNIX</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Verifies the settings for ThreadOptions and ApartmentState.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static void</b> <a id="8fe7da83c3383b8b" href="../../R/8fe7da83c3383b8b.html" target="n" data-glyph="76,1" class="i method">VerifyThreadSettings</a>(<a href="#ce65c0834aa6f0ea" class="t t">PSInvocationSettings</a> <span id="r290 rd" class="r290 r">settings</span>, <span class="i">ApartmentState</span> <span id="r291 rd" class="r291 r">runspaceApartmentState</span>, <a href="Connection.cs.html#e3e452d2492397a5" class="t t">PSThreadOptions</a> <span id="r292 rd" class="r292 r">runspaceThreadOptions</span>, <b>bool</b> <span id="r293 rd" class="r293 r">isRemote</span>)
        {
            <span class="i">ApartmentState</span> <span id="r294 rd" class="r294 r">apartmentState</span>;
 
            <b>if</b> (<span class="r290 r">settings</span> != <b>null</b> &amp;&amp; <span class="r290 r">settings</span>.<a href="#2b73a864082de936" class="i property">ApartmentState</a> != <span class="i">ApartmentState</span>.<span class="i">Unknown</span>)
            {
                <span class="r294 r">apartmentState</span> = <span class="r290 r">settings</span>.<a href="#2b73a864082de936" class="i property">ApartmentState</a>;
            }
            <b>else</b>
            {
                <span class="r294 r">apartmentState</span> = <span class="r291 r">runspaceApartmentState</span>;
            }
 
            <b>if</b> (<span class="r292 r">runspaceThreadOptions</span> == <a href="Connection.cs.html#e3e452d2492397a5" class="t t">PSThreadOptions</a>.<a href="Connection.cs.html#d11fc99ab087227d" class="i field">ReuseThread</a>)
            {
                <b>if</b> (<span class="r294 r">apartmentState</span> != <span class="r291 r">runspaceApartmentState</span>)
                {
                    <b>throw</b> <b>new</b> <span class="i">InvalidOperationException</span>(<span class="i">PowerShellStrings</span>.<span class="i">ApartmentStateMismatch</span>);
                }
            }
            <b>else</b> <b>if</b> (<span class="r292 r">runspaceThreadOptions</span> == <a href="Connection.cs.html#e3e452d2492397a5" class="t t">PSThreadOptions</a>.<a href="Connection.cs.html#1eea8c0b04b31e81" class="i field">UseCurrentThread</a>)
            {
                <b>if</b> (!<span class="r293 r">isRemote</span>) <span class="c">// on remote calls this check needs to be done by the server</span>
                {
                    <b>if</b> (<span class="r294 r">apartmentState</span> != <span class="i">ApartmentState</span>.<span class="i">Unknown</span> &amp;&amp; <span class="r294 r">apartmentState</span> != <span class="i">Thread</span>.<span class="i">CurrentThread</span>.<span class="i">GetApartmentState</span>())
                    {
                        <b>throw</b> <b>new</b> <span class="i">InvalidOperationException</span>(<span class="i">PowerShellStrings</span>.<span class="i">ApartmentStateMismatchCurrentThread</span>);
                    }
                }
            }
        }
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r295 r t">TInput</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Type for the input collection</span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r296 r t">TOutput</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Type for the output collection</span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r297 r">input</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r298 r">output</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r299 r">settings</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r300 r">shouldCreateWorker</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Cannot perform the operation because the command is already started.</span>
        <span class="c">///</span><span class="c"> Stop the command and try the operation again.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>private void</b> <a id="3e34300b3e6d0450" href="../../R/3e34300b3e6d0450.html" target="n" data-glyph="76,1" class="i method">Prepare</a>&lt;<span id="r295 rd t" class="r295 r t">TInput</span>, <span id="r296 rd t" class="r296 r t">TOutput</span>&gt;(<a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<span class="r295 r t">TInput</span>&gt; <span id="r297 rd" class="r297 r">input</span>, <a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<span class="r296 r t">TOutput</span>&gt; <span id="r298 rd" class="r298 r">output</span>, <a href="#ce65c0834aa6f0ea" class="t t">PSInvocationSettings</a> <span id="r299 rd" class="r299 r">settings</span>, <b>bool</b> <span id="r300 rd" class="r300 r">shouldCreateWorker</span>)
        {
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r298 r">output</span> != <b>null</b>, <span class="s">&quot;Output cannot be null&quot;</span>);
 
            <b>lock</b> (<a href="#57ad56a0d8f83c43" class="i field">_syncObject</a>)
            {
                <b>if</b> ((<a href="#f984c2b1a1646528" class="i field">_psCommand</a> == <b>null</b>) || (<a href="#f984c2b1a1646528" class="i field">_psCommand</a>.<a href="PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a> == <b>null</b>) || (<a href="#f984c2b1a1646528" class="i field">_psCommand</a>.<a href="PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>.<span class="i">Count</span> == 0))
                {
                    <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(<span class="i">PowerShellStrings</span>.<span class="i">NoCommandToInvoke</span>);
                }
                <span class="c">// If execution has already started this will throw</span>
                <a href="#3b4d5707d918bf53" class="i method">AssertExecutionNotStarted</a>();
 
                <b>if</b> (<span class="r300 r">shouldCreateWorker</span>)
                {
                    <span class="c">// set the execution state to running.. so changes</span>
                    <span class="c">// to the current instance of powershell</span>
                    <span class="c">// are blocked.</span>
                    <a href="#39b81acd3aeb1582" class="i property">InvocationStateInfo</a> = <b>new</b> <a href="#db44bd87590c83f5" class="t constructor">PSInvocationStateInfo</a>(<a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#7142407e9e49cf13" class="i field">Running</a>, <b>null</b>);
 
                    <span class="c">// update settings for impersonation policy</span>
                    <b>if</b> ((<span class="r299 r">settings</span> != <b>null</b>) &amp;&amp; (<span class="r299 r">settings</span>.<a href="#265dd5f8987b7aa1" class="i property">FlowImpersonationPolicy</a>))
                    {
                        <span class="c">// get the identity of the thread.</span>
                        <span class="c">// false behavior: If the thread is impersonating the WindowsIdentity for the</span>
                        <span class="c">// thread is returned. If the thread is not impersonating, the WindowsIdentity of</span>
                        <span class="c">// the process is returned.</span>
                        <span class="r299 r">settings</span>.<a href="#bd693521a0dc1cee" class="i property">WindowsIdentityToImpersonate</a> =
                            <span class="i n">System</span>.<span class="i">Security</span>.<span class="i">Principal</span>.<span class="i">WindowsIdentity</span>.<span class="i">GetCurrent</span>(<b>false</b>);
                    }
 
                    <span class="c">// Create the streams and handoff these to the pipeline</span>
                    <span class="c">// this way pipeline will not waste resources creating</span>
                    <span class="c">// the same.</span>
                    <a href="../../utils/ObjectStream.cs.html#27e9349816faeecb" class="t t">ObjectStreamBase</a> <span id="r301 rd" class="r301 r">inputStream</span>;
                    <b>if</b> (<span class="r297 r">input</span> != <b>null</b>)
                    {
                        <span class="r301 r">inputStream</span> = <b>new</b> <a href="../../utils/ObjectStream.cs.html#472e4f0d3c7801e9" class="t constructor">PSDataCollectionStream</a>&lt;<span class="r295 r t">TInput</span>&gt;(<a href="#d8c9867186529e49" class="i property">InstanceId</a>, <span class="r297 r">input</span>);
                    }
                    <b>else</b>
                    {
                        <span class="r301 r">inputStream</span> = <b>new</b> <a href="../../utils/ObjectStream.cs.html#9f848b3587e1f797" class="t constructor">ObjectStream</a>();
                        <span class="r301 r">inputStream</span>.<a href="../../utils/ObjectStream.cs.html#2bbebf10cbee9e83" class="i method">Close</a>();
                    }
 
                    <a href="../../utils/ObjectStream.cs.html#27e9349816faeecb" class="t t">ObjectStreamBase</a> <span id="r302 rd" class="r302 r">outputStream</span> = <b>new</b> <a href="../../utils/ObjectStream.cs.html#472e4f0d3c7801e9" class="t constructor">PSDataCollectionStream</a>&lt;<span class="r296 r t">TOutput</span>&gt;(<a href="#d8c9867186529e49" class="i property">InstanceId</a>, <span class="r298 r">output</span>);
                    <a href="#1389234891e6cc36" class="i field">_worker</a> = <b>new</b> <a href="#c5fed6f37f229704" class="t constructor">Worker</a>(<span class="r301 r">inputStream</span>, <span class="r302 r">outputStream</span>, <span class="r299 r">settings</span>, <a href="#3d1b346df3be574c" class="k">this</a>);
                }
            }
 
            <span class="c">// Only one thread will be running after this point</span>
            <span class="c">// so no need to lock.</span>
 
            <b>if</b> (<span class="r300 r">shouldCreateWorker</span>)
            {
                <span class="c">// Raise the state change events outside of the lock</span>
                <span class="c">// send a cloned copy..this way the handler will</span>
                <span class="c">// not see changes happening to the instance&#39;s execution state.</span>
                <a href="#b2d8b3f6b2e97ff3" class="i method">RaiseStateChangeEvent</a>(<a href="#39b81acd3aeb1582" class="i property">InvocationStateInfo</a>.<a href="#919d0448ea5bf72b" class="i method">Clone</a>());
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Called by both Sync Stop and Async Stop.</span>
        <span class="c">///</span><span class="c"> If isSyncCall is false, then an IAsyncResult object is returned which</span>
        <span class="c">///</span><span class="c"> can be passed back to the user.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r303 r">isSyncCall</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> true if pipeline to be stopped synchronously,</span>
        <span class="c">///</span><span class="c"> false otherewise.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r304 r">callback</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Valid for asynchronous stop</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r305 r">state</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Valid for asynchronous stop</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private</b> <span class="i">IAsyncResult</span> <a id="bfcbbffaa4c984b3" href="../../R/bfcbbffaa4c984b3.html" target="n" data-glyph="76,1" class="i method">CoreStop</a>(<b>bool</b> <span id="r303 rd" class="r303 r">isSyncCall</span>, <span class="i">AsyncCallback</span> <span id="r304 rd" class="r304 r">callback</span>, <b>object</b> <span id="r305 rd" class="r305 r">state</span>)
        {
            <b>bool</b> <span id="r306 rd" class="r306 r">isRunning</span> = <b>false</b>;
            <b>bool</b> <span id="r307 rd" class="r307 r">isDisconnected</span> = <b>false</b>;
            <span class="i">Queue</span>&lt;<a href="#42e325836d1ae967" class="t t">PSInvocationStateInfo</a>&gt; <span id="r308 rd" class="r308 r">events</span> = <b>new</b> <span class="i">Queue</span>&lt;<a href="#42e325836d1ae967" class="t t">PSInvocationStateInfo</a>&gt;();
 
            <span class="c">// Acquire lock as we are going to change state here..</span>
            <b>lock</b> (<a href="#57ad56a0d8f83c43" class="i field">_syncObject</a>)
            {
                <span class="c">// BUGBUG: remote powershell appears to handle state change&#39;s differently</span>
                <span class="c">// Need to speak with remoting dev and resolve this.</span>
                <b>switch</b> (<a href="#39b81acd3aeb1582" class="i property">InvocationStateInfo</a>.<a href="#7a70ff5163d0f044" class="i property">State</a>)
                {
                    <b>case</b> <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#3eb81f39bc769d16" class="i field">NotStarted</a>:
                        <span class="c">// Stopped is called before operation started..we need to change</span>
                        <span class="c">// state to stopping and then to stopped... so that future stops</span>
                        <span class="c">// dont affect the state.</span>
                        <a href="#39b81acd3aeb1582" class="i property">InvocationStateInfo</a> = <b>new</b> <a href="#db44bd87590c83f5" class="t constructor">PSInvocationStateInfo</a>(<a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#a9d235bf0dc5bfce" class="i field">Stopping</a>,
                            <b>null</b>);
 
                        <span class="r308 r">events</span>.<span class="i">Enqueue</span>(<b>new</b> <a href="#db44bd87590c83f5" class="t constructor">PSInvocationStateInfo</a>(<a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#6a6866e7df063875" class="i field">Stopped</a>,
                            <b>null</b>));
                        <b>break</b>;
 
                    <b>case</b> <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#89ec15a2a933a2b6" class="i field">Completed</a>:
                    <b>case</b> <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#35065a8449cad351" class="i field">Failed</a>:
                    <b>case</b> <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#6a6866e7df063875" class="i field">Stopped</a>:
                        <a href="#c48e6ad54262904d" class="i field">_stopAsyncResult</a> = <b>new</b> <a href="#a573e20febced368" class="t constructor">PowerShellAsyncResult</a>(<a href="#d8c9867186529e49" class="i property">InstanceId</a>, <span class="r304 r">callback</span>, <span class="r305 r">state</span>, <b>null</b>, <b>false</b>);
                        <a href="#c48e6ad54262904d" class="i field">_stopAsyncResult</a>.<a href="AsyncResult.cs.html#2d78c0fa1b51bb6e" class="i method">SetAsCompleted</a>(<b>null</b>);
                        <b>return</b> <a href="#c48e6ad54262904d" class="i field">_stopAsyncResult</a>;
 
                    <b>case</b> <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#a9d235bf0dc5bfce" class="i field">Stopping</a>:
                        <span class="c">// Create new stop sync object if none exists.  Otherwise return existing.</span>
                        <b>if</b> (<a href="#c48e6ad54262904d" class="i field">_stopAsyncResult</a> == <b>null</b>)
                        {
                            <a href="#c48e6ad54262904d" class="i field">_stopAsyncResult</a> = <b>new</b> <a href="#a573e20febced368" class="t constructor">PowerShellAsyncResult</a>(<a href="#d8c9867186529e49" class="i property">InstanceId</a>, <span class="r304 r">callback</span>, <span class="r305 r">state</span>, <b>null</b>, <b>false</b>);
                            <a href="#c48e6ad54262904d" class="i field">_stopAsyncResult</a>.<a href="AsyncResult.cs.html#2d78c0fa1b51bb6e" class="i method">SetAsCompleted</a>(<b>null</b>);
                        }
 
                        <b>return</b> <a href="#c48e6ad54262904d" class="i field">_stopAsyncResult</a>;
 
                    <b>case</b> <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#7142407e9e49cf13" class="i field">Running</a>:
                        <a href="#39b81acd3aeb1582" class="i property">InvocationStateInfo</a> = <b>new</b> <a href="#db44bd87590c83f5" class="t constructor">PSInvocationStateInfo</a>(<a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#a9d235bf0dc5bfce" class="i field">Stopping</a>,
                            <b>null</b>);
                        <span class="r306 r">isRunning</span> = <b>true</b>;
                        <b>break</b>;
 
                    <b>case</b> <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#55f5ed5d1c0f010a" class="i field">Disconnected</a>:
                        <span class="c">// Stopping a disconnected command results in a failed state.</span>
                        <a href="#39b81acd3aeb1582" class="i property">InvocationStateInfo</a> = <b>new</b> <a href="#db44bd87590c83f5" class="t constructor">PSInvocationStateInfo</a>(<a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#35065a8449cad351" class="i field">Failed</a>, <b>null</b>);
                        <span class="r307 r">isDisconnected</span> = <b>true</b>;
                        <b>break</b>;
                }
 
                <a href="#c48e6ad54262904d" class="i field">_stopAsyncResult</a> = <b>new</b> <a href="#a573e20febced368" class="t constructor">PowerShellAsyncResult</a>(<a href="#d8c9867186529e49" class="i property">InstanceId</a>, <span class="r304 r">callback</span>, <span class="r305 r">state</span>, <b>null</b>, <b>false</b>);
            }
 
            <span class="c">// If in the Disconnected state then stopping simply cuts loose the PowerShell object</span>
            <span class="c">// so that a new one can be connected.  The state is set to Failed since the command</span>
            <span class="c">// cannot complete with this object.</span>
            <b>if</b> (<span class="r307 r">isDisconnected</span>)
            {
                <b>if</b> (<a href="#aa2e4c96efcd9075" class="i field">_invokeAsyncResult</a> != <b>null</b>)
                {
                    <span class="c">// Since object is stopped, allow result wait to end.</span>
                    <a href="#aa2e4c96efcd9075" class="i field">_invokeAsyncResult</a>.<a href="AsyncResult.cs.html#2d78c0fa1b51bb6e" class="i method">SetAsCompleted</a>(<b>null</b>);
                }
 
                <a href="#c48e6ad54262904d" class="i field">_stopAsyncResult</a>.<a href="AsyncResult.cs.html#2d78c0fa1b51bb6e" class="i method">SetAsCompleted</a>(<b>null</b>);
 
                <span class="c">// Raise event for failed state change.</span>
                <a href="#b2d8b3f6b2e97ff3" class="i method">RaiseStateChangeEvent</a>(<a href="#39b81acd3aeb1582" class="i property">InvocationStateInfo</a>.<a href="#919d0448ea5bf72b" class="i method">Clone</a>());
 
                <b>return</b> <a href="#c48e6ad54262904d" class="i field">_stopAsyncResult</a>;
            }
 
            <span class="c">// Ensure the runspace is not blocking in a debug stop.</span>
            <a href="#b3540052aefd87d1" class="i method">ReleaseDebugger</a>();
 
            <a href="#b2d8b3f6b2e97ff3" class="i method">RaiseStateChangeEvent</a>(<a href="#39b81acd3aeb1582" class="i property">InvocationStateInfo</a>.<a href="#919d0448ea5bf72b" class="i method">Clone</a>());
 
            <b>bool</b> <span id="r309 rd" class="r309 r">shouldRunStopHelper</span> = <b>false</b>;
            <a href="RunspacePool.cs.html#c1948c2f22e6b527" class="t t">RunspacePool</a> <span id="r310 rd" class="r310 r">pool</span> = <a href="#ccb6c738e7f3c724" class="i field">_rsConnection</a> <b>as</b> <a href="RunspacePool.cs.html#c1948c2f22e6b527" class="t t">RunspacePool</a>;
 
            <b>if</b> (<span class="r310 r">pool</span> != <b>null</b> &amp;&amp; <span class="r310 r">pool</span>.<a href="RunspacePool.cs.html#6cd4c73a96856bcf" class="i property">IsRemote</a>)
            {
                <b>if</b> ((<a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a> != <b>null</b>) &amp;&amp; <a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a>.<a href="../remoting/client/ClientRemotePowerShell.cs.html#4f8237be57be8c4e" class="i property">Initialized</a>)
                {
                    <a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a>.<a href="../remoting/client/ClientRemotePowerShell.cs.html#b23b50ea93dd2ba0" class="i method">StopAsync</a>();
 
                    <b>if</b> (<span class="r303 r">isSyncCall</span>)
                    {
                        <a href="#c48e6ad54262904d" class="i field">_stopAsyncResult</a>.<a href="AsyncResult.cs.html#c2021ce461eda64c" class="i property">AsyncWaitHandle</a>.<span class="i">WaitOne</span>();
                    }
                }
                <b>else</b>
                {
                    <span class="r309 r">shouldRunStopHelper</span> = <b>true</b>;
                }
            }
            <b>else</b> <b>if</b> (<span class="r306 r">isRunning</span>)
            {
                <a href="#1389234891e6cc36" class="i field">_worker</a>.<a href="#594e8300c7bee072" class="i method">Stop</a>(<span class="r303 r">isSyncCall</span>);
            }
            <b>else</b>
            {
                <span class="r309 r">shouldRunStopHelper</span> = <b>true</b>;
            }
 
            <b>if</b> (<span class="r309 r">shouldRunStopHelper</span>)
            {
                <b>if</b> (<span class="r303 r">isSyncCall</span>)
                {
                    <span class="i">StopHelper</span>(<span class="r308 r">events</span>);
                }
                <b>else</b>
                {
                    <span class="i">ThreadPool</span>.<span class="i">QueueUserWorkItem</span>(<b>new</b> <span class="i">WaitCallback</span>(<span class="i">StopThreadProc</span>), <span class="r308 r">events</span>);
                }
            }
 
            <b>return</b> <a href="#c48e6ad54262904d" class="i field">_stopAsyncResult</a>;
        }
 
        <b>private void</b> <a id="b3540052aefd87d1" href="../../R/b3540052aefd87d1.html" target="n" data-glyph="76,1" class="i method">ReleaseDebugger</a>()
        {
            <a href="../../P/6fffd57173d247a6.html#6fffd57173d247a6" class="t t">LocalRunspace</a> <span id="r311 rd" class="r311 r">localRunspace</span> = <a href="#d6487a2f72366731" class="i field">_runspace</a> <b>as</b> <a href="../../P/6fffd57173d247a6.html#6fffd57173d247a6" class="t t">LocalRunspace</a>;
            <b>if</b> (<span class="r311 r">localRunspace</span> != <b>null</b>)
            {
                <span class="r311 r">localRunspace</span>.<a href="LocalConnection.cs.html#f8ffc628c76d0f2b" class="i method">ReleaseDebugger</a>();
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If there is no worker assigned yet, we need to emulate stop here.</span>
        <span class="c">///</span><span class="c"> In Asynchronous stop case, we need to send event change notifications</span>
        <span class="c">///</span><span class="c"> from a different thread.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r312 r">state</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="ed8dc4028a55ddad" href="../../R/ed8dc4028a55ddad.html" target="n" data-glyph="76,1" class="i method">StopHelper</a>(<b>object</b> <span id="r312 rd" class="r312 r">state</span>)
        {
            <span class="i">Queue</span>&lt;<a href="#42e325836d1ae967" class="t t">PSInvocationStateInfo</a>&gt; <span id="r313 rd" class="r313 r">events</span> = <span class="r312 r">state</span> <b>as</b> <span class="i">Queue</span>&lt;<a href="#42e325836d1ae967" class="t t">PSInvocationStateInfo</a>&gt;;
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r313 r">events</span> != <b>null</b>,
                <span class="s">&quot;StopImplementation expects a Queue&lt;PSInvocationStateInfo&gt; as parameter&quot;</span>);
 
            <span class="c">// Raise the events outside of the lock..this way 3rd party callback</span>
            <span class="c">// cannot hold our lock.</span>
            <b>while</b> (<span class="r313 r">events</span>.<span class="i">Count</span> &gt; 0)
            {
                <a href="#42e325836d1ae967" class="t t">PSInvocationStateInfo</a> <span id="r314 rd" class="r314 r">targetStateInfo</span> = <span class="r313 r">events</span>.<span class="i">Dequeue</span>();
                <a href="#8bc5b0d04eada2b1" class="i method">SetStateChanged</a>(<span class="r314 r">targetStateInfo</span>);
            }
 
            <span class="c">// Clear internal resources</span>
            <a href="#a597838849d3c0e3" class="i method">InternalClearSuppressExceptions</a>();
        }
 
        <b>private void</b> <a id="9dbe45b064d377e4" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">StopThreadProc</a>(<b>object</b> <span id="r315 rd" class="r315 r">state</span>)
        {
            <span class="c">// variable to keep track of exceptions.</span>
            <span class="i">Exception</span> <span id="r316 rd" class="r316 r">exception</span> = <b>null</b>;
 
            <b>try</b>
            {
                <a href="#ed8dc4028a55ddad" class="i method">StopHelper</a>(<span class="r315 r">state</span>);
            }
            <b>catch</b> (<span class="i">Exception</span> <span id="r317 rd" class="r317 r">e</span>)
            {
                <span class="c">// report non-severe exceptions to the user via the</span>
                <span class="c">// asyncresult object</span>
                <span class="r316 r">exception</span> = <span class="r317 r">e</span>;
                <b>throw</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The client remote powershell associated with this</span>
        <span class="c">///</span><span class="c"> powershell object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="../remoting/client/ClientRemotePowerShell.cs.html#b4d2ac017883b31c" class="t t">ClientRemotePowerShell</a> <a id="2f2a1f6f4e814646" href="../../R/2f2a1f6f4e814646.html" target="n" data-glyph="104,1" class="i property">RemotePowerShell</a> { <b>get</b>; <b>private set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The history string to be used for displaying</span>
        <span class="c">///</span><span class="c"> the history.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public string</b> <a id="3b8f81dc833a1a8c" href="../../R/3b8f81dc833a1a8c.html" target="n" data-glyph="102,1" class="i property">HistoryString</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Extra commands to run in a single invocation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">Collection</span>&lt;<a href="PSCommand.cs.html#b9f024f73904cf55" class="t t">PSCommand</a>&gt; <a id="4cfb6cc82eb60c86" href="../../R/4cfb6cc82eb60c86.html" target="n" data-glyph="104,1" class="i property">ExtraCommands</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Currently running extra commands.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="90e4778239a93806" href="../../R/90e4778239a93806.html" target="n" data-glyph="104,1" class="i property">RunningExtraCommands</a> { <b>get</b>; <b>private set</b>; }
 
        <b>private bool</b> <a id="4c6ee695d9a7fe71" href="../../R/4c6ee695d9a7fe71.html" target="n" data-glyph="76,1" class="i method">ServerSupportsBatchInvocation</a>()
        {
            <b>if</b> (<a href="#d6487a2f72366731" class="i field">_runspace</a> != <b>null</b>)
            {
                <b>return</b> <a href="#d6487a2f72366731" class="i field">_runspace</a>.<a href="Connection.cs.html#01b12fbdab6c561a" class="i property">RunspaceStateInfo</a>.<a href="Connection.cs.html#41627f067662d11c" class="i property">State</a> != <a href="Connection.cs.html#5da9dc65e996a685" class="t t">RunspaceState</a>.<a href="Connection.cs.html#4e82723df10b13f6" class="i field">BeforeOpen</a> &amp;&amp;
                       <a href="#d6487a2f72366731" class="i field">_runspace</a>.<a href="Connection.cs.html#4a6e6e16fd38fa86" class="i method">GetRemoteProtocolVersion</a>() &gt;= <a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#d19a1042a44001e8" class="t t">RemotingConstants</a>.<a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#fd42c50dee2d8244" class="i field">ProtocolVersionWin8RTM</a>;
            }
 
            <a href="../remoting/client/RemoteRunspacePoolInternal.cs.html#1aba79be5da56f57" class="t t">RemoteRunspacePoolInternal</a> <span id="r318 rd" class="r318 r">remoteRunspacePoolInternal</span> = <b>null</b>;
            <b>if</b> (<a href="#ccb6c738e7f3c724" class="i field">_rsConnection</a> <b>is</b> <a href="../remoting/client/remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a>)
            {
                <span class="r318 r">remoteRunspacePoolInternal</span> = (<a href="#ccb6c738e7f3c724" class="i field">_rsConnection</a> <b>as</b> <a href="../remoting/client/remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a>).<a href="../remoting/client/remoterunspace.cs.html#52e4a4fcfd3da6a7" class="i property">RunspacePool</a>.<a href="RunspacePool.cs.html#ae1c1c4ae8a5c648" class="i property">RemoteRunspacePoolInternal</a>;
            }
            <b>else</b> <b>if</b> (<a href="#ccb6c738e7f3c724" class="i field">_rsConnection</a> <b>is</b> <a href="RunspacePool.cs.html#c1948c2f22e6b527" class="t t">RunspacePool</a>)
            {
                <span class="r318 r">remoteRunspacePoolInternal</span> = (<a href="#ccb6c738e7f3c724" class="i field">_rsConnection</a> <b>as</b> <a href="RunspacePool.cs.html#c1948c2f22e6b527" class="t t">RunspacePool</a>).<a href="RunspacePool.cs.html#ae1c1c4ae8a5c648" class="i property">RemoteRunspacePoolInternal</a>;
            }
 
            <b>return</b> <span class="r318 r">remoteRunspacePoolInternal</span> != <b>null</b> &amp;&amp;
                   <span class="r318 r">remoteRunspacePoolInternal</span>.<a href="../remoting/client/RemoteRunspacePoolInternal.cs.html#d44f4f1c4f3907db" class="i property">PSRemotingProtocolVersion</a> &gt;= <a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#d19a1042a44001e8" class="t t">RemotingConstants</a>.<a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#fd42c50dee2d8244" class="i field">ProtocolVersionWin8RTM</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Helper method to add running remote PowerShell to the remote runspace list.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private void</b> <a id="6ddec68b40195c65" href="../../R/6ddec68b40195c65.html" target="n" data-glyph="76,1" class="i method">AddToRemoteRunspaceRunningList</a>()
        {
            <b>if</b> (<a href="#d6487a2f72366731" class="i field">_runspace</a> != <b>null</b>)
            {
                <a href="#d6487a2f72366731" class="i field">_runspace</a>.<a href="Connection.cs.html#6da72b8c11307bb9" class="i method">PushRunningPowerShell</a>(<a href="#3d1b346df3be574c" class="k">this</a>);
            }
            <b>else</b>
            {
                <a href="../remoting/client/RemoteRunspacePoolInternal.cs.html#1aba79be5da56f57" class="t t">RemoteRunspacePoolInternal</a> <span id="r319 rd" class="r319 r">remoteRunspacePoolInternal</span> = <a href="#ae8280ca5d8cb929" class="i method">GetRemoteRunspacePoolInternal</a>();
                <b>if</b> (<span class="r319 r">remoteRunspacePoolInternal</span> != <b>null</b>)
                {
                    <span class="r319 r">remoteRunspacePoolInternal</span>.<a href="../remoting/client/RemoteRunspacePoolInternal.cs.html#b0e63b9b498e54b3" class="i method">PushRunningPowerShell</a>(<a href="#3d1b346df3be574c" class="k">this</a>);
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Helper method to remove running remote PowerShell from the remote runspacelist.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private void</b> <a id="32f03dec714cfa31" href="../../R/32f03dec714cfa31.html" target="n" data-glyph="76,1" class="i method">RemoveFromRemoteRunspaceRunningList</a>()
        {
            <b>if</b> (<a href="#d6487a2f72366731" class="i field">_runspace</a> != <b>null</b>)
            {
                <a href="#d6487a2f72366731" class="i field">_runspace</a>.<a href="Connection.cs.html#32999824f64df748" class="i method">PopRunningPowerShell</a>();
            }
            <b>else</b>
            {
                <a href="../remoting/client/RemoteRunspacePoolInternal.cs.html#1aba79be5da56f57" class="t t">RemoteRunspacePoolInternal</a> <span id="r320 rd" class="r320 r">remoteRunspacePoolInternal</span> = <a href="#ae8280ca5d8cb929" class="i method">GetRemoteRunspacePoolInternal</a>();
                <b>if</b> (<span class="r320 r">remoteRunspacePoolInternal</span> != <b>null</b>)
                {
                    <span class="r320 r">remoteRunspacePoolInternal</span>.<a href="../remoting/client/RemoteRunspacePoolInternal.cs.html#856f65c96543a194" class="i method">PopRunningPowerShell</a>();
                }
            }
        }
 
        <b>private</b> <a href="../remoting/client/RemoteRunspacePoolInternal.cs.html#1aba79be5da56f57" class="t t">RemoteRunspacePoolInternal</a> <a id="ae8280ca5d8cb929" href="../../R/ae8280ca5d8cb929.html" target="n" data-glyph="76,1" class="i method">GetRemoteRunspacePoolInternal</a>()
        {
            <a href="RunspacePool.cs.html#c1948c2f22e6b527" class="t t">RunspacePool</a> <span id="r321 rd" class="r321 r">runspacePool</span> = <a href="#ccb6c738e7f3c724" class="i field">_rsConnection</a> <b>as</b> <a href="RunspacePool.cs.html#c1948c2f22e6b527" class="t t">RunspacePool</a>;
            <b>return</b> <span class="r321 r">runspacePool</span>?.<a href="RunspacePool.cs.html#ae1c1c4ae8a5c648" class="i property">RemoteRunspacePoolInternal</a>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Worker
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> AsyncResult object used to monitor pipeline creation and invocation.</span>
        <span class="c">///</span><span class="c"> This is needed as a Runspace may not be available in the RunspacePool.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private sealed class</b> <a id="436f456ebe703274" href="../../R/436f456ebe703274.html" target="n" data-glyph="4,1" class="t t">Worker</a>
        {
            <b>private readonly</b> <a href="../../utils/ObjectStream.cs.html#27e9349816faeecb" class="t t">ObjectStreamBase</a> <a id="45d31f3d828fea64" href="../../R/45d31f3d828fea64.html" target="n" data-glyph="46,2" class="i field">_inputStream</a>;
            <b>private readonly</b> <a href="../../utils/ObjectStream.cs.html#27e9349816faeecb" class="t t">ObjectStreamBase</a> <a id="8e388229fd79c2cb" href="../../R/8e388229fd79c2cb.html" target="n" data-glyph="46,2" class="i field">_outputStream</a>;
            <b>private readonly</b> <a href="../../utils/ObjectStream.cs.html#27e9349816faeecb" class="t t">ObjectStreamBase</a> <a id="c45194e42e7258e4" href="../../R/c45194e42e7258e4.html" target="n" data-glyph="46,2" class="i field">_errorStream</a>;
            <b>private readonly</b> <a href="#ce65c0834aa6f0ea" class="t t">PSInvocationSettings</a> <a id="f4f6205cf768f5a4" href="../../R/f4f6205cf768f5a4.html" target="n" data-glyph="46,2" class="i field">_settings</a>;
            <b>private bool</b> <a id="07f8bf1ea4d782aa" href="../../R/07f8bf1ea4d782aa.html" target="n" data-glyph="46,2" class="i field">_isNotActive</a>;
            <b>private readonly</b> <a href="#3d1b346df3be574c" class="t t">PowerShell</a> <a id="f40501b7b0c519bc" href="../../R/f40501b7b0c519bc.html" target="n" data-glyph="46,2" class="i field">_shell</a>;
            <b>private readonly object</b> <a id="0711e9b9b569dadf" href="../../R/0711e9b9b569dadf.html" target="n" data-glyph="46,2" class="i field">_syncObject</a> = <b>new</b> <b>object</b>();
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r322 r">inputStream</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r323 r">outputStream</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r324 r">settings</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r325 r">shell</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <b>internal</b> <a id="c5fed6f37f229704" href="../../R/c5fed6f37f229704.html" target="n" data-glyph="74,2" class="t constructor">Worker</a>(<a href="../../utils/ObjectStream.cs.html#27e9349816faeecb" class="t t">ObjectStreamBase</a> <span id="r322 rd" class="r322 r">inputStream</span>,
                <a href="../../utils/ObjectStream.cs.html#27e9349816faeecb" class="t t">ObjectStreamBase</a> <span id="r323 rd" class="r323 r">outputStream</span>,
                <a href="#ce65c0834aa6f0ea" class="t t">PSInvocationSettings</a> <span id="r324 rd" class="r324 r">settings</span>,
                <a href="#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r325 rd" class="r325 r">shell</span>)
            {
                <a href="#45d31f3d828fea64" class="i field">_inputStream</a> = <span class="r322 r">inputStream</span>;
                <a href="#8e388229fd79c2cb" class="i field">_outputStream</a> = <span class="r323 r">outputStream</span>;
                <a href="#c45194e42e7258e4" class="i field">_errorStream</a> = <b>new</b> <a href="../../utils/ObjectStream.cs.html#472e4f0d3c7801e9" class="t constructor">PSDataCollectionStream</a>&lt;<a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a>&gt;(<span class="r325 r">shell</span>.<a href="#d8c9867186529e49" class="i property">InstanceId</a>, <span class="r325 r">shell</span>.<a href="#6b0cd6330b1f780f" class="i field">_errorBuffer</a>);
                <a href="#f4f6205cf768f5a4" class="i field">_settings</a> = <span class="r324 r">settings</span>;
                <a href="#f40501b7b0c519bc" class="i field">_shell</a> = <span class="r325 r">shell</span>;
            }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Sets the async result object that monitors a</span>
            <span class="c">///</span><span class="c"> BeginGetRunspace async operation on the</span>
            <span class="c">///</span><span class="c"> RunspacePool.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>internal</b> <span class="i">IAsyncResult</span> <a id="a7de1ad695149d22" href="../../R/a7de1ad695149d22.html" target="n" data-glyph="104,2" class="i property">GetRunspaceAsyncResult</a> { <b>get</b>; <b>set</b>; }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Gets the currently running pipeline.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>internal</b> <a href="Pipeline.cs.html#c607964c20793ea5" class="t t">Pipeline</a> <a id="88b35242d849bc1e" href="../../R/88b35242d849bc1e.html" target="n" data-glyph="104,2" class="i property">CurrentlyRunningPipeline</a> { <b>get</b>; <b>private set</b>; }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> This method gets invoked from a ThreadPool thread.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r326 r">state</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <b>internal void</b> <a id="4247c2fde492bbe9" href="../../R/../../0000000000.html" target="n" data-glyph="74,2" class="i method">CreateRunspaceIfNeededAndDoWork</a>(<b>object</b> <span id="r326 rd" class="r326 r">state</span>)
            {
                <a href="Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a> <span id="r327 rd" class="r327 r">rsToUse</span> = <span class="r326 r">state</span> <b>as</b> <a href="Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a>;
                <a href="#f112c90c3ad6030e" class="i method">CreateRunspaceIfNeededAndDoWork</a>(<span class="r327 r">rsToUse</span>, <b>false</b>);
            }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> This method gets invoked when PowerShell is not associated</span>
            <span class="c">///</span><span class="c"> with a RunspacePool.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r328 r">rsToUse</span><span class="c">&quot;</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> User supplied Runspace if any.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r329 r">isSync</span><span class="c">&quot;</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> true if Invoke() should be used to invoke pipeline</span>
            <span class="c">///</span><span class="c"> false if InvokeAsync() should be used.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> All exceptions are caught and reported via a</span>
            <span class="c">///</span><span class="c"> PipelineStateChanged event.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
            <b>internal void</b> <a id="f112c90c3ad6030e" href="../../R/f112c90c3ad6030e.html" target="n" data-glyph="74,2" class="i method">CreateRunspaceIfNeededAndDoWork</a>(<a href="Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a> <span id="r328 rd" class="r328 r">rsToUse</span>, <b>bool</b> <span id="r329 rd" class="r329 r">isSync</span>)
            {
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">disable</span> 56500
                <b>try</b>
                {
                    <span class="c">// Set the host for this local runspace if user specified one.</span>
                    <a href="../../P/6fffd57173d247a6.html#6fffd57173d247a6" class="t t">LocalRunspace</a> <span id="r330 rd" class="r330 r">rs</span> = <span class="r328 r">rsToUse</span> <b>as</b> <a href="../../P/6fffd57173d247a6.html#6fffd57173d247a6" class="t t">LocalRunspace</a>;
                    <b>if</b> (<span class="r330 r">rs</span> == <b>null</b>)
                    {
                        <b>lock</b> (<a href="#f40501b7b0c519bc" class="i field">_shell</a>.<a href="#57ad56a0d8f83c43" class="i field">_syncObject</a>)
                        {
                            <b>if</b> (<a href="#f40501b7b0c519bc" class="i field">_shell</a>.<a href="#d6487a2f72366731" class="i field">_runspace</a> != <b>null</b>)
                            {
                                <span class="r328 r">rsToUse</span> = <a href="#f40501b7b0c519bc" class="i field">_shell</a>.<a href="#d6487a2f72366731" class="i field">_runspace</a>;
                            }
                            <b>else</b>
                            {
                                <a href="Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a> <span id="r331 rd" class="r331 r">runspace</span> = <b>null</b>;
 
                                <b>if</b> ((<a href="#f4f6205cf768f5a4" class="i field">_settings</a> != <b>null</b>) &amp;&amp; (<a href="#f4f6205cf768f5a4" class="i field">_settings</a>.<a href="#2088d9ba09399d1e" class="i property">Host</a> != <b>null</b>))
                                {
                                    <span class="r331 r">runspace</span> = <a href="ConnectionFactory.cs.html#c5fbe142e4e21218" class="t t">RunspaceFactory</a>.<a href="ConnectionFactory.cs.html#68ee9f57341809d0" class="i method">CreateRunspace</a>(<a href="#f4f6205cf768f5a4" class="i field">_settings</a>.<a href="#2088d9ba09399d1e" class="i property">Host</a>);
                                }
                                <b>else</b>
                                {
                                    <span class="r331 r">runspace</span> = <a href="ConnectionFactory.cs.html#c5fbe142e4e21218" class="t t">RunspaceFactory</a>.<a href="ConnectionFactory.cs.html#d1898b5d69d8413b" class="i method">CreateRunspace</a>();
                                }
 
                                <a href="#f40501b7b0c519bc" class="i field">_shell</a>.<a href="#d47455cbca212aaf" class="i method">SetRunspace</a>(<span class="r331 r">runspace</span>, <b>true</b>);
 
                                <span class="r328 r">rsToUse</span> = (<a href="../../P/6fffd57173d247a6.html#6fffd57173d247a6" class="t t">LocalRunspace</a>)<span class="r331 r">runspace</span>;
                                <span class="r328 r">rsToUse</span>.<a href="Connection.cs.html#61f55439fb78f2fe" class="i method">Open</a>();
                            }
                        }
                    }
 
                    <a href="#6f66f8240faa3068" class="i method">ConstructPipelineAndDoWork</a>(<span class="r328 r">rsToUse</span>, <span class="r329 r">isSync</span>);
                }
                <b>catch</b> (<span class="i">Exception</span> <span id="r332 rd" class="r332 r">e</span>)
                {
                    <span class="c">// PipelineStateChangedEvent is not raised</span>
                    <span class="c">// if there is an exception calling BeginInvoke</span>
                    <span class="c">// So raise the event here and notify the caller.</span>
                    <b>lock</b> (<a href="#0711e9b9b569dadf" class="i field">_syncObject</a>)
                    {
                        <b>if</b> (<a href="#07f8bf1ea4d782aa" class="i field">_isNotActive</a>)
                            <b>return</b>;
                        <a href="#07f8bf1ea4d782aa" class="i field">_isNotActive</a> = <b>true</b>;
                    }
 
                    <a href="#f40501b7b0c519bc" class="i field">_shell</a>.<a href="#70e84a6d82e5ff5c" class="i method">PipelineStateChanged</a>(<a href="#436f456ebe703274" class="k">this</a>,
                           <b>new</b> <a href="Pipeline.cs.html#30728553fbee21a5" class="t constructor">PipelineStateEventArgs</a>(
                               <b>new</b> <a href="Pipeline.cs.html#8a80e8d270916577" class="t constructor">PipelineStateInfo</a>(<a href="Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="Pipeline.cs.html#425f1d8027f15e68" class="i field">Failed</a>,
                                   <span class="r332 r">e</span>)));
 
                    <b>if</b> (<span class="r329 r">isSync</span>)
                    {
                        <b>throw</b>;
                    }
                }
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">restore</span> 56500
            }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> This method gets called from a ThreadPool thread.</span>
            <span class="c">///</span><span class="c"> This method gets called from a RunspacePool thread when a</span>
            <span class="c">///</span><span class="c"> Runspace is available.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r333 r">asyncResult</span><span class="c">&quot;</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> AsyncResult object which monitors the asyncOperation.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> All exceptions are caught and reported via a</span>
            <span class="c">///</span><span class="c"> PipelineStateChanged event.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
            <b>internal void</b> <a id="cf81743872cd2c4f" href="../../R/../../0000000000.html" target="n" data-glyph="74,2" class="i method">RunspaceAvailableCallback</a>(<span class="i">IAsyncResult</span> <span id="r333 rd" class="r333 r">asyncResult</span>)
            {
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">disable</span> 56500
                <b>try</b>
                {
                    <a href="RunspacePool.cs.html#c1948c2f22e6b527" class="t t">RunspacePool</a> <span id="r334 rd" class="r334 r">pool</span> = <a href="#f40501b7b0c519bc" class="i field">_shell</a>.<a href="#ccb6c738e7f3c724" class="i field">_rsConnection</a> <b>as</b> <a href="RunspacePool.cs.html#c1948c2f22e6b527" class="t t">RunspacePool</a>;
                    <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r334 r">pool</span> != <b>null</b>, <span class="s">&quot;RunspaceConnection must be a runspace pool&quot;</span>);
 
                    <span class="c">// get the runspace..this will throw if there is an exception</span>
                    <span class="c">// occurred while getting the runspace.</span>
                    <a href="Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a> <span id="r335 rd" class="r335 r">pooledRunspace</span> = <span class="r334 r">pool</span>.<a href="RunspacePool.cs.html#d4a431395039c1d7" class="i method">EndGetRunspace</a>(<span class="r333 r">asyncResult</span>);
 
                    <b>bool</b> <span id="r336 rd" class="r336 r">isPipelineCreated</span> = <a href="#6f66f8240faa3068" class="i method">ConstructPipelineAndDoWork</a>(<span class="r335 r">pooledRunspace</span>, <b>false</b>);
                    <b>if</b> (!<span class="r336 r">isPipelineCreated</span>)
                    {
                        <span class="r334 r">pool</span>.<a href="RunspacePool.cs.html#eb8b8375fcab8816" class="i method">ReleaseRunspace</a>(<span class="r335 r">pooledRunspace</span>);
                    }
                }
                <b>catch</b> (<span class="i">Exception</span> <span id="r337 rd" class="r337 r">e</span>)
                {
                    <span class="c">// PipelineStateChangedEvent is not raised</span>
                    <span class="c">// if there is an exception calling BeginInvoke</span>
                    <span class="c">// So raise the event here and notify the caller.</span>
                    <b>lock</b> (<a href="#0711e9b9b569dadf" class="i field">_syncObject</a>)
                    {
                        <b>if</b> (<a href="#07f8bf1ea4d782aa" class="i field">_isNotActive</a>)
                            <b>return</b>;
                        <a href="#07f8bf1ea4d782aa" class="i field">_isNotActive</a> = <b>true</b>;
                    }
 
                    <a href="#f40501b7b0c519bc" class="i field">_shell</a>.<a href="#70e84a6d82e5ff5c" class="i method">PipelineStateChanged</a>(<a href="#436f456ebe703274" class="k">this</a>,
                            <b>new</b> <a href="Pipeline.cs.html#30728553fbee21a5" class="t constructor">PipelineStateEventArgs</a>(
                                <b>new</b> <a href="Pipeline.cs.html#8a80e8d270916577" class="t constructor">PipelineStateInfo</a>(<a href="Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="Pipeline.cs.html#425f1d8027f15e68" class="i field">Failed</a>,
                                    <span class="r337 r">e</span>)));
                }
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">restore</span> 56500
            }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Constructs a pipeline from the supplied runspace and invokes</span>
            <span class="c">///</span><span class="c"> pipeline either synchronously or asynchronously identified by</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r338 r">performSyncInvoke</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r339 r">rs</span><span class="c">&quot;</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Runspace to create pipeline. Cannot be null.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r338 r">performSyncInvoke</span><span class="c">&quot;</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> if true, Invoke() is called</span>
            <span class="c">///</span><span class="c"> BeginInvoke() otherwise.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> 1.BeginInvoke is called on nested powershell. Nested</span>
            <span class="c">///</span><span class="c"> Powershell cannot be executed Asynchronously.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> true if the pipeline is created/invoked successfully.</span>
            <span class="c">///</span><span class="c"> false otherwise.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
            <b>internal bool</b> <a id="6f66f8240faa3068" href="../../R/6f66f8240faa3068.html" target="n" data-glyph="74,2" class="i method">ConstructPipelineAndDoWork</a>(<a href="Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a> <span id="r339 rd" class="r339 r">rs</span>, <b>bool</b> <span id="r338 rd" class="r338 r">performSyncInvoke</span>)
            {
                <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r339 r">rs</span> != <b>null</b>, <span class="s">&quot;Runspace cannot be null in ConstructPipelineAndDoWork&quot;</span>);
                <a href="#f40501b7b0c519bc" class="i field">_shell</a>.<a href="#e97b43f065651a57" class="i">RunspaceAssigned</a>.<span class="i">SafeInvoke</span>(<a href="#436f456ebe703274" class="k">this</a>, <b>new</b> <a href="../EventManager.cs.html#93364b791da264c9" class="t constructor">PSEventArgs</a>&lt;<a href="Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a>&gt;(<span class="r339 r">rs</span>));
 
                <span class="c">// lock is needed until a pipeline is created to</span>
                <span class="c">// make stop() cleanly release resources.</span>
                <a href="../../P/6fffd57173d247a6.html#6fffd57173d247a6" class="t t">LocalRunspace</a> <span id="r340 rd" class="r340 r">lrs</span> = <span class="r339 r">rs</span> <b>as</b> <a href="../../P/6fffd57173d247a6.html#6fffd57173d247a6" class="t t">LocalRunspace</a>;
 
                <b>lock</b> (<a href="#0711e9b9b569dadf" class="i field">_syncObject</a>)
                {
                    <b>if</b> (<a href="#07f8bf1ea4d782aa" class="i field">_isNotActive</a>)
                    {
                        <b>return</b> <b>false</b>;
                    }
 
                    <b>if</b> (<span class="r340 r">lrs</span> != <b>null</b>)
                    {
                        <a href="LocalPipeline.cs.html#4ecb13103c10f113" class="t t">LocalPipeline</a> <span id="r341 rd" class="r341 r">localPipeline</span> = <b>new</b> <a href="LocalPipeline.cs.html#dd9341053183341d" class="t constructor">LocalPipeline</a>(
                            <span class="r340 r">lrs</span>,
                            <a href="#f40501b7b0c519bc" class="i field">_shell</a>.<a href="#7bde27452e045465" class="i property">Commands</a>.<a href="PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>,
                            (<a href="#f4f6205cf768f5a4" class="i field">_settings</a> != <b>null</b> &amp;&amp; <a href="#f4f6205cf768f5a4" class="i field">_settings</a>.<a href="#27a80b1485d6fbda" class="i property">AddToHistory</a>),
                            <a href="#f40501b7b0c519bc" class="i field">_shell</a>.<a href="#32c156c0cba25702" class="i property">IsNested</a>,
                            <a href="#45d31f3d828fea64" class="i field">_inputStream</a>,
                            <a href="#8e388229fd79c2cb" class="i field">_outputStream</a>,
                            <a href="#c45194e42e7258e4" class="i field">_errorStream</a>,
                            <a href="#f40501b7b0c519bc" class="i field">_shell</a>.<a href="#4bb26ab73ebaa6ca" class="i property">InformationalBuffers</a>);
 
                        <span class="r341 r">localPipeline</span>.<a href="pipelinebase.cs.html#d786f6d0575d2335" class="i property">IsChild</a> = <a href="#f40501b7b0c519bc" class="i field">_shell</a>.<a href="#d1ffd6dcd401bcb5" class="i property">IsChild</a>;
 
                        <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<a href="#f40501b7b0c519bc" class="i field">_shell</a>.<a href="#3b8f81dc833a1a8c" class="i property">HistoryString</a>))
                        {
                            <span class="r341 r">localPipeline</span>.<a href="LocalPipeline.cs.html#29dfb08028782add" class="i method">SetHistoryString</a>(<a href="#f40501b7b0c519bc" class="i field">_shell</a>.<a href="#3b8f81dc833a1a8c" class="i property">HistoryString</a>);
                        }
 
                        <span class="r341 r">localPipeline</span>.<a href="Pipeline.cs.html#b2ec42030f1944f4" class="i property">RedirectShellErrorOutputPipe</a> = <a href="#f40501b7b0c519bc" class="i field">_shell</a>.<a href="#1b4e6f691674a8b2" class="i property">RedirectShellErrorOutputPipe</a>;
 
                        <a href="#88b35242d849bc1e" class="i property">CurrentlyRunningPipeline</a> = <span class="r341 r">localPipeline</span>;
                        <span class="c">// register for pipeline state changed events within a lock...so that if</span>
                        <span class="c">// stop is called before invoke, we can listen to state transition and</span>
                        <span class="c">// take appropriate action.</span>
                        <a href="#88b35242d849bc1e" class="i property">CurrentlyRunningPipeline</a>.<a href="Pipeline.cs.html#c0baffefeaa75abd" class="i">StateChanged</a> += <a href="#f40501b7b0c519bc" class="i field">_shell</a>.<span class="i">PipelineStateChanged</span>;
                    }
                    <b>else</b>
                    {
                        <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#a7ba17ebc98e51be" class="i method">NewNotImplementedException</a>();
                    }
                }
 
                <span class="c">// Set pipeline specific settings</span>
                <a href="#88b35242d849bc1e" class="i property">CurrentlyRunningPipeline</a>.<a href="Pipeline.cs.html#f37827613834552d" class="i property">InvocationSettings</a> = <a href="#f4f6205cf768f5a4" class="i field">_settings</a>;
 
                <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r340 r">lrs</span> != <b>null</b>, <span class="s">&quot;LocalRunspace cannot be null here&quot;</span>);
 
                <b>if</b> (<span class="r338 r">performSyncInvoke</span>)
                {
                    <a href="#88b35242d849bc1e" class="i property">CurrentlyRunningPipeline</a>.<a href="Pipeline.cs.html#f211da0a5b795e94" class="i method">Invoke</a>();
                }
                <b>else</b>
                {
                    <a href="#88b35242d849bc1e" class="i property">CurrentlyRunningPipeline</a>.<a href="Pipeline.cs.html#fc9df3c8ea46c0e9" class="i method">InvokeAsync</a>();
                }
 
                <b>return</b> <b>true</b>;
            }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Stops the async operation.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r342 r">isSyncCall</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <b>internal void</b> <a id="594e8300c7bee072" href="../../R/594e8300c7bee072.html" target="n" data-glyph="74,2" class="i method">Stop</a>(<b>bool</b> <span id="r342 rd" class="r342 r">isSyncCall</span>)
            {
                <b>lock</b> (<a href="#0711e9b9b569dadf" class="i field">_syncObject</a>)
                {
                    <b>if</b> (<a href="#07f8bf1ea4d782aa" class="i field">_isNotActive</a>)
                    {
                        <b>return</b>;
                    }
 
                    <a href="#07f8bf1ea4d782aa" class="i field">_isNotActive</a> = <b>true</b>;
                    <b>if</b> (<a href="#88b35242d849bc1e" class="i property">CurrentlyRunningPipeline</a> != <b>null</b>)
                    {
                        <b>if</b> (<span class="r342 r">isSyncCall</span>)
                        {
                            <a href="#88b35242d849bc1e" class="i property">CurrentlyRunningPipeline</a>.<a href="Pipeline.cs.html#f53d09a89971ab39" class="i method">Stop</a>();
                        }
                        <b>else</b>
                        {
                            <a href="#88b35242d849bc1e" class="i property">CurrentlyRunningPipeline</a>.<a href="Pipeline.cs.html#112721a0ffd69637" class="i method">StopAsync</a>();
                        }
 
                        <b>return</b>;
                    }
 
                    <b>if</b> (<a href="#a7de1ad695149d22" class="i property">GetRunspaceAsyncResult</a> != <b>null</b>)
                    {
                        <a href="RunspacePool.cs.html#c1948c2f22e6b527" class="t t">RunspacePool</a> <span id="r343 rd" class="r343 r">pool</span> = <a href="#f40501b7b0c519bc" class="i field">_shell</a>.<a href="#ccb6c738e7f3c724" class="i field">_rsConnection</a> <b>as</b> <a href="RunspacePool.cs.html#c1948c2f22e6b527" class="t t">RunspacePool</a>;
                        <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r343 r">pool</span> != <b>null</b>, <span class="s">&quot;RunspaceConnection must be a runspace pool&quot;</span>);
                        <span class="r343 r">pool</span>.<a href="RunspacePool.cs.html#c229807a7d8dcdbc" class="i method">CancelGetRunspace</a>(<a href="#a7de1ad695149d22" class="i property">GetRunspaceAsyncResult</a>);
                    }
                }
 
                <span class="c">// Pipeline is not yet associated with PowerShell..so emulate stop</span>
                <span class="c">// locally</span>
                <span class="i">Queue</span>&lt;<a href="#42e325836d1ae967" class="t t">PSInvocationStateInfo</a>&gt; <span id="r344 rd" class="r344 r">events</span> = <b>new</b> <span class="i">Queue</span>&lt;<a href="#42e325836d1ae967" class="t t">PSInvocationStateInfo</a>&gt;();
                <span class="r344 r">events</span>.<span class="i">Enqueue</span>(<b>new</b> <a href="#db44bd87590c83f5" class="t constructor">PSInvocationStateInfo</a>(<a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#6a6866e7df063875" class="i field">Stopped</a>, <b>null</b>));
 
                <b>if</b> (<span class="r342 r">isSyncCall</span>)
                {
                    <a href="#f40501b7b0c519bc" class="i field">_shell</a>.<span class="i">StopHelper</span>(<span class="r344 r">events</span>);
                }
                <b>else</b>
                {
                    <span class="i">ThreadPool</span>.<span class="i">QueueUserWorkItem</span>(<b>new</b> <span class="i">WaitCallback</span>(<a href="#f40501b7b0c519bc" class="i field">_shell</a>.<span class="i">StopThreadProc</span>), <span class="r344 r">events</span>);
                }
            }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Internal clear is called when the invoke operation</span>
            <span class="c">///</span><span class="c"> is completed or failed or stopped.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>internal void</b> <a id="8eef4b09b7e255c9" href="../../R/8eef4b09b7e255c9.html" target="n" data-glyph="74,2" class="i method">InternalClearSuppressExceptions</a>()
            {
                <b>try</b>
                {
                    <b>if</b> ((<a href="#f4f6205cf768f5a4" class="i field">_settings</a> != <b>null</b>) &amp;&amp; (<a href="#f4f6205cf768f5a4" class="i field">_settings</a>.<a href="#bd693521a0dc1cee" class="i property">WindowsIdentityToImpersonate</a> != <b>null</b>))
                    {
                        <a href="#f4f6205cf768f5a4" class="i field">_settings</a>.<a href="#bd693521a0dc1cee" class="i property">WindowsIdentityToImpersonate</a>.<span class="i">Dispose</span>();
                        <a href="#f4f6205cf768f5a4" class="i field">_settings</a>.<a href="#bd693521a0dc1cee" class="i property">WindowsIdentityToImpersonate</a> = <b>null</b>;
                    }
 
                    <a href="#45d31f3d828fea64" class="i field">_inputStream</a>.<a href="../../utils/ObjectStream.cs.html#2bbebf10cbee9e83" class="i method">Close</a>();
                    <a href="#8e388229fd79c2cb" class="i field">_outputStream</a>.<a href="../../utils/ObjectStream.cs.html#2bbebf10cbee9e83" class="i method">Close</a>();
                    <a href="#c45194e42e7258e4" class="i field">_errorStream</a>.<a href="../../utils/ObjectStream.cs.html#2bbebf10cbee9e83" class="i method">Close</a>();
 
                    <b>if</b> (<a href="#88b35242d849bc1e" class="i property">CurrentlyRunningPipeline</a> == <b>null</b>)
                    {
                        <b>return</b>;
                    }
 
                    <span class="c">// Detach state changed handler so that runspace.close</span>
                    <span class="c">// and pipeline.dispose will not change powershell instances state</span>
                    <a href="#88b35242d849bc1e" class="i property">CurrentlyRunningPipeline</a>.<a href="Pipeline.cs.html#c0baffefeaa75abd" class="i">StateChanged</a> -= <a href="#f40501b7b0c519bc" class="i field">_shell</a>.<span class="i">PipelineStateChanged</span>;
 
                    <b>if</b> ((<a href="#a7de1ad695149d22" class="i property">GetRunspaceAsyncResult</a> == <b>null</b>) &amp;&amp; (<a href="#f40501b7b0c519bc" class="i field">_shell</a>.<a href="#ccb6c738e7f3c724" class="i field">_rsConnection</a> == <b>null</b>))
                    {
                        <span class="c">// user did not supply a runspace..Invoke* method created</span>
                        <span class="c">// a new runspace..so close it.</span>
                        <a href="#88b35242d849bc1e" class="i property">CurrentlyRunningPipeline</a>.<a href="Pipeline.cs.html#cefa43f64a3ac790" class="i property">Runspace</a>.<a href="Connection.cs.html#e7b6aa3b7b07847b" class="i method">Close</a>();
                    }
                    <b>else</b>
                    {
                        <a href="RunspacePool.cs.html#c1948c2f22e6b527" class="t t">RunspacePool</a> <span id="r345 rd" class="r345 r">pool</span> = <a href="#f40501b7b0c519bc" class="i field">_shell</a>.<a href="#ccb6c738e7f3c724" class="i field">_rsConnection</a> <b>as</b> <a href="RunspacePool.cs.html#c1948c2f22e6b527" class="t t">RunspacePool</a>;
                        <b>if</b> (<span class="r345 r">pool</span> != <b>null</b>)
                        {
                            <span class="r345 r">pool</span>.<a href="RunspacePool.cs.html#eb8b8375fcab8816" class="i method">ReleaseRunspace</a>(<a href="#88b35242d849bc1e" class="i property">CurrentlyRunningPipeline</a>.<a href="Pipeline.cs.html#cefa43f64a3ac790" class="i property">Runspace</a>);
                        }
                    }
 
                    <a href="#88b35242d849bc1e" class="i property">CurrentlyRunningPipeline</a>.<a href="Pipeline.cs.html#78d9f1f80ba7c462" class="i method">Dispose</a>();
                }
                <b>catch</b> (<span class="i">ArgumentException</span>)
                {
                }
                <b>catch</b> (<span class="i">InvalidOperationException</span>)
                {
                }
                <b>catch</b> (<a href="Connection.cs.html#340ccbbd1c6e8b87" class="t t">InvalidRunspaceStateException</a>)
                {
                }
                <b>catch</b> (<a href="RunspacePool.cs.html#741ffc1755303d69" class="t t">InvalidRunspacePoolStateException</a>)
                {
                }
 
                <a href="#88b35242d849bc1e" class="i property">CurrentlyRunningPipeline</a> = <b>null</b>;
            }
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">CORECLR</span> <span class="c">// PSMI Not Supported On CSS</span>
<span class="e">            internal void GetSettings(out bool addToHistory, out bool noInput, out uint apartmentState)
            {
                addToHistory = _settings.AddToHistory;
                noInput = false;
                apartmentState = (uint)_settings.ApartmentState;
            }
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Serialization / deserialization for remoting
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates a PowerShell object from a PSObject property bag.</span>
        <span class="c">///</span><span class="c"> PSObject has to be in the format returned by ToPSObjectForRemoting method.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r346 r">powerShellAsPSObject</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">PSObject to rehydrate.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> PowerShell rehydrated from a PSObject property bag</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Thrown if the PSObject is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Remoting</span>.<a href="../remoting/common/remotingexceptions.cs.html#553740d8dd522b58" class="t t">PSRemotingDataStructureException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Thrown when the PSObject is not in the expected format</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal static</b> <a href="#3d1b346df3be574c" class="t t">PowerShell</a> <a id="448b8dfbccdf0e83" href="../../R/448b8dfbccdf0e83.html" target="n" data-glyph="74,1" class="i method">FromPSObjectForRemoting</a>(<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r346 rd" class="r346 r">powerShellAsPSObject</span>)
        {
            <b>if</b> (<span class="r346 r">powerShellAsPSObject</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r346 r">powerShellAsPSObject</span>));
            }
 
            <span class="i">Collection</span>&lt;<a href="PSCommand.cs.html#b9f024f73904cf55" class="t t">PSCommand</a>&gt; <span id="r347 rd" class="r347 r">extraCommands</span> = <b>null</b>;
            <a href="../MshMemberInfo.cs.html#4dd963b2f49e6c5a" class="t t">ReadOnlyPSMemberInfoCollection</a>&lt;<a href="../MshMemberInfo.cs.html#13ab3796654e613c" class="t t">PSPropertyInfo</a>&gt; <span id="r348 rd" class="r348 r">properties</span> = <span class="r346 r">powerShellAsPSObject</span>.<a href="../MshObject.cs.html#59e9cd1ad57ccd34" class="i property">Properties</a>.<a href="../MshMemberInfo.cs.html#f1c7fd033259dd43" class="i method">Match</a>(<a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#7c9c1b0b95848ffd" class="t t">RemoteDataNameStrings</a>.<a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#cff01c012c13ef7d" class="i field">ExtraCommands</a>);
 
            <b>if</b> (<span class="r348 r">properties</span>.<a href="../MshMemberInfo.cs.html#4fcb958a2e493168" class="i property">Count</a> &gt; 0)
            {
                <span class="r347 r">extraCommands</span> = <b>new</b> <span class="i">Collection</span>&lt;<a href="PSCommand.cs.html#b9f024f73904cf55" class="t t">PSCommand</a>&gt;();
 
                <b>foreach</b> (<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r349 rd" class="r349 r">extraCommandsAsPSObject</span> <b>in</b> <a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#6f71f8c4cc2ac041" class="t t">RemotingDecoder</a>.<a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#2942ab29289f1398" class="i method">EnumerateListProperty</a>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;(<span class="r346 r">powerShellAsPSObject</span>, <a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#7c9c1b0b95848ffd" class="t t">RemoteDataNameStrings</a>.<a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#cff01c012c13ef7d" class="i field">ExtraCommands</a>))
                {
                    <a href="PSCommand.cs.html#b9f024f73904cf55" class="t t">PSCommand</a> <span id="r350 rd" class="r350 r">cmd</span> = <b>null</b>;
                    <b>foreach</b> (<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r351 rd" class="r351 r">extraCommand</span> <b>in</b> <a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#6f71f8c4cc2ac041" class="t t">RemotingDecoder</a>.<a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#2942ab29289f1398" class="i method">EnumerateListProperty</a>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;(<span class="r349 r">extraCommandsAsPSObject</span>, <a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#7c9c1b0b95848ffd" class="t t">RemoteDataNameStrings</a>.<a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#7cfc244e3694aa79" class="i field">Commands</a>))
                    {
                        <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Runspaces</span>.<a href="Command.cs.html#b55b68a3bf75e612" class="t t">Command</a> <span id="r352 rd" class="r352 r">command</span> =
                            <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Runspaces</span>.<a href="Command.cs.html#b55b68a3bf75e612" class="t t">Command</a>.<a href="Command.cs.html#2a6d58e45835343c" class="i method">FromPSObjectForRemoting</a>(<span class="r351 r">extraCommand</span>);
 
                        <b>if</b> (<span class="r350 r">cmd</span> == <b>null</b>)
                        {
                            <span class="r350 r">cmd</span> = <b>new</b> <a href="PSCommand.cs.html#630b26942ccab3f2" class="t constructor">PSCommand</a>(<span class="r352 r">command</span>);
                        }
                        <b>else</b>
                        {
                            <span class="r350 r">cmd</span>.<a href="PSCommand.cs.html#7918d4773753829d" class="i method">AddCommand</a>(<span class="r352 r">command</span>);
                        }
                    }
 
                    <span class="r347 r">extraCommands</span>.<span class="i">Add</span>(<span class="r350 r">cmd</span>);
                }
            }
 
            <a href="PSCommand.cs.html#b9f024f73904cf55" class="t t">PSCommand</a> <span id="r353 rd" class="r353 r">psCommand</span> = <b>null</b>;
            <b>foreach</b> (<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r354 rd" class="r354 r">commandAsPSObject</span> <b>in</b> <a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#6f71f8c4cc2ac041" class="t t">RemotingDecoder</a>.<a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#2942ab29289f1398" class="i method">EnumerateListProperty</a>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;(<span class="r346 r">powerShellAsPSObject</span>, <a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#7c9c1b0b95848ffd" class="t t">RemoteDataNameStrings</a>.<a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#7cfc244e3694aa79" class="i field">Commands</a>))
            {
                <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Runspaces</span>.<a href="Command.cs.html#b55b68a3bf75e612" class="t t">Command</a> <span id="r355 rd" class="r355 r">command</span> =
                    <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Runspaces</span>.<a href="Command.cs.html#b55b68a3bf75e612" class="t t">Command</a>.<a href="Command.cs.html#2a6d58e45835343c" class="i method">FromPSObjectForRemoting</a>(<span class="r354 r">commandAsPSObject</span>);
 
                <b>if</b> (<span class="r353 r">psCommand</span> == <b>null</b>)
                {
                    <span class="r353 r">psCommand</span> = <b>new</b> <a href="PSCommand.cs.html#630b26942ccab3f2" class="t constructor">PSCommand</a>(<span class="r355 r">command</span>);
                }
                <b>else</b>
                {
                    <span class="r353 r">psCommand</span>.<a href="PSCommand.cs.html#7918d4773753829d" class="i method">AddCommand</a>(<span class="r355 r">command</span>);
                }
            }
 
            <b>bool</b> <span id="r356 rd" class="r356 r">isNested</span> = <a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#6f71f8c4cc2ac041" class="t t">RemotingDecoder</a>.<a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#d3fee447c77dfb3b" class="i method">GetPropertyValue</a>&lt;<b>bool</b>&gt;(<span class="r346 r">powerShellAsPSObject</span>, <a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#7c9c1b0b95848ffd" class="t t">RemoteDataNameStrings</a>.<a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#7465424b6b7a2bc8" class="i field">IsNested</a>);
            <a href="#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r357 rd" class="r357 r">shell</span> = <a href="#3d1b346df3be574c" class="t t">PowerShell</a>.<a href="#d1f936bb6ec6fd1a" class="i method">Create</a>(<span class="r356 r">isNested</span>, <span class="r353 r">psCommand</span>, <span class="r347 r">extraCommands</span>);
            <span class="r357 r">shell</span>.<a href="#3b8f81dc833a1a8c" class="i property">HistoryString</a> = <a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#6f71f8c4cc2ac041" class="t t">RemotingDecoder</a>.<a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#d3fee447c77dfb3b" class="i method">GetPropertyValue</a>&lt;<b>string</b>&gt;(<span class="r346 r">powerShellAsPSObject</span>, <a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#7c9c1b0b95848ffd" class="t t">RemoteDataNameStrings</a>.<a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#9d2b2a010a961be0" class="i field">HistoryString</a>);
            <span class="r357 r">shell</span>.<a href="#1b4e6f691674a8b2" class="i property">RedirectShellErrorOutputPipe</a> = <a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#6f71f8c4cc2ac041" class="t t">RemotingDecoder</a>.<a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#d3fee447c77dfb3b" class="i method">GetPropertyValue</a>&lt;<b>bool</b>&gt;(<span class="r346 r">powerShellAsPSObject</span>, <a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#7c9c1b0b95848ffd" class="t t">RemoteDataNameStrings</a>.<a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#9a65ef78f9fb246d" class="i field">RedirectShellErrorOutputPipe</a>);
            <b>return</b> <span class="r357 r">shell</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns this object as a PSObject property bag</span>
        <span class="c">///</span><span class="c"> that can be used in a remoting protocol data object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">This object as a PSObject property bag.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal</b> <a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <a id="6749aa2a4e365240" href="../../R/6749aa2a4e365240.html" target="n" data-glyph="74,1" class="i method">ToPSObjectForRemoting</a>()
        {
            <a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r358 rd" class="r358 r">powerShellAsPSObject</span> = <a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#88b19073d823ce05" class="t t">RemotingEncoder</a>.<a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#22d9fb1506026254" class="i method">CreateEmptyPSObject</a>();
            <span class="i">Version</span> <span id="r359 rd" class="r359 r">psRPVersion</span> = <a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#88b19073d823ce05" class="t t">RemotingEncoder</a>.<a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#19381496af8119df" class="i method">GetPSRemotingProtocolVersion</a>(<a href="#ccb6c738e7f3c724" class="i field">_rsConnection</a> <b>as</b> <a href="RunspacePool.cs.html#c1948c2f22e6b527" class="t t">RunspacePool</a>);
 
            <span class="c">// Check if the server supports batch invocation</span>
            <b>if</b> (<a href="#4c6ee695d9a7fe71" class="i method">ServerSupportsBatchInvocation</a>())
            {
                <b>if</b> (<a href="#4cfb6cc82eb60c86" class="i property">ExtraCommands</a>.<span class="i">Count</span> &gt; 0)
                {
                    <span class="i">List</span>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r360 rd" class="r360 r">extraCommandsAsListOfPSObjects</span> = <b>new</b> <span class="i">List</span>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;(<a href="#4cfb6cc82eb60c86" class="i property">ExtraCommands</a>.<span class="i">Count</span>);
                    <b>foreach</b> (<a href="PSCommand.cs.html#b9f024f73904cf55" class="t t">PSCommand</a> <span id="r361 rd" class="r361 r">extraCommand</span> <b>in</b> <a href="#4cfb6cc82eb60c86" class="i property">ExtraCommands</a>)
                    {
                        <a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r362 rd" class="r362 r">obj</span> = <a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#88b19073d823ce05" class="t t">RemotingEncoder</a>.<a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#22d9fb1506026254" class="i method">CreateEmptyPSObject</a>();
 
                        <span class="r362 r">obj</span>.<a href="../MshObject.cs.html#59e9cd1ad57ccd34" class="i property">Properties</a>.<a href="../MshMemberInfo.cs.html#a9e3a2dc56d98237" class="i method">Add</a>(<b>new</b> <span class="t">PSNoteProperty</span>(<a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#7c9c1b0b95848ffd" class="t t">RemoteDataNameStrings</a>.<a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#7cfc244e3694aa79" class="i field">Commands</a>, <a href="#06243009e9cbc70a" class="i method">CommandsAsListOfPSObjects</a>(<span class="r361 r">extraCommand</span>.<a href="PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>, <span class="r359 r">psRPVersion</span>)));
 
                        <span class="r360 r">extraCommandsAsListOfPSObjects</span>.<span class="i">Add</span>(<span class="r362 r">obj</span>);
                    }
 
                    <span class="r358 r">powerShellAsPSObject</span>.<a href="../MshObject.cs.html#59e9cd1ad57ccd34" class="i property">Properties</a>.<a href="../MshMemberInfo.cs.html#a9e3a2dc56d98237" class="i method">Add</a>(<b>new</b> <span class="t">PSNoteProperty</span>(<a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#7c9c1b0b95848ffd" class="t t">RemoteDataNameStrings</a>.<a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#cff01c012c13ef7d" class="i field">ExtraCommands</a>, <span class="r360 r">extraCommandsAsListOfPSObjects</span>));
                }
            }
 
            <span class="i">List</span>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r363 rd" class="r363 r">commandsAsListOfPSObjects</span> = <a href="#06243009e9cbc70a" class="i method">CommandsAsListOfPSObjects</a>(<a href="#7bde27452e045465" class="i property">Commands</a>.<a href="PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>, <span class="r359 r">psRPVersion</span>);
 
            <span class="r358 r">powerShellAsPSObject</span>.<a href="../MshObject.cs.html#59e9cd1ad57ccd34" class="i property">Properties</a>.<a href="../MshMemberInfo.cs.html#a9e3a2dc56d98237" class="i method">Add</a>(<b>new</b> <span class="t">PSNoteProperty</span>(<a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#7c9c1b0b95848ffd" class="t t">RemoteDataNameStrings</a>.<a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#7cfc244e3694aa79" class="i field">Commands</a>, <span class="r363 r">commandsAsListOfPSObjects</span>));
            <span class="r358 r">powerShellAsPSObject</span>.<a href="../MshObject.cs.html#59e9cd1ad57ccd34" class="i property">Properties</a>.<a href="../MshMemberInfo.cs.html#a9e3a2dc56d98237" class="i method">Add</a>(<b>new</b> <a href="../MshMemberInfo.cs.html#f4e5bccf8ccb9f2a" class="t constructor">PSNoteProperty</a>(<a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#7c9c1b0b95848ffd" class="t t">RemoteDataNameStrings</a>.<a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#7465424b6b7a2bc8" class="i field">IsNested</a>, <a href="#3d1b346df3be574c" class="k">this</a>.<a href="#32c156c0cba25702" class="i property">IsNested</a>));
            <span class="r358 r">powerShellAsPSObject</span>.<a href="../MshObject.cs.html#59e9cd1ad57ccd34" class="i property">Properties</a>.<a href="../MshMemberInfo.cs.html#a9e3a2dc56d98237" class="i method">Add</a>(<b>new</b> <a href="../MshMemberInfo.cs.html#f4e5bccf8ccb9f2a" class="t constructor">PSNoteProperty</a>(<a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#7c9c1b0b95848ffd" class="t t">RemoteDataNameStrings</a>.<a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#9d2b2a010a961be0" class="i field">HistoryString</a>, <a href="#3b8f81dc833a1a8c" class="i property">HistoryString</a>));
            <span class="r358 r">powerShellAsPSObject</span>.<a href="../MshObject.cs.html#59e9cd1ad57ccd34" class="i property">Properties</a>.<a href="../MshMemberInfo.cs.html#a9e3a2dc56d98237" class="i method">Add</a>(<b>new</b> <a href="../MshMemberInfo.cs.html#f4e5bccf8ccb9f2a" class="t constructor">PSNoteProperty</a>(<a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#7c9c1b0b95848ffd" class="t t">RemoteDataNameStrings</a>.<a href="../remoting/common/WireDataFormat/EncodeAndDecode.cs.html#9a65ef78f9fb246d" class="i field">RedirectShellErrorOutputPipe</a>, <a href="#3d1b346df3be574c" class="k">this</a>.<a href="#1b4e6f691674a8b2" class="i property">RedirectShellErrorOutputPipe</a>));
            <b>return</b> <span class="r358 r">powerShellAsPSObject</span>;
        }
 
        <b>private static</b> <span class="i">List</span>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <a id="06243009e9cbc70a" href="../../R/06243009e9cbc70a.html" target="n" data-glyph="76,1" class="i method">CommandsAsListOfPSObjects</a>(<a href="Command.cs.html#8276f51c05ad2fa1" class="t t">CommandCollection</a> <span id="r364 rd" class="r364 r">commands</span>, <span class="i">Version</span> <span id="r365 rd" class="r365 r">psRPVersion</span>)
        {
            <span class="i">List</span>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r366 rd" class="r366 r">commandsAsListOfPSObjects</span> = <b>new</b> <span class="i">List</span>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;(<span class="r364 r">commands</span>.<span class="i">Count</span>);
            <b>foreach</b> (<a href="Command.cs.html#b55b68a3bf75e612" class="t t">Command</a> <span id="r367 rd" class="r367 r">command</span> <b>in</b> <span class="r364 r">commands</span>)
            {
                <span class="r366 r">commandsAsListOfPSObjects</span>.<span class="i">Add</span>(<span class="r367 r">command</span>.<a href="Command.cs.html#6b5e43f1f3758707" class="i method">ToPSObjectForRemoting</a>(<span class="r365 r">psRPVersion</span>));
            }
 
            <b>return</b> <span class="r366 r">commandsAsListOfPSObjects</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Remote data drain/block methods
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Suspends data arriving from remote session.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="17cbd8cde3486cb7" href="../../R/17cbd8cde3486cb7.html" target="n" data-glyph="74,1" class="i method">SuspendIncomingData</a>()
        {
            <b>if</b> (<a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <a href="../../utils/MshNotSupportedException.cs.html#d102768354b20ef7" class="t constructor">PSNotSupportedException</a>();
            }
 
            <b>if</b> (<a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a>.<a href="../remoting/client/ClientRemotePowerShell.cs.html#ed443312f1d49fb1" class="i property">DataStructureHandler</a> != <b>null</b>)
            {
                <a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a>.<a href="../remoting/client/ClientRemotePowerShell.cs.html#ed443312f1d49fb1" class="i property">DataStructureHandler</a>.<a href="../remoting/client/RemotingProtocol2.cs.html#d4654360189d8f15" class="i property">TransportManager</a>.<a href="../remoting/fanin/BaseTransportManager.cs.html#67fbcc4583ff15b5" class="i method">SuspendQueue</a>(<b>true</b>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Resumes data arriving from remote session.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="d3f59b7e5131db2a" href="../../R/d3f59b7e5131db2a.html" target="n" data-glyph="74,1" class="i method">ResumeIncomingData</a>()
        {
            <b>if</b> (<a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <a href="../../utils/MshNotSupportedException.cs.html#d102768354b20ef7" class="t constructor">PSNotSupportedException</a>();
            }
 
            <b>if</b> (<a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a>.<a href="../remoting/client/ClientRemotePowerShell.cs.html#ed443312f1d49fb1" class="i property">DataStructureHandler</a> != <b>null</b>)
            {
                <a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a>.<a href="../remoting/client/ClientRemotePowerShell.cs.html#ed443312f1d49fb1" class="i property">DataStructureHandler</a>.<a href="../remoting/client/RemotingProtocol2.cs.html#d4654360189d8f15" class="i property">TransportManager</a>.<a href="../remoting/fanin/BaseTransportManager.cs.html#1a3662753e2dd9a4" class="i method">ResumeQueue</a>();
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Blocking call that waits until the *current remote* data</span>
        <span class="c">///</span><span class="c"> queue at the transport manager is empty.  This affects only</span>
        <span class="c">///</span><span class="c"> the current queue until it is empty.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="59ba1b667dcd86e0" href="../../R/59ba1b667dcd86e0.html" target="n" data-glyph="74,1" class="i method">WaitForServicingComplete</a>()
        {
            <b>if</b> (<a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <a href="../../utils/MshNotSupportedException.cs.html#d102768354b20ef7" class="t constructor">PSNotSupportedException</a>();
            }
 
            <b>if</b> (<a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a>.<a href="../remoting/client/ClientRemotePowerShell.cs.html#ed443312f1d49fb1" class="i property">DataStructureHandler</a> != <b>null</b>)
            {
                <b>int</b> <span id="r368 rd" class="r368 r">count</span> = 0;
                <b>while</b> (++<span class="r368 r">count</span> &lt; 2 &amp;&amp;
                       <a href="#2f2a1f6f4e814646" class="i property">RemotePowerShell</a>.<a href="../remoting/client/ClientRemotePowerShell.cs.html#ed443312f1d49fb1" class="i property">DataStructureHandler</a>.<a href="../remoting/client/RemotingProtocol2.cs.html#d4654360189d8f15" class="i property">TransportManager</a>.<a href="../remoting/fanin/BaseTransportManager.cs.html#df66df4d8de1d05e" class="i property">IsServicing</a>)
                {
                    <span class="c">// Try waiting for 50 ms, then continue.</span>
                    <span class="i">Threading</span>.<span class="i">Thread</span>.<span class="i">Sleep</span>(50);
                }
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">CORECLR</span> <span class="c">// PSMI Not Supported On CSS</span>
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Win Blue Extensions
<span class="e">
        internal CimInstance AsPSPowerShellPipeline()
        {
            CimInstance c = InternalMISerializer.CreateCimInstance(&quot;PS_PowerShellPipeline&quot;);
            CimProperty instanceIdProperty = InternalMISerializer.CreateCimProperty(&quot;InstanceId&quot;,
                                                                                    this.InstanceId.ToString(),
                                                                                    Microsoft.Management.Infrastructure.CimType.String);
            c.CimInstanceProperties.Add(instanceIdProperty);
            CimProperty isNestedProperty = InternalMISerializer.CreateCimProperty(&quot;IsNested&quot;,
                                                                                  this.IsNested,
                                                                                  Microsoft.Management.Infrastructure.CimType.Boolean);
            c.CimInstanceProperties.Add(isNestedProperty);
 
            bool addToHistoryValue = false, noInputValue = false;
            uint apartmentStateValue = 0;
            if (_worker != null)
            {
                _worker.GetSettings(out addToHistoryValue, out noInputValue, out apartmentStateValue);
            }
 
            CimProperty addToHistoryProperty = InternalMISerializer.CreateCimProperty(&quot;AddToHistory&quot;,
                                                                                      addToHistoryValue,
                                                                                      Microsoft.Management.Infrastructure.CimType.Boolean);
            c.CimInstanceProperties.Add(addToHistoryProperty);
            CimProperty noInputProperty = InternalMISerializer.CreateCimProperty(&quot;NoInput&quot;,
                                                                                 noInputValue,
                                                                                 Microsoft.Management.Infrastructure.CimType.Boolean);
            c.CimInstanceProperties.Add(noInputProperty);
            CimProperty apartmentStateProperty = InternalMISerializer.CreateCimProperty(&quot;ApartmentState&quot;,
                                                                                        apartmentStateValue,
                                                                                        Microsoft.Management.Infrastructure.CimType.UInt32);
            c.CimInstanceProperties.Add(apartmentStateProperty);
 
            if (this.Commands.Commands.Count &gt; 0)
            {
                List&lt;CimInstance&gt; commandInstances = new List&lt;CimInstance&gt;();
                foreach (var command in this.Commands.Commands)
                {
                    commandInstances.Add(command.ToCimInstance());
                }
 
                CimProperty commandsProperty = InternalMISerializer.CreateCimProperty(&quot;Commands&quot;,
                                                                                      commandInstances.ToArray(),
                                                                                      Microsoft.Management.Infrastructure.CimType.ReferenceArray);
                c.CimInstanceProperties.Add(commandsProperty);
            }
 
            return c;
        }
</span>        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Win Blue Extensions
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Streams generated by PowerShell invocations.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public sealed class</b> <a id="616ac435fe95ec2a" href="../../R/616ac435fe95ec2a.html" target="n" data-glyph="0,0" class="t t">PSDataStreams</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> PSDataStreams is the public interface to access the *Buffer properties in the PowerShell class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a id="8da2a8137e63a66b" href="../../R/8da2a8137e63a66b.html" target="n" data-glyph="74,1" class="t constructor">PSDataStreams</a>(<a href="#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r369 rd" class="r369 r">powershell</span>)
        {
            <a href="#2be6e263d584752a" class="i field">_powershell</a> = <span class="r369 r">powershell</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the error buffer. Powershell invocation writes</span>
        <span class="c">///</span><span class="c"> the error data into this buffer.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Cannot set to a null value.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2864fc2d24c87a5a" class="t t">InvalidPowerShellStateException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Powershell instance cannot be changed in its</span>
        <span class="c">///</span><span class="c"> current state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Usage&quot;</span>, <span class="s">&quot;CA2227:CollectionPropertiesShouldBeReadOnly&quot;</span>, <span class="i">Justification</span> = <span class="s">&quot;We want to allow callers to change the backing store.&quot;</span>)]
        <b>public</b> <a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a>&gt; <a id="ae04a604c26c6f7d" href="../../R/ae04a604c26c6f7d.html" target="n" data-glyph="102,1" class="i property">Error</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#2be6e263d584752a" class="i field">_powershell</a>.<a href="#f93842fee257462c" class="i property">ErrorBuffer</a>;
            }
 
            <b>set</b>
            {
                <a href="#2be6e263d584752a" class="i field">_powershell</a>.<a href="#f93842fee257462c" class="i property">ErrorBuffer</a> = <b>value</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the progress buffer. Powershell invocation writes</span>
        <span class="c">///</span><span class="c"> the progress data into this buffer. Can be null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2864fc2d24c87a5a" class="t t">InvalidPowerShellStateException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Powershell instance cannot be changed in its</span>
        <span class="c">///</span><span class="c"> current state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Usage&quot;</span>, <span class="s">&quot;CA2227:CollectionPropertiesShouldBeReadOnly&quot;</span>, <span class="i">Justification</span> = <span class="s">&quot;We want to allow callers to change the backing store.&quot;</span>)]
        <b>public</b> <a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../ProgressRecord.cs.html#d79b27687c6ed8c8" class="t t">ProgressRecord</a>&gt; <a id="c29a7555dab6febc" href="../../R/c29a7555dab6febc.html" target="n" data-glyph="102,1" class="i property">Progress</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#2be6e263d584752a" class="i field">_powershell</a>.<a href="#532171848f286698" class="i property">ProgressBuffer</a>;
            }
 
            <b>set</b>
            {
                <a href="#2be6e263d584752a" class="i field">_powershell</a>.<a href="#532171848f286698" class="i property">ProgressBuffer</a> = <b>value</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the verbose buffer. Powershell invocation writes</span>
        <span class="c">///</span><span class="c"> the verbose data into this buffer.  Can be null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2864fc2d24c87a5a" class="t t">InvalidPowerShellStateException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Powershell instance cannot be changed in its</span>
        <span class="c">///</span><span class="c"> current state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Usage&quot;</span>, <span class="s">&quot;CA2227:CollectionPropertiesShouldBeReadOnly&quot;</span>, <span class="i">Justification</span> = <span class="s">&quot;We want to allow callers to change the backing store.&quot;</span>)]
        <b>public</b> <a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="InformationalRecord.cs.html#5d56339940b0040b" class="t t">VerboseRecord</a>&gt; <a id="8e878317a3e80c79" href="../../R/8e878317a3e80c79.html" target="n" data-glyph="102,1" class="i property">Verbose</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#2be6e263d584752a" class="i field">_powershell</a>.<a href="#132c72886803522e" class="i property">VerboseBuffer</a>;
            }
 
            <b>set</b>
            {
                <a href="#2be6e263d584752a" class="i field">_powershell</a>.<a href="#132c72886803522e" class="i property">VerboseBuffer</a> = <b>value</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the debug buffer. Powershell invocation writes</span>
        <span class="c">///</span><span class="c"> the debug data into this buffer.  Can be null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2864fc2d24c87a5a" class="t t">InvalidPowerShellStateException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Powershell instance cannot be changed in its</span>
        <span class="c">///</span><span class="c"> current state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Usage&quot;</span>, <span class="s">&quot;CA2227:CollectionPropertiesShouldBeReadOnly&quot;</span>, <span class="i">Justification</span> = <span class="s">&quot;We want to allow callers to change the backing store.&quot;</span>)]
        <b>public</b> <a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="InformationalRecord.cs.html#8954d4e40287d3de" class="t t">DebugRecord</a>&gt; <a id="96bfebc26e0f381d" href="../../R/96bfebc26e0f381d.html" target="n" data-glyph="102,1" class="i property">Debug</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#2be6e263d584752a" class="i field">_powershell</a>.<a href="#f3b597fa5df321ed" class="i property">DebugBuffer</a>;
            }
 
            <b>set</b>
            {
                <a href="#2be6e263d584752a" class="i field">_powershell</a>.<a href="#f3b597fa5df321ed" class="i property">DebugBuffer</a> = <b>value</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the warning buffer. Powershell invocation writes</span>
        <span class="c">///</span><span class="c"> the warning data into this buffer. Can be null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Cannot set to a null value.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2864fc2d24c87a5a" class="t t">InvalidPowerShellStateException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Powershell instance cannot be changed in its</span>
        <span class="c">///</span><span class="c"> current state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Usage&quot;</span>, <span class="s">&quot;CA2227:CollectionPropertiesShouldBeReadOnly&quot;</span>, <span class="i">Justification</span> = <span class="s">&quot;We want to allow callers to change the backing store.&quot;</span>)]
        <b>public</b> <a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="InformationalRecord.cs.html#59cd69dde48b9557" class="t t">WarningRecord</a>&gt; <a id="a0a7066f9b712955" href="../../R/a0a7066f9b712955.html" target="n" data-glyph="102,1" class="i property">Warning</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#2be6e263d584752a" class="i field">_powershell</a>.<a href="#f188cf7388929c96" class="i property">WarningBuffer</a>;
            }
 
            <b>set</b>
            {
                <a href="#2be6e263d584752a" class="i field">_powershell</a>.<a href="#f188cf7388929c96" class="i property">WarningBuffer</a> = <b>value</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the information buffer. Powershell invocation writes</span>
        <span class="c">///</span><span class="c"> the warning data into this buffer. Can be null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Cannot set to a null value.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2864fc2d24c87a5a" class="t t">InvalidPowerShellStateException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Powershell instance cannot be changed in its</span>
        <span class="c">///</span><span class="c"> current state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Usage&quot;</span>, <span class="s">&quot;CA2227:CollectionPropertiesShouldBeReadOnly&quot;</span>, <span class="i">Justification</span> = <span class="s">&quot;We want to allow callers to change the backing store.&quot;</span>)]
        <b>public</b> <a href="PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../InformationRecord.cs.html#508a9dbac37ec093" class="t t">InformationRecord</a>&gt; <a id="afec31161428f7a7" href="../../R/afec31161428f7a7.html" target="n" data-glyph="102,1" class="i property">Information</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#2be6e263d584752a" class="i field">_powershell</a>.<a href="#9d30dc57a23def37" class="i property">InformationBuffer</a>;
            }
 
            <b>set</b>
            {
                <a href="#2be6e263d584752a" class="i field">_powershell</a>.<a href="#9d30dc57a23def37" class="i property">InformationBuffer</a> = <b>value</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Removes all items from all the data streams.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public void</b> <a id="766655d89d16e5aa" href="../../R/766655d89d16e5aa.html" target="n" data-glyph="72,1" class="i method">ClearStreams</a>()
        {
            <a href="#616ac435fe95ec2a" class="k">this</a>.<a href="#ae04a604c26c6f7d" class="i property">Error</a>.<a href="PSDataCollection.cs.html#8358de7f8ecc84ec" class="i method">Clear</a>();
            <a href="#616ac435fe95ec2a" class="k">this</a>.<a href="#c29a7555dab6febc" class="i property">Progress</a>.<a href="PSDataCollection.cs.html#8358de7f8ecc84ec" class="i method">Clear</a>();
            <a href="#616ac435fe95ec2a" class="k">this</a>.<a href="#8e878317a3e80c79" class="i property">Verbose</a>.<a href="PSDataCollection.cs.html#8358de7f8ecc84ec" class="i method">Clear</a>();
            <a href="#616ac435fe95ec2a" class="k">this</a>.<a href="#afec31161428f7a7" class="i property">Information</a>.<a href="PSDataCollection.cs.html#8358de7f8ecc84ec" class="i method">Clear</a>();
            <a href="#616ac435fe95ec2a" class="k">this</a>.<a href="#96bfebc26e0f381d" class="i property">Debug</a>.<a href="PSDataCollection.cs.html#8358de7f8ecc84ec" class="i method">Clear</a>();
            <a href="#616ac435fe95ec2a" class="k">this</a>.<a href="#a0a7066f9b712955" class="i property">Warning</a>.<a href="PSDataCollection.cs.html#8358de7f8ecc84ec" class="i method">Clear</a>();
        }
 
        <b>private readonly</b> <a href="#3d1b346df3be574c" class="t t">PowerShell</a> <a id="2be6e263d584752a" href="../../R/2be6e263d584752a.html" target="n" data-glyph="46,1" class="i field">_powershell</a>;
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Helper class for making sure Ctrl-C stops an active powershell invocation.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">example</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c">     powerShell = PowerShell.Create();</span>
    <span class="c">///</span><span class="c">     powerShell.AddCommand(&quot;Start-Sleep&quot;);</span>
    <span class="c">///</span><span class="c">     powerShell.AddParameter(&quot;Seconds&quot;, 10);</span>
    <span class="c">///</span><span class="c">     powerShell.Runspace = remoteRunspace;</span>
    <span class="c">///</span><span class="c">     Collection</span><span class="c">&amp;lt;</span><span class="c">PSObject</span><span class="c">&amp;gt;</span><span class="c"> result;</span>
    <span class="c">///</span><span class="c">     using (new PowerShellStopper(context, powerShell))</span>
    <span class="c">///</span><span class="c">     {</span>
    <span class="c">///</span><span class="c">         result = powerShell.Invoke();</span>
    <span class="c">///</span><span class="c">     }</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">example</span><span class="c">&gt;</span>
    <b>internal class</b> <a id="574793a3a39ecbf3" href="../../R/574793a3a39ecbf3.html" target="n" data-glyph="2,0" class="t t">PowerShellStopper</a> : <span class="i">IDisposable</span>
    {
        <b>private readonly</b> <a href="pipelinebase.cs.html#5ad91ced3ee4f37f" class="t t">PipelineBase</a> <a id="ff60e501a9b812d9" href="../../R/ff60e501a9b812d9.html" target="n" data-glyph="46,1" class="i field">_pipeline</a>;
        <b>private readonly</b> <a href="#3d1b346df3be574c" class="t t">PowerShell</a> <a id="f9e076f48e0933c5" href="../../R/f9e076f48e0933c5.html" target="n" data-glyph="46,1" class="i field">_powerShell</a>;
        <b>private</b> <span class="i">EventHandler</span>&lt;<a href="Pipeline.cs.html#f088a79047187694" class="t t">PipelineStateEventArgs</a>&gt; <a id="133304bcbc4d9058" href="../../R/133304bcbc4d9058.html" target="n" data-glyph="46,1" class="i field">_eventHandler</a>;
 
        <b>internal</b> <a id="8f085622ea52cfb5" href="../../R/8f085622ea52cfb5.html" target="n" data-glyph="74,1" class="t constructor">PowerShellStopper</a>(<a href="../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r370 rd" class="r370 r">context</span>, <a href="#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r371 rd" class="r371 r">powerShell</span>)
        {
            <b>if</b> (<span class="r370 r">context</span> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r370 r">context</span>));
            }
 
            <b>if</b> (<span class="r371 r">powerShell</span> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r371 r">powerShell</span>));
            }
 
            <a href="#f9e076f48e0933c5" class="i field">_powerShell</a> = <span class="r371 r">powerShell</span>;
 
            <b>if</b> ((<span class="r370 r">context</span>.<a href="../ExecutionContext.cs.html#1146573afe2845c8" class="i property">CurrentCommandProcessor</a> != <b>null</b>) &amp;&amp;
                (<span class="r370 r">context</span>.<a href="../ExecutionContext.cs.html#1146573afe2845c8" class="i property">CurrentCommandProcessor</a>.<a href="../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a> != <b>null</b>) &amp;&amp;
                (<span class="r370 r">context</span>.<a href="../ExecutionContext.cs.html#1146573afe2845c8" class="i property">CurrentCommandProcessor</a>.<a href="../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../MshCommandRuntime.cs.html#895cb9f77d1d9539" class="i property">PipelineProcessor</a> != <b>null</b>) &amp;&amp;
                (<span class="r370 r">context</span>.<a href="../ExecutionContext.cs.html#1146573afe2845c8" class="i property">CurrentCommandProcessor</a>.<a href="../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../MshCommandRuntime.cs.html#895cb9f77d1d9539" class="i property">PipelineProcessor</a>.<a href="../pipeline.cs.html#3569b3e63d4a06f7" class="i property">LocalPipeline</a> != <b>null</b>))
            {
                <a href="#133304bcbc4d9058" class="i field">_eventHandler</a> = <b>new</b> <span class="i">EventHandler</span>&lt;<a href="Pipeline.cs.html#f088a79047187694" class="t t">PipelineStateEventArgs</a>&gt;(<span class="i">LocalPipeline_StateChanged</span>);
                <a href="#ff60e501a9b812d9" class="i field">_pipeline</a> = <span class="r370 r">context</span>.<a href="../ExecutionContext.cs.html#1146573afe2845c8" class="i property">CurrentCommandProcessor</a>.<a href="../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../MshCommandRuntime.cs.html#895cb9f77d1d9539" class="i property">PipelineProcessor</a>.<a href="../pipeline.cs.html#3569b3e63d4a06f7" class="i property">LocalPipeline</a>;
                <a href="#ff60e501a9b812d9" class="i field">_pipeline</a>.<a href="pipelinebase.cs.html#e04ac3468ab51683" class="i">StateChanged</a> += <a href="#133304bcbc4d9058" class="i field">_eventHandler</a>;
            }
        }
 
        <b>private void</b> <a id="7988263fd468c19a" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">LocalPipeline_StateChanged</a>(<b>object</b> <span id="r372 rd" class="r372 r">sender</span>, <a href="Pipeline.cs.html#f088a79047187694" class="t t">PipelineStateEventArgs</a> <span id="r373 rd" class="r373 r">e</span>)
        {
            <b>if</b> ((<span class="r373 r">e</span>.<a href="Pipeline.cs.html#90fde3748e993197" class="i property">PipelineStateInfo</a>.<a href="Pipeline.cs.html#2589f8c7203969a0" class="i property">State</a> == <a href="Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="Pipeline.cs.html#17a7706ccaf63f5c" class="i field">Stopping</a>) &amp;&amp;
                (<a href="#f9e076f48e0933c5" class="i field">_powerShell</a>.<a href="#39b81acd3aeb1582" class="i property">InvocationStateInfo</a>.<a href="#7a70ff5163d0f044" class="i property">State</a> == <a href="#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="#7142407e9e49cf13" class="i field">Running</a>))
            {
                <a href="#f9e076f48e0933c5" class="i field">_powerShell</a>.<a href="#417fd1f64732b2ef" class="i method">Stop</a>();
            }
        }
 
        <b>private bool</b> <a id="f4ade4b9507b3455" href="../../R/f4ade4b9507b3455.html" target="n" data-glyph="46,1" class="i field">_isDisposed</a>;
 
        <b>public void</b> <a id="d3a966e79b241466" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Dispose</a>()
        {
            <b>if</b> (!<a href="#f4ade4b9507b3455" class="i field">_isDisposed</a>)
            {
                <b>if</b> (<a href="#133304bcbc4d9058" class="i field">_eventHandler</a> != <b>null</b>)
                {
                    <a href="#ff60e501a9b812d9" class="i field">_pipeline</a>.<a href="pipelinebase.cs.html#e04ac3468ab51683" class="i">StateChanged</a> -= <a href="#133304bcbc4d9058" class="i field">_eventHandler</a>;
                    <a href="#133304bcbc4d9058" class="i field">_eventHandler</a> = <b>null</b>;
                }
 
                <span class="i">GC</span>.<span class="i">SuppressFinalize</span>(<a href="#574793a3a39ecbf3" class="k">this</a>);
                <a href="#f4ade4b9507b3455" class="i field">_isDisposed</a> = <b>true</b>;
            }
        }
    }
}
</pre></td></tr></table></div></body></html>
