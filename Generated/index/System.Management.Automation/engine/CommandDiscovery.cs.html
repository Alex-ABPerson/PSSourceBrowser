<!DOCTYPE html>
<html><head><title>CommandDiscovery.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(1736);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#System.Management.Automation/engine/CommandDiscovery.cs" target="_top">engine\CommandDiscovery.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#System.Management.Automation" target="_top">src\System.Management.Automation\System.Management.Automation.csproj</a> (System.Management.Automation)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">ObjectModel</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>.<span class="i">Tracing</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Globalization</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Host</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Internal</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Runspaces</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Security</span>;
 
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Commands</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i">Win32</span>;
 
<b>using</b> <span class="t">Dbg</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>;
 
<b>namespace</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> EventArgs for the ScriptCmdletVariableUpdate event.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public class</b> <a id="1d8153247a726d6e" href="../R/1d8153247a726d6e.html" target="n" data-glyph="0,0" class="t t">CommandLookupEventArgs</a> : <span class="i">EventArgs</span>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Constructor for event args object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">commandName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name of the command we&#39;re searching for.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">commandOrigin</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The origin of the command internal or runspace (external).</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r2 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The execution context for this command.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal</b> <a id="80e896049498247c" href="../R/80e896049498247c.html" target="n" data-glyph="74,1" class="t constructor">CommandLookupEventArgs</a>(<b>string</b> <span id="r0 rd" class="r0 r">commandName</span>, <a href="SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a> <span id="r1 rd" class="r1 r">commandOrigin</span>, <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r2 rd" class="r2 r">context</span>)
        {
            <a href="#422894760c0c9e7b" class="i property">CommandName</a> = <span class="r0 r">commandName</span>;
            <a href="#7bf947ec1fece5b1" class="i property">CommandOrigin</a> = <span class="r1 r">commandOrigin</span>;
            <a href="#bb0aacc5e61a9a6a" class="i field">_context</a> = <span class="r2 r">context</span>;
        }
 
        <b>private readonly</b> <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <a id="bb0aacc5e61a9a6a" href="../R/bb0aacc5e61a9a6a.html" target="n" data-glyph="46,1" class="i field">_context</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The name of the command we&#39;re looking for.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public string</b> <a id="422894760c0c9e7b" href="../R/422894760c0c9e7b.html" target="n" data-glyph="102,1" class="i property">CommandName</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The origin of the command internal or runspace (external)</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public</b> <a href="SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a> <a id="7bf947ec1fece5b1" href="../R/7bf947ec1fece5b1.html" target="n" data-glyph="102,1" class="i property">CommandOrigin</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If true on return from event handler, the search is stopped.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public bool</b> <a id="55ca4fe32b11f7c7" href="../R/55ca4fe32b11f7c7.html" target="n" data-glyph="102,1" class="i property">StopSearch</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The CommandInfo obejct for the command that was found.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public</b> <a href="CommandInfo.cs.html#71babe57a99ca852" class="t t">CommandInfo</a> <a id="83c03f663ddc1dcf" href="../R/83c03f663ddc1dcf.html" target="n" data-glyph="102,1" class="i property">Command</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Scriptblock to be returned as the found command. If it is set to</span>
        <span class="c">///</span><span class="c"> null, then the command to return and the StopSearch flag will be reset.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public</b> <a href="../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a> <a id="ed7e3ba3402bfe32" href="../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">CommandScriptBlock</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#ac0b5a4107378f3b" class="i field">_scriptBlock</a>;
            }
 
            <b>set</b>
            {
                <a href="#ac0b5a4107378f3b" class="i field">_scriptBlock</a> = <b>value</b>;
                <b>if</b> (<a href="#ac0b5a4107378f3b" class="i field">_scriptBlock</a> != <b>null</b>)
                {
                    <b>string</b> <span id="r3 rd" class="r3 r">dynamicName</span> = <span class="s">&quot;LookupHandlerReplacementFor&lt;&lt;&quot;</span> + <a href="#422894760c0c9e7b" class="i property">CommandName</a> + <span class="s">&quot;&gt;&gt;&quot;</span>;
                    <a href="#83c03f663ddc1dcf" class="i property">Command</a> = <b>new</b> <a href="FunctionInfo.cs.html#daf907e5a42ad149" class="t constructor">FunctionInfo</a>(<span class="r3 r">dynamicName</span>, <a href="#ac0b5a4107378f3b" class="i field">_scriptBlock</a>, <a href="#bb0aacc5e61a9a6a" class="i field">_context</a>);
                    <a href="#55ca4fe32b11f7c7" class="i property">StopSearch</a> = <b>true</b>;
                }
                <b>else</b>
                {
                    <a href="#83c03f663ddc1dcf" class="i property">Command</a> = <b>null</b>;
                    <a href="#55ca4fe32b11f7c7" class="i property">StopSearch</a> = <b>false</b>;
                }
            }
        }
 
        <b>private</b> <a href="../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a> <a id="ac0b5a4107378f3b" href="../R/ac0b5a4107378f3b.html" target="n" data-glyph="46,1" class="i field">_scriptBlock</a>;
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Defines the preference options for the Module Auto-loading feature.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public enum</b> <a id="c476355d983131b8" href="../R/c476355d983131b8.html" target="n" data-glyph="18,0" class="t t"><span id="aff0fd7670136aaa">PSModuleAutoLoadingPreference</span></a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Do not auto-load modules when a command is not found.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="8d4577abcb2c6b36" href="../R/8d4577abcb2c6b36.html" target="n" data-glyph="24,1" class="i field">None</a> = 0,
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Only auto-load modules when a command is not found, and the command</span>
        <span class="c">///</span><span class="c"> is module-qualified.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="7893adf7c5140926" href="../R/../../0000000000.html" target="n" data-glyph="24,1" class="i field">ModuleQualified</a> = 1,
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Auto-load modules when a command is not found.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="24f5e6dfa3261542" href="../R/24f5e6dfa3261542.html" target="n" data-glyph="24,1" class="i field">All</a> = 2
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> CommandDiscovery...</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal class</b> <a id="04905efdf0510fc2" href="../R/04905efdf0510fc2.html" target="n" data-glyph="2,0" class="t t">CommandDiscovery</a>
    {
        [<span class="i">TraceSource</span>(<span class="s">&quot;CommandDiscovery&quot;</span>, <span class="s">&quot;Traces the discovery of cmdlets, scripts, functions, applications, etc.&quot;</span>)]
        <b>internal static readonly</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a> <a id="5d9833e2519bb80f" href="../R/5d9833e2519bb80f.html" target="n" data-glyph="44,1" class="i field">discoveryTracer</a> =
            <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#24b0f68d5add3eb3" class="i method">GetTracer</a>(
                <span class="s">&quot;CommandDiscovery&quot;</span>,
                <span class="s">&quot;Traces the discovery of cmdlets, scripts, functions, applications, etc.&quot;</span>,
                <b>false</b>);
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> ctor
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Default constructor...</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r4 r">context</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal</b> <a id="d2cd2dd9e2cb82f4" href="../R/d2cd2dd9e2cb82f4.html" target="n" data-glyph="74,1" class="t constructor">CommandDiscovery</a>(<a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r4 rd" class="r4 r">context</span>)
        {
            <b>if</b> (<span class="r4 r">context</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r4 r">context</span>));
            }
 
            <a href="#b927e58b8d40bcae" class="i property">Context</a> = <span class="r4 r">context</span>;
            <a href="#5d9833e2519bb80f" class="i field">discoveryTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#3505964c91d1d5ab" class="i property">ShowHeaders</a> = <b>false</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Determines if the cmdlet is a cmdlet that shouldn&#39;t be in the discovery list.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r5 r">implementingType</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Type implementing the cmdlet</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> True if the cmdlet is a special cmdlet that shouldn&#39;t be part of the discovery list. Or false otherwise.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static bool</b> <a id="578fe2126720caec" href="../R/578fe2126720caec.html" target="n" data-glyph="76,1" class="i method">IsSpecialCmdlet</a>(<span class="i">Type</span> <span id="r5 rd" class="r5 r">implementingType</span>)
        {
            <span class="c">// These commands should never be put in the discovery list.  They are an internal implementation</span>
            <span class="c">// detail of the formatting and output component. That component uses these cmdlets by creating</span>
            <span class="c">// an instance of the CommandProcessor class directly.</span>
            <b>return</b> <span class="r5 r">implementingType</span> == <b>typeof</b>(<a href="../FormatAndOutput/out-textInterface/OutTextInterface.cs.html#ce8aef1b36e49159" class="t t">OutLineOutputCommand</a>) || <span class="r5 r">implementingType</span> == <b>typeof</b>(<a href="../FormatAndOutput/format-default/format-default.cs.html#ca2f64f1f70e29ba" class="t t">FormatDefaultCommand</a>);
        }
 
        <b>private</b> <a href="CmdletInfo.cs.html#9492ffc9968f644d" class="t t">CmdletInfo</a> <a id="4af36cdfe3157ee9" href="../R/4af36cdfe3157ee9.html" target="n" data-glyph="76,1" class="i method">NewCmdletInfo</a>(<a href="InitialSessionState.cs.html#0b9bc88597e005fb" class="t t">SessionStateCmdletEntry</a> <span id="r6 rd" class="r6 r">entry</span>)
        {
            <b>return</b> <a href="#066a9e2e665e4d8d" class="i method">NewCmdletInfo</a>(<span class="r6 r">entry</span>, <a href="#b927e58b8d40bcae" class="i property">Context</a>);
        }
 
        <b>internal static</b> <a href="CmdletInfo.cs.html#9492ffc9968f644d" class="t t">CmdletInfo</a> <a id="066a9e2e665e4d8d" href="../R/066a9e2e665e4d8d.html" target="n" data-glyph="74,1" class="i method">NewCmdletInfo</a>(<a href="InitialSessionState.cs.html#0b9bc88597e005fb" class="t t">SessionStateCmdletEntry</a> <span id="r7 rd" class="r7 r">entry</span>, <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r8 rd" class="r8 r">context</span>)
        {
            <a href="CmdletInfo.cs.html#9492ffc9968f644d" class="t t">CmdletInfo</a> <span id="r9 rd" class="r9 r">ci</span> = <b>new</b> <a href="CmdletInfo.cs.html#cdd24b9416013a7d" class="t constructor">CmdletInfo</a>(<span class="r7 r">entry</span>.<a href="InitialSessionState.cs.html#c5f3f5b848ea98cd" class="i property">Name</a>, <span class="r7 r">entry</span>.<a href="InitialSessionState.cs.html#41fc8f2889edf406" class="i property">ImplementingType</a>, <span class="r7 r">entry</span>.<a href="InitialSessionState.cs.html#42aafda58947f789" class="i property">HelpFileName</a>, <span class="r7 r">entry</span>.<a href="InitialSessionState.cs.html#a63d54bd9a0897a7" class="i property">PSSnapIn</a>, <span class="r8 r">context</span>)
            {
                <a href="CommandInfo.cs.html#cb0c02415aeca7d5" class="i property">Visibility</a> = <span class="r7 r">entry</span>.<a href="InitialSessionState.cs.html#190a59133ab9a4ce" class="i property">Visibility</a>,
                <a href="CommandInfo.cs.html#600591313a158d6c" class="i property">Module</a> = <span class="r7 r">entry</span>.<a href="InitialSessionState.cs.html#a3328f1f3a3a9605" class="i property">Module</a>
            };
            <b>return</b> <span class="r9 r">ci</span>;
        }
 
        <b>internal static</b> <a href="AliasInfo.cs.html#cf27095b0a2fb6ea" class="t t">AliasInfo</a> <a id="bc7243ca043d311c" href="../R/bc7243ca043d311c.html" target="n" data-glyph="74,1" class="i method">NewAliasInfo</a>(<a href="InitialSessionState.cs.html#3164e16488ced1ed" class="t t">SessionStateAliasEntry</a> <span id="r10 rd" class="r10 r">entry</span>, <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r11 rd" class="r11 r">context</span>)
        {
            <a href="AliasInfo.cs.html#cf27095b0a2fb6ea" class="t t">AliasInfo</a> <span id="r12 rd" class="r12 r">ci</span> = <b>new</b> <a href="AliasInfo.cs.html#908ec52506619a99" class="t constructor">AliasInfo</a>(<span class="r10 r">entry</span>.<a href="InitialSessionState.cs.html#c5f3f5b848ea98cd" class="i property">Name</a>, <span class="r10 r">entry</span>.<a href="InitialSessionState.cs.html#297512f106ee62c3" class="i property">Definition</a>, <span class="r11 r">context</span>, <span class="r10 r">entry</span>.<a href="InitialSessionState.cs.html#a42733e1fa40471e" class="i property">Options</a>)
            {
                <a href="CommandInfo.cs.html#cb0c02415aeca7d5" class="i property">Visibility</a> = <span class="r10 r">entry</span>.<a href="InitialSessionState.cs.html#190a59133ab9a4ce" class="i property">Visibility</a>,
                <a href="CommandInfo.cs.html#600591313a158d6c" class="i property">Module</a> = <span class="r10 r">entry</span>.<a href="InitialSessionState.cs.html#a3328f1f3a3a9605" class="i property">Module</a>
            };
            <b>return</b> <span class="r12 r">ci</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Adds the CmdletInfo to the cmdlet cache in the current scope object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r13 r">name</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The name of the cmdlet to add.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r14 r">newCmdletInfo</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The CmdletInfo to add.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r15 r">isGlobal</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If true, the cmdlet is added to the Module Scope of the session state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/MshNotSupportedException.cs.html#55e79fbd51d0f1cb" class="t t">PSNotSupportedException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If a cmdlet with the same module and cmdlet name already exists</span>
        <span class="c">///</span><span class="c"> but has a different implementing type.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal</b> <a href="CmdletInfo.cs.html#9492ffc9968f644d" class="t t">CmdletInfo</a> <a id="9a96ec9d6b05a280" href="../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">AddCmdletInfoToCache</a>(<b>string</b> <span id="r13 rd" class="r13 r">name</span>, <a href="CmdletInfo.cs.html#9492ffc9968f644d" class="t t">CmdletInfo</a> <span id="r14 rd" class="r14 r">newCmdletInfo</span>, <b>bool</b> <span id="r15 rd" class="r15 r">isGlobal</span>)
        {
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r13 r">name</span>))
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fed5f40dc0075d41" class="i method">NewArgumentException</a>(<b>nameof</b>(<span class="r13 r">name</span>));
            }
 
            <b>if</b> (<span class="r14 r">newCmdletInfo</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<span class="s">&quot;cmdlet&quot;</span>);
            }
 
            <b>if</b> (<span class="r15 r">isGlobal</span>)
            {
                <span class="c">// When cmdlet cache was not scope-based, we used to import cmdlets to the module scope.</span>
                <span class="c">// We need to do the same as the default action (setting &quot;isGlobal&quot; is done as a default action in the caller)</span>
                <b>return</b> <a href="#b927e58b8d40bcae" class="i property">Context</a>.<a href="ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="SessionStateScopeAPIs.cs.html#59eeece84e54dc1f" class="i property">ModuleScope</a>.<a href="SessionStateScope.cs.html#3878bfdb52dbb931" class="i method">AddCmdletToCache</a>(<span class="r14 r">newCmdletInfo</span>.<a href="CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>, <span class="r14 r">newCmdletInfo</span>, <a href="SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a>.<a href="SecurityManagerBase.cs.html#946d8e7ca02acec6" class="i field">Internal</a>, <a href="#b927e58b8d40bcae" class="i property">Context</a>);
            }
 
            <b>return</b> <a href="#b927e58b8d40bcae" class="i property">Context</a>.<a href="ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="SessionStateScopeAPIs.cs.html#224987ad36a90f88" class="i property">CurrentScope</a>.<a href="SessionStateScope.cs.html#3878bfdb52dbb931" class="i method">AddCmdletToCache</a>(<span class="r14 r">newCmdletInfo</span>.<a href="CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>, <span class="r14 r">newCmdletInfo</span>, <a href="SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a>.<a href="SecurityManagerBase.cs.html#946d8e7ca02acec6" class="i field">Internal</a>, <a href="#b927e58b8d40bcae" class="i property">Context</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Add a SessionStateCmdletEntry to the cmdlet cache...</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r16 r">entry</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="4af8294a7b42893b" href="../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">AddSessionStateCmdletEntryToCache</a>(<a href="InitialSessionState.cs.html#0b9bc88597e005fb" class="t t">SessionStateCmdletEntry</a> <span id="r16 rd" class="r16 r">entry</span>)
        {
            <a href="#6036be498f5847c6" class="i method">AddSessionStateCmdletEntryToCache</a>(<span class="r16 r">entry</span>, <span class="c">/*local*/</span><b>false</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Add a SessionStateCmdletEntry to the cmdlet cache...</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r17 r">entry</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r18 r">local</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="6036be498f5847c6" href="../R/6036be498f5847c6.html" target="n" data-glyph="74,1" class="i method">AddSessionStateCmdletEntryToCache</a>(<a href="InitialSessionState.cs.html#0b9bc88597e005fb" class="t t">SessionStateCmdletEntry</a> <span id="r17 rd" class="r17 r">entry</span>, <b>bool</b> <span id="r18 rd" class="r18 r">local</span>)
        {
            <b>if</b> (!<a href="#578fe2126720caec" class="i method">IsSpecialCmdlet</a>(<span class="r17 r">entry</span>.<a href="InitialSessionState.cs.html#41fc8f2889edf406" class="i property">ImplementingType</a>))
            {
                <a href="CmdletInfo.cs.html#9492ffc9968f644d" class="t t">CmdletInfo</a> <span id="r19 rd" class="r19 r">nci</span> = <a href="#4af36cdfe3157ee9" class="i method">NewCmdletInfo</a>(<span class="r17 r">entry</span>);
                <span class="i">AddCmdletInfoToCache</span>(<span class="r19 r">nci</span>.<a href="CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>, <span class="r19 r">nci</span>, !<span class="r18 r">local</span>);
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> ctor
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> internal methods
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Look up a command named by the argument string and return its CommandProcessorBase.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r20 r">commandName</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The command name to lookup.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r21 r">commandOrigin</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Location where the command was dispatched from.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r22 r">useLocalScope</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> True if command processor should use local scope to execute the command,</span>
        <span class="c">///</span><span class="c"> False if not.  Null if command discovery should default to something reasonable</span>
        <span class="c">///</span><span class="c"> for the command discovered.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/CommandDiscoveryExceptions.cs.html#d61739861b769224" class="t t">CommandNotFoundException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the command, </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r20 r">commandName</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">, could not be found.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the security manager is preventing the command from running.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal</b> <a href="CommandProcessorBase.cs.html#45a6054a3775cde6" class="t t">CommandProcessorBase</a> <a id="4d2a4c32a47c20f6" href="../R/4d2a4c32a47c20f6.html" target="n" data-glyph="74,1" class="i method">LookupCommandProcessor</a>(<b>string</b> <span id="r20 rd" class="r20 r">commandName</span>,
            <a href="SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a> <span id="r21 rd" class="r21 r">commandOrigin</span>, <b>bool</b>? <span id="r22 rd" class="r22 r">useLocalScope</span>)
        {
            <a href="CommandProcessorBase.cs.html#45a6054a3775cde6" class="t t">CommandProcessorBase</a> <span id="r23 rd" class="r23 r">processor</span> = <b>null</b>;
            <a href="CommandInfo.cs.html#71babe57a99ca852" class="t t">CommandInfo</a> <span id="r24 rd" class="r24 r">commandInfo</span> = <a href="#11f70d945389a48b" class="i method">LookupCommandInfo</a>(<span class="r20 r">commandName</span>, <span class="r21 r">commandOrigin</span>);
 
            <b>if</b> (<span class="r24 r">commandInfo</span> != <b>null</b>)
            {
                <span class="r23 r">processor</span> = <a href="#677e20c74f6dea43" class="i method">LookupCommandProcessor</a>(<span class="r24 r">commandInfo</span>, <span class="r21 r">commandOrigin</span>, <span class="r22 r">useLocalScope</span>, <b>null</b>);
                <span class="c">// commandInfo.Name might be different than commandName - restore the original invocation name</span>
                <span class="r23 r">processor</span>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#f81679c755698e2e" class="i property">MyInvocation</a>.<a href="InvocationInfo.cs.html#57f452abf157b50b" class="i property">InvocationName</a> = <span class="r20 r">commandName</span>;
            }
 
            <b>return</b> <span class="r23 r">processor</span>;
        }
 
        <b>internal static void</b> <a id="0c902bb77f49e327" href="../R/0c902bb77f49e327.html" target="n" data-glyph="74,1" class="i method">VerifyRequiredModules</a>(<a href="ExternalScriptInfo.cs.html#7806ac40f903221c" class="t t">ExternalScriptInfo</a> <span id="r25 rd" class="r25 r">scriptInfo</span>, <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r26 rd" class="r26 r">context</span>)
        {
            <span class="c">// Check Required Modules</span>
            <b>if</b> (<span class="r25 r">scriptInfo</span>.<a href="ExternalScriptInfo.cs.html#c45f2bbf490cc26b" class="i property">RequiresModules</a> != <b>null</b>)
            {
                <b>foreach</b> (<b>var</b> <span id="r27 rd" class="r27 r">requiredModule</span> <b>in</b> <span class="r25 r">scriptInfo</span>.<a href="ExternalScriptInfo.cs.html#c45f2bbf490cc26b" class="i property">RequiresModules</a>)
                {
                    <a href="ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r28 rd" class="r28 r">error</span> = <b>null</b>;
                    <a href="Modules/ModuleCmdletBase.cs.html#0479f5f00c7dafc1" class="t t">ModuleCmdletBase</a>.<span class="i">LoadRequiredModule</span>(
                        <span class="i">context</span>: <span class="r26 r">context</span>,
                        <span class="i">currentModule</span>: <b>null</b>,
                        <span class="i">requiredModuleSpecification</span>: <span class="r27 r">requiredModule</span>,
                        <span class="i">moduleManifestPath</span>: <b>null</b>,
                        <span class="i">manifestProcessingFlags</span>: <a href="Modules/ModuleCmdletBase.cs.html#0479f5f00c7dafc1" class="t t">ModuleCmdletBase</a>.<a href="Modules/ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="Modules/ModuleCmdletBase.cs.html#4195724a6acb2c06" class="i field">LoadElements</a> | <a href="Modules/ModuleCmdletBase.cs.html#0479f5f00c7dafc1" class="t t">ModuleCmdletBase</a>.<a href="Modules/ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="Modules/ModuleCmdletBase.cs.html#493fa52eb1605135" class="i field">WriteErrors</a>,
                        <span class="i">error</span>: <b>out</b> <span class="r28 r">error</span>);
                    <b>if</b> (<span class="r28 r">error</span> != <b>null</b>)
                    {
                        <a href="../utils/CommandDiscoveryExceptions.cs.html#bc1285da7138b9bd" class="t t">ScriptRequiresException</a> <span id="r29 rd" class="r29 r">scriptRequiresException</span> =
                            <b>new</b> <a href="../utils/CommandDiscoveryExceptions.cs.html#f11e194116041c51" class="t constructor">ScriptRequiresException</a>(
                                <span class="r25 r">scriptInfo</span>.<a href="CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>,
                                <b>new</b> <span class="i">Collection</span>&lt;<b>string</b>&gt; { <span class="r27 r">requiredModule</span>.<span class="i">Name</span> },
                                <span class="s">&quot;ScriptRequiresMissingModules&quot;</span>,
                                <b>false</b>,
                                <span class="r28 r">error</span>);
                        <b>throw</b> <span class="r29 r">scriptRequiresException</span>;
                    }
                }
            }
        }
 
        <b>private static</b> <span class="i">Collection</span>&lt;<b>string</b>&gt; <a id="690ca90703a684ce" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">GetPSSnapinNames</a>(<span class="i">IEnumerable</span>&lt;<a href="ExternalScriptInfo.cs.html#b11a97aaaf8c5e31" class="t t">PSSnapInSpecification</a>&gt; <span id="r30 rd" class="r30 r">PSSnapins</span>)
        {
            <span class="i">Collection</span>&lt;<b>string</b>&gt; <span id="r31 rd" class="r31 r">result</span> = <b>new</b> <span class="i">Collection</span>&lt;<b>string</b>&gt;();
 
            <b>foreach</b> (<b>var</b> <span id="r32 rd" class="r32 r">PSSnapin</span> <b>in</b> <span class="r30 r">PSSnapins</span>)
            {
                <span class="r31 r">result</span>.<span class="i">Add</span>(<span class="i">BuildPSSnapInDisplayName</span>(<span class="r32 r">PSSnapin</span>));
            }
 
            <b>return</b> <span class="r31 r">result</span>;
        }
 
        <b>private</b> <a href="CommandProcessorBase.cs.html#45a6054a3775cde6" class="t t">CommandProcessorBase</a> <a id="e454bf1d5fb646f0" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">CreateScriptProcessorForSingleShell</a>(<a href="ExternalScriptInfo.cs.html#7806ac40f903221c" class="t t">ExternalScriptInfo</a> <span id="r33 rd" class="r33 r">scriptInfo</span>, <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r34 rd" class="r34 r">context</span>, <b>bool</b> <span id="r35 rd" class="r35 r">useLocalScope</span>, <a href="../P/2dc1bd90a8299178.html#2dc1bd90a8299178" class="t t">SessionStateInternal</a> <span id="r36 rd" class="r36 r">sessionState</span>)
        {
            <a href="#cc68f1bbdab748e2" class="i method">VerifyScriptRequirements</a>(<span class="r33 r">scriptInfo</span>, <a href="#b927e58b8d40bcae" class="i property">Context</a>);
 
            <span class="i">IEnumerable</span>&lt;<a href="ExternalScriptInfo.cs.html#b11a97aaaf8c5e31" class="t t">PSSnapInSpecification</a>&gt; <span id="r37 rd" class="r37 r">requiresPSSnapIns</span> = <span class="r33 r">scriptInfo</span>.<a href="ExternalScriptInfo.cs.html#b1561c4c63cf6f9c" class="i property">RequiresPSSnapIns</a>;
            <b>if</b> (<span class="r37 r">requiresPSSnapIns</span> != <b>null</b> &amp;&amp; <span class="r37 r">requiresPSSnapIns</span>.<span class="i">Any</span>())
            {
                <span class="i">Collection</span>&lt;<b>string</b>&gt; <span id="r38 rd" class="r38 r">requiresMissingPSSnapIns</span> = <b>null</b>;
                <a href="#4f76ab9797695c99" class="i method">VerifyRequiredSnapins</a>(<span class="r37 r">requiresPSSnapIns</span>, <span class="r34 r">context</span>, <b>out</b> <span class="r38 r">requiresMissingPSSnapIns</span>);
                <b>if</b> (<span class="r38 r">requiresMissingPSSnapIns</span> != <b>null</b>)
                {
                    <a href="../utils/CommandDiscoveryExceptions.cs.html#bc1285da7138b9bd" class="t t">ScriptRequiresException</a> <span id="r39 rd" class="r39 r">scriptRequiresException</span> =
                        <b>new</b> <a href="../utils/CommandDiscoveryExceptions.cs.html#f962f934cc7d7f86" class="t constructor">ScriptRequiresException</a>(
                            <span class="r33 r">scriptInfo</span>.<a href="CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>,
                            <span class="r38 r">requiresMissingPSSnapIns</span>,
                            <span class="s">&quot;ScriptRequiresMissingPSSnapIns&quot;</span>,
                            <b>true</b>);
                    <b>throw</b> <span class="r39 r">scriptRequiresException</span>;
                }
            }
            <b>else</b>
            {
                <span class="c">// If there were no PSSnapins required but there is a shellID required, then we need</span>
                <span class="c">// to error</span>
 
                <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r33 r">scriptInfo</span>.<a href="ExternalScriptInfo.cs.html#b19e6e108f7cc571" class="i property">RequiresApplicationID</a>))
                {
                    <a href="../utils/CommandDiscoveryExceptions.cs.html#bc1285da7138b9bd" class="t t">ScriptRequiresException</a> <span id="r40 rd" class="r40 r">sre</span> =
                      <b>new</b> <span class="t">ScriptRequiresException</span>(
                          <span class="r33 r">scriptInfo</span>.<a href="CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>,
                          <b>string</b>.<span class="i">Empty</span>,
                          <b>string</b>.<span class="i">Empty</span>,
                          <span class="s">&quot;RequiresShellIDInvalidForSingleShell&quot;</span>);
 
                    <b>throw</b> <span class="r40 r">sre</span>;
                }
            }
 
            <b>return</b> <a href="#7f7b6d78412051ae" class="i method">CreateCommandProcessorForScript</a>(<span class="r33 r">scriptInfo</span>, <a href="#b927e58b8d40bcae" class="i property">Context</a>, <span class="r35 r">useLocalScope</span>, <span class="r36 r">sessionState</span>);
        }
 
        <b>private static void</b> <a id="4f76ab9797695c99" href="../R/4f76ab9797695c99.html" target="n" data-glyph="76,1" class="i method">VerifyRequiredSnapins</a>(<span class="i">IEnumerable</span>&lt;<a href="ExternalScriptInfo.cs.html#b11a97aaaf8c5e31" class="t t">PSSnapInSpecification</a>&gt; <span id="r41 rd" class="r41 r">requiresPSSnapIns</span>, <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r42 rd" class="r42 r">context</span>, <b>out</b> <span class="i">Collection</span>&lt;<b>string</b>&gt; <span id="r43 rd" class="r43 r">requiresMissingPSSnapIns</span>)
        {
            <span class="r43 r">requiresMissingPSSnapIns</span> = <b>null</b>;
            <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r42 r">context</span>.<a href="ExecutionContext.cs.html#2a82be710f3773ae" class="i property">InitialSessionState</a> != <b>null</b>, <span class="s">&quot;PowerShell should be hosted with InitialSessionState&quot;</span>);
 
            <b>foreach</b> (<b>var</b> <span id="r44 rd" class="r44 r">requiresPSSnapIn</span> <b>in</b> <span class="r41 r">requiresPSSnapIns</span>)
            {
                <span class="i">IEnumerable</span>&lt;<a href="../singleshell/config/MshSnapinInfo.cs.html#571fb5b01a41502f" class="t t">PSSnapInInfo</a>&gt; <span id="r45 rd" class="r45 r">loadedPSSnapIns</span> = <b>null</b>;
                <span class="r45 r">loadedPSSnapIns</span> = <span class="r42 r">context</span>.<a href="ExecutionContext.cs.html#2a82be710f3773ae" class="i property">InitialSessionState</a>.<span class="i">GetPSSnapIn</span>(<span class="r44 r">requiresPSSnapIn</span>.<span class="i">Name</span>);
                <b>if</b> (<span class="r45 r">loadedPSSnapIns</span> == <b>null</b> || !<span class="r45 r">loadedPSSnapIns</span>.<span class="i">Any</span>())
                {
                    <b>if</b> (<span class="r43 r">requiresMissingPSSnapIns</span> == <b>null</b>)
                    {
                        <span class="r43 r">requiresMissingPSSnapIns</span> = <b>new</b> <span class="i">Collection</span>&lt;<b>string</b>&gt;();
                    }
 
                    <span class="r43 r">requiresMissingPSSnapIns</span>.<span class="i">Add</span>(<span class="i">BuildPSSnapInDisplayName</span>(<span class="r44 r">requiresPSSnapIn</span>));
                }
                <b>else</b>
                {
                    <span class="c">// the requires PSSnapin is loaded. now check the PSSnapin version</span>
                    <a href="../singleshell/config/MshSnapinInfo.cs.html#571fb5b01a41502f" class="t t">PSSnapInInfo</a> <span id="r46 rd" class="r46 r">loadedPSSnapIn</span> = <span class="r45 r">loadedPSSnapIns</span>.<span class="i">First</span>();
                    <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<span class="i">Assert</span>(<span class="r46 r">loadedPSSnapIn</span>.<a href="../singleshell/config/MshSnapinInfo.cs.html#f0960dddd3597e69" class="i property">Version</a> != <b>null</b>,
                        <b>string</b>.<span class="i">Format</span>(
                            <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                            <span class="s">&quot;Version is null for loaded PSSnapin {0}.&quot;</span>, <span class="r46 r">loadedPSSnapIn</span>));
                    <b>if</b> (<span class="r44 r">requiresPSSnapIn</span>.<span class="i">Version</span> != <b>null</b>)
                    {
                        <b>if</b> (!<span class="i">AreInstalledRequiresVersionsCompatible</span>(
                            <span class="r44 r">requiresPSSnapIn</span>.<span class="i">Version</span>, <span class="r46 r">loadedPSSnapIn</span>.<a href="../singleshell/config/MshSnapinInfo.cs.html#f0960dddd3597e69" class="i property">Version</a>))
                        {
                            <b>if</b> (<span class="r43 r">requiresMissingPSSnapIns</span> == <b>null</b>)
                            {
                                <span class="r43 r">requiresMissingPSSnapIns</span> = <b>new</b> <span class="i">Collection</span>&lt;<b>string</b>&gt;();
                            }
 
                            <span class="r43 r">requiresMissingPSSnapIns</span>.<span class="i">Add</span>(<span class="i">BuildPSSnapInDisplayName</span>(<span class="r44 r">requiresPSSnapIn</span>));
                        }
                    }
                }
            }
        }
 
        <span class="c">// This method verifies the following 3 elements of #Requires statement</span>
        <span class="c">// #Requires -RunAsAdministrator</span>
        <span class="c">// #Requires -PSVersion</span>
        <span class="c">// #Requires -PSEdition</span>
        <span class="c">// #Requires -Module</span>
        <b>internal static void</b> <a id="cc68f1bbdab748e2" href="../R/cc68f1bbdab748e2.html" target="n" data-glyph="74,1" class="i method">VerifyScriptRequirements</a>(<a href="ExternalScriptInfo.cs.html#7806ac40f903221c" class="t t">ExternalScriptInfo</a> <span id="r47 rd" class="r47 r">scriptInfo</span>, <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r48 rd" class="r48 r">context</span>)
        {
            <a href="#152857e527cbaf81" class="i method">VerifyElevatedPrivileges</a>(<span class="r47 r">scriptInfo</span>);
            <a href="#58e17cc89102b795" class="i method">VerifyPSVersion</a>(<span class="r47 r">scriptInfo</span>);
            <a href="#621cf75bae43cc8b" class="i method">VerifyPSEdition</a>(<span class="r47 r">scriptInfo</span>);
            <a href="#0c902bb77f49e327" class="i method">VerifyRequiredModules</a>(<span class="r47 r">scriptInfo</span>, <span class="r48 r">context</span>);
        }
 
        <b>internal static void</b> <a id="58e17cc89102b795" href="../R/58e17cc89102b795.html" target="n" data-glyph="74,1" class="i method">VerifyPSVersion</a>(<a href="ExternalScriptInfo.cs.html#7806ac40f903221c" class="t t">ExternalScriptInfo</a> <span id="r49 rd" class="r49 r">scriptInfo</span>)
        {
            <span class="i">Version</span> <span id="r50 rd" class="r50 r">requiresPSVersion</span> = <span class="r49 r">scriptInfo</span>.<a href="ExternalScriptInfo.cs.html#74d730b787bedd53" class="i property">RequiresPSVersion</a>;
            <span class="c">// in single shell mode</span>
            <b>if</b> (<span class="r50 r">requiresPSVersion</span> != <b>null</b>)
            {
                <b>if</b> (!<a href="Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="Utils.cs.html#80e75c94b0c6f4d5" class="i method">IsPSVersionSupported</a>(<span class="r50 r">requiresPSVersion</span>))
                {
                    <a href="../utils/CommandDiscoveryExceptions.cs.html#bc1285da7138b9bd" class="t t">ScriptRequiresException</a> <span id="r51 rd" class="r51 r">scriptRequiresException</span> =
                        <b>new</b> <span class="t">ScriptRequiresException</span>(
                            <span class="r49 r">scriptInfo</span>.<a href="CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>,
                            <span class="r50 r">requiresPSVersion</span>,
                            <a href="PSVersionInfo.cs.html#be287f9ea52b8d2f" class="t t">PSVersionInfo</a>.<a href="PSVersionInfo.cs.html#ad63365ac7690eeb" class="i property">PSVersion</a>.<span class="i">ToString</span>(),
                            <span class="s">&quot;ScriptRequiresUnmatchedPSVersion&quot;</span>);
                    <b>throw</b> <span class="r51 r">scriptRequiresException</span>;
                }
            }
        }
 
        <b>internal static void</b> <a id="621cf75bae43cc8b" href="../R/621cf75bae43cc8b.html" target="n" data-glyph="74,1" class="i method">VerifyPSEdition</a>(<a href="ExternalScriptInfo.cs.html#7806ac40f903221c" class="t t">ExternalScriptInfo</a> <span id="r52 rd" class="r52 r">scriptInfo</span>)
        {
            <b>if</b> (<span class="r52 r">scriptInfo</span>.<a href="ExternalScriptInfo.cs.html#eaa2c0fb8602194a" class="i property">RequiresPSEditions</a> != <b>null</b>)
            {
                <b>var</b> <span id="r53 rd" class="r53 r">isCurrentEditionListed</span> = <b>false</b>;
                <b>var</b> <span id="r54 rd" class="r54 r">isRequiresPSEditionSpecified</span> = <b>false</b>;
                <b>foreach</b> (<b>var</b> <span id="r55 rd" class="r55 r">edition</span> <b>in</b> <span class="r52 r">scriptInfo</span>.<a href="ExternalScriptInfo.cs.html#eaa2c0fb8602194a" class="i property">RequiresPSEditions</a>)
                {
                    <span class="r54 r">isRequiresPSEditionSpecified</span> = <b>true</b>;
                    <span class="r53 r">isCurrentEditionListed</span> = <a href="Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<span class="i">IsPSEditionSupported</span>(<span class="r55 r">edition</span>);
                    <b>if</b> (<span class="r53 r">isCurrentEditionListed</span>)
                    {
                        <b>break</b>;
                    }
                }
 
                <span class="c">// Throw an error if required PowerShell editions are specified and without the current PowerShell Edition.</span>
                <span class="c">//</span>
                <b>if</b> (<span class="r54 r">isRequiresPSEditionSpecified</span> &amp;&amp; !<span class="r53 r">isCurrentEditionListed</span>)
                {
                    <b>var</b> <span id="r56 rd" class="r56 r">specifiedEditionsString</span> = <b>string</b>.<span class="i">Join</span>(<span class="s">&quot;,&quot;</span>, <span class="r52 r">scriptInfo</span>.<a href="ExternalScriptInfo.cs.html#eaa2c0fb8602194a" class="i property">RequiresPSEditions</a>);
                    <b>var</b> <span id="r57 rd" class="r57 r">message</span> = <a href="../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">DiscoveryExceptions</span>.<span class="i">RequiresPSEditionNotCompatible</span>,
                        <span class="r52 r">scriptInfo</span>.<a href="CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>,
                        <span class="r56 r">specifiedEditionsString</span>,
                        <a href="PSVersionInfo.cs.html#be287f9ea52b8d2f" class="t t">PSVersionInfo</a>.<a href="PSVersionInfo.cs.html#6576f52d703d79c5" class="i property">PSEdition</a>);
                    <a href="../utils/RuntimeException.cs.html#bd88f263eb295545" class="k">var</a> <span id="r58 rd" class="r58 r">ex</span> = <b>new</b> <a href="../utils/RuntimeException.cs.html#e4538a388d78c143" class="t constructor">RuntimeException</a>(<span class="r57 r">message</span>);
                    <span class="r58 r">ex</span>.<a href="../utils/RuntimeException.cs.html#f25affe9a215ccc0" class="i method">SetErrorId</a>(<span class="s">&quot;ScriptRequiresUnmatchedPSEdition&quot;</span>);
                    <span class="r58 r">ex</span>.<a href="../utils/RuntimeException.cs.html#9b2f142e3fc2e683" class="i method">SetTargetObject</a>(<span class="r52 r">scriptInfo</span>.<a href="CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>);
                    <b>throw</b> <span class="r58 r">ex</span>;
                }
            }
        }
 
        <b>internal static void</b> <a id="152857e527cbaf81" href="../R/152857e527cbaf81.html" target="n" data-glyph="74,1" class="i method">VerifyElevatedPrivileges</a>(<a href="ExternalScriptInfo.cs.html#7806ac40f903221c" class="t t">ExternalScriptInfo</a> <span id="r59 rd" class="r59 r">scriptInfo</span>)
        {
            <b>bool</b> <span id="r60 rd" class="r60 r">requiresElevation</span> = <span class="r59 r">scriptInfo</span>.<a href="ExternalScriptInfo.cs.html#2378af23a734c93a" class="i property">RequiresElevation</a>;
            <b>bool</b> <span id="r61 rd" class="r61 r">isAdministrator</span> = <a href="Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="Utils.cs.html#7484d766d2be3ec7" class="i method">IsAdministrator</a>();
            <b>if</b> (<span class="r60 r">requiresElevation</span> &amp;&amp; !<span class="r61 r">isAdministrator</span>)
            {
                <a href="../utils/CommandDiscoveryExceptions.cs.html#bc1285da7138b9bd" class="t t">ScriptRequiresException</a> <span id="r62 rd" class="r62 r">scriptRequiresException</span> =
                        <b>new</b> <a href="../utils/CommandDiscoveryExceptions.cs.html#fdafb939fc0e6164" class="t constructor">ScriptRequiresException</a>(
                            <span class="r59 r">scriptInfo</span>.<a href="CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>,
                            <span class="s">&quot;ScriptRequiresElevation&quot;</span>);
                <b>throw</b> <span class="r62 r">scriptRequiresException</span>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Used to determine compatibility between the versions in the requires statement and</span>
        <span class="c">///</span><span class="c"> the installed version. The version can be PSSnapin or msh.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r63 r">requires</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Versions in the requires statement.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r64 r">installed</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Version installed.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> true if requires and installed&#39;s major version match and requires&#39; minor version</span>
        <span class="c">///</span><span class="c"> is smaller than or equal to installed&#39;s</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> In PowerShell V2, script requiring PowerShell 1.0 will fail.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>private static bool</b> <a id="38bea63c3fd400e1" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">AreInstalledRequiresVersionsCompatible</a>(<span class="i">Version</span> <span id="r63 rd" class="r63 r">requires</span>, <span class="i">Version</span> <span id="r64 rd" class="r64 r">installed</span>)
        {
            <b>return</b> <span class="r63 r">requires</span>.<span class="i">Major</span> == <span class="r64 r">installed</span>.<span class="i">Major</span> &amp;&amp; <span class="r63 r">requires</span>.<span class="i">Minor</span> &lt;= <span class="r64 r">installed</span>.<span class="i">Minor</span>;
        }
 
        <b>private static string</b> <a id="866b5043b8f58588" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">BuildPSSnapInDisplayName</a>(<a href="ExternalScriptInfo.cs.html#b11a97aaaf8c5e31" class="t t">PSSnapInSpecification</a> <span id="r65 rd" class="r65 r">PSSnapin</span>)
        {
            <b>return</b> <span class="r65 r">PSSnapin</span>.<a href="ExternalScriptInfo.cs.html#be5392c38732c5dc" class="i property">Version</a> == <b>null</b> ?
                <span class="r65 r">PSSnapin</span>.<a href="ExternalScriptInfo.cs.html#54b5cbc66708e7e9" class="i property">Name</a> :
                <a href="../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">DiscoveryExceptions</span>.<span class="i">PSSnapInNameVersion</span>,
                        <span class="r65 r">PSSnapin</span>.<a href="ExternalScriptInfo.cs.html#54b5cbc66708e7e9" class="i property">Name</a>, <span class="r65 r">PSSnapin</span>.<a href="ExternalScriptInfo.cs.html#be5392c38732c5dc" class="i property">Version</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Look up a command using a CommandInfo object and return its CommandProcessorBase.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r66 r">commandInfo</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The commandInfo for the command to lookup.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r67 r">commandOrigin</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Location where the command was dispatched from.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r68 r">useLocalScope</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> True if command processor should use local scope to execute the command,</span>
        <span class="c">///</span><span class="c"> False if not.  Null if command discovery should default to something reasonable</span>
        <span class="c">///</span><span class="c"> for the command discovered.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r69 r">sessionState</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The session state the commandInfo should be run in.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/CommandDiscoveryExceptions.cs.html#d61739861b769224" class="t t">CommandNotFoundException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the command, </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="i">commandName</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">, could not be found.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="MshSecurityException.cs.html#4b73a09ff18e1e39" class="t t">PSSecurityException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the security manager is preventing the command from running.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal</b> <a href="CommandProcessorBase.cs.html#45a6054a3775cde6" class="t t">CommandProcessorBase</a> <a id="677e20c74f6dea43" href="../R/677e20c74f6dea43.html" target="n" data-glyph="74,1" class="i method">LookupCommandProcessor</a>(<a href="CommandInfo.cs.html#71babe57a99ca852" class="t t">CommandInfo</a> <span id="r66 rd" class="r66 r">commandInfo</span>,
            <a href="SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a> <span id="r67 rd" class="r67 r">commandOrigin</span>, <b>bool</b>? <span id="r68 rd" class="r68 r">useLocalScope</span>, <a href="../P/2dc1bd90a8299178.html#2dc1bd90a8299178" class="t t">SessionStateInternal</a> <span id="r69 rd" class="r69 r">sessionState</span>)
        {
            <a href="CommandProcessorBase.cs.html#45a6054a3775cde6" class="t t">CommandProcessorBase</a> <span id="r70 rd" class="r70 r">processor</span> = <b>null</b>;
 
            <span class="i">HashSet</span>&lt;<b>string</b>&gt; <span id="r71 rd" class="r71 r">processedAliases</span> = <b>new</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt;(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>);
 
            <b>while</b> (<span class="r66 r">commandInfo</span>.<a href="CommandInfo.cs.html#1aa74ca244a39308" class="i property">CommandType</a> == <a href="CommandInfo.cs.html#3699fe79fa6969b5" class="t t">CommandTypes</a>.<a href="CommandInfo.cs.html#83aa5e1f88cb9bf5" class="i field">Alias</a> &amp;&amp;
                (!<span class="r71 r">processedAliases</span>.<span class="i">Contains</span>(<span class="r66 r">commandInfo</span>.<a href="CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>)) &amp;&amp;
                (<span class="r67 r">commandOrigin</span> == <a href="SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a>.<a href="SecurityManagerBase.cs.html#946d8e7ca02acec6" class="i field">Internal</a> || <span class="r66 r">commandInfo</span>.<a href="CommandInfo.cs.html#cb0c02415aeca7d5" class="i property">Visibility</a> == <a href="SessionStatePublic.cs.html#3acdda74c688180a" class="t t">SessionStateEntryVisibility</a>.<a href="SessionStatePublic.cs.html#74d8ba664c504563" class="i field">Public</a>))
            {
                <span class="r71 r">processedAliases</span>.<span class="i">Add</span>(<span class="r66 r">commandInfo</span>.<a href="CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>);
 
                <a href="AliasInfo.cs.html#cf27095b0a2fb6ea" class="t t">AliasInfo</a> <span id="r72 rd" class="r72 r">aliasCommandInfo</span> = (<a href="AliasInfo.cs.html#cf27095b0a2fb6ea" class="t t">AliasInfo</a>)<span class="r66 r">commandInfo</span>;
                <span class="r66 r">commandInfo</span> = <span class="r72 r">aliasCommandInfo</span>.<a href="AliasInfo.cs.html#3c87427c7d52a654" class="i property">ResolvedCommand</a> ??
                              <a href="#95c4b1448ba39a50" class="i method">LookupCommandInfo</a>(<span class="r72 r">aliasCommandInfo</span>.<a href="AliasInfo.cs.html#18d5b1486b184b4a" class="i property">Definition</a>, <span class="r67 r">commandOrigin</span>, <a href="#b927e58b8d40bcae" class="i property">Context</a>);
 
                <span class="c">// If we didn&#39;t have the alias target already resolved, see if it can be loaded.</span>
 
                <b>if</b> (<span class="r66 r">commandInfo</span> == <b>null</b>)
                {
                    <a href="../utils/CommandDiscoveryExceptions.cs.html#d61739861b769224" class="t t">CommandNotFoundException</a> <span id="r73 rd" class="r73 r">e</span> =
                        <b>new</b> <span class="t">CommandNotFoundException</span>(
                            <span class="r72 r">aliasCommandInfo</span>.<a href="CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>,
                            <b>null</b>,
                            <span class="s">&quot;AliasNotResolvedException&quot;</span>,
                            <span class="i">DiscoveryExceptions</span>.<span class="i">AliasNotResolvedException</span>,
                            <span class="r72 r">aliasCommandInfo</span>.<a href="AliasInfo.cs.html#2ece2cef1b4c256a" class="i property">UnresolvedCommandName</a>);
                    <b>throw</b> <span class="r73 r">e</span>;
                }
            }
 
            <a href="#1511ee5d93cad628" class="i method">ShouldRun</a>(<a href="#b927e58b8d40bcae" class="i property">Context</a>, <a href="#b927e58b8d40bcae" class="i property">Context</a>.<a href="ExecutionContext.cs.html#24a4a46de18d1004" class="i property">EngineHostInterface</a>, <span class="r66 r">commandInfo</span>, <span class="r67 r">commandOrigin</span>);
 
            <b>switch</b> (<span class="r66 r">commandInfo</span>.<a href="CommandInfo.cs.html#1aa74ca244a39308" class="i property">CommandType</a>)
            {
                <b>case</b> <a href="CommandInfo.cs.html#3699fe79fa6969b5" class="t t">CommandTypes</a>.<a href="CommandInfo.cs.html#f4fc4c6de9082bc5" class="i field">Application</a>:
                    <span class="r70 r">processor</span> = <b>new</b> <a href="NativeCommandProcessor.cs.html#ae2eb0e36af996fb" class="t constructor">NativeCommandProcessor</a>((<a href="ApplicationInfo.cs.html#3fe5acebae74c595" class="t t">ApplicationInfo</a>)<span class="r66 r">commandInfo</span>, <a href="#b927e58b8d40bcae" class="i property">Context</a>);
                    <b>break</b>;
                <b>case</b> <a href="CommandInfo.cs.html#3699fe79fa6969b5" class="t t">CommandTypes</a>.<a href="CommandInfo.cs.html#e95f2e5deaaf9b93" class="i field">Cmdlet</a>:
                    <span class="r70 r">processor</span> = <b>new</b> <a href="CommandProcessor.cs.html#64adc694daeabdd8" class="t constructor">CommandProcessor</a>((<a href="CmdletInfo.cs.html#9492ffc9968f644d" class="t t">CmdletInfo</a>)<span class="r66 r">commandInfo</span>, <a href="#b927e58b8d40bcae" class="i property">Context</a>);
                    <b>break</b>;
                <b>case</b> <a href="CommandInfo.cs.html#3699fe79fa6969b5" class="t t">CommandTypes</a>.<a href="CommandInfo.cs.html#5baa5da2219b134a" class="i field">ExternalScript</a>:
                    <a href="ExternalScriptInfo.cs.html#7806ac40f903221c" class="t t">ExternalScriptInfo</a> <span id="r74 rd" class="r74 r">scriptInfo</span> = (<a href="ExternalScriptInfo.cs.html#7806ac40f903221c" class="t t">ExternalScriptInfo</a>)<span class="r66 r">commandInfo</span>;
                    <span class="r74 r">scriptInfo</span>.<a href="ExternalScriptInfo.cs.html#2075d97e6591a1f9" class="i property">SignatureChecked</a> = <b>true</b>;
                    <b>try</b>
                    {
                        <span class="r70 r">processor</span> = <span class="i">CreateScriptProcessorForSingleShell</span>(<span class="r74 r">scriptInfo</span>, <a href="#b927e58b8d40bcae" class="i property">Context</a>, <span class="r68 r">useLocalScope</span> ?? <b>true</b>, <span class="r69 r">sessionState</span>);
                    }
                    <b>catch</b> (<a href="ExternalScriptInfo.cs.html#daf732cd64055d17" class="t t">ScriptRequiresSyntaxException</a> <span id="r75 rd" class="r75 r">reqSyntaxException</span>)
                    {
                        <a href="../utils/CommandDiscoveryExceptions.cs.html#d61739861b769224" class="t t">CommandNotFoundException</a> <span id="r76 rd" class="r76 r">e</span> =
                            <b>new</b> <span class="t">CommandNotFoundException</span>(<span class="r75 r">reqSyntaxException</span>.<span class="i">Message</span>, <span class="r75 r">reqSyntaxException</span>);
                        <b>throw</b> <span class="r76 r">e</span>;
                    }
 
                    <b>break</b>;
                <b>case</b> <a href="CommandInfo.cs.html#3699fe79fa6969b5" class="t t">CommandTypes</a>.<a href="CommandInfo.cs.html#7837d2f5f0343c5e" class="i field">Filter</a>:
                <b>case</b> <a href="CommandInfo.cs.html#3699fe79fa6969b5" class="t t">CommandTypes</a>.<a href="CommandInfo.cs.html#8a4bdbbd93f182bf" class="i field">Function</a>:
                <b>case</b> <a href="CommandInfo.cs.html#3699fe79fa6969b5" class="t t">CommandTypes</a>.<a href="CommandInfo.cs.html#2a673544a3a7e93f" class="i field">Configuration</a>:
                    <a href="FunctionInfo.cs.html#e37ab42bb144c43b" class="t t">FunctionInfo</a> <span id="r77 rd" class="r77 r">functionInfo</span> = (<a href="FunctionInfo.cs.html#e37ab42bb144c43b" class="t t">FunctionInfo</a>)<span class="r66 r">commandInfo</span>;
                    <span class="r70 r">processor</span> = <span class="i">CreateCommandProcessorForScript</span>(<span class="r77 r">functionInfo</span>, <a href="#b927e58b8d40bcae" class="i property">Context</a>, <span class="r68 r">useLocalScope</span> ?? <b>true</b>, <span class="r69 r">sessionState</span>);
                    <b>break</b>;
                <b>case</b> <a href="CommandInfo.cs.html#3699fe79fa6969b5" class="t t">CommandTypes</a>.<a href="CommandInfo.cs.html#8324208f5ee6d431" class="i field">Script</a>:
                    <span class="r70 r">processor</span> = <span class="i">CreateCommandProcessorForScript</span>((<a href="ScriptInfo.cs.html#0ebcce9a1485125a" class="t t">ScriptInfo</a>)<span class="r66 r">commandInfo</span>, <a href="#b927e58b8d40bcae" class="i property">Context</a>, <span class="r68 r">useLocalScope</span> ?? <b>true</b>, <span class="r69 r">sessionState</span>);
                    <b>break</b>;
                <b>case</b> <a href="CommandInfo.cs.html#3699fe79fa6969b5" class="t t">CommandTypes</a>.<a href="CommandInfo.cs.html#83aa5e1f88cb9bf5" class="i field">Alias</a>:
                <b>default</b>:
                    {
                        <a href="../utils/CommandDiscoveryExceptions.cs.html#d61739861b769224" class="t t">CommandNotFoundException</a> <span id="r78 rd" class="r78 r">e</span> =
                            <b>new</b> <span class="t">CommandNotFoundException</span>(
                                <span class="r66 r">commandInfo</span>.<a href="CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>,
                                <b>null</b>,
                                <span class="s">&quot;CommandNotFoundException&quot;</span>,
                                <span class="i">DiscoveryExceptions</span>.<span class="i">CommandNotFoundException</span>);
                        <b>throw</b> <span class="r78 r">e</span>;
                    }
            }
 
            <span class="c">// Set the internal command origin member on the command object at this point...</span>
            <span class="r70 r">processor</span>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#cfb07a45be8fb7d4" class="i field">CommandOriginInternal</a> = <span class="r67 r">commandOrigin</span>;
 
            <span class="r70 r">processor</span>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#f81679c755698e2e" class="i property">MyInvocation</a>.<a href="InvocationInfo.cs.html#57f452abf157b50b" class="i property">InvocationName</a> = <span class="r66 r">commandInfo</span>.<a href="CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>;
 
            <b>return</b> <span class="r70 r">processor</span>;
        }
 
        <b>internal static void</b> <a id="1511ee5d93cad628" href="../R/1511ee5d93cad628.html" target="n" data-glyph="74,1" class="i method">ShouldRun</a>(<a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r79 rd" class="r79 r">context</span>, <a href="hostifaces/MshHost.cs.html#7b79cd90e035740e" class="t t">PSHost</a> <span id="r80 rd" class="r80 r">host</span>, <a href="CommandInfo.cs.html#71babe57a99ca852" class="t t">CommandInfo</a> <span id="r81 rd" class="r81 r">commandInfo</span>, <a href="SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a> <span id="r82 rd" class="r82 r">commandOrigin</span>)
        {
            <span class="c">// ShouldRunInternal throws PSSecurityException if run is not allowed</span>
            <b>try</b>
            {
                <b>if</b> (<span class="r82 r">commandOrigin</span> == <a href="SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a>.<a href="SecurityManagerBase.cs.html#66a89eb31c003ba5" class="i field">Runspace</a> &amp;&amp; <span class="r81 r">commandInfo</span>.<a href="CommandInfo.cs.html#cb0c02415aeca7d5" class="i property">Visibility</a> != <a href="SessionStatePublic.cs.html#3acdda74c688180a" class="t t">SessionStateEntryVisibility</a>.<a href="SessionStatePublic.cs.html#74d8ba664c504563" class="i field">Public</a>)
                {
                    <a href="../utils/CommandDiscoveryExceptions.cs.html#d61739861b769224" class="t t">CommandNotFoundException</a> <span id="r83 rd" class="r83 r">e</span> = <b>new</b> <span class="t">CommandNotFoundException</span>(
                        <span class="r81 r">commandInfo</span>.<a href="CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>, <b>null</b>, <span class="s">&quot;CommandNotFoundException&quot;</span>, <span class="i">DiscoveryExceptions</span>.<span class="i">CommandNotFoundException</span>);
                    <b>throw</b> <span class="r83 r">e</span>;
                }
 
                <span class="r79 r">context</span>.<a href="ExecutionContext.cs.html#d04f29dfc80b1390" class="i property">AuthorizationManager</a>.<a href="SecurityManagerBase.cs.html#c0db5055d86375e7" class="i method">ShouldRunInternal</a>(<span class="r81 r">commandInfo</span>, <span class="r82 r">commandOrigin</span>, <span class="r80 r">host</span>);
            }
            <b>catch</b> (<a href="MshSecurityException.cs.html#4b73a09ff18e1e39" class="t t">PSSecurityException</a> <span id="r84 rd" class="r84 r">reason</span>)
            {
                <a href="../logging/MshLog.cs.html#c21af6f8f06e5873" class="t t">MshLog</a>.<span class="i">LogCommandHealthEvent</span>(<span class="r79 r">context</span>,
                                <span class="r84 r">reason</span>,
                                <a href="../logging/MshLog.cs.html#2b721dd17d857439" class="t t">Severity</a>.<a href="../logging/MshLog.cs.html#1440d51070db4217" class="i field">Warning</a>);
 
                <a href="../logging/MshLog.cs.html#c21af6f8f06e5873" class="t t">MshLog</a>.<a href="../logging/MshLog.cs.html#d7f27139228fb2bb" class="i method">LogCommandLifecycleEvent</a>(<span class="r79 r">context</span>,
                                <a href="../logging/MshLog.cs.html#0592db37e4bdfd35" class="t t">CommandState</a>.<a href="../logging/MshLog.cs.html#2189559e615ae527" class="i field">Terminated</a>,
                                <span class="r81 r">commandInfo</span>.<a href="CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>);
 
                <b>throw</b>;
            }
        }
 
        <b>private static</b> <a href="CommandProcessorBase.cs.html#45a6054a3775cde6" class="t t">CommandProcessorBase</a> <a id="415e889940ead0f4" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">CreateCommandProcessorForScript</a>(<a href="ScriptInfo.cs.html#0ebcce9a1485125a" class="t t">ScriptInfo</a> <span id="r85 rd" class="r85 r">scriptInfo</span>, <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r86 rd" class="r86 r">context</span>, <b>bool</b> <span id="r87 rd" class="r87 r">useNewScope</span>, <a href="../P/2dc1bd90a8299178.html#2dc1bd90a8299178" class="t t">SessionStateInternal</a> <span id="r88 rd" class="r88 r">sessionState</span>)
        {
            <span class="r88 r">sessionState</span> ??= <span class="r85 r">scriptInfo</span>.<a href="ScriptInfo.cs.html#0df6aded67ecf031" class="i property">ScriptBlock</a>.<a href="lang/scriptblock.cs.html#d25a345294fd74f0" class="i property">SessionStateInternal</a> ?? <span class="r86 r">context</span>.<a href="ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>;
            <a href="CommandProcessorBase.cs.html#45a6054a3775cde6" class="t t">CommandProcessorBase</a> <span id="r89 rd" class="r89 r">scriptAsCmdletProcessor</span> = <a href="#bc89ddd0458b72e2" class="i method">GetScriptAsCmdletProcessor</a>(<span class="r85 r">scriptInfo</span>, <span class="r86 r">context</span>, <span class="r87 r">useNewScope</span>, <b>true</b>, <span class="r88 r">sessionState</span>);
            <b>if</b> (<span class="r89 r">scriptAsCmdletProcessor</span> != <b>null</b>)
            {
                <b>return</b> <span class="r89 r">scriptAsCmdletProcessor</span>;
            }
 
            <b>return</b> <b>new</b> <a href="ScriptCommandProcessor.cs.html#e96e5d179ad16073" class="t constructor">DlrScriptCommandProcessor</a>(<span class="r85 r">scriptInfo</span>, <span class="r86 r">context</span>, <span class="r87 r">useNewScope</span>, <span class="r88 r">sessionState</span>);
        }
 
        <b>private static</b> <a href="CommandProcessorBase.cs.html#45a6054a3775cde6" class="t t">CommandProcessorBase</a> <a id="7f7b6d78412051ae" href="../R/7f7b6d78412051ae.html" target="n" data-glyph="76,1" class="i method">CreateCommandProcessorForScript</a>(<a href="ExternalScriptInfo.cs.html#7806ac40f903221c" class="t t">ExternalScriptInfo</a> <span id="r90 rd" class="r90 r">scriptInfo</span>, <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r91 rd" class="r91 r">context</span>, <b>bool</b> <span id="r92 rd" class="r92 r">useNewScope</span>, <a href="../P/2dc1bd90a8299178.html#2dc1bd90a8299178" class="t t">SessionStateInternal</a> <span id="r93 rd" class="r93 r">sessionState</span>)
        {
            <span class="r93 r">sessionState</span> ??= <span class="r90 r">scriptInfo</span>.<a href="ExternalScriptInfo.cs.html#7795a39b7e78fc61" class="i property">ScriptBlock</a>.<a href="lang/scriptblock.cs.html#d25a345294fd74f0" class="i property">SessionStateInternal</a> ?? <span class="r91 r">context</span>.<a href="ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>;
            <a href="CommandProcessorBase.cs.html#45a6054a3775cde6" class="t t">CommandProcessorBase</a> <span id="r94 rd" class="r94 r">scriptAsCmdletProcessor</span> = <a href="#bc89ddd0458b72e2" class="i method">GetScriptAsCmdletProcessor</a>(<span class="r90 r">scriptInfo</span>, <span class="r91 r">context</span>, <span class="r92 r">useNewScope</span>, <b>true</b>, <span class="r93 r">sessionState</span>);
            <b>if</b> (<span class="r94 r">scriptAsCmdletProcessor</span> != <b>null</b>)
            {
                <b>return</b> <span class="r94 r">scriptAsCmdletProcessor</span>;
            }
 
            <b>return</b> <b>new</b> <a href="ScriptCommandProcessor.cs.html#bbd598f3d38ec417" class="t constructor">DlrScriptCommandProcessor</a>(<span class="r90 r">scriptInfo</span>, <span class="r91 r">context</span>, <span class="r92 r">useNewScope</span>, <span class="r93 r">sessionState</span>);
        }
 
        <b>internal static</b> <a href="CommandProcessorBase.cs.html#45a6054a3775cde6" class="t t">CommandProcessorBase</a> <a id="3173529126cdf089" href="../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">CreateCommandProcessorForScript</a>(<a href="FunctionInfo.cs.html#e37ab42bb144c43b" class="t t">FunctionInfo</a> <span id="r95 rd" class="r95 r">functionInfo</span>, <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r96 rd" class="r96 r">context</span>, <b>bool</b> <span id="r97 rd" class="r97 r">useNewScope</span>, <a href="../P/2dc1bd90a8299178.html#2dc1bd90a8299178" class="t t">SessionStateInternal</a> <span id="r98 rd" class="r98 r">sessionState</span>)
        {
            <span class="r98 r">sessionState</span> ??= <span class="r95 r">functionInfo</span>.<a href="FunctionInfo.cs.html#aa3a9db104bb0f61" class="i property">ScriptBlock</a>.<a href="lang/scriptblock.cs.html#d25a345294fd74f0" class="i property">SessionStateInternal</a> ?? <span class="r96 r">context</span>.<a href="ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>;
            <a href="CommandProcessorBase.cs.html#45a6054a3775cde6" class="t t">CommandProcessorBase</a> <span id="r99 rd" class="r99 r">scriptAsCmdletProcessor</span> = <a href="#bc89ddd0458b72e2" class="i method">GetScriptAsCmdletProcessor</a>(<span class="r95 r">functionInfo</span>, <span class="r96 r">context</span>, <span class="r97 r">useNewScope</span>, <b>false</b>, <span class="r98 r">sessionState</span>);
            <b>if</b> (<span class="r99 r">scriptAsCmdletProcessor</span> != <b>null</b>)
            {
                <b>return</b> <span class="r99 r">scriptAsCmdletProcessor</span>;
            }
 
            <b>return</b> <b>new</b> <a href="ScriptCommandProcessor.cs.html#d0e79f30f5606c66" class="t constructor">DlrScriptCommandProcessor</a>(<span class="r95 r">functionInfo</span>, <span class="r96 r">context</span>, <span class="r97 r">useNewScope</span>, <span class="r98 r">sessionState</span>);
        }
 
        <b>internal static</b> <a href="CommandProcessorBase.cs.html#45a6054a3775cde6" class="t t">CommandProcessorBase</a> <a id="64c96a250977ad3f" href="../R/64c96a250977ad3f.html" target="n" data-glyph="74,1" class="i method">CreateCommandProcessorForScript</a>(<a href="../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a> <span id="r100 rd" class="r100 r">scriptblock</span>, <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r101 rd" class="r101 r">context</span>, <b>bool</b> <span id="r102 rd" class="r102 r">useNewScope</span>, <a href="../P/2dc1bd90a8299178.html#2dc1bd90a8299178" class="t t">SessionStateInternal</a> <span id="r103 rd" class="r103 r">sessionState</span>)
        {
            <span class="r103 r">sessionState</span> ??= <span class="r100 r">scriptblock</span>.<a href="lang/scriptblock.cs.html#d25a345294fd74f0" class="i property">SessionStateInternal</a> ?? <span class="r101 r">context</span>.<a href="ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>;
 
            <b>if</b> (<span class="r100 r">scriptblock</span>.<a href="runtime/CompiledScriptBlock.cs.html#42e46e4ff0244eb3" class="i property">UsesCmdletBinding</a>)
            {
                <a href="FunctionInfo.cs.html#e37ab42bb144c43b" class="t t">FunctionInfo</a> <span id="r104 rd" class="r104 r">fi</span> = <b>new</b> <span class="t">FunctionInfo</span>(<b>string</b>.<span class="i">Empty</span>, <span class="r100 r">scriptblock</span>, <span class="r101 r">context</span>);
                <b>return</b> <a href="#bc89ddd0458b72e2" class="i method">GetScriptAsCmdletProcessor</a>(<span class="r104 r">fi</span>, <span class="r101 r">context</span>, <span class="r102 r">useNewScope</span>, <b>false</b>, <span class="r103 r">sessionState</span>);
            }
 
            <b>return</b> <b>new</b> <a href="ScriptCommandProcessor.cs.html#bc8140e230e96c7c" class="t constructor">DlrScriptCommandProcessor</a>(<span class="r100 r">scriptblock</span>, <span class="r101 r">context</span>, <span class="r102 r">useNewScope</span>, <a href="SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a>.<a href="SecurityManagerBase.cs.html#946d8e7ca02acec6" class="i field">Internal</a>, <span class="r103 r">sessionState</span>);
        }
 
        <b>private static</b> <a href="CommandProcessorBase.cs.html#45a6054a3775cde6" class="t t">CommandProcessorBase</a> <a id="bc89ddd0458b72e2" href="../R/bc89ddd0458b72e2.html" target="n" data-glyph="76,1" class="i method">GetScriptAsCmdletProcessor</a>(<a href="CommandInfo.cs.html#2ae2bf5bb21a5a53" class="t t">IScriptCommandInfo</a> <span id="r105 rd" class="r105 r">scriptCommandInfo</span>, <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r106 rd" class="r106 r">context</span>, <b>bool</b> <span id="r107 rd" class="r107 r">useNewScope</span>, <b>bool</b> <span id="r108 rd" class="r108 r">fromScriptFile</span>, <a href="../P/2dc1bd90a8299178.html#2dc1bd90a8299178" class="t t">SessionStateInternal</a> <span id="r109 rd" class="r109 r">sessionState</span>)
        {
            <b>if</b> (<span class="r105 r">scriptCommandInfo</span>.<a href="CommandInfo.cs.html#753af6705016f48b" class="i property">ScriptBlock</a> == <b>null</b> || !<span class="r105 r">scriptCommandInfo</span>.<a href="CommandInfo.cs.html#753af6705016f48b" class="i property">ScriptBlock</a>.<a href="runtime/CompiledScriptBlock.cs.html#42e46e4ff0244eb3" class="i property">UsesCmdletBinding</a>)
            {
                <b>return</b> <b>null</b>;
            }
 
            <span class="r109 r">sessionState</span> ??= <span class="r105 r">scriptCommandInfo</span>.<a href="CommandInfo.cs.html#753af6705016f48b" class="i property">ScriptBlock</a>.<a href="lang/scriptblock.cs.html#d25a345294fd74f0" class="i property">SessionStateInternal</a> ?? <span class="r106 r">context</span>.<a href="ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>;
 
            <b>return</b> <b>new</b> <a href="CommandProcessor.cs.html#6dbda84e1bbd31ad" class="t constructor">CommandProcessor</a>(<span class="r105 r">scriptCommandInfo</span>, <span class="r106 r">context</span>, <span class="r107 r">useNewScope</span>, <span class="r108 r">fromScriptFile</span>, <span class="r109 r">sessionState</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Look up a command and return its CommandInfo.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r110 r">commandName</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The command name to lookup.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An instance of a CommandInfo object that represents the</span>
        <span class="c">///</span><span class="c"> command. If the command is resolved as an alias, an AliasInfo</span>
        <span class="c">///</span><span class="c"> is returned with the ReferencedCommand info intact.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/CommandDiscoveryExceptions.cs.html#d61739861b769224" class="t t">CommandNotFoundException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the command, </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r110 r">commandName</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">, could not be found.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal</b> <a href="CommandInfo.cs.html#71babe57a99ca852" class="t t">CommandInfo</a> <a id="9e9dd9e6bcc08b40" href="../R/9e9dd9e6bcc08b40.html" target="n" data-glyph="74,1" class="i method">LookupCommandInfo</a>(<b>string</b> <span id="r110 rd" class="r110 r">commandName</span>)
        {
            <b>return</b> <a href="#11f70d945389a48b" class="i method">LookupCommandInfo</a>(<span class="r110 r">commandName</span>, <a href="SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a>.<a href="SecurityManagerBase.cs.html#946d8e7ca02acec6" class="i field">Internal</a>);
        }
 
        <b>internal</b> <a href="CommandInfo.cs.html#71babe57a99ca852" class="t t">CommandInfo</a> <a id="11f70d945389a48b" href="../R/11f70d945389a48b.html" target="n" data-glyph="74,1" class="i method">LookupCommandInfo</a>(<b>string</b> <span id="r111 rd" class="r111 r">commandName</span>, <a href="SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a> <span id="r112 rd" class="r112 r">commandOrigin</span>)
        {
            <b>return</b> <a href="#95c4b1448ba39a50" class="i method">LookupCommandInfo</a>(<span class="r111 r">commandName</span>, <span class="r112 r">commandOrigin</span>, <a href="#b927e58b8d40bcae" class="i property">Context</a>);
        }
 
        <b>internal static</b> <a href="CommandInfo.cs.html#71babe57a99ca852" class="t t">CommandInfo</a> <a id="95c4b1448ba39a50" href="../R/95c4b1448ba39a50.html" target="n" data-glyph="74,1" class="i method">LookupCommandInfo</a>(<b>string</b> <span id="r113 rd" class="r113 r">commandName</span>, <a href="SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a> <span id="r114 rd" class="r114 r">commandOrigin</span>, <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r115 rd" class="r115 r">context</span>)
        {
            <b>return</b> <a href="#dccecfd30ed8d054" class="i method">LookupCommandInfo</a>(<span class="r113 r">commandName</span>, <a href="CommandInfo.cs.html#3699fe79fa6969b5" class="t t">CommandTypes</a>.<a href="CommandInfo.cs.html#d7f466cfbbd45cdb" class="i field">All</a>, <a href="CommandSearcher.cs.html#a5748603008affdc" class="t t">SearchResolutionOptions</a>.<a href="CommandSearcher.cs.html#9c3d13905ec4008c" class="i field">ResolveLiteralThenPathPatterns</a>, <span class="r114 r">commandOrigin</span>, <span class="r115 r">context</span>);
        }
 
        <b>internal static</b> <a href="CommandInfo.cs.html#71babe57a99ca852" class="t t">CommandInfo</a> <a id="dccecfd30ed8d054" href="../R/dccecfd30ed8d054.html" target="n" data-glyph="74,1" class="i method">LookupCommandInfo</a>(
            <b>string</b> <span id="r116 rd" class="r116 r">commandName</span>,
            <a href="CommandInfo.cs.html#3699fe79fa6969b5" class="t t">CommandTypes</a> <span id="r117 rd" class="r117 r">commandTypes</span>,
            <a href="CommandSearcher.cs.html#a5748603008affdc" class="t t">SearchResolutionOptions</a> <span id="r118 rd" class="r118 r">searchResolutionOptions</span>,
            <a href="SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a> <span id="r119 rd" class="r119 r">commandOrigin</span>,
            <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r120 rd" class="r120 r">context</span>)
        {
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r116 r">commandName</span>))
            {
                <b>return</b> <b>null</b>;
            }
 
            <b>bool</b> <span id="r121 rd" class="r121 r">etwEnabled</span> = <a href="#3c16c3656953a50c" class="t t">CommandDiscoveryEventSource</a>.<a href="#346fae28f2d8e441" class="i field">Log</a>.<span class="i">IsEnabled</span>();
            <b>if</b> (<span class="r121 r">etwEnabled</span>) <a href="#3c16c3656953a50c" class="t t">CommandDiscoveryEventSource</a>.<a href="#346fae28f2d8e441" class="i field">Log</a>.<a href="#3d3887fee9ce7444" class="i method">CommandLookupStart</a>(<span class="r116 r">commandName</span>);
 
            <a href="CommandInfo.cs.html#71babe57a99ca852" class="t t">CommandInfo</a> <span id="r122 rd" class="r122 r">result</span> = <b>null</b>;
            <b>string</b> <span id="r123 rd" class="r123 r">originalCommandName</span> = <span class="r116 r">commandName</span>;
 
            <span class="i">Exception</span> <span id="r124 rd" class="r124 r">lastError</span> = <b>null</b>;
 
            <span class="c">// Check to see if there is a pre-search look-up event handler...</span>
            <a href="#1d8153247a726d6e" class="t t">CommandLookupEventArgs</a> <span id="r125 rd" class="r125 r">eventArgs</span> = <b>null</b>;
            <span class="i">EventHandler</span>&lt;<a href="#1d8153247a726d6e" class="t t">CommandLookupEventArgs</a>&gt; <span id="r126 rd" class="r126 r">preCommandLookupEvent</span> = <span class="r120 r">context</span>.<a href="ExecutionContext.cs.html#27c4e82ba7216ff8" class="i property">EngineIntrinsics</a>.<a href="EngineIntrinsics.cs.html#9e6ba5466d2a8889" class="i property">InvokeCommand</a>.<a href="MshCmdlet.cs.html#25ba08204a4b14c6" class="i property">PreCommandLookupAction</a>;
 
            <b>if</b> (<span class="r126 r">preCommandLookupEvent</span> != <b>null</b>)
            {
                <a href="#5d9833e2519bb80f" class="i field">discoveryTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Executing PreCommandLookupAction: {0}&quot;</span>, <span class="r116 r">commandName</span>);
                <b>try</b>
                {
                    <span class="r120 r">context</span>.<a href="ExecutionContext.cs.html#586b706a65389941" class="i property">CommandDiscovery</a>.<a href="#6069adf1e5cad61d" class="i method">RegisterLookupCommandInfoAction</a>(<span class="s">&quot;ActivePreLookup&quot;</span>, <span class="r123 r">originalCommandName</span>);
                    <span class="r125 r">eventArgs</span> = <b>new</b> <a href="#80e896049498247c" class="t constructor">CommandLookupEventArgs</a>(<span class="r123 r">originalCommandName</span>, <span class="r119 r">commandOrigin</span>, <span class="r120 r">context</span>);
                    <span class="r126 r">preCommandLookupEvent</span>.<span class="i">Invoke</span>(<span class="r123 r">originalCommandName</span>, <span class="r125 r">eventArgs</span>);
 
                    <a href="#5d9833e2519bb80f" class="i field">discoveryTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;PreCommandLookupAction returned: {0}&quot;</span>, <span class="r125 r">eventArgs</span>.<a href="#83c03f663ddc1dcf" class="i property">Command</a>);
                }
                <b>catch</b> (<span class="i">Exception</span>)
                {
                }
                <b>finally</b> { <span class="r120 r">context</span>.<a href="ExecutionContext.cs.html#586b706a65389941" class="i property">CommandDiscovery</a>.<a href="#478216000be61fad" class="i method">UnregisterLookupCommandInfoAction</a>(<span class="s">&quot;ActivePreLookup&quot;</span>, <span class="r116 r">commandName</span>); }
            }
 
            <span class="c">// Check the module auto-loading preference</span>
            <a href="#c476355d983131b8" class="t t">PSModuleAutoLoadingPreference</a> <span id="r127 rd" class="r127 r">moduleAutoLoadingPreference</span> = <a href="#6495e4b39d68b6a7" class="i method">GetCommandDiscoveryPreference</a>(<span class="r120 r">context</span>, <a href="SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="SpecialVariables.cs.html#e908f6da9e7bb762" class="i field">PSModuleAutoLoadingPreferenceVarPath</a>, <span class="s">&quot;PSModuleAutoLoadingPreference&quot;</span>);
 
            <b>if</b> (<span class="r125 r">eventArgs</span> == <b>null</b> || !<span class="r125 r">eventArgs</span>.<a href="#55ca4fe32b11f7c7" class="i property">StopSearch</a>)
            {
                <b>do</b>
                {
                    <a href="#5d9833e2519bb80f" class="i field">discoveryTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Looking up command: {0}&quot;</span>, <span class="r116 r">commandName</span>);
 
                    <span class="c">// Use the CommandSearcher to find the first command. If there are duplicate</span>
                    <span class="c">// command names, then take the first one...</span>
 
                    <span class="r122 r">result</span> = <a href="#b699d2a35dce10dd" class="i method">TryNormalSearch</a>(<span class="r116 r">commandName</span>, <span class="r120 r">context</span>, <span class="r119 r">commandOrigin</span>, <span class="r118 r">searchResolutionOptions</span>, <span class="r117 r">commandTypes</span>, <b>ref</b> <span class="r124 r">lastError</span>);
 
                    <b>if</b> (<span class="r122 r">result</span> != <b>null</b>)
                        <b>break</b>;
 
                    <span class="c">// Try the module-qualified auto-loading (unless module auto-loading has been entirely disabled)</span>
                    <b>if</b> (<span class="r127 r">moduleAutoLoadingPreference</span> != <a href="#c476355d983131b8" class="t t">PSModuleAutoLoadingPreference</a>.<a href="#8d4577abcb2c6b36" class="i field">None</a>)
                    {
                        <span class="r122 r">result</span> = <a href="#138fc8f07f6f6db1" class="i method">TryModuleAutoLoading</a>(<span class="r116 r">commandName</span>, <span class="r120 r">context</span>, <span class="r123 r">originalCommandName</span>, <span class="r119 r">commandOrigin</span>, <b>ref</b> <span class="r124 r">lastError</span>);
                    }
 
                    <b>if</b> (<span class="r122 r">result</span> != <b>null</b>)
                        <b>break</b>;
 
                    <span class="c">// See if the this was not module-qualified. In that case, we should look for the first module</span>
                    <span class="c">// that contains the command and load that.</span>
                    <b>if</b> (<span class="r127 r">moduleAutoLoadingPreference</span> == <a href="#c476355d983131b8" class="t t">PSModuleAutoLoadingPreference</a>.<a href="#24f5e6dfa3261542" class="i field">All</a>)
                    {
                        <span class="r122 r">result</span> = <a href="#6a43105ad031f0fb" class="i method">TryModuleAutoDiscovery</a>(<span class="r116 r">commandName</span>, <span class="r120 r">context</span>, <span class="r123 r">originalCommandName</span>, <span class="r119 r">commandOrigin</span>,
                                                        <span class="r118 r">searchResolutionOptions</span>, <span class="r117 r">commandTypes</span>, <b>ref</b> <span class="r124 r">lastError</span>);
                    }
 
                    <span class="c">// Otherwise, invoke the CommandNotFound handler</span>
                    <b>if</b> (<span class="r122 r">result</span> == <b>null</b>)
                    {
                        <span class="r122 r">result</span> = <a href="#23047e10886cd784" class="i method">InvokeCommandNotFoundHandler</a>(<span class="r116 r">commandName</span>, <span class="r120 r">context</span>, <span class="r123 r">originalCommandName</span>, <span class="r119 r">commandOrigin</span>);
                    }
                } <b>while</b> (<b>false</b>);
            }
            <b>else</b>
            {
                <b>if</b> (<span class="r125 r">eventArgs</span>.<a href="#83c03f663ddc1dcf" class="i property">Command</a> != <b>null</b>)
                {
                    <span class="r122 r">result</span> = <span class="r125 r">eventArgs</span>.<a href="#83c03f663ddc1dcf" class="i property">Command</a>;
                }
            }
 
            <span class="c">// If we resolved a command, give the PostCommandLookup a chance to change it</span>
            <b>if</b> (<span class="r122 r">result</span> != <b>null</b>)
            {
                <span class="i n">System</span>.<span class="i">EventHandler</span>&lt;<a href="#1d8153247a726d6e" class="t t">CommandLookupEventArgs</a>&gt; <span id="r128 rd" class="r128 r">postAction</span> = <span class="r120 r">context</span>.<a href="ExecutionContext.cs.html#27c4e82ba7216ff8" class="i property">EngineIntrinsics</a>.<a href="EngineIntrinsics.cs.html#9e6ba5466d2a8889" class="i property">InvokeCommand</a>.<a href="MshCmdlet.cs.html#69cb895fe0f516e6" class="i property">PostCommandLookupAction</a>;
                <b>if</b> (<span class="r128 r">postAction</span> != <b>null</b>)
                {
                    <a href="#5d9833e2519bb80f" class="i field">discoveryTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Executing PostCommandLookupAction: {0}&quot;</span>, <span class="r123 r">originalCommandName</span>);
                    <b>try</b>
                    {
                        <span class="r120 r">context</span>.<a href="ExecutionContext.cs.html#586b706a65389941" class="i property">CommandDiscovery</a>.<a href="#6069adf1e5cad61d" class="i method">RegisterLookupCommandInfoAction</a>(<span class="s">&quot;ActivePostCommand&quot;</span>, <span class="r123 r">originalCommandName</span>);
 
                        <span class="r125 r">eventArgs</span> = <b>new</b> <a href="#80e896049498247c" class="t constructor">CommandLookupEventArgs</a>(<span class="r123 r">originalCommandName</span>, <span class="r119 r">commandOrigin</span>, <span class="r120 r">context</span>);
                        <span class="r125 r">eventArgs</span>.<a href="#83c03f663ddc1dcf" class="i property">Command</a> = <span class="r122 r">result</span>;
                        <span class="r128 r">postAction</span>.<span class="i">Invoke</span>(<span class="r123 r">originalCommandName</span>, <span class="r125 r">eventArgs</span>);
 
                        <b>if</b> (<span class="r125 r">eventArgs</span> != <b>null</b>)
                        {
                            <span class="r122 r">result</span> = <span class="r125 r">eventArgs</span>.<a href="#83c03f663ddc1dcf" class="i property">Command</a>;
                            <a href="#5d9833e2519bb80f" class="i field">discoveryTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;PreCommandLookupAction returned: {0}&quot;</span>, <span class="r125 r">eventArgs</span>.<a href="#83c03f663ddc1dcf" class="i property">Command</a>);
                        }
                    }
                    <b>catch</b> (<span class="i">Exception</span>)
                    {
                    }
                    <b>finally</b>
                    {
                        <span class="r120 r">context</span>.<a href="ExecutionContext.cs.html#586b706a65389941" class="i property">CommandDiscovery</a>.<a href="#478216000be61fad" class="i method">UnregisterLookupCommandInfoAction</a>(<span class="s">&quot;ActivePostCommand&quot;</span>, <span class="r123 r">originalCommandName</span>);
                    }
                }
            }
 
            <span class="c">// After all command lookup is done, throw a CommandNotFound if we have no result.</span>
            <b>if</b> (<span class="r122 r">result</span> == <b>null</b>)
            {
                <a href="#5d9833e2519bb80f" class="i field">discoveryTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#e7dd110db4bf902f" class="i method">TraceError</a>(
                    <span class="s">&quot;&#39;{0}&#39; is not recognized as a cmdlet, function, executable program or script file.&quot;</span>,
                    <span class="r116 r">commandName</span>);
 
                <a href="../utils/CommandDiscoveryExceptions.cs.html#d61739861b769224" class="t t">CommandNotFoundException</a> <span id="r129 rd" class="r129 r">e</span> =
                    <b>new</b> <span class="t">CommandNotFoundException</span>(
                        <span class="r123 r">originalCommandName</span>,
                        <span class="r124 r">lastError</span>,
                        <span class="s">&quot;CommandNotFoundException&quot;</span>,
                        <span class="i">DiscoveryExceptions</span>.<span class="i">CommandNotFoundException</span>);
                <b>throw</b> <span class="r129 r">e</span>;
            }
 
            <b>if</b> (<span class="r121 r">etwEnabled</span>) <a href="#3c16c3656953a50c" class="t t">CommandDiscoveryEventSource</a>.<a href="#346fae28f2d8e441" class="i field">Log</a>.<a href="#ca542609fd16903c" class="i method">CommandLookupStop</a>(<span class="r116 r">commandName</span>);
 
            <b>return</b> <span class="r122 r">result</span>;
        }
 
        <b>internal static void</b> <a id="6942b167a12adddf" href="../R/6942b167a12adddf.html" target="n" data-glyph="74,1" class="i method">AutoloadModulesWithJobSourceAdapters</a>(<span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r130 rd" class="r130 r">context</span>, <a href="SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a> <span id="r131 rd" class="r131 r">commandOrigin</span>)
        {
            <span class="c">/* This function is used by *-Job cmdlets (JobCmdletBase.BeginProcessing(), StartJobCommand.BeginProcessing())
            It attempts to load modules from a fixed ModulesWithJobSourceAdapters list that currently has only `PSScheduledJob` module that is not PS-Core compatible.
            Because this function does not check the result of a (currently failing) `PSScheduledJob` module autoload, it provides no value.
            After discussion it was decided to comment out this code as it may be useful if ModulesWithJobSourceAdapters list changes in the future.
 
            if (!context.IsModuleWithJobSourceAdapterLoaded)
            {
                PSModuleAutoLoadingPreference moduleAutoLoadingPreference = GetCommandDiscoveryPreference(context, SpecialVariables.PSModuleAutoLoadingPreferenceVarPath, &quot;PSModuleAutoLoadingPreference&quot;);
                if (moduleAutoLoadingPreference != PSModuleAutoLoadingPreference.None)
                {
                    CmdletInfo cmdletInfo = context.SessionState.InvokeCommand.GetCmdlet(&quot;Microsoft.PowerShell.Core\\Import-Module&quot;);
                    if ((commandOrigin == CommandOrigin.Internal) ||
                        ((cmdletInfo != null) &amp;&amp; (cmdletInfo.Visibility == SessionStateEntryVisibility.Public)))
                    {
                        foreach (var module in System.Management.Automation.ExecutionContext.ModulesWithJobSourceAdapters)
                        {
                            List&lt;PSModuleInfo&gt; existingModule = context.Modules.GetModules(new string[] { module }, false);
                            if (existingModule == null || existingModule.Count == 0)
                            {
                                Exception unUsedException = null;
                                AutoloadSpecifiedModule(module, context, cmdletInfo.Visibility, out unUsedException);
                            }
                        }
 
                        context.IsModuleWithJobSourceAdapterLoaded = true;
                    }
                }
            }*/</span>
        }
 
        <b>internal static</b> <span class="i">Collection</span>&lt;<a href="Modules/PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <a id="c13a16be6d4187e9" href="../R/c13a16be6d4187e9.html" target="n" data-glyph="74,1" class="i method">AutoloadSpecifiedModule</a>(<b>string</b> <span id="r132 rd" class="r132 r">moduleName</span>, <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r133 rd" class="r133 r">context</span>, <a href="SessionStatePublic.cs.html#3acdda74c688180a" class="t t">SessionStateEntryVisibility</a> <span id="r134 rd" class="r134 r">visibility</span>, <b>out</b> <span class="i">Exception</span> <span id="r135 rd" class="r135 r">exception</span>)
        {
            <span class="r135 r">exception</span> = <b>null</b>;
            <span class="i">Collection</span>&lt;<a href="Modules/PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <span id="r136 rd" class="r136 r">matchingModules</span> = <b>null</b>;
            <a href="CommandInfo.cs.html#71babe57a99ca852" class="t t">CommandInfo</a> <span id="r137 rd" class="r137 r">commandInfo</span> = <b>new</b> <span class="t">CmdletInfo</span>(<span class="s">&quot;Import-Module&quot;</span>, <b>typeof</b>(<a href="Modules/ImportModuleCommand.cs.html#4a6e75cbbfb65b34" class="t t">ImportModuleCommand</a>), <b>null</b>, <b>null</b>, <span class="r133 r">context</span>);
            <span class="r137 r">commandInfo</span>.<a href="CommandInfo.cs.html#cb0c02415aeca7d5" class="i property">Visibility</a> = <span class="r134 r">visibility</span>;
            <a href="hostifaces/Command.cs.html#b55b68a3bf75e612" class="t t">Command</a> <span id="r138 rd" class="r138 r">importModuleCommand</span> = <b>new</b> <a href="hostifaces/Command.cs.html#7afd6fbc88a9b688" class="t constructor">Command</a>(<span class="r137 r">commandInfo</span>);
 
            <a href="#5d9833e2519bb80f" class="i field">discoveryTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Attempting to load module: {0}&quot;</span>, <span class="r132 r">moduleName</span>);
 
            <a href="hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r139 rd" class="r139 r">ps</span> = <b>null</b>;
            <b>try</b>
            {
                <span class="r139 r">ps</span> = <a href="hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a>.<a href="hostifaces/PowerShell.cs.html#1c6a51d3c837bb4d" class="i method">Create</a>(<a href="hostifaces/PowerShell.cs.html#c3c0f0e5e0b337ff" class="t t">RunspaceMode</a>.<a href="hostifaces/PowerShell.cs.html#75d224de5df87e75" class="i field">CurrentRunspace</a>)
                    .<a href="hostifaces/PowerShell.cs.html#f68f5b3ba7949aa4" class="i method">AddCommand</a>(<span class="r138 r">importModuleCommand</span>)
                    .<a href="hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;Name&quot;</span>, <span class="r132 r">moduleName</span>)
                     .<a href="hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;Scope&quot;</span>, <a href="SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="SessionStateStrings.cs.html#76950d3d9588bb8a" class="i field">Global</a>)
                     .<a href="hostifaces/PowerShell.cs.html#ad181c9dec5e4ffa" class="i method">AddParameter</a>(<span class="s">&quot;PassThru&quot;</span>)
                     .<span class="i">AddParameter</span>(<span class="s">&quot;ErrorAction&quot;</span>, <a href="CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="CommandBase.cs.html#e7eef70977370b56" class="i field">Ignore</a>)
                     .<span class="i">AddParameter</span>(<span class="s">&quot;WarningAction&quot;</span>, <a href="CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="CommandBase.cs.html#e7eef70977370b56" class="i field">Ignore</a>)
                     .<span class="i">AddParameter</span>(<span class="s">&quot;InformationAction&quot;</span>, <a href="CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="CommandBase.cs.html#e7eef70977370b56" class="i field">Ignore</a>)
                     .<a href="hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;Verbose&quot;</span>, <b>false</b>)
                     .<a href="hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;Debug&quot;</span>, <b>false</b>);
                <span class="r136 r">matchingModules</span> = (<span class="i">Collection</span>&lt;<a href="Modules/PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt;)<span class="r139 r">ps</span>.<a href="hostifaces/PowerShell.cs.html#11053e110c66cae7" class="i method">Invoke</a>&lt;<a href="Modules/PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt;();
            }
            <b>catch</b> (<span class="i">Exception</span> <span id="r140 rd" class="r140 r">e</span>)
            {
                <span class="r135 r">exception</span> = <span class="r140 r">e</span>;
                <a href="#5d9833e2519bb80f" class="i field">discoveryTracer</a>.<span class="i">WriteLine</span>(<span class="s">&quot;Encountered error importing module: {0}&quot;</span>, <span class="r140 r">e</span>.<span class="i">Message</span>);
                <span class="c">// Call-out to user code, catch-all OK</span>
            }
 
            <b>return</b> <span class="r136 r">matchingModules</span>;
        }
 
        <b>private static</b> <a href="CommandInfo.cs.html#71babe57a99ca852" class="t t">CommandInfo</a> <a id="23047e10886cd784" href="../R/23047e10886cd784.html" target="n" data-glyph="76,1" class="i method">InvokeCommandNotFoundHandler</a>(<b>string</b> <span id="r141 rd" class="r141 r">commandName</span>, <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r142 rd" class="r142 r">context</span>, <b>string</b> <span id="r143 rd" class="r143 r">originalCommandName</span>, <a href="SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a> <span id="r144 rd" class="r144 r">commandOrigin</span>)
        {
            <a href="CommandInfo.cs.html#71babe57a99ca852" class="t t">CommandInfo</a> <span id="r145 rd" class="r145 r">result</span> = <b>null</b>;
            <a href="#1d8153247a726d6e" class="t t">CommandLookupEventArgs</a> <span id="r146 rd" class="r146 r">eventArgs</span>;
            <span class="i n">System</span>.<span class="i">EventHandler</span>&lt;<a href="#1d8153247a726d6e" class="t t">CommandLookupEventArgs</a>&gt; <span id="r147 rd" class="r147 r">cmdNotFoundHandler</span> = <span class="r142 r">context</span>.<a href="ExecutionContext.cs.html#27c4e82ba7216ff8" class="i property">EngineIntrinsics</a>.<a href="EngineIntrinsics.cs.html#9e6ba5466d2a8889" class="i property">InvokeCommand</a>.<a href="MshCmdlet.cs.html#225f68e0b7194647" class="i property">CommandNotFoundAction</a>;
            <b>if</b> (<span class="r147 r">cmdNotFoundHandler</span> != <b>null</b>)
            {
                <a href="#5d9833e2519bb80f" class="i field">discoveryTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Executing CommandNotFoundAction: {0}&quot;</span>, <span class="r141 r">commandName</span>);
                <b>try</b>
                {
                    <span class="r142 r">context</span>.<a href="ExecutionContext.cs.html#586b706a65389941" class="i property">CommandDiscovery</a>.<a href="#6069adf1e5cad61d" class="i method">RegisterLookupCommandInfoAction</a>(<span class="s">&quot;ActiveCommandNotFound&quot;</span>, <span class="r143 r">originalCommandName</span>);
                    <span class="r146 r">eventArgs</span> = <b>new</b> <a href="#80e896049498247c" class="t constructor">CommandLookupEventArgs</a>(<span class="r143 r">originalCommandName</span>, <span class="r144 r">commandOrigin</span>, <span class="r142 r">context</span>);
                    <span class="r147 r">cmdNotFoundHandler</span>.<span class="i">Invoke</span>(<span class="r143 r">originalCommandName</span>, <span class="r146 r">eventArgs</span>);
                    <span class="r145 r">result</span> = <span class="r146 r">eventArgs</span>.<a href="#83c03f663ddc1dcf" class="i property">Command</a>;
                }
                <b>catch</b> (<span class="i">Exception</span>)
                {
                }
                <b>finally</b> { <span class="r142 r">context</span>.<a href="ExecutionContext.cs.html#586b706a65389941" class="i property">CommandDiscovery</a>.<a href="#478216000be61fad" class="i method">UnregisterLookupCommandInfoAction</a>(<span class="s">&quot;ActiveCommandNotFound&quot;</span>, <span class="r143 r">originalCommandName</span>); }
            }
 
            <b>return</b> <span class="r145 r">result</span>;
        }
 
        <b>private static</b> <a href="CommandInfo.cs.html#71babe57a99ca852" class="t t">CommandInfo</a> <a id="b699d2a35dce10dd" href="../R/b699d2a35dce10dd.html" target="n" data-glyph="76,1" class="i method">TryNormalSearch</a>(<b>string</b> <span id="r148 rd" class="r148 r">commandName</span>,
                                                   <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r149 rd" class="r149 r">context</span>,
                                                   <a href="SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a> <span id="r150 rd" class="r150 r">commandOrigin</span>,
                                                   <a href="CommandSearcher.cs.html#a5748603008affdc" class="t t">SearchResolutionOptions</a> <span id="r151 rd" class="r151 r">searchResolutionOptions</span>,
                                                   <a href="CommandInfo.cs.html#3699fe79fa6969b5" class="t t">CommandTypes</a> <span id="r152 rd" class="r152 r">commandTypes</span>,
                                                   <b>ref</b> <span class="i">Exception</span> <span id="r153 rd" class="r153 r">lastError</span>)
        {
            <a href="CommandInfo.cs.html#71babe57a99ca852" class="t t">CommandInfo</a> <span id="r154 rd" class="r154 r">result</span> = <b>null</b>;
 
            <a href="CommandSearcher.cs.html#b56d4ddadb4e7cd0" class="t t">CommandSearcher</a> <span id="r155 rd" class="r155 r">searcher</span> =
                <b>new</b> <a href="CommandSearcher.cs.html#7c52be99f559c2b3" class="t constructor">CommandSearcher</a>(
                    <span class="r148 r">commandName</span>,
                    <span class="r151 r">searchResolutionOptions</span>,
                    <span class="r152 r">commandTypes</span>,
                    <span class="r149 r">context</span>);
            <span class="r155 r">searcher</span>.<a href="CommandSearcher.cs.html#34d5e34f877c31b7" class="i property">CommandOrigin</a> = <span class="r150 r">commandOrigin</span>;
 
            <b>try</b>
            {
                <b>if</b> (!<span class="r155 r">searcher</span>.<a href="CommandSearcher.cs.html#157d1fe83dcb77a7" class="i method">MoveNext</a>())
                {
                    <b>if</b> (!<span class="r148 r">commandName</span>.<span class="i">Contains</span>(<span class="s">&#39;-&#39;</span>) &amp;&amp; !<span class="r148 r">commandName</span>.<span class="i">Contains</span>(<span class="s">&#39;\\&#39;</span>))
                    {
                        <a href="#5d9833e2519bb80f" class="i field">discoveryTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(
                            <span class="s">&quot;The command [{0}] was not found, trying again with get- prepended&quot;</span>,
                            <span class="r148 r">commandName</span>);
 
                        <span class="r148 r">commandName</span> = <a href="SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="SessionStateStrings.cs.html#b284ca2138b9ec0a" class="i field">DefaultCommandVerb</a> + <a href="SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="SessionStateStrings.cs.html#54cddae81b4733be" class="i field">CommandVerbNounSeparator</a> + <span class="r148 r">commandName</span>;
 
                        <b>try</b>
                        {
                            <span class="r154 r">result</span> = <a href="#dccecfd30ed8d054" class="i method">LookupCommandInfo</a>(<span class="r148 r">commandName</span>, <span class="r152 r">commandTypes</span>, <span class="r151 r">searchResolutionOptions</span>, <span class="r150 r">commandOrigin</span>, <span class="r149 r">context</span>);
                        }
                        <b>catch</b> (<a href="../utils/CommandDiscoveryExceptions.cs.html#d61739861b769224" class="t t">CommandNotFoundException</a>) { }
                    }
                }
                <b>else</b>
                {
                    <span class="r154 r">result</span> = ((<span class="i">IEnumerator</span>&lt;<a href="CommandInfo.cs.html#71babe57a99ca852" class="t t">CommandInfo</a>&gt;)<span class="r155 r">searcher</span>).<span class="i">Current</span>;
                }
            }
            <b>catch</b> (<span class="i">ArgumentException</span> <span id="r156 rd" class="r156 r">argException</span>)
            {
                <span class="r153 r">lastError</span> = <span class="r156 r">argException</span>;
            }
            <b>catch</b> (<span class="i">PathTooLongException</span> <span id="r157 rd" class="r157 r">pathTooLong</span>)
            {
                <span class="r153 r">lastError</span> = <span class="r157 r">pathTooLong</span>;
            }
            <b>catch</b> (<span class="i">FileLoadException</span> <span id="r158 rd" class="r158 r">fileLoadException</span>)
            {
                <span class="r153 r">lastError</span> = <span class="r158 r">fileLoadException</span>;
            }
            <b>catch</b> (<span class="i">FormatException</span> <span id="r159 rd" class="r159 r">formatException</span>)
            {
                <span class="r153 r">lastError</span> = <span class="r159 r">formatException</span>;
            }
            <b>catch</b> (<a href="../utils/MetadataExceptions.cs.html#3bf974090c4e60a1" class="t t">MetadataException</a> <span id="r160 rd" class="r160 r">metadataException</span>)
            {
                <span class="r153 r">lastError</span> = <span class="r160 r">metadataException</span>;
            }
 
            <b>return</b> <span class="r154 r">result</span>;
        }
 
        <b>private static</b> <a href="CommandInfo.cs.html#71babe57a99ca852" class="t t">CommandInfo</a> <a id="6a43105ad031f0fb" href="../R/6a43105ad031f0fb.html" target="n" data-glyph="76,1" class="i method">TryModuleAutoDiscovery</a>(<b>string</b> <span id="r161 rd" class="r161 r">commandName</span>,
                                                          <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r162 rd" class="r162 r">context</span>,
                                                          <b>string</b> <span id="r163 rd" class="r163 r">originalCommandName</span>,
                                                          <a href="SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a> <span id="r164 rd" class="r164 r">commandOrigin</span>,
                                                          <a href="CommandSearcher.cs.html#a5748603008affdc" class="t t">SearchResolutionOptions</a> <span id="r165 rd" class="r165 r">searchResolutionOptions</span>,
                                                          <a href="CommandInfo.cs.html#3699fe79fa6969b5" class="t t">CommandTypes</a> <span id="r166 rd" class="r166 r">commandTypes</span>,
                                                          <b>ref</b> <span class="i">Exception</span> <span id="r167 rd" class="r167 r">lastError</span>)
        {
            <b>bool</b> <span id="r168 rd" class="r168 r">etwEnabled</span> = <a href="#3c16c3656953a50c" class="t t">CommandDiscoveryEventSource</a>.<a href="#346fae28f2d8e441" class="i field">Log</a>.<span class="i">IsEnabled</span>();
            <b>if</b> (<span class="r168 r">etwEnabled</span>) <a href="#3c16c3656953a50c" class="t t">CommandDiscoveryEventSource</a>.<a href="#346fae28f2d8e441" class="i field">Log</a>.<a href="#5cc5dd1b196d17e5" class="i method">ModuleAutoDiscoveryStart</a>(<span class="r161 r">commandName</span>);
 
            <a href="CommandInfo.cs.html#71babe57a99ca852" class="t t">CommandInfo</a> <span id="r169 rd" class="r169 r">result</span> = <b>null</b>;
            <b>try</b>
            {
                <span class="c">// If commandName had a slash, it was module-qualified or path-qualified.</span>
                <span class="c">// In that case, we should not return anything (module-qualified is handled</span>
                <span class="c">// by the previous call to TryModuleAutoLoading().</span>
                <b>int</b> <span id="r170 rd" class="r170 r">colonOrBackslash</span> = <span class="r161 r">commandName</span>.<span class="i">IndexOfAny</span>(<a href="Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="Utils.cs.html#6fd6d3492cb91f87" class="t t">Separators</a>.<a href="Utils.cs.html#928ae75b04c26cb4" class="i field">ColonOrBackslash</a>);
                <b>if</b> (<span class="r170 r">colonOrBackslash</span> != -1)
                    <b>return</b> <b>null</b>;
 
                <a href="CmdletInfo.cs.html#9492ffc9968f644d" class="t t">CmdletInfo</a> <span id="r171 rd" class="r171 r">cmdletInfo</span> = <span class="r162 r">context</span>.<a href="ExecutionContext.cs.html#4502619a6e4808ee" class="i property">SessionState</a>.<a href="SessionStatePublic.cs.html#236f6ceba41f8f3e" class="i property">InvokeCommand</a>.<a href="MshCmdlet.cs.html#f14de699060a0394" class="i method">GetCmdlet</a>(<span class="s">&quot;Microsoft.PowerShell.Core\\Get-Module&quot;</span>);
                <b>if</b> ((<span class="r164 r">commandOrigin</span> == <a href="SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a>.<a href="SecurityManagerBase.cs.html#946d8e7ca02acec6" class="i field">Internal</a>) ||
                    ((<span class="r171 r">cmdletInfo</span> != <b>null</b>) &amp;&amp; (<span class="r171 r">cmdletInfo</span>.<a href="CommandInfo.cs.html#cb0c02415aeca7d5" class="i property">Visibility</a> == <a href="SessionStatePublic.cs.html#3acdda74c688180a" class="t t">SessionStateEntryVisibility</a>.<a href="SessionStatePublic.cs.html#74d8ba664c504563" class="i field">Public</a>)))
                {
                    <span class="c">// Search for a module with a matching command, as long as the user would have the ability to</span>
                    <span class="c">// import the module.</span>
                    <span class="r171 r">cmdletInfo</span> = <span class="r162 r">context</span>.<a href="ExecutionContext.cs.html#4502619a6e4808ee" class="i property">SessionState</a>.<a href="SessionStatePublic.cs.html#236f6ceba41f8f3e" class="i property">InvokeCommand</a>.<a href="MshCmdlet.cs.html#f14de699060a0394" class="i method">GetCmdlet</a>(<span class="s">&quot;Microsoft.PowerShell.Core\\Import-Module&quot;</span>);
                    <b>if</b> (((<span class="r164 r">commandOrigin</span> == <a href="SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a>.<a href="SecurityManagerBase.cs.html#946d8e7ca02acec6" class="i field">Internal</a>) ||
                         ((<span class="r171 r">cmdletInfo</span> != <b>null</b>) &amp;&amp; (<span class="r171 r">cmdletInfo</span>.<a href="CommandInfo.cs.html#cb0c02415aeca7d5" class="i property">Visibility</a> == <a href="SessionStatePublic.cs.html#3acdda74c688180a" class="t t">SessionStateEntryVisibility</a>.<a href="SessionStatePublic.cs.html#74d8ba664c504563" class="i field">Public</a>))))
                    {
                        <a href="#5d9833e2519bb80f" class="i field">discoveryTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Executing non module-qualified search: {0}&quot;</span>, <span class="r161 r">commandName</span>);
                        <span class="r162 r">context</span>.<a href="ExecutionContext.cs.html#586b706a65389941" class="i property">CommandDiscovery</a>.<a href="#6069adf1e5cad61d" class="i method">RegisterLookupCommandInfoAction</a>(<span class="s">&quot;ActiveModuleSearch&quot;</span>, <span class="r161 r">commandName</span>);
 
                        <span class="c">// Get the available module files, preferring modules from $PSHOME so that user modules don&#39;t</span>
                        <span class="c">// override system modules during auto-loading</span>
                        <b>if</b> (<span class="r168 r">etwEnabled</span>) <a href="#3c16c3656953a50c" class="t t">CommandDiscoveryEventSource</a>.<a href="#346fae28f2d8e441" class="i field">Log</a>.<a href="#212b33b9dd2b2fde" class="i method">SearchingForModuleFilesStart</a>();
                        <b>var</b> <span id="r172 rd" class="r172 r">defaultAvailableModuleFiles</span> = <a href="Modules/ModuleUtils.cs.html#623e3612c4173093" class="t t">ModuleUtils</a>.<a href="Modules/ModuleUtils.cs.html#2c015e257649873c" class="i method">GetDefaultAvailableModuleFiles</a>(<span class="r173 r">isForAutoDiscovery</span>: <b>true</b>, <span class="r162 r">context</span>);
                        <b>if</b> (<span class="r168 r">etwEnabled</span>) <a href="#3c16c3656953a50c" class="t t">CommandDiscoveryEventSource</a>.<a href="#346fae28f2d8e441" class="i field">Log</a>.<a href="#02dc92d90689a88e" class="i method">SearchingForModuleFilesStop</a>();
 
                        <b>foreach</b> (<b>string</b> <span id="r174 rd" class="r174 r">modulePath</span> <b>in</b> <span class="r172 r">defaultAvailableModuleFiles</span>)
                        {
                            <span class="c">// WinBlue:69141 - We need to get the full path here because the module path might be C:\Users\User1\DOCUME~1</span>
                            <span class="c">// While the exportedCommands are cached, they are cached with the full path</span>
                            <b>string</b> <span id="r175 rd" class="r175 r">expandedModulePath</span> = <span class="i">IO</span>.<span class="i">Path</span>.<span class="i">GetFullPath</span>(<span class="r174 r">modulePath</span>);
                            <b>string</b> <span id="r176 rd" class="r176 r">moduleShortName</span> = <span class="i n">System</span>.<span class="i">IO</span>.<span class="i">Path</span>.<span class="i">GetFileNameWithoutExtension</span>(<span class="r175 r">expandedModulePath</span>);
                            <b>var</b> <span id="r177 rd" class="r177 r">exportedCommands</span> = <a href="Modules/AnalysisCache.cs.html#e469d7c6575d3464" class="t t">AnalysisCache</a>.<a href="Modules/AnalysisCache.cs.html#c5534fd9817cef4e" class="i method">GetExportedCommands</a>(<span class="r175 r">expandedModulePath</span>, <b>false</b>, <span class="r162 r">context</span>);
 
                            <b>if</b> (<span class="r177 r">exportedCommands</span> == <b>null</b>) { <b>continue</b>; }
 
                            <a href="CommandInfo.cs.html#3699fe79fa6969b5" class="t t">CommandTypes</a> <span id="r178 rd" class="r178 r">exportedCommandTypes</span>;
                            <span class="c">// Skip if module only has class or other types and no commands.</span>
                            <b>if</b> (<span class="r177 r">exportedCommands</span>.<span class="i">TryGetValue</span>(<span class="r161 r">commandName</span>, <b>out</b> <span class="r178 r">exportedCommandTypes</span>))
                            {
                                <span class="i">Exception</span> <span id="r179 rd" class="r179 r">exception</span>;
                                <a href="#5d9833e2519bb80f" class="i field">discoveryTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Found in module: {0}&quot;</span>, <span class="r175 r">expandedModulePath</span>);
                                <span class="i">Collection</span>&lt;<a href="Modules/PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <span id="r180 rd" class="r180 r">matchingModule</span> = <a href="#c13a16be6d4187e9" class="i method">AutoloadSpecifiedModule</a>(<span class="r175 r">expandedModulePath</span>, <span class="r162 r">context</span>,
                                    <span class="r171 r">cmdletInfo</span> != <b>null</b> ? <span class="r171 r">cmdletInfo</span>.<a href="CommandInfo.cs.html#cb0c02415aeca7d5" class="i property">Visibility</a> : <a href="SessionStatePublic.cs.html#3acdda74c688180a" class="t t">SessionStateEntryVisibility</a>.<a href="SessionStatePublic.cs.html#9412d519f56b8001" class="i field">Private</a>,
                                        <b>out</b> <span class="r179 r">exception</span>);
                                <span class="r167 r">lastError</span> = <span class="r179 r">exception</span>;
                                <b>if</b> ((<span class="r180 r">matchingModule</span> == <b>null</b>) || (<span class="r180 r">matchingModule</span>.<span class="i">Count</span> == 0))
                                {
                                    <b>string</b> <span id="r181 rd" class="r181 r">error</span> = <a href="../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">DiscoveryExceptions</span>.<span class="i">CouldNotAutoImportMatchingModule</span>, <span class="r161 r">commandName</span>, <span class="r176 r">moduleShortName</span>);
                                    <a href="../utils/CommandDiscoveryExceptions.cs.html#d61739861b769224" class="t t">CommandNotFoundException</a> <span id="r182 rd" class="r182 r">commandNotFound</span> = <b>new</b> <a href="../utils/CommandDiscoveryExceptions.cs.html#c162ab5344cd50f5" class="t constructor">CommandNotFoundException</a>(
                                        <span class="r163 r">originalCommandName</span>,
                                        <span class="r167 r">lastError</span>,
                                        <span class="s">&quot;CouldNotAutoloadMatchingModule&quot;</span>, <span class="r181 r">error</span>);
                                    <b>throw</b> <span class="r182 r">commandNotFound</span>;
                                }
 
                                <span class="r169 r">result</span> = <a href="#dccecfd30ed8d054" class="i method">LookupCommandInfo</a>(<span class="r161 r">commandName</span>, <span class="r166 r">commandTypes</span>, <span class="r165 r">searchResolutionOptions</span>, <span class="r164 r">commandOrigin</span>, <span class="r162 r">context</span>);
                            }
 
                            <b>if</b> (<span class="r169 r">result</span> != <b>null</b>)
                            {
                                <b>break</b>;
                            }
                        }
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">CORECLR</span>
<span class="e">                        // Close the progress pane that may have popped up from analyzing UNC paths.
                        if (context.CurrentCommandProcessor != null)
                        {
                            ProgressRecord analysisProgress = new ProgressRecord(0, Modules.ScriptAnalysisPreparing, &quot; &quot;);
                            analysisProgress.RecordType = ProgressRecordType.Completed;
                            context.CurrentCommandProcessor.CommandRuntime.WriteProgress(analysisProgress);
                        }
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
                    }
                }
            }
            <b>catch</b> (<a href="../utils/CommandDiscoveryExceptions.cs.html#d61739861b769224" class="t t">CommandNotFoundException</a>) { <b>throw</b>; }
            <b>catch</b> (<span class="i">Exception</span>)
            {
            }
            <b>finally</b>
            {
                <span class="r162 r">context</span>.<a href="ExecutionContext.cs.html#586b706a65389941" class="i property">CommandDiscovery</a>.<a href="#478216000be61fad" class="i method">UnregisterLookupCommandInfoAction</a>(<span class="s">&quot;ActiveModuleSearch&quot;</span>, <span class="r161 r">commandName</span>);
            }
 
            <b>if</b> (<span class="r168 r">etwEnabled</span>) <a href="#3c16c3656953a50c" class="t t">CommandDiscoveryEventSource</a>.<a href="#346fae28f2d8e441" class="i field">Log</a>.<a href="#ee282c89a7b55579" class="i method">ModuleAutoDiscoveryStop</a>(<span class="r161 r">commandName</span>);
 
            <b>return</b> <span class="r169 r">result</span>;
        }
 
        <b>private static</b> <a href="CommandInfo.cs.html#71babe57a99ca852" class="t t">CommandInfo</a> <a id="138fc8f07f6f6db1" href="../R/138fc8f07f6f6db1.html" target="n" data-glyph="76,1" class="i method">TryModuleAutoLoading</a>(<b>string</b> <span id="r183 rd" class="r183 r">commandName</span>, <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r184 rd" class="r184 r">context</span>, <b>string</b> <span id="r185 rd" class="r185 r">originalCommandName</span>, <a href="SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a> <span id="r186 rd" class="r186 r">commandOrigin</span>, <b>ref</b> <span class="i">Exception</span> <span id="r187 rd" class="r187 r">lastError</span>)
        {
            <a href="CommandInfo.cs.html#71babe57a99ca852" class="t t">CommandInfo</a> <span id="r188 rd" class="r188 r">result</span> = <b>null</b>;
 
            <span class="c">// If commandName was module-qualified. In that case, we should load the module.</span>
            <b>var</b> <span id="r189 rd" class="r189 r">colonOrBackslash</span> = <span class="r183 r">commandName</span>.<span class="i">IndexOfAny</span>(<a href="Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="Utils.cs.html#6fd6d3492cb91f87" class="t t">Separators</a>.<a href="Utils.cs.html#928ae75b04c26cb4" class="i field">ColonOrBackslash</a>);
 
            <span class="c">// If we don&#39;t see &#39;\&#39;, there is no module specified, so no module to load.</span>
            <span class="c">// If we see &#39;:&#39; before &#39;\&#39;, then we probably have a drive qualified path, not a module name</span>
            <b>if</b> (<span class="r189 r">colonOrBackslash</span> == -1 || <span class="r183 r">commandName</span>[<span class="r189 r">colonOrBackslash</span>] == <span class="s">&#39;:&#39;</span>)
                <b>return</b> <b>null</b>;
 
            <b>string</b> <span id="r190 rd" class="r190 r">moduleCommandName</span> = <span class="r183 r">commandName</span>.<span class="i">Substring</span>(<span class="r189 r">colonOrBackslash</span> + 1, <span class="r183 r">commandName</span>.<span class="i">Length</span> - <span class="r189 r">colonOrBackslash</span> - 1);
            <b>string</b> <span id="r191 rd" class="r191 r">moduleName</span>;
 
            <span class="c">// Now we check if there exists the second &#39;\&#39;</span>
            <b>var</b> <span id="r192 rd" class="r192 r">secondBackslash</span> = <span class="r190 r">moduleCommandName</span>.<span class="i">IndexOfAny</span>(<a href="Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="Utils.cs.html#6fd6d3492cb91f87" class="t t">Separators</a>.<a href="Utils.cs.html#247bb446a0dd1494" class="i field">Backslash</a>);
            <b>if</b> (<span class="r192 r">secondBackslash</span> == -1)
            {
                <span class="r191 r">moduleName</span> = <span class="r183 r">commandName</span>.<span class="i">Substring</span>(0, <span class="r189 r">colonOrBackslash</span>);
            }
            <b>else</b>
            {
                <b>string</b> <span id="r193 rd" class="r193 r">versionString</span> = <span class="r190 r">moduleCommandName</span>.<span class="i">Substring</span>(0, <span class="r192 r">secondBackslash</span>);
                <span class="c">// The second &#39;\&#39; could be version specified. eg: &quot;Microsoft.PowerShell.Archive\1.0.0.0\Compress-Archive&quot;, we need to support this scenario</span>
                <span class="i">Version</span> <span id="r194 rd" class="r194 r">version</span>;
                <b>if</b> (<span class="i">Version</span>.<span class="i">TryParse</span>(<span class="r193 r">versionString</span>, <b>out</b> <span class="r194 r">version</span>))
                {
                    <span class="r190 r">moduleCommandName</span> = <span class="r190 r">moduleCommandName</span>.<span class="i">Substring</span>(<span class="r192 r">secondBackslash</span> + 1, <span class="r190 r">moduleCommandName</span>.<span class="i">Length</span> - <span class="r192 r">secondBackslash</span> - 1);
                    <span class="r191 r">moduleName</span> = <span class="r183 r">commandName</span>.<span class="i">Substring</span>(0, <span class="r189 r">colonOrBackslash</span>) + <span class="s">&quot;\\&quot;</span> + <span class="r193 r">versionString</span> + <span class="s">&quot;\\&quot;</span> + <span class="r183 r">commandName</span>.<span class="i">Substring</span>(0, <span class="r189 r">colonOrBackslash</span>) + <span class="s">&quot;.psd1&quot;</span>;
                }
                <b>else</b>
                {
                    <span class="r191 r">moduleName</span> = <span class="r183 r">commandName</span>.<span class="i">Substring</span>(0, <span class="r189 r">colonOrBackslash</span>);
                }
            }
 
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r191 r">moduleName</span>) || <b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r190 r">moduleCommandName</span>) || <span class="r191 r">moduleName</span>.<span class="i">EndsWith</span>(<span class="s">&#39;.&#39;</span>))
                <b>return</b> <b>null</b>;
 
            <b>bool</b> <span id="r195 rd" class="r195 r">etwEnabled</span> = <a href="#3c16c3656953a50c" class="t t">CommandDiscoveryEventSource</a>.<a href="#346fae28f2d8e441" class="i field">Log</a>.<span class="i">IsEnabled</span>();
            <b>if</b> (<span class="r195 r">etwEnabled</span>) <a href="#3c16c3656953a50c" class="t t">CommandDiscoveryEventSource</a>.<a href="#346fae28f2d8e441" class="i field">Log</a>.<a href="#e84b8e1820817577" class="i method">ModuleAutoLoadingStart</a>(<span class="r183 r">commandName</span>);
 
            <b>try</b>
            {
                <a href="#5d9833e2519bb80f" class="i field">discoveryTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Executing module-qualified search: {0}&quot;</span>, <span class="r183 r">commandName</span>);
                <span class="r184 r">context</span>.<a href="ExecutionContext.cs.html#586b706a65389941" class="i property">CommandDiscovery</a>.<a href="#6069adf1e5cad61d" class="i method">RegisterLookupCommandInfoAction</a>(<span class="s">&quot;ActiveModuleSearch&quot;</span>, <span class="r183 r">commandName</span>);
 
                <span class="c">// Verify that auto-loading is only done on for internal commands if it&#39;s not public</span>
                <a href="CmdletInfo.cs.html#9492ffc9968f644d" class="t t">CmdletInfo</a> <span id="r196 rd" class="r196 r">cmdletInfo</span> = <span class="r184 r">context</span>.<a href="ExecutionContext.cs.html#4502619a6e4808ee" class="i property">SessionState</a>.<a href="SessionStatePublic.cs.html#236f6ceba41f8f3e" class="i property">InvokeCommand</a>.<a href="MshCmdlet.cs.html#f14de699060a0394" class="i method">GetCmdlet</a>(<span class="s">&quot;Microsoft.PowerShell.Core\\Import-Module&quot;</span>);
                <b>if</b> ((<span class="r186 r">commandOrigin</span> == <a href="SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a>.<a href="SecurityManagerBase.cs.html#946d8e7ca02acec6" class="i field">Internal</a>) ||
                    ((<span class="r196 r">cmdletInfo</span> != <b>null</b>) &amp;&amp; (<span class="r196 r">cmdletInfo</span>.<a href="CommandInfo.cs.html#cb0c02415aeca7d5" class="i property">Visibility</a> == <a href="SessionStatePublic.cs.html#3acdda74c688180a" class="t t">SessionStateEntryVisibility</a>.<a href="SessionStatePublic.cs.html#74d8ba664c504563" class="i field">Public</a>)))
                {
                    <span class="i">List</span>&lt;<a href="Modules/PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <span id="r197 rd" class="r197 r">existingModule</span> = <span class="r184 r">context</span>.<a href="ExecutionContext.cs.html#2d3edf63c7afa4b2" class="i property">Modules</a>.<a href="Modules/ModuleIntrinsics.cs.html#1c52622ea6eacb86" class="i method">GetModules</a>(<b>new</b> <b>string</b>[] { <span class="r191 r">moduleName</span> }, <b>false</b>);
                    <a href="Modules/PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r198 rd" class="r198 r">discoveredModule</span> = <b>null</b>;
 
                    <b>if</b> (<span class="r197 r">existingModule</span> == <b>null</b> || <span class="r197 r">existingModule</span>.<span class="i">Count</span> == 0)
                    {
                        <a href="#5d9833e2519bb80f" class="i field">discoveryTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Attempting to load module: {0}&quot;</span>, <span class="r191 r">moduleName</span>);
                        <span class="i">Exception</span> <span id="r199 rd" class="r199 r">exception</span>;
                        <span class="i">Collection</span>&lt;<a href="Modules/PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <span id="r200 rd" class="r200 r">importedModule</span> = <a href="#c13a16be6d4187e9" class="i method">AutoloadSpecifiedModule</a>(<span class="r191 r">moduleName</span>, <span class="r184 r">context</span>, <span class="r196 r">cmdletInfo</span>.<a href="CommandInfo.cs.html#cb0c02415aeca7d5" class="i property">Visibility</a>, <b>out</b> <span class="r199 r">exception</span>);
                        <span class="r187 r">lastError</span> = <span class="r199 r">exception</span>;
 
                        <b>if</b> ((<span class="r200 r">importedModule</span> == <b>null</b>) || (<span class="r200 r">importedModule</span>.<span class="i">Count</span> == 0))
                        {
                            <b>string</b> <span id="r201 rd" class="r201 r">error</span> = <a href="../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">DiscoveryExceptions</span>.<span class="i">CouldNotAutoImportModule</span>, <span class="r191 r">moduleName</span>);
                            <a href="../utils/CommandDiscoveryExceptions.cs.html#d61739861b769224" class="t t">CommandNotFoundException</a> <span id="r202 rd" class="r202 r">commandNotFound</span> = <b>new</b> <a href="../utils/CommandDiscoveryExceptions.cs.html#c162ab5344cd50f5" class="t constructor">CommandNotFoundException</a>(
                                <span class="r185 r">originalCommandName</span>,
                                <span class="r187 r">lastError</span>,
                                <span class="s">&quot;CouldNotAutoLoadModule&quot;</span>,
                                <span class="r201 r">error</span>);
                            <b>throw</b> <span class="r202 r">commandNotFound</span>;
                        }
 
                        <span class="r198 r">discoveredModule</span> = <span class="r200 r">importedModule</span>[0];
                    }
                    <b>else</b>
                    {
                        <span class="r198 r">discoveredModule</span> = <span class="r197 r">existingModule</span>[0];
                    }
 
                    <a href="CommandInfo.cs.html#71babe57a99ca852" class="t t">CommandInfo</a> <span id="r203 rd" class="r203 r">exportedResult</span>;
                    <b>if</b> (<span class="r198 r">discoveredModule</span>.<a href="Modules/PSModuleInfo.cs.html#032fe7ae84c51dab" class="i property">ExportedCommands</a>.<span class="i">TryGetValue</span>(<span class="r190 r">moduleCommandName</span>, <b>out</b> <span class="r203 r">exportedResult</span>))
                    {
                        <span class="c">// Return the command if we found a module</span>
                        <span class="r188 r">result</span> = <span class="r203 r">exportedResult</span>;
                    }
                }
            }
            <b>catch</b> (<a href="../utils/CommandDiscoveryExceptions.cs.html#d61739861b769224" class="t t">CommandNotFoundException</a>) { <b>throw</b>; }
            <b>catch</b> (<span class="i">Exception</span>)
            {
            }
            <b>finally</b> { <span class="r184 r">context</span>.<a href="ExecutionContext.cs.html#586b706a65389941" class="i property">CommandDiscovery</a>.<a href="#478216000be61fad" class="i method">UnregisterLookupCommandInfoAction</a>(<span class="s">&quot;ActiveModuleSearch&quot;</span>, <span class="r183 r">commandName</span>); }
 
            <b>if</b> (<span class="r195 r">etwEnabled</span>) <a href="#3c16c3656953a50c" class="t t">CommandDiscoveryEventSource</a>.<a href="#346fae28f2d8e441" class="i field">Log</a>.<a href="#39178d6500b3d0ac" class="i method">ModuleAutoLoadingStop</a>(<span class="r183 r">commandName</span>);
            <b>return</b> <span class="r188 r">result</span>;
        }
 
        <b>internal void</b> <a id="6069adf1e5cad61d" href="../R/6069adf1e5cad61d.html" target="n" data-glyph="74,1" class="i method">RegisterLookupCommandInfoAction</a>(<b>string</b> <span id="r204 rd" class="r204 r">currentAction</span>, <b>string</b> <span id="r205 rd" class="r205 r">command</span>)
        {
            <span class="i">HashSet</span>&lt;<b>string</b>&gt; <span id="r206 rd" class="r206 r">currentActionSet</span> = <b>null</b>;
            <b>switch</b> (<span class="r204 r">currentAction</span>)
            {
                <b>case</b> <span class="s">&quot;ActivePreLookup&quot;</span>: <span class="r206 r">currentActionSet</span> = <a href="#a2bcf1606571790c" class="i field">_activePreLookup</a>; <b>break</b>;
                <b>case</b> <span class="s">&quot;ActiveModuleSearch&quot;</span>: <span class="r206 r">currentActionSet</span> = <a href="#3bfccb3b3ecf045b" class="i field">_activeModuleSearch</a>; <b>break</b>;
                <b>case</b> <span class="s">&quot;ActiveCommandNotFound&quot;</span>: <span class="r206 r">currentActionSet</span> = <a href="#3e47d97b250bd4aa" class="i field">_activeCommandNotFound</a>; <b>break</b>;
                <b>case</b> <span class="s">&quot;ActivePostCommand&quot;</span>: <span class="r206 r">currentActionSet</span> = <a href="#4d1984b505ed7f0b" class="i field">_activePostCommand</a>; <b>break</b>;
            }
 
            <b>if</b> (<span class="r206 r">currentActionSet</span>.<span class="i">Contains</span>(<span class="r205 r">command</span>))
                <b>throw</b> <b>new</b> <span class="i">InvalidOperationException</span>();
            <b>else</b>
                <span class="r206 r">currentActionSet</span>.<span class="i">Add</span>(<span class="r205 r">command</span>);
        }
 
        <b>internal void</b> <a id="478216000be61fad" href="../R/478216000be61fad.html" target="n" data-glyph="74,1" class="i method">UnregisterLookupCommandInfoAction</a>(<b>string</b> <span id="r207 rd" class="r207 r">currentAction</span>, <b>string</b> <span id="r208 rd" class="r208 r">command</span>)
        {
            <span class="i">HashSet</span>&lt;<b>string</b>&gt; <span id="r209 rd" class="r209 r">currentActionSet</span> = <b>null</b>;
            <b>switch</b> (<span class="r207 r">currentAction</span>)
            {
                <b>case</b> <span class="s">&quot;ActivePreLookup&quot;</span>: <span class="r209 r">currentActionSet</span> = <a href="#a2bcf1606571790c" class="i field">_activePreLookup</a>; <b>break</b>;
                <b>case</b> <span class="s">&quot;ActiveModuleSearch&quot;</span>: <span class="r209 r">currentActionSet</span> = <a href="#3bfccb3b3ecf045b" class="i field">_activeModuleSearch</a>; <b>break</b>;
                <b>case</b> <span class="s">&quot;ActiveCommandNotFound&quot;</span>: <span class="r209 r">currentActionSet</span> = <a href="#3e47d97b250bd4aa" class="i field">_activeCommandNotFound</a>; <b>break</b>;
                <b>case</b> <span class="s">&quot;ActivePostCommand&quot;</span>: <span class="r209 r">currentActionSet</span> = <a href="#4d1984b505ed7f0b" class="i field">_activePostCommand</a>; <b>break</b>;
            }
 
            <b>if</b> (<span class="r209 r">currentActionSet</span>.<span class="i">Contains</span>(<span class="r208 r">command</span>))
                <span class="r209 r">currentActionSet</span>.<span class="i">Remove</span>(<span class="r208 r">command</span>);
        }
 
        <b>private readonly</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt; <a id="a2bcf1606571790c" href="../R/a2bcf1606571790c.html" target="n" data-glyph="46,1" class="i field">_activePreLookup</a> = <b>new</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt;(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>);
        <b>private readonly</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt; <a id="3bfccb3b3ecf045b" href="../R/3bfccb3b3ecf045b.html" target="n" data-glyph="46,1" class="i field">_activeModuleSearch</a> = <b>new</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt;(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>);
        <b>private readonly</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt; <a id="3e47d97b250bd4aa" href="../R/3e47d97b250bd4aa.html" target="n" data-glyph="46,1" class="i field">_activeCommandNotFound</a> = <b>new</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt;(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>);
        <b>private readonly</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt; <a id="4d1984b505ed7f0b" href="../R/4d1984b505ed7f0b.html" target="n" data-glyph="46,1" class="i field">_activePostCommand</a> = <b>new</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt;(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the resolved paths contained in the PATH environment</span>
        <span class="c">///</span><span class="c"> variable.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The contents of the PATH environment variable split on System.IO.Path.PathSeparator.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The result is an ordered list of paths with paths starting with &quot;.&quot; unresolved until lookup time.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>internal</b> <a href="#57824bf3a39bbcd1" class="t t">LookupPathCollection</a> <a id="9e0a3ce76f51b028" href="../R/9e0a3ce76f51b028.html" target="n" data-glyph="74,1" class="i method">GetLookupDirectoryPaths</a>()
        {
            <a href="#57824bf3a39bbcd1" class="t t">LookupPathCollection</a> <span id="r210 rd" class="r210 r">result</span> = <b>new</b> <a href="#e8f6b7a7bef770f5" class="t constructor">LookupPathCollection</a>();
 
            <b>string</b> <span id="r211 rd" class="r211 r">path</span> = <span class="i">Environment</span>.<span class="i">GetEnvironmentVariable</span>(<span class="s">&quot;PATH&quot;</span>);
 
            <a href="#5d9833e2519bb80f" class="i field">discoveryTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(
                <span class="s">&quot;PATH: {0}&quot;</span>,
                <span class="r211 r">path</span>);
 
            <b>bool</b> <span id="r212 rd" class="r212 r">isPathCacheValid</span> =
                <span class="r211 r">path</span> != <b>null</b> &amp;&amp;
                <b>string</b>.<span class="i">Equals</span>(<a href="#dcee29bd651bf5d4" class="i field">_pathCacheKey</a>, <span class="r211 r">path</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) &amp;&amp;
                <a href="#5179dc2799fa1c47" class="i field">_cachedPath</a> != <b>null</b>;
 
            <b>if</b> (!<span class="r212 r">isPathCacheValid</span>)
            {
                <span class="c">// Reset the cached lookup paths</span>
                <a href="#6a3865bb50f942cb" class="i field">_cachedLookupPaths</a> = <b>null</b>;
 
                <span class="c">// Tokenize the path and cache it</span>
 
                <a href="#dcee29bd651bf5d4" class="i field">_pathCacheKey</a> = <span class="r211 r">path</span>;
 
                <b>if</b> (<a href="#dcee29bd651bf5d4" class="i field">_pathCacheKey</a> != <b>null</b>)
                {
                    <b>string</b>[] <span id="r213 rd" class="r213 r">tokenizedPath</span> = <a href="#dcee29bd651bf5d4" class="i field">_pathCacheKey</a>.<span class="i">Split</span>(<a href="Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="Utils.cs.html#6fd6d3492cb91f87" class="t t">Separators</a>.<a href="Utils.cs.html#016bc808c2acadd4" class="i field">PathSeparator</a>, <span class="i">StringSplitOptions</span>.<span class="i">RemoveEmptyEntries</span>);
                    <a href="#5179dc2799fa1c47" class="i field">_cachedPath</a> = <b>new</b> <span class="i">Collection</span>&lt;<b>string</b>&gt;();
 
                    <b>foreach</b> (<b>string</b> <span id="r214 rd" class="r214 r">directory</span> <b>in</b> <span class="r213 r">tokenizedPath</span>)
                    {
                        <b>string</b> <span id="r215 rd" class="r215 r">tempDir</span> = <span class="r214 r">directory</span>.<span class="i">TrimStart</span>();
                        <b>if</b> (<span class="r215 r">tempDir</span>.<a href="parser/TypeInferenceVisitor.cs.html#f162fefed69a1305" class="i method">EqualsOrdinalIgnoreCase</a>(<span class="s">&quot;~&quot;</span>))
                        {
                            <span class="r215 r">tempDir</span> = <span class="i">Environment</span>.<span class="i">GetFolderPath</span>(<span class="i">Environment</span>.<span class="i">SpecialFolder</span>.<span class="i">UserProfile</span>);
                        }
                        <b>else</b> <b>if</b> (<span class="r215 r">tempDir</span>.<span class="i">StartsWith</span>(<span class="s">&quot;~&quot;</span> + <span class="i">Path</span>.<span class="i">DirectorySeparatorChar</span>))
                        {
                            <span class="r215 r">tempDir</span> = <span class="i">Environment</span>.<span class="i">GetFolderPath</span>(<span class="i">Environment</span>.<span class="i">SpecialFolder</span>.<span class="i">UserProfile</span>) + <span class="i">Path</span>.<span class="i">DirectorySeparatorChar</span> + <span class="r215 r">tempDir</span>.<span class="i">Substring</span>(2);
                        }
 
                        <a href="#5179dc2799fa1c47" class="i field">_cachedPath</a>.<span class="i">Add</span>(<span class="r215 r">tempDir</span>);
                        <span class="r210 r">result</span>.<a href="#5bf39696caf7c517" class="i method">Add</a>(<span class="r215 r">tempDir</span>);
                    }
                }
            }
            <b>else</b>
            {
                <span class="r210 r">result</span>.<span class="i">AddRange</span>(<a href="#5179dc2799fa1c47" class="i field">_cachedPath</a>);
            }
 
            <span class="c">// Cache the new lookup paths</span>
            <b>return</b> <a href="#6a3865bb50f942cb" class="i field">_cachedLookupPaths</a> ??= <span class="r210 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The cached list of lookup paths. It can be invalidated by</span>
        <span class="c">///</span><span class="c"> the PATH changing.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private</b> <a href="#57824bf3a39bbcd1" class="t t">LookupPathCollection</a> <a id="6a3865bb50f942cb" href="../R/6a3865bb50f942cb.html" target="n" data-glyph="46,1" class="i field">_cachedLookupPaths</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The key that determines if the cached PATH can be used.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private string</b> <a id="dcee29bd651bf5d4" href="../R/dcee29bd651bf5d4.html" target="n" data-glyph="46,1" class="i field">_pathCacheKey</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The cache of the tokenized PATH directories.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private</b> <span class="i">Collection</span>&lt;<b>string</b>&gt; <a id="5179dc2799fa1c47" href="../R/5179dc2799fa1c47.html" target="n" data-glyph="46,1" class="i field">_cachedPath</a>;
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> internal members
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> environment variable helpers
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the PATHEXT environment variable extensions and tokenizes them.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static string</b>[] <a id="9bf9d4eaf7ff2fb4" href="../R/9bf9d4eaf7ff2fb4.html" target="n" data-glyph="104,1" class="i property">PathExtensionsWithPs1Prepended</a>
        {
            <b>get</b>
            {
                <b>var</b> <span id="r216 rd" class="r216 r">pathExt</span> = <span class="i">Environment</span>.<span class="i">GetEnvironmentVariable</span>(<span class="s">&quot;PATHEXT&quot;</span>);
 
                <b>if</b> (!<b>string</b>.<span class="i">Equals</span>(<span class="r216 r">pathExt</span>, <a href="#bd067a050f22fcd0" class="i field">s_pathExtCacheKey</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) ||
                    <a href="#3f5d6f73ea792d51" class="i field">s_cachedPathExtCollection</a> == <b>null</b>)
                {
                    <span class="i">InitPathExtCache</span>(<span class="r216 r">pathExt</span>);
                }
 
                <b>return</b> <a href="#e766c87eee9b2798" class="i field">s_cachedPathExtCollectionWithPs1</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the PATHEXT environment variable extensions and tokenizes them.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static string</b>[] <a id="bfb5c06a04a1d33d" href="../R/bfb5c06a04a1d33d.html" target="n" data-glyph="104,1" class="i property">PathExtensions</a>
        {
            <b>get</b>
            {
                <b>var</b> <span id="r217 rd" class="r217 r">pathExt</span> = <span class="i">Environment</span>.<span class="i">GetEnvironmentVariable</span>(<span class="s">&quot;PATHEXT&quot;</span>);
 
                <b>if</b> (!<b>string</b>.<span class="i">Equals</span>(<span class="r217 r">pathExt</span>, <a href="#bd067a050f22fcd0" class="i field">s_pathExtCacheKey</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) ||
                    <a href="#3f5d6f73ea792d51" class="i field">s_cachedPathExtCollection</a> == <b>null</b>)
                {
                    <span class="i">InitPathExtCache</span>(<span class="r217 r">pathExt</span>);
                }
 
                <b>return</b> <a href="#3f5d6f73ea792d51" class="i field">s_cachedPathExtCollection</a>;
            }
        }
 
        <b>private static void</b> <a id="1c84ac0a74310cdd" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">InitPathExtCache</a>(<b>string</b> <span id="r218 rd" class="r218 r">pathExt</span>)
        {
            <b>lock</b> (<a href="#ce0ba38b83c3518b" class="i field">s_lockObject</a>)
            {
                <a href="#3f5d6f73ea792d51" class="i field">s_cachedPathExtCollection</a> = <span class="r218 r">pathExt</span> != <b>null</b>
                    ? <span class="r218 r">pathExt</span>.<span class="i">ToLower</span>().<span class="i">Split</span>(<a href="Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="Utils.cs.html#6fd6d3492cb91f87" class="t t">Separators</a>.<a href="Utils.cs.html#016bc808c2acadd4" class="i field">PathSeparator</a>, <span class="i">StringSplitOptions</span>.<span class="i">RemoveEmptyEntries</span>)
                    : <span class="i">Array</span>.<span class="i">Empty</span>&lt;<b>string</b>&gt;();
                <a href="#e766c87eee9b2798" class="i field">s_cachedPathExtCollectionWithPs1</a> = <b>new</b> <b>string</b>[<a href="#3f5d6f73ea792d51" class="i field">s_cachedPathExtCollection</a>.<span class="i">Length</span> + 1];
                <a href="#e766c87eee9b2798" class="i field">s_cachedPathExtCollectionWithPs1</a>[0] = <a href="SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="SessionStateStrings.cs.html#2338784ad03a106f" class="i field">PowerShellScriptFileExtension</a>;
                <span class="i">Array</span>.<span class="i">Copy</span>(<a href="#3f5d6f73ea792d51" class="i field">s_cachedPathExtCollection</a>, 0, <a href="#e766c87eee9b2798" class="i field">s_cachedPathExtCollectionWithPs1</a>, 1, <a href="#3f5d6f73ea792d51" class="i field">s_cachedPathExtCollection</a>.<span class="i">Length</span>);
 
                <a href="#bd067a050f22fcd0" class="i field">s_pathExtCacheKey</a> = <span class="r218 r">pathExt</span>;
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> environment variable helpers
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> private members
 
        <b>private static readonly object</b> <a id="ce0ba38b83c3518b" href="../R/ce0ba38b83c3518b.html" target="n" data-glyph="46,1" class="i field">s_lockObject</a> = <b>new</b> <b>object</b>();
        <b>private static string</b> <a id="bd067a050f22fcd0" href="../R/bd067a050f22fcd0.html" target="n" data-glyph="46,1" class="i field">s_pathExtCacheKey</a>;
        <b>private static string</b>[] <a id="3f5d6f73ea792d51" href="../R/3f5d6f73ea792d51.html" target="n" data-glyph="46,1" class="i field">s_cachedPathExtCollection</a>;
        <b>private static string</b>[] <a id="e766c87eee9b2798" href="../R/e766c87eee9b2798.html" target="n" data-glyph="46,1" class="i field">s_cachedPathExtCollectionWithPs1</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the cmdlet information for the specified name.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r219 r">cmdletName</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The name of the cmdlet to return the information for.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r220 r">searchAllScopes</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> True if we should search all scopes, false if we should stop after finding the first.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The CmdletInfo for the cmdlet for all the cmdlets with the specified name.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r219 r">cmdletName</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null or empty.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">IEnumerator</span>&lt;<a href="CmdletInfo.cs.html#9492ffc9968f644d" class="t t">CmdletInfo</a>&gt; <a id="43c1c6300a16d1ae" href="../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">GetCmdletInfo</a>(<b>string</b> <span id="r219 rd" class="r219 r">cmdletName</span>, <b>bool</b> <span id="r220 rd" class="r220 r">searchAllScopes</span>)
        {
            <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r219 r">cmdletName</span>), <span class="s">&quot;Caller should verify the cmdletName&quot;</span>);
 
            <a href="MshSnapinQualifiedName.cs.html#93cb5bb27e91d97d" class="t t">PSSnapinQualifiedName</a> <span id="r221 rd" class="r221 r">commandName</span> = <a href="MshSnapinQualifiedName.cs.html#93cb5bb27e91d97d" class="t t">PSSnapinQualifiedName</a>.<span class="i">GetInstance</span>(<span class="r219 r">cmdletName</span>);
 
            <b>if</b> (<span class="r221 r">commandName</span> == <b>null</b>)
            {
                <b>yield</b> <b>break</b>;
            }
 
            <span class="c">// Check the current cmdlet cache then check the top level</span>
            <span class="c">// if we aren&#39;t already at the top level.</span>
            <a href="SessionStateScopeEnumerator.cs.html#8788a8469feccecf" class="t t">SessionStateScopeEnumerator</a> <span id="r222 rd" class="r222 r">scopeEnumerator</span> =
                <b>new</b> <a href="SessionStateScopeEnumerator.cs.html#5e5d2a8d36a22ba8" class="t constructor">SessionStateScopeEnumerator</a>(<a href="#b927e58b8d40bcae" class="i property">Context</a>.<a href="ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="SessionStateScopeAPIs.cs.html#224987ad36a90f88" class="i property">CurrentScope</a>);
 
            <b>foreach</b> (<a href="SessionStateScope.cs.html#460261155e0163cb" class="t t">SessionStateScope</a> <span id="r223 rd" class="r223 r">scope</span> <b>in</b> <span class="r222 r">scopeEnumerator</span>)
            {
                <span class="i">List</span>&lt;<a href="CmdletInfo.cs.html#9492ffc9968f644d" class="t t">CmdletInfo</a>&gt; <span id="r224 rd" class="r224 r">cmdlets</span>;
                <b>if</b> (!<span class="r223 r">scope</span>.<a href="SessionStateScope.cs.html#bedca0fe0b1b3026" class="i property">CmdletTable</a>.<span class="i">TryGetValue</span>(<span class="r221 r">commandName</span>.<a href="MshSnapinQualifiedName.cs.html#cb4b6868a9751795" class="i property">ShortName</a>, <b>out</b> <span class="r224 r">cmdlets</span>))
                {
                    <b>continue</b>;
                }
 
                <b>foreach</b> (<b>var</b> <span id="r225 rd" class="r225 r">cmdletInfo</span> <b>in</b> <span class="r224 r">cmdlets</span>)
                {
                    <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r221 r">commandName</span>.<a href="MshSnapinQualifiedName.cs.html#2638d2d5a054bb72" class="i property">PSSnapInName</a>))
                    {
                        <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<span class="r225 r">cmdletInfo</span>.<span class="i">ModuleName</span>, <span class="r221 r">commandName</span>.<a href="MshSnapinQualifiedName.cs.html#2638d2d5a054bb72" class="i property">PSSnapInName</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                        {
                            <b>yield</b> <b>return</b> <span class="r225 r">cmdletInfo</span>;
                            <b>if</b> (!<span class="r220 r">searchAllScopes</span>)
                            {
                                <b>yield</b> <b>break</b>;
                            }
                        }
                        <span class="c">// The engine cmdlets get imported (via Import-Module) once when PowerShell starts and the cmdletInfo is added to PSSnapinHelpers._cmdletcache(static) with ModuleName</span>
                        <span class="c">// as &quot;System.Management.Automation.dll&quot; instead of the actual snapin name. The next time we load something in an InitialSessionState, we look at this _cmdletcache and</span>
                        <span class="c">// if the the assembly is already loaded, we just return the cmdlets back. So, the CmdletInfo has moduleName has &quot;System.Management.Automation.dll&quot;. So, when M3P Activity</span>
                        <span class="c">// tries to access Microsoft.PowerShell.Core\\Get-Command, it cannot. So, adding an additional check to return the correct cmdletInfo for cmdlets from core modules.</span>
                        <b>else</b> <b>if</b> (<a href="InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a>.<span class="i">IsEngineModule</span>(<span class="r225 r">cmdletInfo</span>.<span class="i">ModuleName</span>))
                        {
                            <b>if</b> (<b>string</b>.<span class="i">Equals</span>(
                                <span class="r225 r">cmdletInfo</span>.<span class="i">ModuleName</span>,
                                <a href="InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a>.<span class="i">GetNestedModuleDllName</span>(<span class="r221 r">commandName</span>.<a href="MshSnapinQualifiedName.cs.html#2638d2d5a054bb72" class="i property">PSSnapInName</a>),
                                <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                            {
                                <b>yield</b> <b>return</b> <span class="r225 r">cmdletInfo</span>;
                                <b>if</b> (!<span class="r220 r">searchAllScopes</span>)
                                {
                                    <b>yield</b> <b>break</b>;
                                }
                            }
                        }
                    }
                    <b>else</b>
                    {
                        <b>yield</b> <b>return</b> <span class="r225 r">cmdletInfo</span>;
                        <b>if</b> (!<span class="r220 r">searchAllScopes</span>)
                        {
                            <b>yield</b> <b>break</b>;
                        }
                    }
                }
            }
        }
 
        <b>internal</b> <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <a id="b927e58b8d40bcae" href="../R/b927e58b8d40bcae.html" target="n" data-glyph="104,1" class="i property">Context</a> { <b>get</b>; }
 
        <b>internal static</b> <a href="#c476355d983131b8" class="t t">PSModuleAutoLoadingPreference</a> <a id="6495e4b39d68b6a7" href="../R/6495e4b39d68b6a7.html" target="n" data-glyph="74,1" class="i method">GetCommandDiscoveryPreference</a>(<a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r226 rd" class="r226 r">context</span>, <a href="VariablePath.cs.html#41e5b41974741cc5" class="t t">VariablePath</a> <span id="r227 rd" class="r227 r">variablePath</span>, <b>string</b> <span id="r228 rd" class="r228 r">environmentVariable</span>)
        {
            <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r226 r">context</span> != <b>null</b>, <span class="s">&quot;context cannot be Null&quot;</span>);
            <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r227 r">variablePath</span> != <b>null</b>, <span class="s">&quot;variablePath must be non empty&quot;</span>);
            <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r228 r">environmentVariable</span>), <span class="s">&quot;environmentVariable must be non empty&quot;</span>);
 
            <b>if</b> (<span class="r226 r">context</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r226 r">context</span>));
            }
 
            <span class="c">// check the PSVariable</span>
            <b>object</b> <span id="r229 rd" class="r229 r">result</span> = <span class="r226 r">context</span>.<a href="ExecutionContext.cs.html#3a6f9a48ec862dfb" class="i method">GetVariableValue</a>(<span class="r227 r">variablePath</span>);
 
            <b>try</b>
            {
                <b>if</b> (<span class="r229 r">result</span> != <b>null</b>)
                {
                    <b>return</b> <a href="LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="LanguagePrimitives.cs.html#8b9327b10b12742d" class="i method">ConvertTo</a>&lt;<a href="#c476355d983131b8" class="t t">PSModuleAutoLoadingPreference</a>&gt;(<span class="r229 r">result</span>);
                }
 
                <span class="c">// check the environment variable</span>
                <b>string</b> <span id="r230 rd" class="r230 r">psEnvironmentVariable</span> = <span class="i">Environment</span>.<span class="i">GetEnvironmentVariable</span>(<span class="r228 r">environmentVariable</span>);
                <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r230 r">psEnvironmentVariable</span>))
                {
                    <b>return</b> <a href="LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="LanguagePrimitives.cs.html#8b9327b10b12742d" class="i method">ConvertTo</a>&lt;<a href="#c476355d983131b8" class="t t">PSModuleAutoLoadingPreference</a>&gt;(<span class="r230 r">psEnvironmentVariable</span>);
                }
            }
            <b>catch</b> (<span class="i">Exception</span>)
            {
                <b>return</b> <a href="#c476355d983131b8" class="t t">PSModuleAutoLoadingPreference</a>.<a href="#24f5e6dfa3261542" class="i field">All</a>;
            }
 
            <b>return</b> <a href="#c476355d983131b8" class="t t">PSModuleAutoLoadingPreference</a>.<a href="#24f5e6dfa3261542" class="i field">All</a>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> A helper collection of strings that doesn&#39;t allow duplicate strings. Comparison</span>
    <span class="c">///</span><span class="c"> is case-insensitive and done in the invariant culture.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal class</b> <a id="57824bf3a39bbcd1" href="../R/57824bf3a39bbcd1.html" target="n" data-glyph="2,0" class="t t">LookupPathCollection</a> : <span class="i">Collection</span>&lt;<b>string</b>&gt;
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Default constructor.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a id="e8f6b7a7bef770f5" href="../R/e8f6b7a7bef770f5.html" target="n" data-glyph="74,1" class="t constructor">LookupPathCollection</a>() : <b>base</b>() { }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Constructs a LookupPathCollection object and adds all the items</span>
        <span class="c">///</span><span class="c"> in the supplied collection to it.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r231 r">collection</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A set of items to be added to the collection.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal</b> <a id="3849e41a0b21af2e" href="../R/../../0000000000.html" target="n" data-glyph="74,1" class="t constructor">LookupPathCollection</a>(<span class="i">IEnumerable</span>&lt;<b>string</b>&gt; <span id="r231 rd" class="r231 r">collection</span>) : <b>base</b>()
        {
            <b>foreach</b> (<b>string</b> <span id="r232 rd" class="r232 r">item</span> <b>in</b> <span class="r231 r">collection</span>)
            {
                <a href="#5bf39696caf7c517" class="i method">Add</a>(<span class="r232 r">item</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Adds the specified string to the collection if its not already</span>
        <span class="c">///</span><span class="c"> a member of the collection.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r233 r">item</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The string to add to the collection.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The index at which the string was added or -1 if it was not added.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public</b> <b>new</b> <b>int</b> <a id="5bf39696caf7c517" href="../R/5bf39696caf7c517.html" target="n" data-glyph="72,1" class="i method">Add</a>(<b>string</b> <span id="r233 rd" class="r233 r">item</span>)
        {
            <b>int</b> <span id="r234 rd" class="r234 r">result</span> = -1;
            <b>if</b> (!<a href="#43fb54ad9d6a3920" class="i method">Contains</a>(<span class="r233 r">item</span>))
            {
                <b>base</b>.<span class="i">Add</span>(<span class="r233 r">item</span>);
                <span class="r234 r">result</span> = <b>base</b>.<span class="i">IndexOf</span>(<span class="r233 r">item</span>);
            }
 
            <b>return</b> <span class="r234 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Adds all the strings in the specified collection to this collection.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r235 r">collection</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The collection of strings to add.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Only the strings that are not already in the collection will be added.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="1bce1b43bdccc830" href="../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">AddRange</a>(<span class="i">ICollection</span>&lt;<b>string</b>&gt; <span id="r235 rd" class="r235 r">collection</span>)
        {
            <b>foreach</b> (<b>string</b> <span id="r236 rd" class="r236 r">name</span> <b>in</b> <span class="r235 r">collection</span>)
            {
                <a href="#5bf39696caf7c517" class="i method">Add</a>(<span class="r236 r">name</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Determines if the string already exists in the collection</span>
        <span class="c">///</span><span class="c"> using a invariant culture case insensitive comparison.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r237 r">item</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The string to check for existence.</span>
        <span class="c">///</span><span class="c">  </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> True if the string already exists in the collection.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public</b> <b>new</b> <b>bool</b> <a id="43fb54ad9d6a3920" href="../R/43fb54ad9d6a3920.html" target="n" data-glyph="72,1" class="i method">Contains</a>(<b>string</b> <span id="r237 rd" class="r237 r">item</span>)
        {
            <b>bool</b> <span id="r238 rd" class="r238 r">result</span> = <b>false</b>;
 
            <b>foreach</b> (<b>string</b> <span id="r239 rd" class="r239 r">name</span> <b>in</b> <a href="#57824bf3a39bbcd1" class="k">this</a>)
            {
                <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<span class="r237 r">item</span>, <span class="r239 r">name</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <span class="r238 r">result</span> = <b>true</b>;
                    <b>break</b>;
                }
            }
 
            <b>return</b> <span class="r238 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns a collection of all the indexes that are relative paths.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A collection of all the indexes that are relative paths.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">Collection</span>&lt;<b>int</b>&gt; <a id="2af9555c6dcc416d" href="../R/2af9555c6dcc416d.html" target="n" data-glyph="74,1" class="i method">IndexOfRelativePath</a>()
        {
            <span class="i">Collection</span>&lt;<b>int</b>&gt; <span id="r240 rd" class="r240 r">result</span> = <b>new</b> <span class="i">Collection</span>&lt;<b>int</b>&gt;();
 
            <b>for</b> (<b>int</b> <span id="r241 rd" class="r241 r">index</span> = 0; <span class="r241 r">index</span> &lt; <a href="#57824bf3a39bbcd1" class="k">this</a>.<span class="i">Count</span>; ++<span class="r241 r">index</span>)
            {
                <b>string</b> <span id="r242 rd" class="r242 r">path</span> = <a href="#57824bf3a39bbcd1" class="k">this</a>[<span class="r241 r">index</span>];
                <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r242 r">path</span>) &amp;&amp;
                    <span class="r242 r">path</span>.<span class="i">StartsWith</span>(<span class="s">&#39;.&#39;</span>))
                {
                    <span class="r240 r">result</span>.<span class="i">Add</span>(<span class="r241 r">index</span>);
                }
            }
 
            <b>return</b> <span class="r240 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Finds the first index of the specified string. The string</span>
        <span class="c">///</span><span class="c"> is compared in the invariant culture using a case-insensitive comparison.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r243 r">item</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The string to look for.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The index of the string in the collection or -1 if it was not found.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r243 r">item</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null or empty.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public</b> <b>new</b> <b>int</b> <a id="f0e5086ce238a8ca" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">IndexOf</a>(<b>string</b> <span id="r243 rd" class="r243 r">item</span>)
        {
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r243 r">item</span>))
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fed5f40dc0075d41" class="i method">NewArgumentException</a>(<b>nameof</b>(<span class="r243 r">item</span>));
            }
 
            <b>int</b> <span id="r244 rd" class="r244 r">result</span> = -1;
 
            <b>for</b> (<b>int</b> <span id="r245 rd" class="r245 r">index</span> = 0; <span class="r245 r">index</span> &lt; <a href="#57824bf3a39bbcd1" class="k">this</a>.<span class="i">Count</span>; ++<span class="r245 r">index</span>)
            {
                <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<a href="#57824bf3a39bbcd1" class="k">this</a>[<span class="r245 r">index</span>], <span class="r243 r">item</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <span class="r244 r">result</span> = <span class="r245 r">index</span>;
                    <b>break</b>;
                }
            }
 
            <b>return</b> <span class="r244 r">result</span>;
        }
    }
 
    <span class="c">// Guid is {ea9e8155-5042-5537-0b73-8c0e6b53f398}</span>
 
    [<span class="i">EventSource</span>(<span class="i">Name</span> = <span class="s">&quot;Microsoft-PowerShell-CommandDiscovery&quot;</span>)]
    <b>internal class</b> <a id="3c16c3656953a50c" href="../R/3c16c3656953a50c.html" target="n" data-glyph="2,0" class="t t"><span id="cdebcacc2318f0d8">CommandDiscoveryEventSource</span></a> : <span class="i">EventSource</span>
    {
        <b>internal static readonly</b> <a href="#3c16c3656953a50c" class="t t">CommandDiscoveryEventSource</a> <a id="346fae28f2d8e441" href="../R/346fae28f2d8e441.html" target="n" data-glyph="44,1" class="i field">Log</a> = <b>new</b> <span class="t">CommandDiscoveryEventSource</span>();
 
        <b>public void</b> <a id="3d3887fee9ce7444" href="../R/3d3887fee9ce7444.html" target="n" data-glyph="72,1" class="i method">CommandLookupStart</a>(<b>string</b> <span id="r246 rd" class="r246 r">CommandName</span>) { <span class="i">WriteEvent</span>(1, <span class="r246 r">CommandName</span>); }
 
        <b>public void</b> <a id="ca542609fd16903c" href="../R/ca542609fd16903c.html" target="n" data-glyph="72,1" class="i method">CommandLookupStop</a>(<b>string</b> <span id="r247 rd" class="r247 r">CommandName</span>) { <span class="i">WriteEvent</span>(2, <span class="r247 r">CommandName</span>); }
 
        <b>public void</b> <a id="e84b8e1820817577" href="../R/e84b8e1820817577.html" target="n" data-glyph="72,1" class="i method">ModuleAutoLoadingStart</a>(<b>string</b> <span id="r248 rd" class="r248 r">CommandName</span>) { <span class="i">WriteEvent</span>(3, <span class="r248 r">CommandName</span>); }
 
        <b>public void</b> <a id="39178d6500b3d0ac" href="../R/39178d6500b3d0ac.html" target="n" data-glyph="72,1" class="i method">ModuleAutoLoadingStop</a>(<b>string</b> <span id="r249 rd" class="r249 r">CommandName</span>) { <span class="i">WriteEvent</span>(4, <span class="r249 r">CommandName</span>); }
 
        <b>public void</b> <a id="5cc5dd1b196d17e5" href="../R/5cc5dd1b196d17e5.html" target="n" data-glyph="72,1" class="i method">ModuleAutoDiscoveryStart</a>(<b>string</b> <span id="r250 rd" class="r250 r">CommandName</span>) { <span class="i">WriteEvent</span>(5, <span class="r250 r">CommandName</span>); }
 
        <b>public void</b> <a id="ee282c89a7b55579" href="../R/ee282c89a7b55579.html" target="n" data-glyph="72,1" class="i method">ModuleAutoDiscoveryStop</a>(<b>string</b> <span id="r251 rd" class="r251 r">CommandName</span>) { <span class="i">WriteEvent</span>(6, <span class="r251 r">CommandName</span>); }
 
        <b>public void</b> <a id="212b33b9dd2b2fde" href="../R/212b33b9dd2b2fde.html" target="n" data-glyph="72,1" class="i method">SearchingForModuleFilesStart</a>() { <span class="i">WriteEvent</span>(7); }
 
        <b>public void</b> <a id="02dc92d90689a88e" href="../R/02dc92d90689a88e.html" target="n" data-glyph="72,1" class="i method">SearchingForModuleFilesStop</a>() { <span class="i">WriteEvent</span>(8); }
 
        <b>public void</b> <a id="1de09a0b4cd435f1" href="../R/1de09a0b4cd435f1.html" target="n" data-glyph="72,1" class="i method">GetModuleExportedCommandsStart</a>(<b>string</b> <span id="r252 rd" class="r252 r">ModulePath</span>) { <span class="i">WriteEvent</span>(9, <span class="r252 r">ModulePath</span>); }
 
        <b>public void</b> <a id="ce82d83eb94ae56d" href="../R/ce82d83eb94ae56d.html" target="n" data-glyph="72,1" class="i method">GetModuleExportedCommandsStop</a>(<b>string</b> <span id="r253 rd" class="r253 r">ModulePath</span>) { <span class="i">WriteEvent</span>(10, <span class="r253 r">ModulePath</span>); }
 
        <b>public void</b> <a id="df6a31ee4c71c191" href="../R/df6a31ee4c71c191.html" target="n" data-glyph="72,1" class="i method">ModuleManifestAnalysisResult</a>(<b>string</b> <span id="r254 rd" class="r254 r">ModulePath</span>, <b>bool</b> <span id="r255 rd" class="r255 r">Success</span>) { <span class="i">WriteEvent</span>(11, <span class="r254 r">ModulePath</span>, <span class="r255 r">Success</span>); }
 
        <b>public void</b> <a id="d9829408d915505c" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ModuleManifestAnalysisException</a>(<b>string</b> <span id="r256 rd" class="r256 r">ModulePath</span>, <b>string</b> <span id="r257 rd" class="r257 r">Exception</span>) { <span class="i">WriteEvent</span>(12, <span class="r256 r">ModulePath</span>, <span class="r257 r">Exception</span>); }
    }
}
</pre></td></tr></table></div></body></html>
