<!DOCTYPE html>
<html><head><title>CommandProcessorBase.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(966);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#System.Management.Automation/engine/CommandProcessorBase.cs" target="_top">engine\CommandProcessorBase.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#System.Management.Automation" target="_top">src\System.Management.Automation\System.Management.Automation.csproj</a> (System.Management.Automation)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">ObjectModel</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Internal</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Language</span>;
 
<b>using</b> <span class="t">Dbg</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>;
 
<b>namespace</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> The base class for all command processor classes. It provides</span>
    <span class="c">///</span><span class="c"> abstract methods to execute a command.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal abstract class</b> <a id="45a6054a3775cde6" href="../R/45a6054a3775cde6.html" target="n" data-glyph="2,0" class="t t">CommandProcessorBase</a> : <span class="i">IDisposable</span>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> ctor
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Default constructor.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a id="dbc0f9bab0ed1b35" href="../R/../../0000000000.html" target="n" data-glyph="74,1" class="t constructor">CommandProcessorBase</a>()
        {
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initializes the base command processor class with the command metadata.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">commandInfo</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The metadata about the command to run.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal</b> <a id="64e9365f7027b222" href="../R/64e9365f7027b222.html" target="n" data-glyph="74,1" class="t constructor">CommandProcessorBase</a>(<a href="CommandInfo.cs.html#71babe57a99ca852" class="t t">CommandInfo</a> <span id="r0 rd" class="r0 r">commandInfo</span>)
        {
            <b>if</b> (<span class="r0 r">commandInfo</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r0 r">commandInfo</span>));
            }
 
            <b>if</b> (<span class="r0 r">commandInfo</span> <b>is</b> <a href="CommandInfo.cs.html#2ae2bf5bb21a5a53" class="t t">IScriptCommandInfo</a> <span id="r1 rd" class="r1 r">scriptCommand</span>)
            {
                <a href="ExperimentalFeature/ExperimentalFeature.cs.html#a9ee2c313b8e7ce8" class="t t">ExperimentalAttribute</a> <span id="r2 rd" class="r2 r">expAttribute</span> = <span class="r1 r">scriptCommand</span>.<a href="CommandInfo.cs.html#753af6705016f48b" class="i property">ScriptBlock</a>.<a href="runtime/CompiledScriptBlock.cs.html#91492ca459ac2cd6" class="i property">ExperimentalAttribute</a>;
                <b>if</b> (<span class="r2 r">expAttribute</span> != <b>null</b> &amp;&amp; <span class="r2 r">expAttribute</span>.<a href="ExperimentalFeature/ExperimentalFeature.cs.html#5f379d0c61d42350" class="i property">ToHide</a>)
                {
                    <b>string</b> <span id="r3 rd" class="r3 r">errorTemplate</span> = <span class="r2 r">expAttribute</span>.<a href="ExperimentalFeature/ExperimentalFeature.cs.html#20a9ca428bdbcbe5" class="i property">ExperimentAction</a> == <a href="ExperimentalFeature/ExperimentalFeature.cs.html#7c48b7b0fa5fcf50" class="t t">ExperimentAction</a>.<a href="ExperimentalFeature/ExperimentalFeature.cs.html#b680ff9e715e3e46" class="i field">Hide</a>
                        ? <span class="i">DiscoveryExceptions</span>.<span class="i">ScriptDisabledWhenFeatureOn</span>
                        : <span class="i">DiscoveryExceptions</span>.<span class="i">ScriptDisabledWhenFeatureOff</span>;
                    <b>string</b> <span id="r4 rd" class="r4 r">errorMsg</span> = <a href="../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<a href="../utils/StringUtil.cs.html#6dd43165d0b5d92f" class="i method">Format</a>(<span class="r3 r">errorTemplate</span>, <span class="r2 r">expAttribute</span>.<a href="ExperimentalFeature/ExperimentalFeature.cs.html#4eab9ddcb05ecc77" class="i property">ExperimentName</a>);
                    <a href="ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r5 rd" class="r5 r">errorRecord</span> = <b>new</b> <span class="t">ErrorRecord</span>(
                        <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r4 r">errorMsg</span>),
                        <span class="s">&quot;ScriptCommandDisabled&quot;</span>,
                        <a href="ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="ErrorPackage.cs.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>,
                        <span class="r0 r">commandInfo</span>);
                    <b>throw</b> <b>new</b> <a href="../utils/ExecutionExceptions.cs.html#442c9ff167794161" class="t constructor">CmdletInvocationException</a>(<span class="r5 r">errorRecord</span>);
                }
            }
 
            <a href="#b61b3a9315a42a73" class="i property">CommandInfo</a> = <span class="r0 r">commandInfo</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> ctor
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> properties
 
        <b>private</b> <a href="CommandBase.cs.html#26cb3aadccaa58ac" class="t t">InternalCommand</a> <a id="b7d438c6cef40d8e" href="../R/b7d438c6cef40d8e.html" target="n" data-glyph="46,1" class="i field">_command</a>;
 
        <span class="c">// Marker of whether BeginProcessing() has already run,</span>
        <span class="c">// also used by CommandProcessor.</span>
        <b>internal bool</b> <a id="7b0f1c2306037414" href="../R/7b0f1c2306037414.html" target="n" data-glyph="44,1" class="i field">RanBeginAlready</a>;
 
        <span class="c">// Marker of whether this command has already been added to</span>
        <span class="c">// a PipelineProcessor. It is an error to add the same command</span>
        <span class="c">// more than once.</span>
        <b>internal bool</b> <a id="54564bea0a55d4b0" href="../R/54564bea0a55d4b0.html" target="n" data-glyph="104,1" class="i property">AddedToPipelineAlready</a>
        {
            <b>get</b> { <b>return</b> <a href="#60b9057ad36a7561" class="i field">_addedToPipelineAlready</a>; }
 
            <b>set</b> { <a href="#60b9057ad36a7561" class="i field">_addedToPipelineAlready</a> = <b>value</b>; }
        }
 
        <b>internal bool</b> <a id="60b9057ad36a7561" href="../R/60b9057ad36a7561.html" target="n" data-glyph="44,1" class="i field">_addedToPipelineAlready</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the CommandInfo for the command this command processor represents.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        <b>internal</b> <a href="CommandInfo.cs.html#71babe57a99ca852" class="t t">CommandInfo</a> <a id="b61b3a9315a42a73" href="../R/b61b3a9315a42a73.html" target="n" data-glyph="104,1" class="i property">CommandInfo</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This indicates whether this command processor is created from</span>
        <span class="c">///</span><span class="c"> a script file.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Script command processor created from a script file is special</span>
        <span class="c">///</span><span class="c"> in following two perspectives,</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c">     1. New scope created needs to be a &#39;script&#39; scope in the</span>
        <span class="c">///</span><span class="c">        sense that it needs to handle $script: variables.</span>
        <span class="c">///</span><span class="c">        For normal functions or scriptblocks, script scope</span>
        <span class="c">///</span><span class="c">        variables are not supported.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c">     2. ExitException will be handled by setting lastExitCode.</span>
        <span class="c">///</span><span class="c">        For normal functions or scriptblocks, exit command will</span>
        <span class="c">///</span><span class="c">        kill current powershell session.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>public bool</b> <a id="abf3d4779190c608" href="../R/abf3d4779190c608.html" target="n" data-glyph="102,1" class="i property">FromScriptFile</a> { <b>get</b> { <b>return</b> <a href="#0043954ffd6af0aa" class="i field">_fromScriptFile</a>; } }
 
        <b>protected bool</b> <a id="0043954ffd6af0aa" href="../R/0043954ffd6af0aa.html" target="n" data-glyph="45,1" class="i field">_fromScriptFile</a> = <b>false</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If this flag is true, the commands in this Pipeline will redirect</span>
        <span class="c">///</span><span class="c"> the global error output pipe to the command&#39;s error output pipe.</span>
        <span class="c">///</span><span class="c"> (See the comment in Pipeline.RedirectShellErrorOutputPipe for an</span>
        <span class="c">///</span><span class="c"> explanation of why this flag is needed).</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="26a87154c49eb3eb" href="../R/26a87154c49eb3eb.html" target="n" data-glyph="104,1" class="i property">RedirectShellErrorOutputPipe</a> { <b>get</b>; <b>set</b>; } = <b>false</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the command object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="CommandBase.cs.html#26cb3aadccaa58ac" class="t t">InternalCommand</a> <a id="f58ee453ebc82f56" href="../R/f58ee453ebc82f56.html" target="n" data-glyph="104,1" class="i property">Command</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#b7d438c6cef40d8e" class="i field">_command</a>;
            }
 
            <b>set</b>
            {
                <span class="c">// The command runtime needs to be set up...</span>
                <b>if</b> (<b>value</b> != <b>null</b>)
                {
                    <b>value</b>.<a href="CommandBase.cs.html#71eb09c6dd471a86" class="i field">commandRuntime</a> = <a href="#45a6054a3775cde6" class="k">this</a>.<a href="#c9b17347b060ac3f" class="i field">commandRuntime</a>;
                    <b>if</b> (<a href="#b7d438c6cef40d8e" class="i field">_command</a> != <b>null</b>)
                        <b>value</b>.<a href="CommandBase.cs.html#1f4a1f38862b466a" class="i property">CommandInfo</a> = <a href="#b7d438c6cef40d8e" class="i field">_command</a>.<a href="CommandBase.cs.html#1f4a1f38862b466a" class="i property">CommandInfo</a>;
 
                    <span class="c">// Set the execution context for the command it&#39;s currently</span>
                    <span class="c">// null and our context has already been set up.</span>
                    <b>if</b> (<b>value</b>.<a href="CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a> == <b>null</b> &amp;&amp; <a href="#bb86759713ca670f" class="i field">_context</a> != <b>null</b>)
                        <b>value</b>.<a href="CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a> = <a href="#bb86759713ca670f" class="i field">_context</a>;
                }
 
                <a href="#b7d438c6cef40d8e" class="i field">_command</a> = <b>value</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Get the ObsoleteAttribute of the current command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal virtual</b> <span class="i">ObsoleteAttribute</span> <a id="a39ec94e2ce59ff6" href="../R/a39ec94e2ce59ff6.html" target="n" data-glyph="104,1" class="i property">ObsoleteAttribute</a>
        {
            <b>get</b> { <b>return</b> <b>null</b>; }
        }
 
        <span class="c">// Full Qualified ID for the obsolete command warning</span>
        <b>private const string</b> <a id="5f02f4cd2aa6a0ec" href="../R/5f02f4cd2aa6a0ec.html" target="n" data-glyph="10,1" class="i field">FQIDCommandObsolete</a> = <span class="s">&quot;CommandObsolete&quot;</span>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The command runtime used for this instance of a command processor.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected</b> <a href="MshCommandRuntime.cs.html#f9ebe6a3b284ab55" class="t t">MshCommandRuntime</a> <a id="c9b17347b060ac3f" href="../R/c9b17347b060ac3f.html" target="n" data-glyph="45,1" class="i field">commandRuntime</a>;
 
        <b>internal</b> <a href="MshCommandRuntime.cs.html#f9ebe6a3b284ab55" class="t t">MshCommandRuntime</a> <a id="d539d84981be114a" href="../R/d539d84981be114a.html" target="n" data-glyph="104,1" class="i property">CommandRuntime</a>
        {
            <b>get</b> { <b>return</b> <a href="#c9b17347b060ac3f" class="i field">commandRuntime</a>; }
 
            <b>set</b> { <a href="#c9b17347b060ac3f" class="i field">commandRuntime</a> = <b>value</b>; }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> For commands that use the scope stack, if this flag is</span>
        <span class="c">///</span><span class="c"> true, don&#39;t create a new scope when running this command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="d3edce8b26f160da" href="../R/d3edce8b26f160da.html" target="n" data-glyph="104,1" class="i property">UseLocalScope</a>
        {
            <b>get</b> { <b>return</b> <a href="#914bf3a87736a651" class="i field">_useLocalScope</a>; }
 
            <b>set</b> { <a href="#914bf3a87736a651" class="i field">_useLocalScope</a> = <b>value</b>; }
        }
 
        <b>protected bool</b> <a id="914bf3a87736a651" href="../R/914bf3a87736a651.html" target="n" data-glyph="45,1" class="i field">_useLocalScope</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Ensures that the provided script block is compatible with the current language mode - to</span>
        <span class="c">///</span><span class="c"> be used when a script block is being dotted.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r6 r">scriptBlock</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The script block being dotted.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r7 r">languageMode</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The current language mode.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r8 r">invocationInfo</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The invocation info about the command.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>protected static void</b> <a id="8219620967fc9f1a" href="../R/8219620967fc9f1a.html" target="n" data-glyph="75,1" class="i method">ValidateCompatibleLanguageMode</a>(
            <a href="../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a> <span id="r6 rd" class="r6 r">scriptBlock</span>,
            <a href="SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a> <span id="r7 rd" class="r7 r">languageMode</span>,
            <a href="InvocationInfo.cs.html#407d6c7d1ecbc8cc" class="t t">InvocationInfo</a> <span id="r8 rd" class="r8 r">invocationInfo</span>)
        {
            <span class="c">// If we are in a constrained language mode (Core or Restricted), block it.</span>
            <span class="c">// We are currently restricting in one direction:</span>
            <span class="c">//    - Can&#39;t dot something from a more permissive mode, since that would probably expose</span>
            <span class="c">//      functions that were never designed to handle untrusted data.</span>
            <span class="c">// This function won&#39;t be called for NoLanguage mode so the only direction checked is trusted</span>
            <span class="c">// (FullLanguage mode) script running in a constrained/restricted session.</span>
            <b>if</b> ((<span class="r6 r">scriptBlock</span>.<a href="lang/scriptblock.cs.html#5e76a9fb0d1a7f12" class="i property">LanguageMode</a>.<span class="i">HasValue</span>) &amp;&amp;
                (<span class="r6 r">scriptBlock</span>.<a href="lang/scriptblock.cs.html#5e76a9fb0d1a7f12" class="i property">LanguageMode</a> != <span class="r7 r">languageMode</span>) &amp;&amp;
                ((<span class="r7 r">languageMode</span> == <a href="SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="SessionStatePublic.cs.html#ea8105287b8c6b25" class="i field">RestrictedLanguage</a>) ||
                (<span class="r7 r">languageMode</span> == <a href="SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="SessionStatePublic.cs.html#9f1205fe78117fc2" class="i field">ConstrainedLanguage</a>)))
            {
                <span class="c">// Finally check if script block is really just PowerShell commands plus parameters.</span>
                <span class="c">// If so then it is safe to dot source across language mode boundaries.</span>
                <b>bool</b> <span id="r9 rd" class="r9 r">isSafeToDotSource</span> = <b>false</b>;
                <b>try</b>
                {
                    <span class="r6 r">scriptBlock</span>.<a href="lang/scriptblock.cs.html#b40ee1adbffb9303" class="i method">GetPowerShell</a>();
                    <span class="r9 r">isSafeToDotSource</span> = <b>true</b>;
                }
                <b>catch</b> (<span class="i">Exception</span>)
                {
                }
 
                <b>if</b> (!<span class="r9 r">isSafeToDotSource</span>)
                {
                    <a href="ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r10 rd" class="r10 r">errorRecord</span> = <b>new</b> <span class="t">ErrorRecord</span>(
                    <b>new</b> <span class="i">NotSupportedException</span>(
                        <span class="i">DiscoveryExceptions</span>.<span class="i">DotSourceNotSupported</span>),
                        <span class="s">&quot;DotSourceNotSupported&quot;</span>,
                        <a href="ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="ErrorPackage.cs.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>,
                        <b>null</b>);
                    <span class="r10 r">errorRecord</span>.<a href="ErrorPackage.cs.html#14b8261653db7b03" class="i method">SetInvocationInfo</a>(<span class="r8 r">invocationInfo</span>);
                    <b>throw</b> <b>new</b> <a href="../utils/ExecutionExceptions.cs.html#442c9ff167794161" class="t constructor">CmdletInvocationException</a>(<span class="r10 r">errorRecord</span>);
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The execution context used by the system.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected</b> <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <a id="bb86759713ca670f" href="../R/bb86759713ca670f.html" target="n" data-glyph="45,1" class="i field">_context</a>;
 
        <b>internal</b> <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <a id="00c4abcf32dda50f" href="../R/00c4abcf32dda50f.html" target="n" data-glyph="104,1" class="i property">Context</a>
        {
            <b>get</b> { <b>return</b> <a href="#bb86759713ca670f" class="i field">_context</a>; }
 
            <b>set</b> { <a href="#bb86759713ca670f" class="i field">_context</a> = <b>value</b>; }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Etw activity for this pipeline.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">Guid</span> <a id="93260940d32e4e50" href="../R/93260940d32e4e50.html" target="n" data-glyph="104,1" class="i property">PipelineActivityId</a> { <b>get</b>; <b>set</b>; } = <span class="i">Guid</span>.<span class="i">Empty</span>;
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> properties
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> methods
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> handling of -? parameter
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Checks if user has requested help (for example passing &quot;-?&quot; parameter for a cmdlet)</span>
        <span class="c">///</span><span class="c"> and if yes, then returns the help target to display.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r11 r">helpTarget</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Help target to request.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r12 r">helpCategory</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Help category to request.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;</span><span class="c">see</span> <span class="c">langword</span><span class="c">=</span><span class="c">&quot;</span><span class="c">true</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> if user requested help; </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">langword</span><span class="c">=</span><span class="c">&quot;</span><span class="c">false</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> otherwise.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal virtual bool</b> <a id="67dd0c69e6a0187b" href="../R/67dd0c69e6a0187b.html" target="n" data-glyph="74,1" class="i method">IsHelpRequested</a>(<b>out string</b> <span id="r11 rd" class="r11 r">helpTarget</span>, <b>out</b> <a href="../help/HelpSystem.cs.html#5ad0a796ad0d8ceb" class="t t">HelpCategory</a> <span id="r12 rd" class="r12 r">helpCategory</span>)
        {
            <span class="c">// by default we don&#39;t handle &quot;-?&quot; parameter at all</span>
            <span class="c">// (we want to do the checks only for cmdlets - this method is overridden in CommandProcessor)</span>
            <span class="r11 r">helpTarget</span> = <b>null</b>;
            <span class="r12 r">helpCategory</span> = <a href="../help/HelpSystem.cs.html#5ad0a796ad0d8ceb" class="t t">HelpCategory</a>.<a href="../help/HelpSystem.cs.html#bffe33d47c20ce20" class="i field">None</a>;
            <b>return</b> <b>false</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates a command processor for &quot;get-help [helpTarget]&quot;.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r13 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Context for the command processor.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r14 r">helpTarget</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Help target.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r15 r">helpCategory</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Help category.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Command processor for &quot;get-help [helpTarget]&quot;.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static</b> <a href="#45a6054a3775cde6" class="t t">CommandProcessorBase</a> <a id="55bbbf951649455b" href="../R/55bbbf951649455b.html" target="n" data-glyph="74,1" class="i method">CreateGetHelpCommandProcessor</a>(
            <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r13 rd" class="r13 r">context</span>,
            <b>string</b> <span id="r14 rd" class="r14 r">helpTarget</span>,
            <a href="../help/HelpSystem.cs.html#5ad0a796ad0d8ceb" class="t t">HelpCategory</a> <span id="r15 rd" class="r15 r">helpCategory</span>)
        {
            <b>if</b> (<span class="r13 r">context</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r13 r">context</span>));
            }
 
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r14 r">helpTarget</span>))
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r14 r">helpTarget</span>));
            }
 
            <a href="#45a6054a3775cde6" class="t t">CommandProcessorBase</a> <span id="r16 rd" class="r16 r">helpCommandProcessor</span> = <span class="r13 r">context</span>.<a href="ExecutionContext.cs.html#df39c8180123370b" class="i method">CreateCommand</a>(<span class="s">&quot;get-help&quot;</span>, <b>false</b>);
            <a href="CommandParameter.cs.html#4e36e2c205cfc418" class="k">var</a> <span id="r17 rd" class="r17 r">cpi</span> = <a href="CommandParameter.cs.html#4e36e2c205cfc418" class="t t">CommandParameterInternal</a>.<a href="CommandParameter.cs.html#b0a57c9e4428f6f3" class="i method">CreateParameterWithArgument</a>(
                <span class="c">/*parameterAst*/</span><b>null</b>, <span class="s">&quot;Name&quot;</span>, <span class="s">&quot;-Name:&quot;</span>,
                <span class="c">/*argumentAst*/</span><b>null</b>, <span class="r14 r">helpTarget</span>,
                <b>false</b>);
            <span class="r16 r">helpCommandProcessor</span>.<a href="#a862b2435f52bbdf" class="i method">AddParameter</a>(<span class="r17 r">cpi</span>);
            <span class="r17 r">cpi</span> = <a href="CommandParameter.cs.html#4e36e2c205cfc418" class="t t">CommandParameterInternal</a>.<span class="i">CreateParameterWithArgument</span>(
                <span class="c">/*parameterAst*/</span><b>null</b>, <span class="s">&quot;Category&quot;</span>, <span class="s">&quot;-Category:&quot;</span>,
                <span class="c">/*argumentAst*/</span><b>null</b>, <span class="r15 r">helpCategory</span>.<span class="i">ToString</span>(),
                <b>false</b>);
            <span class="r16 r">helpCommandProcessor</span>.<a href="#a862b2435f52bbdf" class="i method">AddParameter</a>(<span class="r17 r">cpi</span>);
            <b>return</b> <span class="r16 r">helpCommandProcessor</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Tells whether pipeline input is expected or not.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A bool indicating whether pipeline input is expected.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="93abe05c663b0330" href="../R/93abe05c663b0330.html" target="n" data-glyph="74,1" class="i method">IsPipelineInputExpected</a>()
        {
            <b>return</b> <a href="#c9b17347b060ac3f" class="i field">commandRuntime</a>.<a href="MshCommandRuntime.cs.html#3d7740144c766c64" class="i property">IsPipelineInputExpected</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If you want this command to execute in other than the default session</span>
        <span class="c">///</span><span class="c"> state, use this API to get and set that session state instance...</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="../P/2dc1bd90a8299178.html#2dc1bd90a8299178" class="t t">SessionStateInternal</a> <a id="1f3fb39371c48d78" href="../R/1f3fb39371c48d78.html" target="n" data-glyph="104,1" class="i property">CommandSessionState</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the session state scope for this command processor object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected internal</b> <a href="SessionStateScope.cs.html#460261155e0163cb" class="t t">SessionStateScope</a> <a id="fefd69f2b6b9e222" href="../R/fefd69f2b6b9e222.html" target="n" data-glyph="105,1" class="i property">CommandScope</a> { <b>get</b>; <b>protected set</b>; }
 
        <b>protected virtual void</b> <a id="804b024846ce5612" href="../R/804b024846ce5612.html" target="n" data-glyph="75,1" class="i method">OnSetCurrentScope</a>()
        {
        }
 
        <b>protected virtual void</b> <a id="ac1e3c14bfabf09d" href="../R/ac1e3c14bfabf09d.html" target="n" data-glyph="75,1" class="i method">OnRestorePreviousScope</a>()
        {
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This method sets the current session state scope to the execution scope for the pipeline</span>
        <span class="c">///</span><span class="c"> that was stored in the pipeline manager when it was first invoked.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="2a4698751cbdab79" href="../R/2a4698751cbdab79.html" target="n" data-glyph="74,1" class="i method">SetCurrentScopeToExecutionScope</a>()
        {
            <span class="c">// Make sure we have a session state instance for this command.</span>
            <span class="c">// If one hasn&#39;t been explicitly set, then use the session state</span>
            <span class="c">// available on the engine execution context...</span>
            <b>if</b> (<a href="#1f3fb39371c48d78" class="i property">CommandSessionState</a> == <b>null</b>)
            {
                <a href="#1f3fb39371c48d78" class="i property">CommandSessionState</a> = <a href="#00c4abcf32dda50f" class="i property">Context</a>.<a href="ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>;
            }
 
            <span class="c">// Store off the current scope</span>
            <a href="#49434add1d49c253" class="i field">_previousScope</a> = <a href="#1f3fb39371c48d78" class="i property">CommandSessionState</a>.<a href="SessionStateScopeAPIs.cs.html#224987ad36a90f88" class="i property">CurrentScope</a>;
            <a href="#c27331937aba3463" class="i field">_previousCommandSessionState</a> = <a href="#00c4abcf32dda50f" class="i property">Context</a>.<a href="ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>;
            <a href="#00c4abcf32dda50f" class="i property">Context</a>.<a href="ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a> = <a href="#1f3fb39371c48d78" class="i property">CommandSessionState</a>;
 
            <span class="c">// Set the current scope to the pipeline execution scope</span>
            <a href="#1f3fb39371c48d78" class="i property">CommandSessionState</a>.<a href="SessionStateScopeAPIs.cs.html#224987ad36a90f88" class="i property">CurrentScope</a> = <a href="#fefd69f2b6b9e222" class="i property">CommandScope</a>;
 
            <a href="#804b024846ce5612" class="i method">OnSetCurrentScope</a>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Restores the current session state scope to the scope which was active when SetCurrentScopeToExecutionScope</span>
        <span class="c">///</span><span class="c"> was called.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="1a8d2d2aeb322b3b" href="../R/1a8d2d2aeb322b3b.html" target="n" data-glyph="74,1" class="i method">RestorePreviousScope</a>()
        {
            <a href="#ac1e3c14bfabf09d" class="i method">OnRestorePreviousScope</a>();
 
            <a href="#00c4abcf32dda50f" class="i property">Context</a>.<a href="ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a> = <a href="#c27331937aba3463" class="i field">_previousCommandSessionState</a>;
 
            <b>if</b> (<a href="#49434add1d49c253" class="i field">_previousScope</a> != <b>null</b>)
            {
                <span class="c">// Restore the scope but use the same session state instance we</span>
                <span class="c">// got it from because the command may have changed the execution context</span>
                <span class="c">// session state...</span>
                <a href="#1f3fb39371c48d78" class="i property">CommandSessionState</a>.<a href="SessionStateScopeAPIs.cs.html#224987ad36a90f88" class="i property">CurrentScope</a> = <a href="#49434add1d49c253" class="i field">_previousScope</a>;
            }
        }
 
        <b>private</b> <a href="SessionStateScope.cs.html#460261155e0163cb" class="t t">SessionStateScope</a> <a id="49434add1d49c253" href="../R/49434add1d49c253.html" target="n" data-glyph="46,1" class="i field">_previousScope</a>;
        <b>private</b> <a href="../P/2dc1bd90a8299178.html#2dc1bd90a8299178" class="t t">SessionStateInternal</a> <a id="c27331937aba3463" href="../R/c27331937aba3463.html" target="n" data-glyph="46,1" class="i field">_previousCommandSessionState</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A collection of arguments that have been added by the parser or</span>
        <span class="c">///</span><span class="c"> host interfaces. These will be sent to the parameter binder controller</span>
        <span class="c">///</span><span class="c"> for processing.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">Collection</span>&lt;<a href="CommandParameter.cs.html#4e36e2c205cfc418" class="t t">CommandParameterInternal</a>&gt; <a id="5bfa2b362a5e8358" href="../R/5bfa2b362a5e8358.html" target="n" data-glyph="44,1" class="i field">arguments</a> = <b>new</b> <span class="i">Collection</span>&lt;<a href="CommandParameter.cs.html#4e36e2c205cfc418" class="t t">CommandParameterInternal</a>&gt;();
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Adds an unbound parameter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r18 r">parameter</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The parameter to add to the unbound arguments list</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="a862b2435f52bbdf" href="../R/a862b2435f52bbdf.html" target="n" data-glyph="74,1" class="i method">AddParameter</a>(<a href="CommandParameter.cs.html#4e36e2c205cfc418" class="t t">CommandParameterInternal</a> <span id="r18 rd" class="r18 r">parameter</span>)
        {
            <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r18 r">parameter</span> != <b>null</b>, <span class="s">&quot;Caller to verify parameter argument&quot;</span>);
            <a href="#5bfa2b362a5e8358" class="i field">arguments</a>.<span class="i">Add</span>(<span class="r18 r">parameter</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Prepares the command for execution.</span>
        <span class="c">///</span><span class="c"> This should be called once before ProcessRecord().</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal abstract void</b> <a id="fa36d5ed736d8147" href="../R/fa36d5ed736d8147.html" target="n" data-glyph="74,1" class="i method">Prepare</a>(<span class="i">IDictionary</span> <span id="r19 rd" class="r19 r">psDefaultParameterValues</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Write warning message for an obsolete command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r20 r">obsoleteAttr</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="b975e8c5479eb271" href="../R/b975e8c5479eb271.html" target="n" data-glyph="76,1" class="i method">HandleObsoleteCommand</a>(<span class="i">ObsoleteAttribute</span> <span id="r20 rd" class="r20 r">obsoleteAttr</span>)
        {
            <b>string</b> <span id="r21 rd" class="r21 r">commandName</span> =
                <b>string</b>.<span class="i">IsNullOrEmpty</span>(<a href="#b61b3a9315a42a73" class="i property">CommandInfo</a>.<a href="CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>)
                    ? <span class="s">&quot;script block&quot;</span>
                    : <b>string</b>.<span class="i">Format</span>(<span class="i n">System</span>.<span class="i">Globalization</span>.<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                                    <span class="i">CommandBaseStrings</span>.<span class="i">ObsoleteCommand</span>, <a href="#b61b3a9315a42a73" class="i property">CommandInfo</a>.<a href="CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>);
 
            <b>string</b> <span id="r22 rd" class="r22 r">warningMsg</span> = <b>string</b>.<span class="i">Format</span>(
                <span class="i n">System</span>.<span class="i">Globalization</span>.<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                <span class="i">CommandBaseStrings</span>.<span class="i">UseOfDeprecatedCommandWarning</span>,
                <span class="r21 r">commandName</span>, <span class="r20 r">obsoleteAttr</span>.<span class="i">Message</span>);
 
            <span class="c">// We ignore the IsError setting because we don&#39;t want to break people when obsoleting a command</span>
            <b>using</b> (<a href="#45a6054a3775cde6" class="k">this</a>.<a href="#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="MshCommandRuntime.cs.html#898174c9e014e567" class="i method">AllowThisCommandToWrite</a>(<b>false</b>))
            {
                <a href="#45a6054a3775cde6" class="k">this</a>.<a href="#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="MshCommandRuntime.cs.html#9cc8b7d137e9323d" class="i method">WriteWarning</a>(<b>new</b> <a href="hostifaces/InformationalRecord.cs.html#dcad78b02a1ab129" class="t constructor">WarningRecord</a>(<a href="#5f02f4cd2aa6a0ec" class="i field">FQIDCommandObsolete</a>, <span class="r22 r">warningMsg</span>));
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Sets the execution scope for the pipeline and then calls the Prepare</span>
        <span class="c">///</span><span class="c"> abstract method which gets overridden by derived classes.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="16a98e93ca4b16ab" href="../R/16a98e93ca4b16ab.html" target="n" data-glyph="74,1" class="i method">DoPrepare</a>(<span class="i">IDictionary</span> <span id="r23 rd" class="r23 r">psDefaultParameterValues</span>)
        {
            <a href="#45a6054a3775cde6" class="t t">CommandProcessorBase</a> <span id="r24 rd" class="r24 r">oldCurrentCommandProcessor</span> = <a href="#bb86759713ca670f" class="i field">_context</a>.<a href="ExecutionContext.cs.html#1146573afe2845c8" class="i property">CurrentCommandProcessor</a>;
            <b>try</b>
            {
                <a href="#00c4abcf32dda50f" class="i property">Context</a>.<a href="ExecutionContext.cs.html#1146573afe2845c8" class="i property">CurrentCommandProcessor</a> = <a href="#45a6054a3775cde6" class="k">this</a>;
                <a href="#2a4698751cbdab79" class="i method">SetCurrentScopeToExecutionScope</a>();
                <a href="#fa36d5ed736d8147" class="i method">Prepare</a>(<span class="r23 r">psDefaultParameterValues</span>);
 
                <span class="c">// Check obsolete attribute after Prepare so that -WarningAction will be respected for cmdlets</span>
                <b>if</b> (<a href="#a39ec94e2ce59ff6" class="i property">ObsoleteAttribute</a> != <b>null</b>)
                {
                    <span class="c">// Obsolete command is rare. Put the IF here to avoid method call overhead</span>
                    <a href="#b975e8c5479eb271" class="i method">HandleObsoleteCommand</a>(<a href="#a39ec94e2ce59ff6" class="i property">ObsoleteAttribute</a>);
                }
            }
            <b>catch</b> (<span class="i">Exception</span>)
            {
                <b>if</b> (<a href="#914bf3a87736a651" class="i field">_useLocalScope</a>)
                {
                    <span class="c">// If we had an exception during Prepare, we&#39;re done trying to execute the command</span>
                    <span class="c">// so the scope we created needs to release any resources it hold.s</span>
                    <a href="#1f3fb39371c48d78" class="i property">CommandSessionState</a>.<a href="SessionStateScopeAPIs.cs.html#729d02bb53189219" class="i method">RemoveScope</a>(<a href="#fefd69f2b6b9e222" class="i property">CommandScope</a>);
                }
 
                <b>throw</b>;
            }
            <b>finally</b>
            {
                <a href="#00c4abcf32dda50f" class="i property">Context</a>.<a href="ExecutionContext.cs.html#1146573afe2845c8" class="i property">CurrentCommandProcessor</a> = <span class="r24 r">oldCurrentCommandProcessor</span>;
                <a href="#1a8d2d2aeb322b3b" class="i method">RestorePreviousScope</a>();
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Called once before ProcessRecord(). Internally it calls</span>
        <span class="c">///</span><span class="c"> BeginProcessing() of the InternalCommand.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> a terminating error occurred, or the pipeline was otherwise stopped</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal virtual void</b> <a id="888ccfe4b17ac047" href="../R/888ccfe4b17ac047.html" target="n" data-glyph="74,1" class="i method">DoBegin</a>()
        {
            <span class="c">// Note that DoPrepare() and DoBegin() should NOT be combined.</span>
            <span class="c">// Reason: Encoding of commandline parameters happen as part</span>
            <span class="c">// of DoPrepare(). If they are combined, the first command&#39;s</span>
            <span class="c">// DoBegin() will be called before the next command&#39;s</span>
            <span class="c">// DoPrepare(). Since BeginProcessing() can write objects</span>
            <span class="c">// to the downstream commandlet, it will end up calling</span>
            <span class="c">// DoExecute() (from Pipe.Add()) before DoPrepare.</span>
            <b>if</b> (!<a href="#7b0f1c2306037414" class="i field">RanBeginAlready</a>)
            {
                <a href="#7b0f1c2306037414" class="i field">RanBeginAlready</a> = <b>true</b>;
                <a href="Pipe.cs.html#59f1a03e60a5aa51" class="t t">Pipe</a> <span id="r25 rd" class="r25 r">oldErrorOutputPipe</span> = <a href="#bb86759713ca670f" class="i field">_context</a>.<a href="ExecutionContext.cs.html#d0ed5d60dd57b004" class="i property">ShellFunctionErrorOutputPipe</a>;
                <a href="#45a6054a3775cde6" class="t t">CommandProcessorBase</a> <span id="r26 rd" class="r26 r">oldCurrentCommandProcessor</span> = <a href="#bb86759713ca670f" class="i field">_context</a>.<a href="ExecutionContext.cs.html#1146573afe2845c8" class="i property">CurrentCommandProcessor</a>;
                <b>try</b>
                {
                    <span class="c">//</span>
                    <span class="c">// On V1 the output pipe was redirected to the command&#39;s output pipe only when it</span>
                    <span class="c">// was already redirected. This is the original comment explaining this behaviour:</span>
                    <span class="c">//</span>
                    <span class="c">//      NTRAID#Windows Out of Band Releases-926183-2005-12-15</span>
                    <span class="c">//      MonadTestHarness has a bad dependency on an artifact of the current implementation</span>
                    <span class="c">//      The following code only redirects the output pipe if it&#39;s already redirected</span>
                    <span class="c">//      to preserve the artifact. The test suites need to be fixed and then this</span>
                    <span class="c">//      the check can be removed and the assignment always done.</span>
                    <span class="c">//</span>
                    <span class="c">// However, this makes the hosting APIs behave differently than commands executed</span>
                    <span class="c">// from the command-line host (for example, see bugs Win7:415915 and Win7:108670).</span>
                    <span class="c">// The RedirectShellErrorOutputPipe flag is used by the V2 hosting API to force the</span>
                    <span class="c">// redirection.</span>
                    <span class="c">//</span>
                    <b>if</b> (<a href="#45a6054a3775cde6" class="k">this</a>.<a href="#26a87154c49eb3eb" class="i property">RedirectShellErrorOutputPipe</a> || <a href="#bb86759713ca670f" class="i field">_context</a>.<a href="ExecutionContext.cs.html#d0ed5d60dd57b004" class="i property">ShellFunctionErrorOutputPipe</a> != <b>null</b>)
                    {
                        <a href="#bb86759713ca670f" class="i field">_context</a>.<a href="ExecutionContext.cs.html#d0ed5d60dd57b004" class="i property">ShellFunctionErrorOutputPipe</a> = <a href="#45a6054a3775cde6" class="k">this</a>.<a href="#c9b17347b060ac3f" class="i field">commandRuntime</a>.<a href="MshCommandRuntime.cs.html#8cfabd8908a77f92" class="i property">ErrorOutputPipe</a>;
                    }
 
                    <a href="#bb86759713ca670f" class="i field">_context</a>.<a href="ExecutionContext.cs.html#1146573afe2845c8" class="i property">CurrentCommandProcessor</a> = <a href="#45a6054a3775cde6" class="k">this</a>;
                    <b>using</b> (<a href="#c9b17347b060ac3f" class="i field">commandRuntime</a>.<a href="MshCommandRuntime.cs.html#898174c9e014e567" class="i method">AllowThisCommandToWrite</a>(<b>true</b>))
                    {
                        <b>using</b> (<a href="ParameterBinderBase.cs.html#6a035e6bf95bfc67" class="t t">ParameterBinderBase</a>.<a href="ParameterBinderBase.cs.html#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#19ce116f88d7b1c7" class="i method">TraceScope</a>(
                            <span class="s">&quot;CALLING BeginProcessing&quot;</span>))
                        {
                            <a href="#2a4698751cbdab79" class="i method">SetCurrentScopeToExecutionScope</a>();
 
                            <b>if</b> (<a href="#00c4abcf32dda50f" class="i property">Context</a>.<a href="ExecutionContext.cs.html#00e6fdde4b76eb15" class="i field">_debuggingMode</a> &gt; 0 &amp;&amp; <a href="#f58ee453ebc82f56" class="i property">Command</a> <b>is not</b> <a href="runtime/CompiledScriptBlock.cs.html#20151031a0be3c24" class="t t">PSScriptCmdlet</a>)
                            {
                                <a href="#00c4abcf32dda50f" class="i property">Context</a>.<a href="ExecutionContext.cs.html#3e56b2d709de0d80" class="i property">Debugger</a>.<a href="debugger/debugger.cs.html#ab0382a7b993ff7c" class="i method">CheckCommand</a>(<a href="#45a6054a3775cde6" class="k">this</a>.<a href="#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#f81679c755698e2e" class="i property">MyInvocation</a>);
                            }
 
                            <a href="#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#f66e210571551e42" class="i method">DoBeginProcessing</a>();
                        }
                    }
                }
                <b>catch</b> (<span class="i">Exception</span> <span id="r27 rd" class="r27 r">e</span>)
                {
                    <span class="c">// This cmdlet threw an exception, so</span>
                    <span class="c">// wrap it and bubble it up.</span>
                    <b>throw</b> <a href="#2b54af4c46f46a60" class="i method">ManageInvocationException</a>(<span class="r27 r">e</span>);
                }
                <b>finally</b>
                {
                    <a href="#bb86759713ca670f" class="i field">_context</a>.<a href="ExecutionContext.cs.html#d0ed5d60dd57b004" class="i property">ShellFunctionErrorOutputPipe</a> = <span class="r25 r">oldErrorOutputPipe</span>;
                    <a href="#bb86759713ca670f" class="i field">_context</a>.<a href="ExecutionContext.cs.html#1146573afe2845c8" class="i property">CurrentCommandProcessor</a> = <span class="r26 r">oldCurrentCommandProcessor</span>;
                    <a href="#1a8d2d2aeb322b3b" class="i method">RestorePreviousScope</a>();
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This calls the command.  It assumes that DoPrepare() has already been called.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal abstract void</b> <a id="99f764c4c1235235" href="../R/99f764c4c1235235.html" target="n" data-glyph="74,1" class="i method">ProcessRecord</a>();
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This method sets the execution scope to the</span>
        <span class="c">///</span><span class="c"> appropriate scope for the pipeline and then calls</span>
        <span class="c">///</span><span class="c"> the ProcessRecord abstract method that derived command processors</span>
        <span class="c">///</span><span class="c"> override.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="b81b6f6845c9c70c" href="../R/b81b6f6845c9c70c.html" target="n" data-glyph="74,1" class="i method">DoExecute</a>()
        {
            <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a>.<a href="ExecutionContext.cs.html#3dcd207b1b77d402" class="i method">CheckStackDepth</a>();
 
            <a href="#45a6054a3775cde6" class="t t">CommandProcessorBase</a> <span id="r28 rd" class="r28 r">oldCurrentCommandProcessor</span> = <a href="#bb86759713ca670f" class="i field">_context</a>.<a href="ExecutionContext.cs.html#1146573afe2845c8" class="i property">CurrentCommandProcessor</a>;
            <b>try</b>
            {
                <a href="#00c4abcf32dda50f" class="i property">Context</a>.<a href="ExecutionContext.cs.html#1146573afe2845c8" class="i property">CurrentCommandProcessor</a> = <a href="#45a6054a3775cde6" class="k">this</a>;
                <a href="#2a4698751cbdab79" class="i method">SetCurrentScopeToExecutionScope</a>();
                <a href="#99f764c4c1235235" class="i method">ProcessRecord</a>();
            }
            <b>finally</b>
            {
                <a href="#00c4abcf32dda50f" class="i property">Context</a>.<a href="ExecutionContext.cs.html#1146573afe2845c8" class="i property">CurrentCommandProcessor</a> = <span class="r28 r">oldCurrentCommandProcessor</span>;
                <a href="#1a8d2d2aeb322b3b" class="i method">RestorePreviousScope</a>();
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Called once after ProcessRecord().</span>
        <span class="c">///</span><span class="c"> Internally it calls EndProcessing() of the InternalCommand.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A terminating error occurred, or the pipeline was otherwise stopped.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal virtual void</b> <a id="cc3e9ab4c388fd46" href="../R/cc3e9ab4c388fd46.html" target="n" data-glyph="74,1" class="i method">Complete</a>()
        {
            <span class="c">// Call ProcessRecord once from complete. Don&#39;t call DoExecute...</span>
            <a href="#99f764c4c1235235" class="i method">ProcessRecord</a>();
 
            <b>try</b>
            {
                <b>using</b> (<a href="#c9b17347b060ac3f" class="i field">commandRuntime</a>.<a href="MshCommandRuntime.cs.html#898174c9e014e567" class="i method">AllowThisCommandToWrite</a>(<b>true</b>))
                {
                    <b>using</b> (<a href="ParameterBinderBase.cs.html#6a035e6bf95bfc67" class="t t">ParameterBinderBase</a>.<a href="ParameterBinderBase.cs.html#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#19ce116f88d7b1c7" class="i method">TraceScope</a>(
                        <span class="s">&quot;CALLING EndProcessing&quot;</span>))
                    {
                        <a href="#45a6054a3775cde6" class="k">this</a>.<a href="#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#3f339d3baaf5f5d7" class="i method">DoEndProcessing</a>();
                    }
                }
            }
            <span class="c">// 2004/03/18-JonN This is understood to be</span>
            <span class="c">// an FXCOP violation, cleared by KCwalina.</span>
            <b>catch</b> (<span class="i">Exception</span> <span id="r29 rd" class="r29 r">e</span>)
            {
                <span class="c">// This cmdlet threw an exception, so</span>
                <span class="c">// wrap it and bubble it up.</span>
                <b>throw</b> <a href="#2b54af4c46f46a60" class="i method">ManageInvocationException</a>(<span class="r29 r">e</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Calls the virtual Complete method after setting the appropriate session state scope.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="1b17cb8b4db02dee" href="../R/1b17cb8b4db02dee.html" target="n" data-glyph="74,1" class="i method">DoComplete</a>()
        {
            <a href="Pipe.cs.html#59f1a03e60a5aa51" class="t t">Pipe</a> <span id="r30 rd" class="r30 r">oldErrorOutputPipe</span> = <a href="#bb86759713ca670f" class="i field">_context</a>.<a href="ExecutionContext.cs.html#d0ed5d60dd57b004" class="i property">ShellFunctionErrorOutputPipe</a>;
            <a href="#45a6054a3775cde6" class="t t">CommandProcessorBase</a> <span id="r31 rd" class="r31 r">oldCurrentCommandProcessor</span> = <a href="#bb86759713ca670f" class="i field">_context</a>.<a href="ExecutionContext.cs.html#1146573afe2845c8" class="i property">CurrentCommandProcessor</a>;
            <b>try</b>
            {
                <span class="c">//</span>
                <span class="c">// On V1 the output pipe was redirected to the command&#39;s output pipe only when it</span>
                <span class="c">// was already redirected. This is the original comment explaining this behaviour:</span>
                <span class="c">//</span>
                <span class="c">//      NTRAID#Windows Out of Band Releases-926183-2005-12-15</span>
                <span class="c">//      MonadTestHarness has a bad dependency on an artifact of the current implementation</span>
                <span class="c">//      The following code only redirects the output pipe if it&#39;s already redirected</span>
                <span class="c">//      to preserve the artifact. The test suites need to be fixed and then this</span>
                <span class="c">//      the check can be removed and the assignment always done.</span>
                <span class="c">//</span>
                <span class="c">// However, this makes the hosting APIs behave differently than commands executed</span>
                <span class="c">// from the command-line host (for example, see bugs Win7:415915 and Win7:108670).</span>
                <span class="c">// The RedirectShellErrorOutputPipe flag is used by the V2 hosting API to force the</span>
                <span class="c">// redirection.</span>
                <span class="c">//</span>
                <b>if</b> (<a href="#45a6054a3775cde6" class="k">this</a>.<a href="#26a87154c49eb3eb" class="i property">RedirectShellErrorOutputPipe</a> || <a href="#bb86759713ca670f" class="i field">_context</a>.<a href="ExecutionContext.cs.html#d0ed5d60dd57b004" class="i property">ShellFunctionErrorOutputPipe</a> != <b>null</b>)
                {
                    <a href="#bb86759713ca670f" class="i field">_context</a>.<a href="ExecutionContext.cs.html#d0ed5d60dd57b004" class="i property">ShellFunctionErrorOutputPipe</a> = <a href="#45a6054a3775cde6" class="k">this</a>.<a href="#c9b17347b060ac3f" class="i field">commandRuntime</a>.<a href="MshCommandRuntime.cs.html#8cfabd8908a77f92" class="i property">ErrorOutputPipe</a>;
                }
 
                <a href="#bb86759713ca670f" class="i field">_context</a>.<a href="ExecutionContext.cs.html#1146573afe2845c8" class="i property">CurrentCommandProcessor</a> = <a href="#45a6054a3775cde6" class="k">this</a>;
 
                <a href="#2a4698751cbdab79" class="i method">SetCurrentScopeToExecutionScope</a>();
                <a href="#cc3e9ab4c388fd46" class="i method">Complete</a>();
            }
            <b>finally</b>
            {
                <a href="#ac1e3c14bfabf09d" class="i method">OnRestorePreviousScope</a>();
 
                <a href="#bb86759713ca670f" class="i field">_context</a>.<a href="ExecutionContext.cs.html#d0ed5d60dd57b004" class="i property">ShellFunctionErrorOutputPipe</a> = <span class="r30 r">oldErrorOutputPipe</span>;
                <a href="#bb86759713ca670f" class="i field">_context</a>.<a href="ExecutionContext.cs.html#1146573afe2845c8" class="i property">CurrentCommandProcessor</a> = <span class="r31 r">oldCurrentCommandProcessor</span>;
 
                <span class="c">// Destroy the local scope at this point if there is one...</span>
                <b>if</b> (<a href="#914bf3a87736a651" class="i field">_useLocalScope</a> &amp;&amp; <a href="#fefd69f2b6b9e222" class="i property">CommandScope</a> != <b>null</b>)
                {
                    <a href="#1f3fb39371c48d78" class="i property">CommandSessionState</a>.<a href="SessionStateScopeAPIs.cs.html#729d02bb53189219" class="i method">RemoveScope</a>(<a href="#fefd69f2b6b9e222" class="i property">CommandScope</a>);
                }
 
                <span class="c">// and the previous scope...</span>
                <b>if</b> (<a href="#49434add1d49c253" class="i field">_previousScope</a> != <b>null</b>)
                {
                    <span class="c">// Restore the scope but use the same session state instance we</span>
                    <span class="c">// got it from because the command may have changed the execution context</span>
                    <span class="c">// session state...</span>
                    <a href="#1f3fb39371c48d78" class="i property">CommandSessionState</a>.<a href="SessionStateScopeAPIs.cs.html#224987ad36a90f88" class="i property">CurrentScope</a> = <a href="#49434add1d49c253" class="i field">_previousScope</a>;
                }
 
                <span class="c">// Restore the previous session state</span>
                <b>if</b> (<a href="#c27331937aba3463" class="i field">_previousCommandSessionState</a> != <b>null</b>)
                {
                    <a href="#00c4abcf32dda50f" class="i property">Context</a>.<a href="ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a> = <a href="#c27331937aba3463" class="i field">_previousCommandSessionState</a>;
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> For diagnostic purposes.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public override string</b> <a id="aad5c303a9a24e04" href="../R/aad5c303a9a24e04.html" target="n" data-glyph="72,1" class="i method">ToString</a>()
        {
            <b>if</b> (<a href="#b61b3a9315a42a73" class="i property">CommandInfo</a> != <b>null</b>)
                <b>return</b> <a href="#b61b3a9315a42a73" class="i property">CommandInfo</a>.<a href="CommandInfo.cs.html#c3bac3ed48b7e00e" class="i method">ToString</a>();
            <b>return</b> <span class="s">&quot;&lt;NullCommandInfo&gt;&quot;</span>; <span class="c">// does not require localization</span>
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> True if Read() has not be called, false otherwise.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="c63c5e463d9389bb" href="../R/c63c5e463d9389bb.html" target="n" data-glyph="46,1" class="i field">_firstCallToRead</a> = <b>true</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Entry point used by the engine to reads the input pipeline object</span>
        <span class="c">///</span><span class="c"> and binds the parameters.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> This default implementation reads the next pipeline object and sets</span>
        <span class="c">///</span><span class="c"> it as the CurrentPipelineObject in the InternalCommand.</span>
        <span class="c">///</span><span class="c"> Does not throw.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> True if read succeeds.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal virtual bool</b> <a id="11858c2b783304d7" href="../R/11858c2b783304d7.html" target="n" data-glyph="74,1" class="i method">Read</a>()
        {
            <span class="c">// Prepare the default value parameter list if this is the first call to Read</span>
            <b>if</b> (<a href="#c63c5e463d9389bb" class="i field">_firstCallToRead</a>)
            {
                <a href="#c63c5e463d9389bb" class="i field">_firstCallToRead</a> = <b>false</b>;
            }
 
            <span class="c">// Retrieve the object from the input pipeline</span>
            <b>object</b> <span id="r32 rd" class="r32 r">inputObject</span> = <a href="#45a6054a3775cde6" class="k">this</a>.<a href="#c9b17347b060ac3f" class="i field">commandRuntime</a>.<a href="MshCommandRuntime.cs.html#2a3306bd1f3917ef" class="i property">InputPipe</a>.<a href="Pipe.cs.html#364489802d14033a" class="i method">Retrieve</a>();
 
            <b>if</b> (<span class="r32 r">inputObject</span> == <a href="AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>)
            {
                <b>return</b> <b>false</b>;
            }
 
            <span class="c">// If we are reading input for the first command in the pipeline increment PipelineIterationInfo[0], which is the number of items read from the input</span>
            <b>if</b> (<a href="#45a6054a3775cde6" class="k">this</a>.<a href="#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#f81679c755698e2e" class="i property">MyInvocation</a>.<a href="InvocationInfo.cs.html#b9401843293d51d4" class="i property">PipelinePosition</a> == 1)
            {
                <a href="#45a6054a3775cde6" class="k">this</a>.<a href="#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#f81679c755698e2e" class="i property">MyInvocation</a>.<a href="InvocationInfo.cs.html#0696af7afce6ee9b" class="i property">PipelineIterationInfo</a>[0]++;
            }
 
            <a href="#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#394e3b79ee75331b" class="i property">CurrentPipelineObject</a> = <a href="LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="LanguagePrimitives.cs.html#e9d9a7d7ec7be239" class="i method">AsPSObjectOrNull</a>(<span class="r32 r">inputObject</span>);
 
            <b>return</b> <b>true</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Wraps the exception which occurred during cmdlet invocation,</span>
        <span class="c">///</span><span class="c"> stores that as the exception to be returned from</span>
        <span class="c">///</span><span class="c"> PipelineProcessor.SynchronousExecute, and writes it to</span>
        <span class="c">///</span><span class="c"> the error variable.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r33 r">e</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The exception to wrap in a CmdletInvocationException or</span>
        <span class="c">///</span><span class="c"> CmdletProviderInvocationException.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Always returns PipelineStoppedException.  The caller should</span>
        <span class="c">///</span><span class="c"> throw this exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Almost all exceptions which occur during pipeline invocation</span>
        <span class="c">///</span><span class="c"> are wrapped in CmdletInvocationException before they are stored</span>
        <span class="c">///</span><span class="c"> in the pipeline.  However, there are several exceptions:</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> AccessViolationException, StackOverflowException:</span>
        <span class="c">///</span><span class="c"> These are considered to be such severe errors that we</span>
        <span class="c">///</span><span class="c"> FailFast the process immediately.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> ProviderInvocationException: In this case, we assume that the</span>
        <span class="c">///</span><span class="c"> cmdlet is get-item or the like, a thin wrapper around the</span>
        <span class="c">///</span><span class="c"> provider API.  We discard the original ProviderInvocationException</span>
        <span class="c">///</span><span class="c"> and re-wrap its InnerException (the real error) in</span>
        <span class="c">///</span><span class="c"> CmdletProviderInvocationException. This makes it easier to reach</span>
        <span class="c">///</span><span class="c"> the real error.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> CmdletInvocationException, ActionPreferenceStopException:</span>
        <span class="c">///</span><span class="c"> This indicates that the cmdlet itself ran a command which failed.</span>
        <span class="c">///</span><span class="c"> We could go ahead and wrap the original exception in multiple</span>
        <span class="c">///</span><span class="c"> layers of CmdletInvocationException, but this makes it difficult</span>
        <span class="c">///</span><span class="c"> for the caller to access the root problem, plus the serialization</span>
        <span class="c">///</span><span class="c"> layer might not communicate properties beyond some fixed depth.</span>
        <span class="c">///</span><span class="c"> Instead, we choose to not re-wrap the exception.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> PipelineStoppedException: This could mean one of two things.</span>
        <span class="c">///</span><span class="c"> It usually means that this pipeline has already stopped,</span>
        <span class="c">///</span><span class="c"> in which case the pipeline already stores the original error.</span>
        <span class="c">///</span><span class="c"> It could also mean that the cmdlet ran a command which was</span>
        <span class="c">///</span><span class="c"> stopped by CTRL-C etc, in which case we choose not to</span>
        <span class="c">///</span><span class="c"> re-wrap the exception as with CmdletInvocationException.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>internal</b> <a href="../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a> <a id="2b54af4c46f46a60" href="../R/2b54af4c46f46a60.html" target="n" data-glyph="74,1" class="i method">ManageInvocationException</a>(<span class="i">Exception</span> <span id="r33 rd" class="r33 r">e</span>)
        {
            <b>try</b>
            {
                <b>if</b> (<a href="#f58ee453ebc82f56" class="i property">Command</a> != <b>null</b>)
                {
                    <b>do</b> <span class="c">// false loop</span>
                    {
                        <a href="../utils/SessionStateExceptions.cs.html#35e07c15a7526bcd" class="t t">ProviderInvocationException</a> <span id="r34 rd" class="r34 r">pie</span> = <span class="r33 r">e</span> <b>as</b> <a href="../utils/SessionStateExceptions.cs.html#35e07c15a7526bcd" class="t t">ProviderInvocationException</a>;
                        <b>if</b> (<span class="r34 r">pie</span> != <b>null</b>)
                        {
                            <span class="c">// If a ProviderInvocationException occurred,</span>
                            <span class="c">// discard the ProviderInvocationException and</span>
                            <span class="c">// re-wrap in CmdletProviderInvocationException</span>
                            <span class="r33 r">e</span> = <b>new</b> <a href="../utils/ExecutionExceptions.cs.html#5e09ca103543bbc7" class="t constructor">CmdletProviderInvocationException</a>(
                                <span class="r34 r">pie</span>,
                                <a href="#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#f81679c755698e2e" class="i property">MyInvocation</a>);
                            <b>break</b>;
                        }
 
                        <span class="c">// 1021203-2005/05/09-JonN</span>
                        <span class="c">// HaltCommandException will cause the command</span>
                        <span class="c">// to stop, but not be reported as an error.</span>
                        <span class="c">// 906445-2005/05/16-JonN</span>
                        <span class="c">// FlowControlException should not be wrapped</span>
                        <b>if</b> (<span class="r33 r">e</span> <b>is</b> <a href="../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a>
                            || <span class="r33 r">e</span> <b>is</b> <a href="../utils/ExecutionExceptions.cs.html#7b242746a433b370" class="t t">CmdletInvocationException</a>
                            || <span class="r33 r">e</span> <b>is</b> <a href="../utils/ExecutionExceptions.cs.html#f896df45dff24981" class="t t">ActionPreferenceStopException</a>
                            || <span class="r33 r">e</span> <b>is</b> <a href="../utils/ExecutionExceptions.cs.html#ec3d1200bf100d3c" class="t t">HaltCommandException</a>
                            || <span class="r33 r">e</span> <b>is</b> <a href="lang/parserutils.cs.html#a3a2a71cfea9c3b1" class="t t">FlowControlException</a>
                            || <span class="r33 r">e</span> <b>is</b> <a href="../utils/ExecutionExceptions.cs.html#fa64ade1e4dc44f8" class="t t">ScriptCallDepthException</a>)
                        {
                            <span class="c">// do nothing; do not rewrap these exceptions</span>
                            <b>break</b>;
                        }
 
                        <a href="../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a> <span id="r35 rd" class="r35 r">rte</span> = <span class="r33 r">e</span> <b>as</b> <a href="../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>;
                        <b>if</b> (<span class="r35 r">rte</span> != <b>null</b> &amp;&amp; <span class="r35 r">rte</span>.<a href="../utils/RuntimeException.cs.html#07e13566c1a5f36a" class="i property">WasThrownFromThrowStatement</a>)
                        {
                            <span class="c">// do not rewrap a script based throw</span>
                            <b>break</b>;
                        }
 
                        <span class="c">// wrap all other exceptions</span>
                        <span class="r33 r">e</span> = <b>new</b> <a href="../utils/ExecutionExceptions.cs.html#b3316b9ed5e8a1c1" class="t constructor">CmdletInvocationException</a>(
                                    <span class="r33 r">e</span>,
                                    <a href="#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#f81679c755698e2e" class="i property">MyInvocation</a>);
                    } <b>while</b> (<b>false</b>);
 
                    <span class="c">// commandRuntime.ManageException will always throw PipelineStoppedException</span>
                    <span class="c">// Otherwise, just return this exception...</span>
 
                    <span class="c">// If this exception happened in a transacted cmdlet,</span>
                    <span class="c">// rollback the transaction</span>
                    <b>if</b> (<a href="#c9b17347b060ac3f" class="i field">commandRuntime</a>.<a href="MshCommandRuntime.cs.html#84be5d945a0edf7b" class="i property">UseTransaction</a>)
                    {
                        <span class="c">// The &quot;transaction timed out&quot; exception is</span>
                        <span class="c">// exceedingly obtuse. We clarify things here.</span>
                        <b>bool</b> <span id="r36 rd" class="r36 r">isTimeoutException</span> = <b>false</b>;
                        <span class="i">Exception</span> <span id="r37 rd" class="r37 r">tempException</span> = <span class="r33 r">e</span>;
                        <b>while</b> (<span class="r37 r">tempException</span> != <b>null</b>)
                        {
                            <b>if</b> (<span class="r37 r">tempException</span> <b>is</b> <span class="i n">System</span>.<span class="i">TimeoutException</span>)
                            {
                                <span class="r36 r">isTimeoutException</span> = <b>true</b>;
                                <b>break</b>;
                            }
 
                            <span class="r37 r">tempException</span> = <span class="r37 r">tempException</span>.<span class="i">InnerException</span>;
                        }
 
                        <b>if</b> (<span class="r36 r">isTimeoutException</span>)
                        {
                            <a href="ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r38 rd" class="r38 r">errorRecord</span> = <b>new</b> <span class="t">ErrorRecord</span>(
                                <b>new</b> <span class="i">InvalidOperationException</span>(
                                    <span class="i">TransactionStrings</span>.<span class="i">TransactionTimedOut</span>),
                                <span class="s">&quot;TRANSACTION_TIMEOUT&quot;</span>,
                                <a href="ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="ErrorPackage.cs.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>,
                                <span class="r33 r">e</span>);
                            <span class="r38 r">errorRecord</span>.<a href="ErrorPackage.cs.html#14b8261653db7b03" class="i method">SetInvocationInfo</a>(<a href="#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#f81679c755698e2e" class="i property">MyInvocation</a>);
 
                            <span class="r33 r">e</span> = <b>new</b> <a href="../utils/ExecutionExceptions.cs.html#442c9ff167794161" class="t constructor">CmdletInvocationException</a>(<span class="r38 r">errorRecord</span>);
                        }
 
                        <span class="c">// Rollback the transaction in the case of errors.</span>
                        <b>if</b> (
                            <a href="#bb86759713ca670f" class="i field">_context</a>.<a href="ExecutionContext.cs.html#d432bf41e44dd9db" class="i property">TransactionManager</a>.<a href="../CoreCLR/CorePsStub.cs.html#8034b8ed99ff105b" class="i property">HasTransaction</a>
                            &amp;&amp;
                            <a href="#bb86759713ca670f" class="i field">_context</a>.<a href="ExecutionContext.cs.html#d432bf41e44dd9db" class="i property">TransactionManager</a>.<a href="../CoreCLR/CorePsStub.cs.html#5e3b48ff3edf5b68" class="i property">RollbackPreference</a> != <a href="../CoreCLR/CorePsStub.cs.html#093dd53b7c8e0582" class="t t">RollbackSeverity</a>.<a href="../CoreCLR/CorePsStub.cs.html#84ea7205031b0ba6" class="i field">Never</a>
                           )
                        {
                            <a href="#00c4abcf32dda50f" class="i property">Context</a>.<a href="ExecutionContext.cs.html#d432bf41e44dd9db" class="i property">TransactionManager</a>.<a href="../CoreCLR/CorePsStub.cs.html#c002f17dda3f7e78" class="i method">Rollback</a>(<b>true</b>);
                        }
                    }
 
                    <b>return</b> (<a href="../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a>)<a href="#45a6054a3775cde6" class="k">this</a>.<a href="#c9b17347b060ac3f" class="i field">commandRuntime</a>.<a href="MshCommandRuntime.cs.html#ac21e463bdb95d02" class="i method">ManageException</a>(<span class="r33 r">e</span>);
                }
 
                <span class="c">// Upstream cmdlets see only that execution stopped</span>
                <span class="c">// This should only happen if Command is null</span>
                <b>return</b> <b>new</b> <a href="../utils/ExecutionExceptions.cs.html#105b0214d3aab114" class="t constructor">PipelineStoppedException</a>();
            }
            <b>catch</b> (<span class="i">Exception</span>)
            {
                <span class="c">// this method should not throw exceptions; warn about any violations on checked builds and re-throw</span>
                <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<b>false</b>, <span class="s">&quot;This method should not throw exceptions!&quot;</span>);
                <b>throw</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Stores the exception to be returned from</span>
        <span class="c">///</span><span class="c"> PipelineProcessor.SynchronousExecute, and writes it to</span>
        <span class="c">///</span><span class="c"> the error variable.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r39 r">e</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The exception which occurred during script execution</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> ManageScriptException throws PipelineStoppedException if-and-only-if</span>
        <span class="c">///</span><span class="c"> the exception is a RuntimeException, otherwise it returns.</span>
        <span class="c">///</span><span class="c"> This allows the caller to rethrow unexpected exceptions.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="44e39dd7927a2328" href="../R/44e39dd7927a2328.html" target="n" data-glyph="74,1" class="i method">ManageScriptException</a>(<a href="../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a> <span id="r39 rd" class="r39 r">e</span>)
        {
            <b>if</b> (<a href="#f58ee453ebc82f56" class="i property">Command</a> != <b>null</b> &amp;&amp; <a href="#c9b17347b060ac3f" class="i field">commandRuntime</a>.<a href="MshCommandRuntime.cs.html#895cb9f77d1d9539" class="i property">PipelineProcessor</a> != <b>null</b>)
            {
                <a href="#c9b17347b060ac3f" class="i field">commandRuntime</a>.<a href="MshCommandRuntime.cs.html#895cb9f77d1d9539" class="i property">PipelineProcessor</a>.<span class="i">RecordFailure</span>(<span class="r39 r">e</span>, <a href="#f58ee453ebc82f56" class="i property">Command</a>);
 
                <span class="c">// An explicit throw is written to $error as an ErrorRecord, so we</span>
                <span class="c">// skip adding what is more or less a duplicate.</span>
                <b>if</b> (<span class="r39 r">e</span> <b>is not</b> <a href="../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a> &amp;&amp; !<span class="r39 r">e</span>.<a href="../utils/RuntimeException.cs.html#07e13566c1a5f36a" class="i property">WasThrownFromThrowStatement</a>)
                    <a href="#c9b17347b060ac3f" class="i field">commandRuntime</a>.<a href="MshCommandRuntime.cs.html#877f409b69c044ab" class="i method">AppendErrorToVariables</a>(<span class="r39 r">e</span>);
            }
            <span class="c">// Upstream cmdlets see only that execution stopped</span>
            <b>throw</b> <b>new</b> <a href="../utils/ExecutionExceptions.cs.html#105b0214d3aab114" class="t constructor">PipelineStoppedException</a>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Sometimes we shouldn&#39;t be rethrow the exception we previously caught,</span>
        <span class="c">///</span><span class="c"> such as when the exception is handled by a trap.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="072501da99fba9ed" href="../R/072501da99fba9ed.html" target="n" data-glyph="74,1" class="i method">ForgetScriptException</a>()
        {
            <b>if</b> (<a href="#f58ee453ebc82f56" class="i property">Command</a> != <b>null</b> &amp;&amp; <a href="#c9b17347b060ac3f" class="i field">commandRuntime</a>.<a href="MshCommandRuntime.cs.html#895cb9f77d1d9539" class="i property">PipelineProcessor</a> != <b>null</b>)
            {
                <a href="#c9b17347b060ac3f" class="i field">commandRuntime</a>.<a href="MshCommandRuntime.cs.html#895cb9f77d1d9539" class="i property">PipelineProcessor</a>.<a href="pipeline.cs.html#32078eca48d5267c" class="i method">ForgetFailure</a>();
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> methods
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> IDispose
        <span class="c">// 2004/03/05-JonN BrucePay has suggested that the IDispose</span>
        <span class="c">// implementations in PipelineProcessor and CommandProcessor can be</span>
        <span class="c">// removed.</span>
        <b>private bool</b> <a id="afb4110653fda097" href="../R/afb4110653fda097.html" target="n" data-glyph="46,1" class="i field">_disposed</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> IDisposable implementation</span>
        <span class="c">///</span><span class="c"> When the command is complete, the CommandProcessorBase should be disposed.</span>
        <span class="c">///</span><span class="c"> This enables cmdlets to reliably release file handles etc.</span>
        <span class="c">///</span><span class="c"> without waiting for garbage collection.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span><span class="c">We use the standard IDispose pattern</span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>public void</b> <a id="1def878a0308e741" href="../R/1def878a0308e741.html" target="n" data-glyph="72,1" class="i method">Dispose</a>()
        {
            <a href="#a1d5da1ff988aa28" class="i method">Dispose</a>(<b>true</b>);
            <span class="i">GC</span>.<span class="i">SuppressFinalize</span>(<a href="#45a6054a3775cde6" class="k">this</a>);
        }
 
        <b>private void</b> <a id="a1d5da1ff988aa28" href="../R/a1d5da1ff988aa28.html" target="n" data-glyph="76,1" class="i method">Dispose</a>(<b>bool</b> <span id="r40 rd" class="r40 r">disposing</span>)
        {
            <b>if</b> (<a href="#afb4110653fda097" class="i field">_disposed</a>)
                <b>return</b>;
 
            <b>if</b> (<span class="r40 r">disposing</span>)
            {
                <span class="c">// 2004/03/05-JonN Look into using metadata to check</span>
                <span class="c">// whether IDisposable is implemented, in order to avoid</span>
                <span class="c">// this expensive reflection cast.</span>
                <span class="i">IDisposable</span> <span id="r41 rd" class="r41 r">id</span> = <a href="#f58ee453ebc82f56" class="i property">Command</a> <b>as</b> <span class="i">IDisposable</span>;
                <b>if</b> (<span class="r41 r">id</span> != <b>null</b>)
                {
                    <span class="r41 r">id</span>.<span class="i">Dispose</span>();
                }
            }
 
            <a href="#afb4110653fda097" class="i field">_disposed</a> = <b>true</b>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> IDispose
    }
}
</pre></td></tr></table></div></body></html>
