<!DOCTYPE html>
<html><head><title>Telemetry.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(870);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#System.Management.Automation/utils/Telemetry.cs" target="_top">utils\Telemetry.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#System.Management.Automation" target="_top">src\System.Management.Automation\System.Management.Automation.csproj</a> (System.Management.Automation)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Runtime</span>.<span class="i">InteropServices</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Threading</span>;
 
<b>using</b> <span class="i n">Microsoft</span>.<span class="i">ApplicationInsights</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i">ApplicationInsights</span>.<span class="i">Extensibility</span>;
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Telemetry</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> The category of telemetry.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal enum</b> <a id="3951f46d9ee8c91d" href="../R/3951f46d9ee8c91d.html" target="n" data-glyph="20,0" class="t t"><span id="e4d394506b72804d">TelemetryType</span></a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Telemetry of the application type (cmdlet, script, etc).</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="a4e962dedc97caa5" href="../R/a4e962dedc97caa5.html" target="n" data-glyph="24,1" class="i field">ApplicationType</a>,
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Send telemetry when we load a module, only module names in the s_knownModules list</span>
        <span class="c">///</span><span class="c"> will be reported, otherwise it will be &quot;anonymous&quot;.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="f3f3b72577bf44b5" href="../R/f3f3b72577bf44b5.html" target="n" data-glyph="24,1" class="i field">ModuleLoad</a>,
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Send telemetry when we load a module using Windows compatibility feature, only module names in the s_knownModules list</span>
        <span class="c">///</span><span class="c"> will be reported, otherwise it will be &quot;anonymous&quot;.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="80e278d1d50e7321" href="../R/80e278d1d50e7321.html" target="n" data-glyph="24,1" class="i field">WinCompatModuleLoad</a>,
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Send telemetry for experimental module feature activation.</span>
        <span class="c">///</span><span class="c"> All experimental engine features will be have telemetry.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="56438e56a9b215e8" href="../R/56438e56a9b215e8.html" target="n" data-glyph="24,1" class="i field">ExperimentalEngineFeatureActivation</a>,
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Send telemetry for experimental module feature activation.</span>
        <span class="c">///</span><span class="c"> Experimental module features will send telemetry based on the module it is in.</span>
        <span class="c">///</span><span class="c"> If we send telemetry for the module, we will also do so for any experimental feature</span>
        <span class="c">///</span><span class="c"> in that module.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="4a0d991add36402b" href="../R/4a0d991add36402b.html" target="n" data-glyph="24,1" class="i field">ExperimentalModuleFeatureActivation</a>,
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Send telemetry for each PowerShell.Create API.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="463b1bedf5979814" href="../R/463b1bedf5979814.html" target="n" data-glyph="24,1" class="i field">PowerShellCreate</a>,
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Remote session creation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="1cf75b47c1af2ffa" href="../R/1cf75b47c1af2ffa.html" target="n" data-glyph="24,1" class="i field">RemoteSessionOpen</a>,
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Send up telemetry for startup.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public static class</b> <a id="9832071d08aec551" href="../R/9832071d08aec551.html" target="n" data-glyph="0,0" class="t t">ApplicationInsightsTelemetry</a>
    {
        <span class="c">// If this env var is true, yes, or 1, telemetry will NOT be sent.</span>
        <b>private const string</b> <a id="50d91da2336098ff" href="../R/50d91da2336098ff.html" target="n" data-glyph="10,1" class="i field">_telemetryOptoutEnvVar</a> = <span class="s">&quot;POWERSHELL_TELEMETRY_OPTOUT&quot;</span>;
 
        <span class="c">// PSCoreInsight2 telemetry key</span>
        <span class="c">// private const string _psCoreTelemetryKey = &quot;ee4b2115-d347-47b0-adb6-b19c2c763808&quot;; // Production</span>
        <b>private const string</b> <a id="c332f153a7efa83b" href="../R/c332f153a7efa83b.html" target="n" data-glyph="10,1" class="i field">_psCoreTelemetryKey</a> = <a href="../../GuidAssembly/R/d26a5ef4-d608-452c-a6b8-a4a55935f70d.html" target="n" class="s">&quot;d26a5ef4-d608-452c-a6b8-a4a55935f70d&quot;</a>; <span class="c">// V7 Preview 3</span>
 
        <span class="c">// Use &quot;anonymous&quot; as the string to return when you can&#39;t report a name</span>
        <b>private const string</b> <a id="c410edb71a276b86" href="../R/c410edb71a276b86.html" target="n" data-glyph="10,1" class="i field">_anonymous</a> = <span class="s">&quot;anonymous&quot;</span>;
 
        <span class="c">// the telemetry failure string</span>
        <b>private const string</b> <a id="72bda94374b47155" href="../R/72bda94374b47155.html" target="n" data-glyph="10,1" class="i field">_telemetryFailure</a> = <span class="s">&quot;TELEMETRY_FAILURE&quot;</span>;
 
        <span class="c">// Telemetry client to be reused when we start sending more telemetry</span>
        <b>private static</b> <span class="i">TelemetryClient</span> <a id="4fc680ecb049bdc0" href="../R/4fc680ecb049bdc0.html" target="n" data-glyph="106,1" class="i property">s_telemetryClient</a> { <b>get</b>; }
 
        <span class="c">// the unique identifier for the user, when we start we</span>
        <b>private static string</b> <a id="acfc2b5c6f2d0013" href="../R/acfc2b5c6f2d0013.html" target="n" data-glyph="106,1" class="i property">s_uniqueUserIdentifier</a> { <b>get</b>; }
 
        <span class="c">// the session identifier</span>
        <b>private static string</b> <a id="84f784ec4c40a82e" href="../R/84f784ec4c40a82e.html" target="n" data-glyph="106,1" class="i property">s_sessionId</a> { <b>get</b>; }
 
        <span class="c">// private semaphore to determine whether we sent the startup telemetry event</span>
        <b>private static int</b> <a id="33c078cb3faca0df" href="../R/33c078cb3faca0df.html" target="n" data-glyph="46,1" class="i field">s_startupEventSent</a> = 0;
 
        <span class="c">///</span><span class="c"> Use a hashset for quick lookups.</span>
        <span class="c">///</span><span class="c"> We send telemetry only a known set of modules.</span>
        <span class="c">///</span><span class="c"> If it&#39;s not in the list (initialized in the static constructor), then we report anonymous.</span>
        <b>private static readonly</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt; <a id="90cb4ece75da9244" href="../R/90cb4ece75da9244.html" target="n" data-glyph="46,1" class="i field">s_knownModules</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">Gets a value indicating whether telemetry can be sent.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public static bool</b> <a id="1975902903f5429d" href="../R/1975902903f5429d.html" target="n" data-glyph="102,1" class="i property">CanSendTelemetry</a> { <b>get</b>; <b>private set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initializes static members of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#9832071d08aec551" class="t t">ApplicationInsightsTelemetry</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> class.</span>
        <span class="c">///</span><span class="c"> Static constructor determines whether telemetry is to be sent, and then</span>
        <span class="c">///</span><span class="c"> sets the telemetry key and set the telemetry delivery mode.</span>
        <span class="c">///</span><span class="c"> Creates the session ID and initializes the HashSet of known module names.</span>
        <span class="c">///</span><span class="c"> Gets or constructs the unique identifier.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>static</b> <a id="fda24ca069c66460" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="t method">ApplicationInsightsTelemetry</a>()
        {
            <span class="c">// If we can&#39;t send telemetry, there&#39;s no reason to do any of this</span>
            <a href="#1975902903f5429d" class="i property">CanSendTelemetry</a> = !<a href="#53009e27d3e18f4b" class="i method">GetEnvironmentVariableAsBool</a>(<span class="r0 r">name</span>: <a href="#50d91da2336098ff" class="i field">_telemetryOptoutEnvVar</a>, <span class="r1 r">defaultValue</span>: <b>false</b>);
            <b>if</b> (<a href="#1975902903f5429d" class="i property">CanSendTelemetry</a>)
            {
                <span class="i">TelemetryConfiguration</span> <span id="r2 rd" class="r2 r">configuration</span> = <span class="i">TelemetryConfiguration</span>.<span class="i">CreateDefault</span>();
                <span class="r2 r">configuration</span>.<span class="i">InstrumentationKey</span> = <a href="#c332f153a7efa83b" class="i field">_psCoreTelemetryKey</a>;
 
                <span class="c">// Set this to true to reduce latency during development</span>
                <span class="r2 r">configuration</span>.<span class="i">TelemetryChannel</span>.<span class="i">DeveloperMode</span> = <b>false</b>;
 
                <a href="#4fc680ecb049bdc0" class="i property">s_telemetryClient</a> = <b>new</b> <span class="i">TelemetryClient</span>(<span class="r2 r">configuration</span>);
                <a href="#84f784ec4c40a82e" class="i property">s_sessionId</a> = <span class="i">Guid</span>.<span class="i">NewGuid</span>().<span class="i">ToString</span>();
 
                <span class="c">// use a hashset when looking for module names, it should be quicker than a string comparison</span>
                <a href="#90cb4ece75da9244" class="i field">s_knownModules</a> = <b>new</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt;(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>)
                    {
                        <span class="s">&quot;AADRM&quot;</span>,
                        <span class="s">&quot;activedirectory&quot;</span>,
                        <span class="s">&quot;adcsadministration&quot;</span>,
                        <span class="s">&quot;adcsdeployment&quot;</span>,
                        <span class="s">&quot;addsadministration&quot;</span>,
                        <span class="s">&quot;addsdeployment&quot;</span>,
                        <span class="s">&quot;adfs&quot;</span>,
                        <span class="s">&quot;adrms&quot;</span>,
                        <span class="s">&quot;adrmsadmin&quot;</span>,
                        <span class="s">&quot;agpm&quot;</span>,
                        <span class="s">&quot;appbackgroundtask&quot;</span>,
                        <span class="s">&quot;applocker&quot;</span>,
                        <span class="s">&quot;appv&quot;</span>,
                        <span class="s">&quot;appvclient&quot;</span>,
                        <span class="s">&quot;appvsequencer&quot;</span>,
                        <span class="s">&quot;appvserver&quot;</span>,
                        <span class="s">&quot;appx&quot;</span>,
                        <span class="s">&quot;assignedaccess&quot;</span>,
                        <span class="s">&quot;Az&quot;</span>,
                        <span class="s">&quot;Az.Accounts&quot;</span>,
                        <span class="s">&quot;Az.Advisor&quot;</span>,
                        <span class="s">&quot;Az.Aks&quot;</span>,
                        <span class="s">&quot;Az.AlertsManagement&quot;</span>,
                        <span class="s">&quot;Az.AnalysisServices&quot;</span>,
                        <span class="s">&quot;Az.ApiManagement&quot;</span>,
                        <span class="s">&quot;Az.ApplicationInsights&quot;</span>,
                        <span class="s">&quot;Az.Attestation&quot;</span>,
                        <span class="s">&quot;Az.Automation&quot;</span>,
                        <span class="s">&quot;Az.Batch&quot;</span>,
                        <span class="s">&quot;Az.Billing&quot;</span>,
                        <span class="s">&quot;Az.Blueprint&quot;</span>,
                        <span class="s">&quot;Az.Cdn&quot;</span>,
                        <span class="s">&quot;Az.CognitiveServices&quot;</span>,
                        <span class="s">&quot;Az.Compute&quot;</span>,
                        <span class="s">&quot;Az.ContainerInstance&quot;</span>,
                        <span class="s">&quot;Az.ContainerRegistry&quot;</span>,
                        <span class="s">&quot;Az.DataBox&quot;</span>,
                        <span class="s">&quot;Az.DataFactory&quot;</span>,
                        <span class="s">&quot;Az.DataLakeAnalytics&quot;</span>,
                        <span class="s">&quot;Az.DataLakeStore&quot;</span>,
                        <span class="s">&quot;Az.DataMigration&quot;</span>,
                        <span class="s">&quot;Az.DataShare&quot;</span>,
                        <span class="s">&quot;Az.DeploymentManager&quot;</span>,
                        <span class="s">&quot;Az.DeviceProvisioningServices&quot;</span>,
                        <span class="s">&quot;Az.DevSpaces&quot;</span>,
                        <span class="s">&quot;Az.DevTestLabs&quot;</span>,
                        <span class="s">&quot;Az.Dns&quot;</span>,
                        <span class="s">&quot;Az.EventGrid&quot;</span>,
                        <span class="s">&quot;Az.EventHub&quot;</span>,
                        <span class="s">&quot;Az.FrontDoor&quot;</span>,
                        <span class="s">&quot;Az.GuestConfiguration&quot;</span>,
                        <span class="s">&quot;Az.HDInsight&quot;</span>,
                        <span class="s">&quot;Az.HealthcareApis&quot;</span>,
                        <span class="s">&quot;Az.IotCentral&quot;</span>,
                        <span class="s">&quot;Az.IotHub&quot;</span>,
                        <span class="s">&quot;Az.KeyVault&quot;</span>,
                        <span class="s">&quot;Az.Kusto&quot;</span>,
                        <span class="s">&quot;Az.LogicApp&quot;</span>,
                        <span class="s">&quot;Az.MachineLearning&quot;</span>,
                        <span class="s">&quot;Az.ManagedServiceIdentity&quot;</span>,
                        <span class="s">&quot;Az.ManagedServices&quot;</span>,
                        <span class="s">&quot;Az.ManagementPartner&quot;</span>,
                        <span class="s">&quot;Az.Maps&quot;</span>,
                        <span class="s">&quot;Az.MarketplaceOrdering&quot;</span>,
                        <span class="s">&quot;Az.Media&quot;</span>,
                        <span class="s">&quot;Az.MixedReality&quot;</span>,
                        <span class="s">&quot;Az.Monitor&quot;</span>,
                        <span class="s">&quot;Az.NetAppFiles&quot;</span>,
                        <span class="s">&quot;Az.Network&quot;</span>,
                        <span class="s">&quot;Az.NotificationHubs&quot;</span>,
                        <span class="s">&quot;Az.OperationalInsights&quot;</span>,
                        <span class="s">&quot;Az.Peering&quot;</span>,
                        <span class="s">&quot;Az.PolicyInsights&quot;</span>,
                        <span class="s">&quot;Az.PowerBIEmbedded&quot;</span>,
                        <span class="s">&quot;Az.PrivateDns&quot;</span>,
                        <span class="s">&quot;Az.RecoveryServices&quot;</span>,
                        <span class="s">&quot;Az.RedisCache&quot;</span>,
                        <span class="s">&quot;Az.Relay&quot;</span>,
                        <span class="s">&quot;Az.Reservations&quot;</span>,
                        <span class="s">&quot;Az.ResourceGraph&quot;</span>,
                        <span class="s">&quot;Az.Resources&quot;</span>,
                        <span class="s">&quot;Az.Search&quot;</span>,
                        <span class="s">&quot;Az.Security&quot;</span>,
                        <span class="s">&quot;Az.ServiceBus&quot;</span>,
                        <span class="s">&quot;Az.ServiceFabric&quot;</span>,
                        <span class="s">&quot;Az.SignalR&quot;</span>,
                        <span class="s">&quot;Az.Sql&quot;</span>,
                        <span class="s">&quot;Az.Storage&quot;</span>,
                        <span class="s">&quot;Az.StorageSync&quot;</span>,
                        <span class="s">&quot;Az.StorageTable&quot;</span>,
                        <span class="s">&quot;Az.StreamAnalytics&quot;</span>,
                        <span class="s">&quot;Az.Subscription&quot;</span>,
                        <span class="s">&quot;Az.TrafficManager&quot;</span>,
                        <span class="s">&quot;Az.Websites&quot;</span>,
                        <span class="s">&quot;Azs.Azurebridge.Admin&quot;</span>,
                        <span class="s">&quot;Azs.Backup.Admin&quot;</span>,
                        <span class="s">&quot;Azs.Commerce.Admin&quot;</span>,
                        <span class="s">&quot;Azs.Compute.Admin&quot;</span>,
                        <span class="s">&quot;Azs.Fabric.Admin&quot;</span>,
                        <span class="s">&quot;Azs.Gallery.Admin&quot;</span>,
                        <span class="s">&quot;Azs.Infrastructureinsights.Admin&quot;</span>,
                        <span class="s">&quot;Azs.Keyvault.Admin&quot;</span>,
                        <span class="s">&quot;Azs.Network.Admin&quot;</span>,
                        <span class="s">&quot;Azs.Storage.Admin&quot;</span>,
                        <span class="s">&quot;Azs.Subscriptions&quot;</span>,
                        <span class="s">&quot;Azs.Subscriptions.Admin&quot;</span>,
                        <span class="s">&quot;Azs.Update.Admin&quot;</span>,
                        <span class="s">&quot;AzStorageTable&quot;</span>,
                        <span class="s">&quot;Azure&quot;</span>,
                        <span class="s">&quot;Azure.AnalysisServices&quot;</span>,
                        <span class="s">&quot;Azure.Storage&quot;</span>,
                        <span class="s">&quot;AzureAD&quot;</span>,
                        <span class="s">&quot;AzureInformationProtection&quot;</span>,
                        <span class="s">&quot;AzureRM.Aks&quot;</span>,
                        <span class="s">&quot;AzureRM.AnalysisServices&quot;</span>,
                        <span class="s">&quot;AzureRM.ApiManagement&quot;</span>,
                        <span class="s">&quot;AzureRM.ApplicationInsights&quot;</span>,
                        <span class="s">&quot;AzureRM.Automation&quot;</span>,
                        <span class="s">&quot;AzureRM.Backup&quot;</span>,
                        <span class="s">&quot;AzureRM.Batch&quot;</span>,
                        <span class="s">&quot;AzureRM.Billing&quot;</span>,
                        <span class="s">&quot;AzureRM.Cdn&quot;</span>,
                        <span class="s">&quot;AzureRM.CognitiveServices&quot;</span>,
                        <span class="s">&quot;AzureRm.Compute&quot;</span>,
                        <span class="s">&quot;AzureRM.Compute.ManagedService&quot;</span>,
                        <span class="s">&quot;AzureRM.Consumption&quot;</span>,
                        <span class="s">&quot;AzureRM.ContainerInstance&quot;</span>,
                        <span class="s">&quot;AzureRM.ContainerRegistry&quot;</span>,
                        <span class="s">&quot;AzureRM.DataFactories&quot;</span>,
                        <span class="s">&quot;AzureRM.DataFactoryV2&quot;</span>,
                        <span class="s">&quot;AzureRM.DataLakeAnalytics&quot;</span>,
                        <span class="s">&quot;AzureRM.DataLakeStore&quot;</span>,
                        <span class="s">&quot;AzureRM.DataMigration&quot;</span>,
                        <span class="s">&quot;AzureRM.DeploymentManager&quot;</span>,
                        <span class="s">&quot;AzureRM.DeviceProvisioningServices&quot;</span>,
                        <span class="s">&quot;AzureRM.DevSpaces&quot;</span>,
                        <span class="s">&quot;AzureRM.DevTestLabs&quot;</span>,
                        <span class="s">&quot;AzureRm.Dns&quot;</span>,
                        <span class="s">&quot;AzureRM.EventGrid&quot;</span>,
                        <span class="s">&quot;AzureRM.EventHub&quot;</span>,
                        <span class="s">&quot;AzureRM.FrontDoor&quot;</span>,
                        <span class="s">&quot;AzureRM.HDInsight&quot;</span>,
                        <span class="s">&quot;AzureRm.Insights&quot;</span>,
                        <span class="s">&quot;AzureRM.IotCentral&quot;</span>,
                        <span class="s">&quot;AzureRM.IotHub&quot;</span>,
                        <span class="s">&quot;AzureRm.Keyvault&quot;</span>,
                        <span class="s">&quot;AzureRM.LocationBasedServices&quot;</span>,
                        <span class="s">&quot;AzureRM.LogicApp&quot;</span>,
                        <span class="s">&quot;AzureRM.MachineLearning&quot;</span>,
                        <span class="s">&quot;AzureRM.MachineLearningCompute&quot;</span>,
                        <span class="s">&quot;AzureRM.ManagedServiceIdentity&quot;</span>,
                        <span class="s">&quot;AzureRM.ManagementPartner&quot;</span>,
                        <span class="s">&quot;AzureRM.Maps&quot;</span>,
                        <span class="s">&quot;AzureRM.MarketplaceOrdering&quot;</span>,
                        <span class="s">&quot;AzureRM.Media&quot;</span>,
                        <span class="s">&quot;AzureRM.Network&quot;</span>,
                        <span class="s">&quot;AzureRM.NotificationHubs&quot;</span>,
                        <span class="s">&quot;AzureRM.OperationalInsights&quot;</span>,
                        <span class="s">&quot;AzureRM.PolicyInsights&quot;</span>,
                        <span class="s">&quot;AzureRM.PowerBIEmbedded&quot;</span>,
                        <span class="s">&quot;AzureRM.Profile&quot;</span>,
                        <span class="s">&quot;AzureRM.RecoveryServices&quot;</span>,
                        <span class="s">&quot;AzureRM.RecoveryServices.Backup&quot;</span>,
                        <span class="s">&quot;AzureRM.RecoveryServices.SiteRecovery&quot;</span>,
                        <span class="s">&quot;AzureRM.RedisCache&quot;</span>,
                        <span class="s">&quot;AzureRM.Relay&quot;</span>,
                        <span class="s">&quot;AzureRM.Reservations&quot;</span>,
                        <span class="s">&quot;AzureRM.ResourceGraph&quot;</span>,
                        <span class="s">&quot;AzureRM.Resources&quot;</span>,
                        <span class="s">&quot;AzureRM.Scheduler&quot;</span>,
                        <span class="s">&quot;AzureRM.Search&quot;</span>,
                        <span class="s">&quot;AzureRM.Security&quot;</span>,
                        <span class="s">&quot;AzureRM.ServerManagement&quot;</span>,
                        <span class="s">&quot;AzureRM.ServiceBus&quot;</span>,
                        <span class="s">&quot;AzureRM.ServiceFabric&quot;</span>,
                        <span class="s">&quot;AzureRM.SignalR&quot;</span>,
                        <span class="s">&quot;AzureRM.SiteRecovery&quot;</span>,
                        <span class="s">&quot;AzureRM.Sql&quot;</span>,
                        <span class="s">&quot;AzureRm.Storage&quot;</span>,
                        <span class="s">&quot;AzureRM.StorageSync&quot;</span>,
                        <span class="s">&quot;AzureRM.StreamAnalytics&quot;</span>,
                        <span class="s">&quot;AzureRM.Subscription&quot;</span>,
                        <span class="s">&quot;AzureRM.Subscription.Preview&quot;</span>,
                        <span class="s">&quot;AzureRM.Tags&quot;</span>,
                        <span class="s">&quot;AzureRM.TrafficManager&quot;</span>,
                        <span class="s">&quot;AzureRm.UsageAggregates&quot;</span>,
                        <span class="s">&quot;AzureRm.Websites&quot;</span>,
                        <span class="s">&quot;AzureRmStorageTable&quot;</span>,
                        <span class="s">&quot;bestpractices&quot;</span>,
                        <span class="s">&quot;bitlocker&quot;</span>,
                        <span class="s">&quot;bitstransfer&quot;</span>,
                        <span class="s">&quot;booteventcollector&quot;</span>,
                        <span class="s">&quot;branchcache&quot;</span>,
                        <span class="s">&quot;CimCmdlets&quot;</span>,
                        <span class="s">&quot;clusterawareupdating&quot;</span>,
                        <span class="s">&quot;configci&quot;</span>,
                        <span class="s">&quot;ConfigurationManager&quot;</span>,
                        <span class="s">&quot;DataProtectionManager&quot;</span>,
                        <span class="s">&quot;dcbqos&quot;</span>,
                        <span class="s">&quot;deduplication&quot;</span>,
                        <span class="s">&quot;defender&quot;</span>,
                        <span class="s">&quot;devicehealthattestation&quot;</span>,
                        <span class="s">&quot;dfsn&quot;</span>,
                        <span class="s">&quot;dfsr&quot;</span>,
                        <span class="s">&quot;dhcpserver&quot;</span>,
                        <span class="s">&quot;directaccessclient&quot;</span>,
                        <span class="s">&quot;directaccessclientcomponent&quot;</span>,
                        <span class="s">&quot;directaccessclientcomponents&quot;</span>,
                        <span class="s">&quot;dism&quot;</span>,
                        <span class="s">&quot;dnsclient&quot;</span>,
                        <span class="s">&quot;dnsserver&quot;</span>,
                        <span class="s">&quot;ElasticDatabaseJobs&quot;</span>,
                        <span class="s">&quot;EventTracingManagement&quot;</span>,
                        <span class="s">&quot;failoverclusters&quot;</span>,
                        <span class="s">&quot;fileserverresourcemanager&quot;</span>,
                        <span class="s">&quot;FIMAutomation&quot;</span>,
                        <span class="s">&quot;GPRegistryPolicy&quot;</span>,
                        <span class="s">&quot;grouppolicy&quot;</span>,
                        <span class="s">&quot;hardwarecertification&quot;</span>,
                        <span class="s">&quot;hcs&quot;</span>,
                        <span class="s">&quot;hgsattestation&quot;</span>,
                        <span class="s">&quot;hgsclient&quot;</span>,
                        <span class="s">&quot;hgsdiagnostics&quot;</span>,
                        <span class="s">&quot;hgskeyprotection&quot;</span>,
                        <span class="s">&quot;hgsserver&quot;</span>,
                        <span class="s">&quot;hnvdiagnostics&quot;</span>,
                        <span class="s">&quot;hostcomputeservice&quot;</span>,
                        <span class="s">&quot;hpc&quot;</span>,
                        <span class="s">&quot;HPC.ACM&quot;</span>,
                        <span class="s">&quot;HPC.ACM.API.PS&quot;</span>,
                        <span class="s">&quot;HPCPack2016&quot;</span>,
                        <span class="s">&quot;hyper-v&quot;</span>,
                        <span class="s">&quot;IISAdministration&quot;</span>,
                        <span class="s">&quot;international&quot;</span>,
                        <span class="s">&quot;ipamserver&quot;</span>,
                        <span class="s">&quot;iscsi&quot;</span>,
                        <span class="s">&quot;iscsitarget&quot;</span>,
                        <span class="s">&quot;ISE&quot;</span>,
                        <span class="s">&quot;kds&quot;</span>,
                        <span class="s">&quot;Microsoft.MBAM&quot;</span>,
                        <span class="s">&quot;Microsoft.MEDV&quot;</span>,
                        <span class="s">&quot;MgmtSvcAdmin&quot;</span>,
                        <span class="s">&quot;MgmtSvcConfig&quot;</span>,
                        <span class="s">&quot;MgmtSvcMySql&quot;</span>,
                        <span class="s">&quot;MgmtSvcSqlServer&quot;</span>,
                        <span class="s">&quot;Microsoft.AzureStack.ReadinessChecker&quot;</span>,
                        <span class="s">&quot;Microsoft.Crm.PowerShell&quot;</span>,
                        <span class="s">&quot;Microsoft.DiagnosticDataViewer&quot;</span>,
                        <span class="s">&quot;Microsoft.DirectoryServices.MetadirectoryServices.Config&quot;</span>,
                        <span class="s">&quot;Microsoft.Dynamics.Nav.Apps.Management&quot;</span>,
                        <span class="s">&quot;Microsoft.Dynamics.Nav.Apps.Tools&quot;</span>,
                        <span class="s">&quot;Microsoft.Dynamics.Nav.Ide&quot;</span>,
                        <span class="s">&quot;Microsoft.Dynamics.Nav.Management&quot;</span>,
                        <span class="s">&quot;Microsoft.Dynamics.Nav.Model.Tools&quot;</span>,
                        <span class="s">&quot;Microsoft.Dynamics.Nav.Model.Tools.Crm&quot;</span>,
                        <span class="s">&quot;Microsoft.EnterpriseManagement.Warehouse.Cmdlets&quot;</span>,
                        <span class="s">&quot;Microsoft.Medv.Administration.Commands.WorkspacePackager&quot;</span>,
                        <span class="s">&quot;Microsoft.PowerApps.Checker.PowerShell&quot;</span>,
                        <span class="s">&quot;Microsoft.PowerShell.Archive&quot;</span>,
                        <span class="s">&quot;Microsoft.PowerShell.Core&quot;</span>,
                        <span class="s">&quot;Microsoft.PowerShell.Crescendo&quot;</span>,
                        <span class="s">&quot;Microsoft.PowerShell.Diagnostics&quot;</span>,
                        <span class="s">&quot;Microsoft.PowerShell.Host&quot;</span>,
                        <span class="s">&quot;Microsoft.PowerShell.LocalAccounts&quot;</span>,
                        <span class="s">&quot;Microsoft.PowerShell.Management&quot;</span>,
                        <span class="s">&quot;Microsoft.PowerShell.ODataUtils&quot;</span>,
                        <span class="s">&quot;Microsoft.PowerShell.Operation.Validation&quot;</span>,
                        <span class="s">&quot;Microsoft.PowerShell.RemotingTools&quot;</span>,
                        <span class="s">&quot;Microsoft.PowerShell.SecretManagement&quot;</span>,
                        <span class="s">&quot;Microsoft.PowerShell.SecretStore&quot;</span>,
                        <span class="s">&quot;Microsoft.PowerShell.Security&quot;</span>,
                        <span class="s">&quot;Microsoft.PowerShell.TextUtility&quot;</span>,
                        <span class="s">&quot;Microsoft.PowerShell.Utility&quot;</span>,
                        <span class="s">&quot;Microsoft.SharePoint.Powershell&quot;</span>,
                        <span class="s">&quot;Microsoft.SystemCenter.ServiceManagementAutomation&quot;</span>,
                        <span class="s">&quot;Microsoft.Windows.ServerManager.Migration&quot;</span>,
                        <span class="s">&quot;Microsoft.WSMan.Management&quot;</span>,
                        <span class="s">&quot;Microsoft.Xrm.OnlineManagementAPI&quot;</span>,
                        <span class="s">&quot;Microsoft.Xrm.Tooling.CrmConnector.PowerShell&quot;</span>,
                        <span class="s">&quot;Microsoft.Xrm.Tooling.PackageDeployment&quot;</span>,
                        <span class="s">&quot;Microsoft.Xrm.Tooling.PackageDeployment.Powershell&quot;</span>,
                        <span class="s">&quot;Microsoft.Xrm.Tooling.Testing&quot;</span>,
                        <span class="s">&quot;MicrosoftPowerBIMgmt&quot;</span>,
                        <span class="s">&quot;MicrosoftPowerBIMgmt.Data&quot;</span>,
                        <span class="s">&quot;MicrosoftPowerBIMgmt.Profile&quot;</span>,
                        <span class="s">&quot;MicrosoftPowerBIMgmt.Reports&quot;</span>,
                        <span class="s">&quot;MicrosoftPowerBIMgmt.Workspaces&quot;</span>,
                        <span class="s">&quot;MicrosoftStaffHub&quot;</span>,
                        <span class="s">&quot;MicrosoftTeams&quot;</span>,
                        <span class="s">&quot;MIMPAM&quot;</span>,
                        <span class="s">&quot;mlSqlPs&quot;</span>,
                        <span class="s">&quot;MMAgent&quot;</span>,
                        <span class="s">&quot;MPIO&quot;</span>,
                        <span class="s">&quot;MsDtc&quot;</span>,
                        <span class="s">&quot;MSMQ&quot;</span>,
                        <span class="s">&quot;MSOnline&quot;</span>,
                        <span class="s">&quot;MSOnlineBackup&quot;</span>,
                        <span class="s">&quot;WmsCmdlets&quot;</span>,
                        <span class="s">&quot;WmsCmdlets3&quot;</span>,
                        <span class="s">&quot;NanoServerImageGenerator&quot;</span>,
                        <span class="s">&quot;NAVWebClientManagement&quot;</span>,
                        <span class="s">&quot;NetAdapter&quot;</span>,
                        <span class="s">&quot;NetConnection&quot;</span>,
                        <span class="s">&quot;NetEventPacketCapture&quot;</span>,
                        <span class="s">&quot;Netlbfo&quot;</span>,
                        <span class="s">&quot;Netldpagent&quot;</span>,
                        <span class="s">&quot;NetNat&quot;</span>,
                        <span class="s">&quot;Netqos&quot;</span>,
                        <span class="s">&quot;NetSecurity&quot;</span>,
                        <span class="s">&quot;NetSwitchtTeam&quot;</span>,
                        <span class="s">&quot;Nettcpip&quot;</span>,
                        <span class="s">&quot;Netwnv&quot;</span>,
                        <span class="s">&quot;NetworkConnectivity&quot;</span>,
                        <span class="s">&quot;NetworkConnectivityStatus&quot;</span>,
                        <span class="s">&quot;NetworkController&quot;</span>,
                        <span class="s">&quot;NetworkControllerDiagnostics&quot;</span>,
                        <span class="s">&quot;NetworkloadBalancingClusters&quot;</span>,
                        <span class="s">&quot;NetworkSwitchManager&quot;</span>,
                        <span class="s">&quot;NetworkTransition&quot;</span>,
                        <span class="s">&quot;NFS&quot;</span>,
                        <span class="s">&quot;NPS&quot;</span>,
                        <span class="s">&quot;OfficeWebapps&quot;</span>,
                        <span class="s">&quot;OperationsManager&quot;</span>,
                        <span class="s">&quot;PackageManagement&quot;</span>,
                        <span class="s">&quot;PartnerCenter&quot;</span>,
                        <span class="s">&quot;pcsvdevice&quot;</span>,
                        <span class="s">&quot;pef&quot;</span>,
                        <span class="s">&quot;Pester&quot;</span>,
                        <span class="s">&quot;pkiclient&quot;</span>,
                        <span class="s">&quot;platformidentifier&quot;</span>,
                        <span class="s">&quot;pnpdevice&quot;</span>,
                        <span class="s">&quot;PowerShellEditorServices&quot;</span>,
                        <span class="s">&quot;PowerShellGet&quot;</span>,
                        <span class="s">&quot;powershellwebaccess&quot;</span>,
                        <span class="s">&quot;printmanagement&quot;</span>,
                        <span class="s">&quot;ProcessMitigations&quot;</span>,
                        <span class="s">&quot;provisioning&quot;</span>,
                        <span class="s">&quot;PSDesiredStateConfiguration&quot;</span>,
                        <span class="s">&quot;PSDiagnostics&quot;</span>,
                        <span class="s">&quot;PSReadLine&quot;</span>,
                        <span class="s">&quot;PSScheduledJob&quot;</span>,
                        <span class="s">&quot;PSScriptAnalyzer&quot;</span>,
                        <span class="s">&quot;PSWorkflow&quot;</span>,
                        <span class="s">&quot;PSWorkflowUtility&quot;</span>,
                        <span class="s">&quot;RemoteAccess&quot;</span>,
                        <span class="s">&quot;RemoteDesktop&quot;</span>,
                        <span class="s">&quot;RemoteDesktopServices&quot;</span>,
                        <span class="s">&quot;ScheduledTasks&quot;</span>,
                        <span class="s">&quot;Secureboot&quot;</span>,
                        <span class="s">&quot;ServerCore&quot;</span>,
                        <span class="s">&quot;ServerManager&quot;</span>,
                        <span class="s">&quot;ServerManagerTasks&quot;</span>,
                        <span class="s">&quot;ServerMigrationcmdlets&quot;</span>,
                        <span class="s">&quot;ServiceFabric&quot;</span>,
                        <span class="s">&quot;Microsoft.Online.SharePoint.PowerShell&quot;</span>,
                        <span class="s">&quot;shieldedvmdatafile&quot;</span>,
                        <span class="s">&quot;shieldedvmprovisioning&quot;</span>,
                        <span class="s">&quot;shieldedvmtemplate&quot;</span>,
                        <span class="s">&quot;SkypeOnlineConnector&quot;</span>,
                        <span class="s">&quot;SkypeForBusinessHybridHealth&quot;</span>,
                        <span class="s">&quot;smbshare&quot;</span>,
                        <span class="s">&quot;smbwitness&quot;</span>,
                        <span class="s">&quot;smisconfig&quot;</span>,
                        <span class="s">&quot;softwareinventorylogging&quot;</span>,
                        <span class="s">&quot;SPFAdmin&quot;</span>,
                        <span class="s">&quot;Microsoft.SharePoint.MigrationTool.PowerShell&quot;</span>,
                        <span class="s">&quot;sqlps&quot;</span>,
                        <span class="s">&quot;SqlServer&quot;</span>,
                        <span class="s">&quot;StartLayout&quot;</span>,
                        <span class="s">&quot;StartScreen&quot;</span>,
                        <span class="s">&quot;Storage&quot;</span>,
                        <span class="s">&quot;StorageDsc&quot;</span>,
                        <span class="s">&quot;storageqos&quot;</span>,
                        <span class="s">&quot;Storagereplica&quot;</span>,
                        <span class="s">&quot;Storagespaces&quot;</span>,
                        <span class="s">&quot;Syncshare&quot;</span>,
                        <span class="s">&quot;System.Center.Service.Manager&quot;</span>,
                        <span class="s">&quot;TLS&quot;</span>,
                        <span class="s">&quot;TroubleshootingPack&quot;</span>,
                        <span class="s">&quot;TrustedPlatformModule&quot;</span>,
                        <span class="s">&quot;UEV&quot;</span>,
                        <span class="s">&quot;UpdateServices&quot;</span>,
                        <span class="s">&quot;UserAccessLogging&quot;</span>,
                        <span class="s">&quot;vamt&quot;</span>,
                        <span class="s">&quot;VirtualMachineManager&quot;</span>,
                        <span class="s">&quot;vpnclient&quot;</span>,
                        <span class="s">&quot;WasPSExt&quot;</span>,
                        <span class="s">&quot;WDAC&quot;</span>,
                        <span class="s">&quot;WDS&quot;</span>,
                        <span class="s">&quot;WebAdministration&quot;</span>,
                        <span class="s">&quot;WebAdministrationDsc&quot;</span>,
                        <span class="s">&quot;WebApplicationProxy&quot;</span>,
                        <span class="s">&quot;WebSites&quot;</span>,
                        <span class="s">&quot;Whea&quot;</span>,
                        <span class="s">&quot;WhiteboardAdmin&quot;</span>,
                        <span class="s">&quot;WindowsDefender&quot;</span>,
                        <span class="s">&quot;WindowsDefenderDsc&quot;</span>,
                        <span class="s">&quot;WindowsDeveloperLicense&quot;</span>,
                        <span class="s">&quot;WindowsDiagnosticData&quot;</span>,
                        <span class="s">&quot;WindowsErrorReporting&quot;</span>,
                        <span class="s">&quot;WindowServerRackup&quot;</span>,
                        <span class="s">&quot;WindowsSearch&quot;</span>,
                        <span class="s">&quot;WindowsServerBackup&quot;</span>,
                        <span class="s">&quot;WindowsUpdate&quot;</span>,
                        <span class="s">&quot;wsscmdlets&quot;</span>,
                        <span class="s">&quot;wsssetup&quot;</span>,
                        <span class="s">&quot;wsus&quot;</span>,
                        <span class="s">&quot;xActiveDirectory&quot;</span>,
                        <span class="s">&quot;xBitLocker&quot;</span>,
                        <span class="s">&quot;xDefender&quot;</span>,
                        <span class="s">&quot;xDhcpServer&quot;</span>,
                        <span class="s">&quot;xDismFeature&quot;</span>,
                        <span class="s">&quot;xDnsServer&quot;</span>,
                        <span class="s">&quot;xHyper-V&quot;</span>,
                        <span class="s">&quot;xHyper-VBackup&quot;</span>,
                        <span class="s">&quot;xPSDesiredStateConfiguration&quot;</span>,
                        <span class="s">&quot;xSmbShare&quot;</span>,
                        <span class="s">&quot;xSqlPs&quot;</span>,
                        <span class="s">&quot;xStorage&quot;</span>,
                        <span class="s">&quot;xWebAdministration&quot;</span>,
                        <span class="s">&quot;xWindowsUpdate&quot;</span>,
                    };
 
                <a href="#acfc2b5c6f2d0013" class="i property">s_uniqueUserIdentifier</a> = <a href="#4188c30d0db474b4" class="i method">GetUniqueIdentifier</a>().<span class="i">ToString</span>();
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Determine whether the environment variable is set and how.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">name</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name of the environment variable.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">defaultValue</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">If the environment variable is not set, use this as the default value.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A boolean representing the value of the environment variable.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static bool</b> <a id="53009e27d3e18f4b" href="../R/53009e27d3e18f4b.html" target="n" data-glyph="76,1" class="i method">GetEnvironmentVariableAsBool</a>(<b>string</b> <span id="r0 rd" class="r0 r">name</span>, <b>bool</b> <span id="r1 rd" class="r1 r">defaultValue</span>)
        {
            <b>var</b> <span id="r3 rd" class="r3 r">str</span> = <span class="i">Environment</span>.<span class="i">GetEnvironmentVariable</span>(<span class="r0 r">name</span>);
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r3 r">str</span>))
            {
                <b>return</b> <span class="r1 r">defaultValue</span>;
            }
 
            <b>var</b> <span id="r4 rd" class="r4 r">boolStr</span> = <span class="r3 r">str</span>.<span class="i">AsSpan</span>();
 
            <b>if</b> (<span class="r4 r">boolStr</span>.<span class="i">Length</span> == 1)
            {
                <b>if</b> (<span class="r4 r">boolStr</span>[0] == <span class="s">&#39;1&#39;</span>)
                {
                    <b>return</b> <b>true</b>;
                }
 
                <b>if</b> (<span class="r4 r">boolStr</span>[0] == <span class="s">&#39;0&#39;</span>)
                {
                    <b>return</b> <b>false</b>;
                }
            }
 
            <b>if</b> (<span class="r4 r">boolStr</span>.<span class="i">Length</span> == 3 &amp;&amp;
                (<span class="r4 r">boolStr</span>[0] == <span class="s">&#39;y&#39;</span> || <span class="r4 r">boolStr</span>[0] == <span class="s">&#39;Y&#39;</span>) &amp;&amp;
                (<span class="r4 r">boolStr</span>[1] == <span class="s">&#39;e&#39;</span> || <span class="r4 r">boolStr</span>[1] == <span class="s">&#39;E&#39;</span>) &amp;&amp;
                (<span class="r4 r">boolStr</span>[2] == <span class="s">&#39;s&#39;</span> || <span class="r4 r">boolStr</span>[2] == <span class="s">&#39;S&#39;</span>))
            {
                <b>return</b> <b>true</b>;
            }
 
            <b>if</b> (<span class="r4 r">boolStr</span>.<span class="i">Length</span> == 2 &amp;&amp;
                (<span class="r4 r">boolStr</span>[0] == <span class="s">&#39;n&#39;</span> || <span class="r4 r">boolStr</span>[0] == <span class="s">&#39;N&#39;</span>) &amp;&amp;
                (<span class="r4 r">boolStr</span>[1] == <span class="s">&#39;o&#39;</span> || <span class="r4 r">boolStr</span>[1] == <span class="s">&#39;O&#39;</span>))
            {
                <b>return</b> <b>false</b>;
            }
 
            <b>if</b> (<span class="r4 r">boolStr</span>.<span class="i">Length</span> == 4 &amp;&amp;
                (<span class="r4 r">boolStr</span>[0] == <span class="s">&#39;t&#39;</span> || <span class="r4 r">boolStr</span>[0] == <span class="s">&#39;T&#39;</span>) &amp;&amp;
                (<span class="r4 r">boolStr</span>[1] == <span class="s">&#39;r&#39;</span> || <span class="r4 r">boolStr</span>[1] == <span class="s">&#39;R&#39;</span>) &amp;&amp;
                (<span class="r4 r">boolStr</span>[2] == <span class="s">&#39;u&#39;</span> || <span class="r4 r">boolStr</span>[2] == <span class="s">&#39;U&#39;</span>) &amp;&amp;
                (<span class="r4 r">boolStr</span>[3] == <span class="s">&#39;e&#39;</span> || <span class="r4 r">boolStr</span>[3] == <span class="s">&#39;E&#39;</span>))
            {
                <b>return</b> <b>true</b>;
            }
 
            <b>if</b> (<span class="r4 r">boolStr</span>.<span class="i">Length</span> == 5 &amp;&amp;
                (<span class="r4 r">boolStr</span>[0] == <span class="s">&#39;f&#39;</span> || <span class="r4 r">boolStr</span>[0] == <span class="s">&#39;F&#39;</span>) &amp;&amp;
                (<span class="r4 r">boolStr</span>[1] == <span class="s">&#39;a&#39;</span> || <span class="r4 r">boolStr</span>[1] == <span class="s">&#39;A&#39;</span>) &amp;&amp;
                (<span class="r4 r">boolStr</span>[2] == <span class="s">&#39;l&#39;</span> || <span class="r4 r">boolStr</span>[2] == <span class="s">&#39;L&#39;</span>) &amp;&amp;
                (<span class="r4 r">boolStr</span>[3] == <span class="s">&#39;s&#39;</span> || <span class="r4 r">boolStr</span>[3] == <span class="s">&#39;S&#39;</span>) &amp;&amp;
                (<span class="r4 r">boolStr</span>[4] == <span class="s">&#39;e&#39;</span> || <span class="r4 r">boolStr</span>[4] == <span class="s">&#39;E&#39;</span>))
            {
                <b>return</b> <b>false</b>;
            }
 
            <b>return</b> <span class="r1 r">defaultValue</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Send telemetry as a metric.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r5 r">metricId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The type of telemetry that we&#39;ll be sending.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r6 r">data</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The specific details about the telemetry.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal static void</b> <a id="a7904dd2d0082ac3" href="../R/a7904dd2d0082ac3.html" target="n" data-glyph="74,1" class="i method">SendTelemetryMetric</a>(<a href="#3951f46d9ee8c91d" class="t t">TelemetryType</a> <span id="r5 rd" class="r5 r">metricId</span>, <b>string</b> <span id="r6 rd" class="r6 r">data</span>)
        {
            <b>if</b> (!<a href="#1975902903f5429d" class="i property">CanSendTelemetry</a>)
            {
                <b>return</b>;
            }
 
            <a href="#7f1f1594a2f21bfc" class="i method">SendPSCoreStartupTelemetry</a>(<span class="s">&quot;hosted&quot;</span>);
 
            <b>string</b> <span id="r7 rd" class="r7 r">metricName</span> = <span class="r5 r">metricId</span>.<span class="i">ToString</span>();
            <b>try</b>
            {
                <b>switch</b> (<span class="r5 r">metricId</span>)
                {
                    <b>case</b> <a href="#3951f46d9ee8c91d" class="t t">TelemetryType</a>.<a href="#a4e962dedc97caa5" class="i field">ApplicationType</a>:
                    <b>case</b> <a href="#3951f46d9ee8c91d" class="t t">TelemetryType</a>.<a href="#463b1bedf5979814" class="i field">PowerShellCreate</a>:
                    <b>case</b> <a href="#3951f46d9ee8c91d" class="t t">TelemetryType</a>.<a href="#1cf75b47c1af2ffa" class="i field">RemoteSessionOpen</a>:
                    <b>case</b> <a href="#3951f46d9ee8c91d" class="t t">TelemetryType</a>.<a href="#56438e56a9b215e8" class="i field">ExperimentalEngineFeatureActivation</a>:
                        <a href="#4fc680ecb049bdc0" class="i property">s_telemetryClient</a>.<span class="i">GetMetric</span>(<span class="r7 r">metricName</span>, <span class="s">&quot;uuid&quot;</span>, <span class="s">&quot;SessionId&quot;</span>, <span class="s">&quot;Detail&quot;</span>).<span class="i">TrackValue</span>(<span class="i">metricValue</span>: 1.0, <a href="#acfc2b5c6f2d0013" class="i property">s_uniqueUserIdentifier</a>, <a href="#84f784ec4c40a82e" class="i property">s_sessionId</a>, <span class="r6 r">data</span>);
                        <b>break</b>;
                    <b>case</b> <a href="#3951f46d9ee8c91d" class="t t">TelemetryType</a>.<a href="#4a0d991add36402b" class="i field">ExperimentalModuleFeatureActivation</a>:
                        <b>string</b> <span id="r8 rd" class="r8 r">experimentalFeatureName</span> = <a href="#de16900cc73402a4" class="i method">GetExperimentalFeatureName</a>(<span class="r6 r">data</span>);
                        <a href="#4fc680ecb049bdc0" class="i property">s_telemetryClient</a>.<span class="i">GetMetric</span>(<span class="r7 r">metricName</span>, <span class="s">&quot;uuid&quot;</span>, <span class="s">&quot;SessionId&quot;</span>, <span class="s">&quot;Detail&quot;</span>).<span class="i">TrackValue</span>(<span class="i">metricValue</span>: 1.0, <a href="#acfc2b5c6f2d0013" class="i property">s_uniqueUserIdentifier</a>, <a href="#84f784ec4c40a82e" class="i property">s_sessionId</a>, <span class="r8 r">experimentalFeatureName</span>);
                        <b>break</b>;
                    <b>case</b> <a href="#3951f46d9ee8c91d" class="t t">TelemetryType</a>.<a href="#f3f3b72577bf44b5" class="i field">ModuleLoad</a>:
                    <b>case</b> <a href="#3951f46d9ee8c91d" class="t t">TelemetryType</a>.<a href="#80e278d1d50e7321" class="i field">WinCompatModuleLoad</a>:
                        <b>string</b> <span id="r9 rd" class="r9 r">moduleName</span> = <a href="#19b2dec3982253e7" class="i method">GetModuleName</a>(<span class="r6 r">data</span>); <span class="c">// This will return anonymous if the modulename is not on the report list</span>
                        <a href="#4fc680ecb049bdc0" class="i property">s_telemetryClient</a>.<span class="i">GetMetric</span>(<span class="r7 r">metricName</span>, <span class="s">&quot;uuid&quot;</span>, <span class="s">&quot;SessionId&quot;</span>, <span class="s">&quot;Detail&quot;</span>).<span class="i">TrackValue</span>(<span class="i">metricValue</span>: 1.0, <a href="#acfc2b5c6f2d0013" class="i property">s_uniqueUserIdentifier</a>, <a href="#84f784ec4c40a82e" class="i property">s_sessionId</a>, <span class="r9 r">moduleName</span>);
                        <b>break</b>;
                }
            }
            <b>catch</b>
            {
                <span class="c">// do nothing, telemetry can&#39;t be sent</span>
                <span class="c">// don&#39;t send the panic telemetry as if we have failed above, it will likely fail here.</span>
            }
        }
 
        <span class="c">// Get the experimental feature name. If we can report it, we&#39;ll return the name of the feature, otherwise, we&#39;ll return &quot;anonymous&quot;</span>
        <b>private static string</b> <a id="de16900cc73402a4" href="../R/de16900cc73402a4.html" target="n" data-glyph="76,1" class="i method">GetExperimentalFeatureName</a>(<b>string</b> <span id="r10 rd" class="r10 r">featureNameToValidate</span>)
        {
            <span class="c">// An experimental feature in a module is guaranteed to start with the module name</span>
            <span class="c">// we can strip out the text past the last &#39;.&#39; as the text before that will be the ModuleName</span>
            <b>int</b> <span id="r11 rd" class="r11 r">lastDotIndex</span> = <span class="r10 r">featureNameToValidate</span>.<span class="i">LastIndexOf</span>(<span class="s">&#39;.&#39;</span>);
            <b>string</b> <span id="r12 rd" class="r12 r">moduleName</span> = <span class="r10 r">featureNameToValidate</span>.<span class="i">Substring</span>(0, <span class="r11 r">lastDotIndex</span>);
            <b>if</b> (<a href="#90cb4ece75da9244" class="i field">s_knownModules</a>.<span class="i">Contains</span>(<span class="r12 r">moduleName</span>))
            {
                <b>return</b> <span class="r10 r">featureNameToValidate</span>;
            }
 
            <b>return</b> <a href="#c410edb71a276b86" class="i field">_anonymous</a>;
        }
 
        <span class="c">// Get the module name. If we can report it, we&#39;ll return the name, otherwise, we&#39;ll return &quot;anonymous&quot;</span>
        <b>private static string</b> <a id="19b2dec3982253e7" href="../R/19b2dec3982253e7.html" target="n" data-glyph="76,1" class="i method">GetModuleName</a>(<b>string</b> <span id="r13 rd" class="r13 r">moduleNameToValidate</span>)
        {
            <b>if</b> (<a href="#90cb4ece75da9244" class="i field">s_knownModules</a>.<span class="i">Contains</span>(<span class="r13 r">moduleNameToValidate</span>))
            {
                <b>return</b> <span class="r13 r">moduleNameToValidate</span>;
            }
 
            <b>return</b> <a href="#c410edb71a276b86" class="i field">_anonymous</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Create the startup payload and send it up.</span>
        <span class="c">///</span><span class="c"> This is done only once during for the console host.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r14 r">mode</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The &quot;mode&quot; of the startup.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal static void</b> <a id="7f1f1594a2f21bfc" href="../R/7f1f1594a2f21bfc.html" target="n" data-glyph="74,1" class="i method">SendPSCoreStartupTelemetry</a>(<b>string</b> <span id="r14 rd" class="r14 r">mode</span>)
        {
            <span class="c">// Check if we already sent startup telemetry</span>
            <b>if</b> (<span class="i">Interlocked</span>.<span class="i">CompareExchange</span>(<b>ref</b> <a href="#33c078cb3faca0df" class="i field">s_startupEventSent</a>, 1, 0) == 1)
            {
                <b>return</b>;
            }
 
            <b>if</b> (!<a href="#1975902903f5429d" class="i property">CanSendTelemetry</a>)
            {
                <b>return</b>;
            }
 
            <b>var</b> <span id="r15 rd" class="r15 r">properties</span> = <b>new</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <b>string</b>&gt;();
 
            <span class="c">// The variable POWERSHELL_DISTRIBUTION_CHANNEL is set in our docker images.</span>
            <span class="c">// This allows us to track the actual docker OS as OSDescription provides only &quot;linuxkit&quot;</span>
            <span class="c">// which has limited usefulness</span>
            <b>var</b> <span id="r16 rd" class="r16 r">channel</span> = <span class="i">Environment</span>.<span class="i">GetEnvironmentVariable</span>(<span class="s">&quot;POWERSHELL_DISTRIBUTION_CHANNEL&quot;</span>);
 
            <span class="r15 r">properties</span>.<span class="i">Add</span>(<span class="s">&quot;SessionId&quot;</span>, <a href="#84f784ec4c40a82e" class="i property">s_sessionId</a>);
            <span class="r15 r">properties</span>.<span class="i">Add</span>(<span class="s">&quot;UUID&quot;</span>, <a href="#acfc2b5c6f2d0013" class="i property">s_uniqueUserIdentifier</a>);
            <span class="r15 r">properties</span>.<span class="i">Add</span>(<span class="s">&quot;GitCommitID&quot;</span>, <a href="../engine/PSVersionInfo.cs.html#be287f9ea52b8d2f" class="t t">PSVersionInfo</a>.<a href="../engine/PSVersionInfo.cs.html#624934150adfee0d" class="i property">GitCommitId</a>);
            <span class="r15 r">properties</span>.<span class="i">Add</span>(<span class="s">&quot;OSDescription&quot;</span>, <span class="i">RuntimeInformation</span>.<span class="i">OSDescription</span>);
            <span class="r15 r">properties</span>.<span class="i">Add</span>(<span class="s">&quot;OSChannel&quot;</span>, <b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r16 r">channel</span>) ? <span class="s">&quot;unknown&quot;</span> : <span class="r16 r">channel</span>);
            <span class="r15 r">properties</span>.<span class="i">Add</span>(<span class="s">&quot;StartMode&quot;</span>, <b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r14 r">mode</span>) ? <span class="s">&quot;unknown&quot;</span> : <span class="r14 r">mode</span>);
            <b>try</b>
            {
                <a href="#4fc680ecb049bdc0" class="i property">s_telemetryClient</a>.<span class="i">TrackEvent</span>(<span class="s">&quot;ConsoleHostStartup&quot;</span>, <span class="r15 r">properties</span>, <b>null</b>);
            }
            <b>catch</b>
            {
                <span class="c">// do nothing, telemetry cannot be sent</span>
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Try to read the file and collect the guid.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r17 r">telemetryFilePath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The path to the telemetry file.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r18 r">id</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The newly created id.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The method returns a bool indicating success or failure of creating the id.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static bool</b> <a id="88953d4d47a1012b" href="../R/88953d4d47a1012b.html" target="n" data-glyph="76,1" class="i method">TryGetIdentifier</a>(<b>string</b> <span id="r17 rd" class="r17 r">telemetryFilePath</span>, <b>out</b> <span class="i">Guid</span> <span id="r18 rd" class="r18 r">id</span>)
        {
            <b>if</b> (<span class="i">File</span>.<span class="i">Exists</span>(<span class="r17 r">telemetryFilePath</span>))
            {
                <span class="c">// attempt to read the persisted identifier</span>
                <b>const int</b> <span id="r19 rd" class="r19 r">GuidSize</span> = 16;
                <b>byte</b>[] <span id="r20 rd" class="r20 r">buffer</span> = <b>new</b> <b>byte</b>[<span class="r19 r">GuidSize</span>];
                <b>try</b>
                {
                    <b>using</b> (<span class="i">FileStream</span> <span id="r21 rd" class="r21 r">fs</span> = <b>new</b> <span class="i">FileStream</span>(<span class="r17 r">telemetryFilePath</span>, <span class="i">FileMode</span>.<span class="i">Open</span>, <span class="i">FileAccess</span>.<span class="i">Read</span>))
                    {
                        <span class="c">// if the read is invalid, or wrong size, we return it</span>
                        <b>int</b> <span id="r22 rd" class="r22 r">n</span> = <span class="r21 r">fs</span>.<span class="i">Read</span>(<span class="r20 r">buffer</span>, 0, <span class="r19 r">GuidSize</span>);
                        <b>if</b> (<span class="r22 r">n</span> == <span class="r19 r">GuidSize</span>)
                        {
                            <span class="c">// it&#39;s possible this could through</span>
                            <span class="r18 r">id</span> = <b>new</b> <span class="i">Guid</span>(<span class="r20 r">buffer</span>);
                            <b>if</b> (<span class="r18 r">id</span> != <span class="i">Guid</span>.<span class="i">Empty</span>)
                            {
                                <b>return</b> <b>true</b>;
                            }
                        }
                    }
                }
                <b>catch</b>
                {
                    <span class="c">// something went wrong, the file may not exist or not have enough bytes, so return false</span>
                }
            }
 
            <span class="r18 r">id</span> = <span class="i">Guid</span>.<span class="i">Empty</span>;
            <b>return</b> <b>false</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Try to create a unique identifier and persist it to the telemetry.uuid file.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r23 r">telemetryFilePath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The path to the persisted telemetry.uuid file.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r24 r">id</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The created identifier.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The method returns a bool indicating success or failure of creating the id.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static bool</b> <a id="9a17a3be795ae716" href="../R/9a17a3be795ae716.html" target="n" data-glyph="76,1" class="i method">TryCreateUniqueIdentifierAndFile</a>(<b>string</b> <span id="r23 rd" class="r23 r">telemetryFilePath</span>, <b>out</b> <span class="i">Guid</span> <span id="r24 rd" class="r24 r">id</span>)
        {
            <span class="c">// one last attempt to retrieve before creating incase we have a lot of simultaneous entry into the mutex.</span>
            <span class="r24 r">id</span> = <span class="i">Guid</span>.<span class="i">Empty</span>;
            <b>if</b> (<a href="#88953d4d47a1012b" class="i method">TryGetIdentifier</a>(<span class="r23 r">telemetryFilePath</span>, <b>out</b> <span class="r24 r">id</span>))
            {
                <b>return</b> <b>true</b>;
            }
 
            <span class="c">// The directory may not exist, so attempt to create it</span>
            <span class="c">// CreateDirectory will simply return the directory if exists</span>
            <b>try</b>
            {
                <span class="i">Directory</span>.<span class="i">CreateDirectory</span>(<span class="i">Path</span>.<span class="i">GetDirectoryName</span>(<span class="r23 r">telemetryFilePath</span>));
            }
            <b>catch</b>
            {
                <span class="c">// send a telemetry indicating a problem with the cache dir</span>
                <span class="c">// it&#39;s likely something is seriously wrong so we should at least report it.</span>
                <span class="c">// We don&#39;t want to provide reasons here, that&#39;s not the point, but we</span>
                <span class="c">// would like to know if we&#39;re having a generalized problem which we can trace statistically</span>
                <a href="#1975902903f5429d" class="i property">CanSendTelemetry</a> = <b>false</b>;
                <a href="#4fc680ecb049bdc0" class="i property">s_telemetryClient</a>.<span class="i">GetMetric</span>(<a href="#72bda94374b47155" class="i field">_telemetryFailure</a>, <span class="s">&quot;Detail&quot;</span>).<span class="i">TrackValue</span>(1, <span class="s">&quot;cachedir&quot;</span>);
                <b>return</b> <b>false</b>;
            }
 
            <span class="c">// Create and save the new identifier, and if there&#39;s a problem, disable telemetry</span>
            <b>try</b>
            {
                <span class="r24 r">id</span> = <span class="i">Guid</span>.<span class="i">NewGuid</span>();
                <span class="i">File</span>.<span class="i">WriteAllBytes</span>(<span class="r23 r">telemetryFilePath</span>, <span class="r24 r">id</span>.<span class="i">ToByteArray</span>());
                <b>return</b> <b>true</b>;
            }
            <b>catch</b>
            {
                <span class="c">// another bit of telemetry to notify us about a problem with saving the unique id.</span>
                <a href="#4fc680ecb049bdc0" class="i property">s_telemetryClient</a>.<span class="i">GetMetric</span>(<a href="#72bda94374b47155" class="i field">_telemetryFailure</a>, <span class="s">&quot;Detail&quot;</span>).<span class="i">TrackValue</span>(1, <span class="s">&quot;saveuuid&quot;</span>);
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Retrieve the unique identifier from the persisted file, if it doesn&#39;t exist create it.</span>
        <span class="c">///</span><span class="c"> Generate a guid which will be used as the UUID.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A guid which represents the unique identifier.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static</b> <span class="i">Guid</span> <a id="4188c30d0db474b4" href="../R/4188c30d0db474b4.html" target="n" data-glyph="76,1" class="i method">GetUniqueIdentifier</a>()
        {
            <span class="c">// Try to get the unique id. If this returns false, we&#39;ll</span>
            <span class="c">// create/recreate the telemetry.uuid file to persist for next startup.</span>
            <span class="i">Guid</span> <span id="r25 rd" class="r25 r">id</span> = <span class="i">Guid</span>.<span class="i">Empty</span>;
            <b>string</b> <span id="r26 rd" class="r26 r">uuidPath</span> = <span class="i">Path</span>.<span class="i">Join</span>(<a href="../CoreCLR/CorePsPlatform.cs.html#693813241122eb45" class="t t">Platform</a>.<a href="../CoreCLR/CorePsPlatform.cs.html#4dfab0cd608f3fa0" class="i field">CacheDirectory</a>, <span class="s">&quot;telemetry.uuid&quot;</span>);
            <b>if</b> (<a href="#88953d4d47a1012b" class="i method">TryGetIdentifier</a>(<span class="r26 r">uuidPath</span>, <b>out</b> <span class="r25 r">id</span>))
            {
                <b>return</b> <span class="r25 r">id</span>;
            }
 
            <span class="c">// Multiple processes may start simultaneously so we need a system wide</span>
            <span class="c">// way to control access to the file in the case (although remote) when we have</span>
            <span class="c">// simultaneous shell starts without the persisted file which attempt to create the file.</span>
            <b>try</b>
            {
                <span class="c">// TryCreateUniqueIdentifierAndFile shouldn&#39;t throw, but the mutex might</span>
                <b>using</b> <b>var</b> <span id="r27 rd" class="r27 r">m</span> = <b>new</b> <span class="i">Mutex</span>(<b>true</b>, <span class="s">&quot;CreateUniqueUserId&quot;</span>);
                <span class="r27 r">m</span>.<span class="i">WaitOne</span>();
                <b>try</b>
                {
                    <b>if</b> (<a href="#9a17a3be795ae716" class="i method">TryCreateUniqueIdentifierAndFile</a>(<span class="r26 r">uuidPath</span>, <b>out</b> <span class="r25 r">id</span>))
                    {
                        <b>return</b> <span class="r25 r">id</span>;
                    }
                }
                <b>finally</b>
                {
                    <span class="r27 r">m</span>.<span class="i">ReleaseMutex</span>();
                }
            }
            <b>catch</b> (<span class="i">Exception</span>)
            {
                <span class="c">// Any problem in generating a uuid will result in no telemetry being sent.</span>
                <span class="c">// Try to send the failure in telemetry, but it will have no unique id.</span>
                <a href="#4fc680ecb049bdc0" class="i property">s_telemetryClient</a>.<span class="i">GetMetric</span>(<a href="#72bda94374b47155" class="i field">_telemetryFailure</a>, <span class="s">&quot;Detail&quot;</span>).<span class="i">TrackValue</span>(1, <span class="s">&quot;mutex&quot;</span>);
            }
 
            <span class="c">// something bad happened, turn off telemetry since the unique id wasn&#39;t set.</span>
            <a href="#1975902903f5429d" class="i property">CanSendTelemetry</a> = <b>false</b>;
            <b>return</b> <span class="r25 r">id</span>;
        }
    }
}
</pre></td></tr></table></div></body></html>
