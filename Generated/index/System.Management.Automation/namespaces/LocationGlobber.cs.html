<!DOCTYPE html>
<html><head><title>LocationGlobber.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(4730);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#System.Management.Automation/namespaces/LocationGlobber.cs" target="_top">namespaces\LocationGlobber.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#System.Management.Automation" target="_top">src\System.Management.Automation\System.Management.Automation.csproj</a> (System.Management.Automation)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">ObjectModel</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Provider</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Text</span>;
 
<b>using</b> <span class="i">Dbg</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>;
 
<b>namespace</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Implements the interfaces used by navigation commands to work with</span>
    <span class="c">///</span><span class="c"> the virtual drive system.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal sealed class</b> <a id="6387d90abe0ca584" href="../R/6387d90abe0ca584.html" target="n" data-glyph="2,0" class="t t">LocationGlobber</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Trace object
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An instance of the PSTraceSource class used for trace output</span>
        <span class="c">///</span><span class="c"> using &quot;LocationGlobber&quot; as the category.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i n">Dbg</span>.<span class="i">TraceSourceAttribute</span>(
             <span class="s">&quot;LocationGlobber&quot;</span>,
             <span class="s">&quot;The location globber converts PowerShell paths with glob characters to zero or more paths.&quot;</span>)]
        <b>private static readonly</b> <span class="i n">Dbg</span>.<a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a> <a id="52218724c4b84b4d" href="../R/52218724c4b84b4d.html" target="n" data-glyph="46,1" class="i field">s_tracer</a> =
            <span class="i n">Dbg</span>.<a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#697b06ec70e3c537" class="i method">GetTracer</a>(<span class="s">&quot;LocationGlobber&quot;</span>,
             <span class="s">&quot;The location globber converts PowerShell paths with glob characters to zero or more paths.&quot;</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> User level tracing for path resolution.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i n">Dbg</span>.<span class="i">TraceSourceAttribute</span>(
             <span class="s">&quot;PathResolution&quot;</span>,
             <span class="s">&quot;Traces the path resolution algorithm.&quot;</span>)]
        <b>private static readonly</b> <span class="i n">Dbg</span>.<a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a> <a id="9dce9630a6e8ca4b" href="../R/9dce9630a6e8ca4b.html" target="n" data-glyph="46,1" class="i field">s_pathResolutionTracer</a> =
            <span class="i n">Dbg</span>.<a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#24b0f68d5add3eb3" class="i method">GetTracer</a>(
                <span class="s">&quot;PathResolution&quot;</span>,
                <span class="s">&quot;Traces the path resolution algorithm.&quot;</span>,
                <b>false</b>);
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Trace object
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Constructor
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Constructs an instance of the LocationGlobber from the current SessionState.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">sessionState</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The instance of session state on which this location globber acts.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">sessionState</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal</b> <a id="4e39cf9c7f318f61" href="../R/4e39cf9c7f318f61.html" target="n" data-glyph="74,1" class="t constructor">LocationGlobber</a>(<a href="../engine/SessionStatePublic.cs.html#0a202aa6b2d52930" class="t t">SessionState</a> <span id="r0 rd" class="r0 r">sessionState</span>)
        {
            <b>if</b> (<span class="r0 r">sessionState</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r0 r">sessionState</span>));
            }
 
            <a href="#06ecc54ac29ea6b5" class="i field">_sessionState</a> = <span class="r0 r">sessionState</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Constructor
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Public methods
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> PowerShell paths from PowerShell path globbing
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Converts a PowerShell path containing glob characters to PowerShell paths that match</span>
        <span class="c">///</span><span class="c"> the glob string.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A PowerShell path containing glob characters.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r2 r">allowNonexistingPaths</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If true, a ItemNotFoundException will not be thrown for non-existing</span>
        <span class="c">///</span><span class="c"> paths. Instead an appropriate path will be returned as if it did exist.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r3 r">providerInstance</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The provider instance used to resolve the path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The PowerShell paths that match the glob string.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#a58038dc730da896" class="t t">ProviderNotFoundException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is a provider-qualified path</span>
        <span class="c">///</span><span class="c"> and the specified provider does not exist.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#35e07c15a7526bcd" class="t t">ProviderInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider throws an exception when its MakePath gets</span>
        <span class="c">///</span><span class="c"> called.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">NotSupportedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider does not support multiple items.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the home location for the provider is not set and</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> starts with a &quot;~&quot;.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#9ed59df3c4c15193" class="t t">ItemNotFoundException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> does not contain glob characters and</span>
        <span class="c">///</span><span class="c"> could not be found.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">Collection</span>&lt;<a href="PathInfo.cs.html#9504cfb54420cfd7" class="t t">PathInfo</a>&gt; <a id="7b9b4909d299cb1a" href="../R/7b9b4909d299cb1a.html" target="n" data-glyph="74,1" class="i method">GetGlobbedMonadPathsFromMonadPath</a>(
            <b>string</b> <span id="r1 rd" class="r1 r">path</span>,
            <b>bool</b> <span id="r2 rd" class="r2 r">allowNonexistingPaths</span>,
            <b>out</b> <a href="../P/71826561229efd99.html#71826561229efd99" class="t t">CmdletProvider</a> <span id="r3 rd" class="r3 r">providerInstance</span>)
        {
            <a href="CoreCommandContext.cs.html#1e83d35d5286e174" class="t t">CmdletProviderContext</a> <span id="r4 rd" class="r4 r">context</span> =
                <b>new</b> <a href="CoreCommandContext.cs.html#8a0e078b40b2fd0e" class="t constructor">CmdletProviderContext</a>(<a href="#06ecc54ac29ea6b5" class="i field">_sessionState</a>.<a href="../engine/SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../engine/SessionState.cs.html#3ddff2db6bc01805" class="i property">ExecutionContext</a>);
 
            <b>return</b> <a href="#4058cafa7013d845" class="i method">GetGlobbedMonadPathsFromMonadPath</a>(<span class="r1 r">path</span>, <span class="r2 r">allowNonexistingPaths</span>, <span class="r4 r">context</span>, <b>out</b> <span class="r3 r">providerInstance</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Converts a PowerShell path containing glob characters to PowerShell paths that match</span>
        <span class="c">///</span><span class="c"> the glob string.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r5 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A PowerShell path containing glob characters.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r6 r">allowNonexistingPaths</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If true, a ItemNotFoundException will not be thrown for non-existing</span>
        <span class="c">///</span><span class="c"> paths. Instead an appropriate path will be returned as if it did exist.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r7 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The context under which the command is running.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r8 r">providerInstance</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The instance of the provider used to resolve the path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The PowerShell paths that match the glob string.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r5 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> or </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r7 r">context</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#a58038dc730da896" class="t t">ProviderNotFoundException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r5 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is a provider-qualified path</span>
        <span class="c">///</span><span class="c"> and the specified provider does not exist.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#35e07c15a7526bcd" class="t t">ProviderInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider throws an exception when its MakePath gets</span>
        <span class="c">///</span><span class="c"> called.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">NotSupportedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider does not support multiple items.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the home location for the provider is not set and</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r5 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> starts with a &quot;~&quot;.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#9ed59df3c4c15193" class="t t">ItemNotFoundException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r5 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> does not contain glob characters and</span>
        <span class="c">///</span><span class="c"> could not be found.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r7 r">context</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> has been signaled for</span>
        <span class="c">///</span><span class="c"> StopProcessing.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">Collection</span>&lt;<a href="PathInfo.cs.html#9504cfb54420cfd7" class="t t">PathInfo</a>&gt; <a id="4058cafa7013d845" href="../R/4058cafa7013d845.html" target="n" data-glyph="74,1" class="i method">GetGlobbedMonadPathsFromMonadPath</a>(
            <b>string</b> <span id="r5 rd" class="r5 r">path</span>,
            <b>bool</b> <span id="r6 rd" class="r6 r">allowNonexistingPaths</span>,
            <a href="CoreCommandContext.cs.html#1e83d35d5286e174" class="t t">CmdletProviderContext</a> <span id="r7 rd" class="r7 r">context</span>,
            <b>out</b> <a href="../P/71826561229efd99.html#71826561229efd99" class="t t">CmdletProvider</a> <span id="r8 rd" class="r8 r">providerInstance</span>)
        {
            <span class="r8 r">providerInstance</span> = <b>null</b>;
            <b>if</b> (<span class="r5 r">path</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r5 r">path</span>));
            }
 
            <b>if</b> (<span class="r7 r">context</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r7 r">context</span>));
            }
 
            <span class="i">Collection</span>&lt;<a href="PathInfo.cs.html#9504cfb54420cfd7" class="t t">PathInfo</a>&gt; <span id="r9 rd" class="r9 r">result</span>;
 
            <b>using</b> (<a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#ff5e86462c8f4f03" class="i method">TraceScope</a>(<span class="s">&quot;Resolving MSH path \&quot;{0}\&quot; to MSH path&quot;</span>, <span class="r5 r">path</span>))
            {
                <a href="#2bf2d71caf7f9287" class="i method">TraceFilters</a>(<span class="r7 r">context</span>);
 
                <span class="c">// First check to see if the path starts with a ~ (home)</span>
 
                <b>if</b> (<a href="#48978d46f1040a39" class="i method">IsHomePath</a>(<span class="r5 r">path</span>))
                {
                    <b>using</b> (<a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#19ce116f88d7b1c7" class="i method">TraceScope</a>(<span class="s">&quot;Resolving HOME relative path.&quot;</span>))
                    {
                        <span class="r5 r">path</span> = <a href="#a5b7e35a38a3d24c" class="i method">GetHomeRelativePath</a>(<span class="r5 r">path</span>);
                    }
                }
 
                <span class="c">// Now determine how to parse the path</span>
 
                <b>bool</b> <span id="r10 rd" class="r10 r">isProviderDirectPath</span> = <a href="#f0c7a79be5b8b12b" class="i method">IsProviderDirectPath</a>(<span class="r5 r">path</span>);
                <b>bool</b> <span id="r11 rd" class="r11 r">isProviderQualifiedPath</span> = <a href="#45d8fc5f64551b7a" class="i method">IsProviderQualifiedPath</a>(<span class="r5 r">path</span>);
                <b>if</b> (<span class="r10 r">isProviderDirectPath</span> || <span class="r11 r">isProviderQualifiedPath</span>)
                {
                    <span class="r9 r">result</span> =
                        <a href="#ea43142143b0c7dc" class="i method">ResolvePSPathFromProviderPath</a>(
                            <span class="r5 r">path</span>,
                            <span class="r7 r">context</span>,
                            <span class="r6 r">allowNonexistingPaths</span>,
                            <span class="r10 r">isProviderDirectPath</span>,
                            <span class="r11 r">isProviderQualifiedPath</span>,
                            <b>out</b> <span class="r8 r">providerInstance</span>);
                }
                <b>else</b>
                {
                    <span class="r9 r">result</span> =
                        <a href="#5bbcea5cd3612980" class="i method">ResolveDriveQualifiedPath</a>(
                            <span class="r5 r">path</span>,
                            <span class="r7 r">context</span>,
                            <span class="r6 r">allowNonexistingPaths</span>,
                            <b>out</b> <span class="r8 r">providerInstance</span>);
                }
 
                <b>if</b> (!<span class="r6 r">allowNonexistingPaths</span> &amp;&amp;
                    <span class="r9 r">result</span>.<span class="i">Count</span> &lt; 1 &amp;&amp;
                    (!<a href="../engine/regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../engine/regex.cs.html#f9cf207fdd565080" class="i method">ContainsWildcardCharacters</a>(<span class="r5 r">path</span>) || <span class="r7 r">context</span>.<a href="CoreCommandContext.cs.html#b9edf955d3776935" class="i property">SuppressWildcardExpansion</a>) &amp;&amp;
                    (<span class="r7 r">context</span>.<a href="CoreCommandContext.cs.html#ab4bd68ec99ecaa3" class="i property">Include</a> == <b>null</b> || <span class="r7 r">context</span>.<a href="CoreCommandContext.cs.html#ab4bd68ec99ecaa3" class="i property">Include</a>.<span class="i">Count</span> == 0) &amp;&amp;
                    (<span class="r7 r">context</span>.<a href="CoreCommandContext.cs.html#93e21581391c00fc" class="i property">Exclude</a> == <b>null</b> || <span class="r7 r">context</span>.<a href="CoreCommandContext.cs.html#93e21581391c00fc" class="i property">Exclude</a>.<span class="i">Count</span> == 0))
                {
                    <span class="c">// Since we are not globbing, throw an exception since</span>
                    <span class="c">// the path doesn&#39;t exist</span>
 
                    <a href="../utils/SessionStateExceptions.cs.html#9ed59df3c4c15193" class="t t">ItemNotFoundException</a> <span id="r12 rd" class="r12 r">pathNotFound</span> =
                        <b>new</b> <span class="t">ItemNotFoundException</span>(
                            <span class="r5 r">path</span>,
                            <span class="s">&quot;PathNotFound&quot;</span>,
                            <span class="i">SessionStateStrings</span>.<span class="i">PathNotFound</span>);
 
                    <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#e7dd110db4bf902f" class="i method">TraceError</a>(<span class="s">&quot;Item does not exist: {0}&quot;</span>, <span class="r5 r">path</span>);
 
                    <b>throw</b> <span class="r12 r">pathNotFound</span>;
                }
            }
 
            <b>return</b> <span class="r9 r">result</span>;
        }
 
        <b>private</b> <span class="i">Collection</span>&lt;<b>string</b>&gt; <a id="26777aabb813c60c" href="../R/26777aabb813c60c.html" target="n" data-glyph="76,1" class="i method">ResolveProviderPathFromProviderPath</a>(
            <b>string</b> <span id="r13 rd" class="r13 r">providerPath</span>,
            <b>string</b> <span id="r14 rd" class="r14 r">providerId</span>,
            <b>bool</b> <span id="r15 rd" class="r15 r">allowNonexistingPaths</span>,
            <a href="CoreCommandContext.cs.html#1e83d35d5286e174" class="t t">CmdletProviderContext</a> <span id="r16 rd" class="r16 r">context</span>,
            <b>out</b> <a href="../P/71826561229efd99.html#71826561229efd99" class="t t">CmdletProvider</a> <span id="r17 rd" class="r17 r">providerInstance</span>
            )
        {
            <span class="c">// Check the provider capabilities before globbing</span>
            <span class="r17 r">providerInstance</span> = <a href="#06ecc54ac29ea6b5" class="i field">_sessionState</a>.<a href="../engine/SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../engine/SessionStateProviderAPIs.cs.html#e8e87f501c578713" class="i method">GetProviderInstance</a>(<span class="r14 r">providerId</span>);
            <a href="ContainerProviderBase.cs.html#bfc85492b760e757" class="t t">ContainerCmdletProvider</a> <span id="r18 rd" class="r18 r">containerCmdletProvider</span> = <span class="r17 r">providerInstance</span> <b>as</b> <a href="ContainerProviderBase.cs.html#bfc85492b760e757" class="t t">ContainerCmdletProvider</a>;
            <a href="ItemProviderBase.cs.html#ca858520f083a7df" class="t t">ItemCmdletProvider</a> <span id="r19 rd" class="r19 r">itemProvider</span> = <span class="r17 r">providerInstance</span> <b>as</b> <a href="ItemProviderBase.cs.html#ca858520f083a7df" class="t t">ItemCmdletProvider</a>;
 
            <span class="i">Collection</span>&lt;<b>string</b>&gt; <span id="r20 rd" class="r20 r">stringResult</span> = <b>new</b> <span class="i">Collection</span>&lt;<b>string</b>&gt;();
 
            <b>if</b> (!<span class="r16 r">context</span>.<a href="CoreCommandContext.cs.html#b9edf955d3776935" class="i property">SuppressWildcardExpansion</a>)
            {
                <span class="c">// See if the provider will expand the wildcard</span>
                <b>if</b> (<a href="../engine/ProviderInterfaces.cs.html#5df802574bbd2fbe" class="t t">CmdletProviderManagementIntrinsics</a>.<a href="../engine/ProviderInterfaces.cs.html#91fe18556cbf9bf1" class="i method">CheckProviderCapabilities</a>(
                        <a href="ProviderDeclarationAttribute.cs.html#a29c0c50418632fb" class="t t">ProviderCapabilities</a>.<a href="ProviderDeclarationAttribute.cs.html#caea78b074b53f87" class="i field">ExpandWildcards</a>,
                        <span class="r17 r">providerInstance</span>.<a href="ProviderBase.cs.html#6129ef83671ead76" class="i property">ProviderInfo</a>))
                {
                    <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#96aaf3813a5962a0" class="i method">WriteLine</a>(<span class="s">&quot;Wildcard matching is being performed by the provider.&quot;</span>);
 
                    <span class="c">// Only do the expansion if the path actually contains wildcard</span>
                    <span class="c">// characters.</span>
                    <b>if</b> ((<span class="r19 r">itemProvider</span> != <b>null</b>) &amp;&amp;
                        (<a href="../engine/regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../engine/regex.cs.html#f9cf207fdd565080" class="i method">ContainsWildcardCharacters</a>(<span class="r13 r">providerPath</span>)))
                    {
                        <span class="r20 r">stringResult</span> = <b>new</b> <span class="i">Collection</span>&lt;<b>string</b>&gt;(<span class="r19 r">itemProvider</span>.<a href="ItemProviderBase.cs.html#3607567c1768c08b" class="i method">ExpandPath</a>(<span class="r13 r">providerPath</span>, <span class="r16 r">context</span>));
                    }
                    <b>else</b>
                    {
                        <span class="r20 r">stringResult</span>.<span class="i">Add</span>(<span class="r13 r">providerPath</span>);
                    }
                }
                <b>else</b>
                {
                    <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#96aaf3813a5962a0" class="i method">WriteLine</a>(<span class="s">&quot;Wildcard matching is being performed by the engine.&quot;</span>);
 
                    <b>if</b> (<span class="r18 r">containerCmdletProvider</span> != <b>null</b>)
                    {
                        <span class="c">// Since it is really a provider-internal path, use provider-to-provider globbing</span>
                        <span class="c">// and then add back on the provider ID.</span>
 
                        <span class="r20 r">stringResult</span> =
                            <a href="#9b78be2dcbbaf075" class="i method">GetGlobbedProviderPathsFromProviderPath</a>(
                                <span class="r13 r">providerPath</span>,
                                <span class="r15 r">allowNonexistingPaths</span>,
                                <span class="r18 r">containerCmdletProvider</span>,
                                <span class="r16 r">context</span>);
                    }
                    <b>else</b>
                    {
                        <span class="c">// For simple CmdletProvider instances, we can&#39;t resolve the paths any</span>
                        <span class="c">// further, so just return the providerPath</span>
                        <span class="r20 r">stringResult</span>.<span class="i">Add</span>(<span class="r13 r">providerPath</span>);
                    }
                }
            }
            <span class="c">// They are suppressing wildcard expansion</span>
            <b>else</b>
            {
                <b>if</b> (<span class="r19 r">itemProvider</span> != <b>null</b>)
                {
                    <b>if</b> (<span class="r15 r">allowNonexistingPaths</span> || <span class="r19 r">itemProvider</span>.<a href="ItemProviderBase.cs.html#99dfd768e6f3aa7c" class="i method">ItemExists</a>(<span class="r13 r">providerPath</span>, <span class="r16 r">context</span>))
                    {
                        <span class="r20 r">stringResult</span>.<span class="i">Add</span>(<span class="r13 r">providerPath</span>);
                    }
                }
                <b>else</b>
                {
                    <span class="r20 r">stringResult</span>.<span class="i">Add</span>(<span class="r13 r">providerPath</span>);
                }
            }
 
            <span class="c">// Make sure this resolved to something</span>
            <b>if</b> ((!<span class="r15 r">allowNonexistingPaths</span>) &amp;&amp;
                <span class="r20 r">stringResult</span>.<span class="i">Count</span> &lt; 1 &amp;&amp;
                !<a href="../engine/regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../engine/regex.cs.html#f9cf207fdd565080" class="i method">ContainsWildcardCharacters</a>(<span class="r13 r">providerPath</span>) &amp;&amp;
                (<span class="r16 r">context</span>.<a href="CoreCommandContext.cs.html#ab4bd68ec99ecaa3" class="i property">Include</a> == <b>null</b> || <span class="r16 r">context</span>.<a href="CoreCommandContext.cs.html#ab4bd68ec99ecaa3" class="i property">Include</a>.<span class="i">Count</span> == 0) &amp;&amp;
                (<span class="r16 r">context</span>.<a href="CoreCommandContext.cs.html#93e21581391c00fc" class="i property">Exclude</a> == <b>null</b> || <span class="r16 r">context</span>.<a href="CoreCommandContext.cs.html#93e21581391c00fc" class="i property">Exclude</a>.<span class="i">Count</span> == 0))
            {
                <a href="../utils/SessionStateExceptions.cs.html#9ed59df3c4c15193" class="t t">ItemNotFoundException</a> <span id="r21 rd" class="r21 r">pathNotFound</span> =
                    <b>new</b> <span class="t">ItemNotFoundException</span>(
                        <span class="r13 r">providerPath</span>,
                        <span class="s">&quot;PathNotFound&quot;</span>,
                        <span class="i">SessionStateStrings</span>.<span class="i">PathNotFound</span>);
 
                <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#e7dd110db4bf902f" class="i method">TraceError</a>(<span class="s">&quot;Item does not exist: {0}&quot;</span>, <span class="r13 r">providerPath</span>);
                <b>throw</b> <span class="r21 r">pathNotFound</span>;
            }
 
            <b>return</b> <span class="r20 r">stringResult</span>;
        }
 
        <b>private</b> <span class="i">Collection</span>&lt;<a href="PathInfo.cs.html#9504cfb54420cfd7" class="t t">PathInfo</a>&gt; <a id="ea43142143b0c7dc" href="../R/ea43142143b0c7dc.html" target="n" data-glyph="76,1" class="i method">ResolvePSPathFromProviderPath</a>(
            <b>string</b> <span id="r22 rd" class="r22 r">path</span>,
            <a href="CoreCommandContext.cs.html#1e83d35d5286e174" class="t t">CmdletProviderContext</a> <span id="r23 rd" class="r23 r">context</span>,
            <b>bool</b> <span id="r24 rd" class="r24 r">allowNonexistingPaths</span>,
            <b>bool</b> <span id="r25 rd" class="r25 r">isProviderDirectPath</span>,
            <b>bool</b> <span id="r26 rd" class="r26 r">isProviderQualifiedPath</span>,
            <b>out</b> <a href="../P/71826561229efd99.html#71826561229efd99" class="t t">CmdletProvider</a> <span id="r27 rd" class="r27 r">providerInstance</span>)
        {
            <span class="i">Collection</span>&lt;<a href="PathInfo.cs.html#9504cfb54420cfd7" class="t t">PathInfo</a>&gt; <span id="r28 rd" class="r28 r">result</span> = <b>new</b> <span class="i">Collection</span>&lt;<a href="PathInfo.cs.html#9504cfb54420cfd7" class="t t">PathInfo</a>&gt;();
 
            <span class="r27 r">providerInstance</span> = <b>null</b>;
            <b>string</b> <span id="r29 rd" class="r29 r">providerId</span> = <b>null</b>;
            <a href="../engine/DataStoreAdapter.cs.html#2d16b26a541ba185" class="t t">PSDriveInfo</a> <span id="r30 rd" class="r30 r">drive</span> = <b>null</b>;
 
            <span class="c">// The path is a provide direct path so use the current</span>
            <span class="c">// provider and don&#39;t modify the path.</span>
 
            <b>string</b> <span id="r31 rd" class="r31 r">providerPath</span> = <b>null</b>;
 
            <b>if</b> (<span class="r25 r">isProviderDirectPath</span>)
            {
                <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#96aaf3813a5962a0" class="i method">WriteLine</a>(<span class="s">&quot;Path is PROVIDER-DIRECT&quot;</span>);
                <span class="r31 r">providerPath</span> = <span class="r22 r">path</span>;
                <span class="r29 r">providerId</span> = <a href="#06ecc54ac29ea6b5" class="i field">_sessionState</a>.<a href="../engine/SessionStatePublic.cs.html#3390cfbbdcffb036" class="i property">Path</a>.<a href="../engine/PathInterfaces.cs.html#91ffa5f8fc6b1308" class="i property">CurrentLocation</a>.<a href="PathInfo.cs.html#223c6ebf64760c0d" class="i property">Provider</a>.<a href="../engine/DataStoreAdapterProvider.cs.html#2837d805ea30ef5c" class="i property">Name</a>;
            }
            <b>else</b> <b>if</b> (<span class="r26 r">isProviderQualifiedPath</span>)
            {
                <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#96aaf3813a5962a0" class="i method">WriteLine</a>(<span class="s">&quot;Path is PROVIDER-QUALIFIED&quot;</span>);
                <span class="r31 r">providerPath</span> = <a href="#d0dba4efed9d6237" class="i method">ParseProviderPath</a>(<span class="r22 r">path</span>, <b>out</b> <span class="r29 r">providerId</span>);
            }
 
            <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;PROVIDER-INTERNAL path: {0}&quot;</span>, <span class="r31 r">providerPath</span>);
            <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Provider: {0}&quot;</span>, <span class="r29 r">providerId</span>);
 
            <span class="i">Collection</span>&lt;<b>string</b>&gt; <span id="r32 rd" class="r32 r">stringResult</span> = <a href="#26777aabb813c60c" class="i method">ResolveProviderPathFromProviderPath</a>(
                <span class="r31 r">providerPath</span>,
                <span class="r29 r">providerId</span>,
                <span class="r24 r">allowNonexistingPaths</span>,
                <span class="r23 r">context</span>,
                <b>out</b> <span class="r27 r">providerInstance</span>
                );
 
            <span class="c">// Get the hidden drive for the provider</span>
            <span class="r30 r">drive</span> = <span class="r27 r">providerInstance</span>.<a href="ProviderBase.cs.html#6129ef83671ead76" class="i property">ProviderInfo</a>.<a href="../engine/DataStoreAdapterProvider.cs.html#81f9b0afcf0650d8" class="i property">HiddenDrive</a>;
 
            <span class="c">// Now fix the paths</span>
            <b>foreach</b> (<b>string</b> <span id="r33 rd" class="r33 r">globbedPath</span> <b>in</b> <span class="r32 r">stringResult</span>)
            {
                <b>string</b> <span id="r34 rd" class="r34 r">escapedPath</span> = <span class="r33 r">globbedPath</span>;
 
                <span class="c">// Making sure to obey the StopProcessing.</span>
                <b>if</b> (<span class="r23 r">context</span>.<a href="CoreCommandContext.cs.html#649b794a0afa4fa8" class="i property">Stopping</a>)
                {
                    <b>throw</b> <b>new</b> <a href="../utils/ExecutionExceptions.cs.html#105b0214d3aab114" class="t constructor">PipelineStoppedException</a>();
                }
 
                <b>string</b> <span id="r35 rd" class="r35 r">constructedProviderPath</span> = <b>null</b>;
 
                <b>if</b> (<a href="#f0c7a79be5b8b12b" class="i method">IsProviderDirectPath</a>(<span class="r34 r">escapedPath</span>))
                {
                    <span class="r35 r">constructedProviderPath</span> = <span class="r34 r">escapedPath</span>;
                }
                <b>else</b>
                {
                    <span class="r35 r">constructedProviderPath</span> =
                        <b>string</b>.<span class="i">Format</span>(
                            <span class="i n">System</span>.<span class="i">Globalization</span>.<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                            <span class="s">&quot;{0}::{1}&quot;</span>,
                            <span class="r29 r">providerId</span>,
                            <span class="r34 r">escapedPath</span>);
                }
 
                <span class="r28 r">result</span>.<span class="i">Add</span>(<b>new</b> <a href="PathInfo.cs.html#6846c3b69ef77149" class="t constructor">PathInfo</a>(<span class="r30 r">drive</span>, <span class="r27 r">providerInstance</span>.<a href="ProviderBase.cs.html#6129ef83671ead76" class="i property">ProviderInfo</a>, <span class="r35 r">constructedProviderPath</span>, <a href="#06ecc54ac29ea6b5" class="i field">_sessionState</a>));
                <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;RESOLVED PATH: {0}&quot;</span>, <span class="r35 r">constructedProviderPath</span>);
            }
 
            <b>return</b> <span class="r28 r">result</span>;
        }
 
        <b>private</b> <span class="i">Collection</span>&lt;<a href="PathInfo.cs.html#9504cfb54420cfd7" class="t t">PathInfo</a>&gt; <a id="5bbcea5cd3612980" href="../R/5bbcea5cd3612980.html" target="n" data-glyph="76,1" class="i method">ResolveDriveQualifiedPath</a>(
            <b>string</b> <span id="r36 rd" class="r36 r">path</span>,
            <a href="CoreCommandContext.cs.html#1e83d35d5286e174" class="t t">CmdletProviderContext</a> <span id="r37 rd" class="r37 r">context</span>,
            <b>bool</b> <span id="r38 rd" class="r38 r">allowNonexistingPaths</span>,
            <b>out</b> <a href="../P/71826561229efd99.html#71826561229efd99" class="t t">CmdletProvider</a> <span id="r39 rd" class="r39 r">providerInstance</span>)
        {
            <span class="r39 r">providerInstance</span> = <b>null</b>;
            <a href="../engine/DataStoreAdapter.cs.html#2d16b26a541ba185" class="t t">PSDriveInfo</a> <span id="r40 rd" class="r40 r">drive</span> = <b>null</b>;
 
            <span class="i">Collection</span>&lt;<a href="PathInfo.cs.html#9504cfb54420cfd7" class="t t">PathInfo</a>&gt; <span id="r41 rd" class="r41 r">result</span> = <b>new</b> <span class="i">Collection</span>&lt;<a href="PathInfo.cs.html#9504cfb54420cfd7" class="t t">PathInfo</a>&gt;();
 
            <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#96aaf3813a5962a0" class="i method">WriteLine</a>(<span class="s">&quot;Path is DRIVE-QUALIFIED&quot;</span>);
 
            <b>string</b> <span id="r42 rd" class="r42 r">relativePath</span> =
                <span class="i">GetDriveRootRelativePathFromPSPath</span>(
                    <span class="r36 r">path</span>,
                    <span class="r37 r">context</span>,
                    !<span class="r37 r">context</span>.<a href="CoreCommandContext.cs.html#b9edf955d3776935" class="i property">SuppressWildcardExpansion</a>,
                    <b>out</b> <span class="r40 r">drive</span>,
                    <b>out</b> <span class="r39 r">providerInstance</span>);
 
            <span class="i n">Dbg</span>.<a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(
                <span class="r40 r">drive</span> != <b>null</b>,
                <span class="s">&quot;GetDriveRootRelativePathFromPSPath should always return a valid drive&quot;</span>);
 
            <span class="i n">Dbg</span>.<a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<span class="i">Assert</span>(
                <span class="r42 r">relativePath</span> != <b>null</b>,
                <span class="s">&quot;There should always be a way to generate a provider path for a &quot;</span> +
                <span class="s">&quot;given path&quot;</span>);
 
            <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;DRIVE-RELATIVE path: {0}&quot;</span>, <span class="r42 r">relativePath</span>);
            <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Drive: {0}&quot;</span>, <span class="r40 r">drive</span>.<a href="../engine/DataStoreAdapter.cs.html#7c2d83a1b2b425a9" class="i property">Name</a>);
            <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Provider: {0}&quot;</span>, <span class="r40 r">drive</span>.<a href="../engine/DataStoreAdapter.cs.html#599e6ea3519fc2d6" class="i property">Provider</a>);
 
            <span class="c">// Associate the drive with the context</span>
 
            <span class="r37 r">context</span>.<a href="CoreCommandContext.cs.html#f037b19aae477b8f" class="i property">Drive</a> = <span class="r40 r">drive</span>;
            <span class="r39 r">providerInstance</span> = <a href="#06ecc54ac29ea6b5" class="i field">_sessionState</a>.<a href="../engine/SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../engine/SessionStateProviderAPIs.cs.html#effde0c1f75d8b39" class="i method">GetContainerProviderInstance</a>(<span class="r40 r">drive</span>.<a href="../engine/DataStoreAdapter.cs.html#599e6ea3519fc2d6" class="i property">Provider</a>);
            <a href="ContainerProviderBase.cs.html#bfc85492b760e757" class="t t">ContainerCmdletProvider</a> <span id="r43 rd" class="r43 r">containerCmdletProvider</span> = <span class="r39 r">providerInstance</span> <b>as</b> <a href="ContainerProviderBase.cs.html#bfc85492b760e757" class="t t">ContainerCmdletProvider</a>;
            <a href="ItemProviderBase.cs.html#ca858520f083a7df" class="t t">ItemCmdletProvider</a> <span id="r44 rd" class="r44 r">itemProvider</span> = <span class="r39 r">providerInstance</span> <b>as</b> <a href="ItemProviderBase.cs.html#ca858520f083a7df" class="t t">ItemCmdletProvider</a>;
 
            <a href="../engine/DataStoreAdapterProvider.cs.html#dd4e1f2f8e73a1dd" class="t t">ProviderInfo</a> <span id="r45 rd" class="r45 r">provider</span> = <span class="r39 r">providerInstance</span>.<a href="ProviderBase.cs.html#6129ef83671ead76" class="i property">ProviderInfo</a>;
 
            <b>string</b> <span id="r46 rd" class="r46 r">userPath</span> = <b>null</b>;
            <b>string</b> <span id="r47 rd" class="r47 r">itemPath</span> = <b>null</b>;
 
            <b>if</b> (<span class="r40 r">drive</span>.<a href="../engine/DataStoreAdapter.cs.html#27d719becccdef1a" class="i property">Hidden</a>)
            {
                <span class="r46 r">userPath</span> = <a href="#27fa0f384ea11c27" class="i method">GetProviderQualifiedPath</a>(<span class="r42 r">relativePath</span>, <span class="r45 r">provider</span>);
                <span class="r47 r">itemPath</span> = <span class="r42 r">relativePath</span>;
            }
            <b>else</b>
            {
                <span class="r46 r">userPath</span> = <a href="#86d3acb1cb597023" class="i method">GetDriveQualifiedPath</a>(<span class="r42 r">relativePath</span>, <span class="r40 r">drive</span>);
                <span class="r47 r">itemPath</span> = <a href="#11c999b7af9a2872" class="i method">GetProviderPath</a>(<span class="r36 r">path</span>, <span class="r37 r">context</span>);
            }
 
            <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;PROVIDER path: {0}&quot;</span>, <span class="r47 r">itemPath</span>);
 
            <span class="i">Collection</span>&lt;<b>string</b>&gt; <span id="r48 rd" class="r48 r">stringResult</span> = <b>new</b> <span class="i">Collection</span>&lt;<b>string</b>&gt;();
 
            <b>if</b> (!<span class="r37 r">context</span>.<a href="CoreCommandContext.cs.html#b9edf955d3776935" class="i property">SuppressWildcardExpansion</a>)
            {
                <span class="c">// See if the provider will expand the wildcard</span>
                <b>if</b> (<a href="../engine/ProviderInterfaces.cs.html#5df802574bbd2fbe" class="t t">CmdletProviderManagementIntrinsics</a>.<a href="../engine/ProviderInterfaces.cs.html#91fe18556cbf9bf1" class="i method">CheckProviderCapabilities</a>(
                        <a href="ProviderDeclarationAttribute.cs.html#a29c0c50418632fb" class="t t">ProviderCapabilities</a>.<a href="ProviderDeclarationAttribute.cs.html#caea78b074b53f87" class="i field">ExpandWildcards</a>,
                        <span class="r45 r">provider</span>))
                {
                    <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#96aaf3813a5962a0" class="i method">WriteLine</a>(<span class="s">&quot;Wildcard matching is being performed by the provider.&quot;</span>);
 
                    <span class="c">// Only do the expansion if the path actually contains wildcard</span>
                    <span class="c">// characters.</span>
                    <b>if</b> ((<span class="r44 r">itemProvider</span> != <b>null</b>) &amp;&amp;
                        (<a href="../engine/regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../engine/regex.cs.html#f9cf207fdd565080" class="i method">ContainsWildcardCharacters</a>(<span class="r42 r">relativePath</span>)))
                    {
                        <b>foreach</b> (<b>string</b> <span id="r49 rd" class="r49 r">pathResult</span> <b>in</b> <span class="r44 r">itemProvider</span>.<a href="ItemProviderBase.cs.html#3607567c1768c08b" class="i method">ExpandPath</a>(<span class="r47 r">itemPath</span>, <span class="r37 r">context</span>))
                        {
                            <span class="r48 r">stringResult</span>.<span class="i">Add</span>(
                                <a href="#c9f4b93d1b734069" class="i method">GetDriveRootRelativePathFromProviderPath</a>(<span class="r49 r">pathResult</span>, <span class="r40 r">drive</span>, <span class="r37 r">context</span>));
                        }
                    }
                    <b>else</b>
                    {
                        <span class="r48 r">stringResult</span>.<span class="i">Add</span>(<a href="#c9f4b93d1b734069" class="i method">GetDriveRootRelativePathFromProviderPath</a>(<span class="r47 r">itemPath</span>, <span class="r40 r">drive</span>, <span class="r37 r">context</span>));
                    }
                }
                <b>else</b>
                {
                    <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#96aaf3813a5962a0" class="i method">WriteLine</a>(<span class="s">&quot;Wildcard matching is being performed by the engine.&quot;</span>);
 
                    <span class="c">// Now perform the globbing</span>
                    <span class="r48 r">stringResult</span> =
                        <a href="#9df1b8bf48658855" class="i method">ExpandMshGlobPath</a>(
                            <span class="r42 r">relativePath</span>,
                            <span class="r38 r">allowNonexistingPaths</span>,
                            <span class="r40 r">drive</span>,
                            <span class="r43 r">containerCmdletProvider</span>,
                            <span class="r37 r">context</span>);
                }
            }
            <span class="c">// They are suppressing wildcard expansion</span>
            <b>else</b>
            {
                <b>if</b> (<span class="r44 r">itemProvider</span> != <b>null</b>)
                {
                    <b>if</b> (<span class="r38 r">allowNonexistingPaths</span> || <span class="r44 r">itemProvider</span>.<a href="ItemProviderBase.cs.html#99dfd768e6f3aa7c" class="i method">ItemExists</a>(<span class="r47 r">itemPath</span>, <span class="r37 r">context</span>))
                    {
                        <span class="r48 r">stringResult</span>.<span class="i">Add</span>(<span class="r46 r">userPath</span>);
                    }
                }
                <b>else</b>
                {
                    <span class="r48 r">stringResult</span>.<span class="i">Add</span>(<span class="r46 r">userPath</span>);
                }
            }
 
            <span class="c">// Make sure this resolved to something</span>
            <b>if</b> ((!<span class="r38 r">allowNonexistingPaths</span>) &amp;&amp;
                <span class="r48 r">stringResult</span>.<span class="i">Count</span> &lt; 1 &amp;&amp;
                !<a href="../engine/regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../engine/regex.cs.html#f9cf207fdd565080" class="i method">ContainsWildcardCharacters</a>(<span class="r36 r">path</span>) &amp;&amp;
                (<span class="r37 r">context</span>.<a href="CoreCommandContext.cs.html#ab4bd68ec99ecaa3" class="i property">Include</a> == <b>null</b> || <span class="r37 r">context</span>.<a href="CoreCommandContext.cs.html#ab4bd68ec99ecaa3" class="i property">Include</a>.<span class="i">Count</span> == 0) &amp;&amp;
                (<span class="r37 r">context</span>.<a href="CoreCommandContext.cs.html#93e21581391c00fc" class="i property">Exclude</a> == <b>null</b> || <span class="r37 r">context</span>.<a href="CoreCommandContext.cs.html#93e21581391c00fc" class="i property">Exclude</a>.<span class="i">Count</span> == 0))
            {
                <a href="../utils/SessionStateExceptions.cs.html#9ed59df3c4c15193" class="t t">ItemNotFoundException</a> <span id="r50 rd" class="r50 r">pathNotFound</span> =
                    <b>new</b> <span class="t">ItemNotFoundException</span>(
                        <span class="r36 r">path</span>,
                        <span class="s">&quot;PathNotFound&quot;</span>,
                        <span class="i">SessionStateStrings</span>.<span class="i">PathNotFound</span>);
 
                <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#e7dd110db4bf902f" class="i method">TraceError</a>(<span class="s">&quot;Item does not exist: {0}&quot;</span>, <span class="r36 r">path</span>);
                <b>throw</b> <span class="r50 r">pathNotFound</span>;
            }
 
            <span class="c">// Now fix the paths</span>
            <b>foreach</b> (<b>string</b> <span id="r51 rd" class="r51 r">expandedPath</span> <b>in</b> <span class="r48 r">stringResult</span>)
            {
                <span class="c">// Make sure to obey StopProcessing</span>
                <b>if</b> (<span class="r37 r">context</span>.<a href="CoreCommandContext.cs.html#649b794a0afa4fa8" class="i property">Stopping</a>)
                {
                    <b>throw</b> <b>new</b> <a href="../utils/ExecutionExceptions.cs.html#105b0214d3aab114" class="t constructor">PipelineStoppedException</a>();
                }
 
                <span class="c">// Add the drive back into the path</span>
                <span class="r46 r">userPath</span> = <b>null</b>;
 
                <b>if</b> (<span class="r40 r">drive</span>.<a href="../engine/DataStoreAdapter.cs.html#27d719becccdef1a" class="i property">Hidden</a>)
                {
                    <b>if</b> (<a href="#f0c7a79be5b8b12b" class="i method">IsProviderDirectPath</a>(<span class="r51 r">expandedPath</span>))
                    {
                        <span class="r46 r">userPath</span> = <span class="r51 r">expandedPath</span>;
                    }
                    <b>else</b>
                    {
                        <span class="r46 r">userPath</span> =
                            <a href="#6387d90abe0ca584" class="t t">LocationGlobber</a>.<a href="#27fa0f384ea11c27" class="i method">GetProviderQualifiedPath</a>(
                                <span class="r51 r">expandedPath</span>,
                                <span class="r45 r">provider</span>);
                    }
                }
                <b>else</b>
                {
                    <span class="r46 r">userPath</span> =
                        <a href="#6387d90abe0ca584" class="t t">LocationGlobber</a>.<a href="#86d3acb1cb597023" class="i method">GetDriveQualifiedPath</a>(
                                <span class="r51 r">expandedPath</span>,
                                <span class="r40 r">drive</span>);
                }
 
                <span class="r41 r">result</span>.<span class="i">Add</span>(<b>new</b> <a href="PathInfo.cs.html#6846c3b69ef77149" class="t constructor">PathInfo</a>(<span class="r40 r">drive</span>, <span class="r45 r">provider</span>, <span class="r46 r">userPath</span>, <a href="#06ecc54ac29ea6b5" class="i field">_sessionState</a>));
                <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;RESOLVED PATH: {0}&quot;</span>, <span class="r46 r">userPath</span>);
            }
 
            <b>return</b> <span class="r41 r">result</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> PowerShell paths from PowerShell path globbing
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Provider paths from PowerShell path globbing
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Converts a PowerShell path containing glob characters to the provider</span>
        <span class="c">///</span><span class="c"> specific paths matching the glob strings.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r52 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A PowerShell path containing glob characters.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r53 r">allowNonexistingPaths</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If true, a ItemNotFoundException will not be thrown for non-existing</span>
        <span class="c">///</span><span class="c"> paths. Instead an appropriate path will be returned as if it did exist.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r54 r">provider</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns the information of the provider that was used to do the globbing.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r55 r">providerInstance</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The instance of the provider used to resolve the path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An array of provider specific paths that matched the PowerShell glob path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r52 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#a58038dc730da896" class="t t">ProviderNotFoundException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the path is a provider-qualified path for a provider that is</span>
        <span class="c">///</span><span class="c"> not loaded into the system.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#09140e6dc875019b" class="t t">DriveNotFoundException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r52 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> refers to a drive that could not be found.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#35e07c15a7526bcd" class="t t">ProviderInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider used to build the path threw an exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">NotSupportedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider that the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r52 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> represents is not a NavigationCmdletProvider</span>
        <span class="c">///</span><span class="c"> or ContainerCmdletProvider.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r52 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> starts with &quot;~&quot; and the home location is not set for</span>
        <span class="c">///</span><span class="c"> the provider.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#35e07c15a7526bcd" class="t t">ProviderInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider associated with the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r52 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> threw an</span>
        <span class="c">///</span><span class="c"> exception when its GetParentPath or MakePath was called while</span>
        <span class="c">///</span><span class="c"> processing the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r52 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#9ed59df3c4c15193" class="t t">ItemNotFoundException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r52 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> does not contain glob characters and</span>
        <span class="c">///</span><span class="c"> could not be found.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Any exception can be thrown by the provider that is called to build</span>
        <span class="c">///</span><span class="c"> the provider path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">Collection</span>&lt;<b>string</b>&gt; <a id="389b6a9407459a62" href="../R/389b6a9407459a62.html" target="n" data-glyph="74,1" class="i method">GetGlobbedProviderPathsFromMonadPath</a>(
            <b>string</b> <span id="r52 rd" class="r52 r">path</span>,
            <b>bool</b> <span id="r53 rd" class="r53 r">allowNonexistingPaths</span>,
            <b>out</b> <a href="../engine/DataStoreAdapterProvider.cs.html#dd4e1f2f8e73a1dd" class="t t">ProviderInfo</a> <span id="r54 rd" class="r54 r">provider</span>,
            <b>out</b> <a href="../P/71826561229efd99.html#71826561229efd99" class="t t">CmdletProvider</a> <span id="r55 rd" class="r55 r">providerInstance</span>)
        {
            <span class="r55 r">providerInstance</span> = <b>null</b>;
            <b>if</b> (<span class="r52 r">path</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r52 r">path</span>));
            }
 
            <a href="CoreCommandContext.cs.html#1e83d35d5286e174" class="t t">CmdletProviderContext</a> <span id="r56 rd" class="r56 r">context</span> =
                <b>new</b> <a href="CoreCommandContext.cs.html#8a0e078b40b2fd0e" class="t constructor">CmdletProviderContext</a>(<a href="#06ecc54ac29ea6b5" class="i field">_sessionState</a>.<a href="../engine/SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../engine/SessionState.cs.html#3ddff2db6bc01805" class="i property">ExecutionContext</a>);
 
            <b>return</b> <a href="#79c1f17dc6323c22" class="i method">GetGlobbedProviderPathsFromMonadPath</a>(<span class="r52 r">path</span>, <span class="r53 r">allowNonexistingPaths</span>, <span class="r56 r">context</span>, <b>out</b> <span class="r54 r">provider</span>, <b>out</b> <span class="r55 r">providerInstance</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Converts a PowerShell path containing glob characters to the provider</span>
        <span class="c">///</span><span class="c"> specific paths matching the glob strings.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r57 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A PowerShell path containing glob characters.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r58 r">allowNonexistingPaths</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If true, a ItemNotFoundException will not be thrown for non-existing</span>
        <span class="c">///</span><span class="c"> paths. Instead an appropriate path will be returned as if it did exist.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r59 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The context under which the command is running.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r60 r">provider</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns the information of the provider that was used to do the globbing.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r61 r">providerInstance</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The instance of the provider used to resolve the path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An array of provider specific paths that matched the PowerShell glob path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r57 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> or </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r59 r">context</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#a58038dc730da896" class="t t">ProviderNotFoundException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the path is a provider-qualified path for a provider that is</span>
        <span class="c">///</span><span class="c"> not loaded into the system.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#09140e6dc875019b" class="t t">DriveNotFoundException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r57 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> refers to a drive that could not be found.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#35e07c15a7526bcd" class="t t">ProviderInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider used to build the path threw an exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">NotSupportedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider that the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r57 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> represents is not a NavigationCmdletProvider</span>
        <span class="c">///</span><span class="c"> or ContainerCmdletProvider.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r57 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> starts with &quot;~&quot; and the home location is not set for</span>
        <span class="c">///</span><span class="c"> the provider.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#35e07c15a7526bcd" class="t t">ProviderInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider associated with the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r57 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> threw an</span>
        <span class="c">///</span><span class="c"> exception when its GetParentPath or MakePath was called while</span>
        <span class="c">///</span><span class="c"> processing the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r57 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#9ed59df3c4c15193" class="t t">ItemNotFoundException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r57 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> does not contain glob characters and</span>
        <span class="c">///</span><span class="c"> could not be found.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Any exception can be thrown by the provider that is called to build</span>
        <span class="c">///</span><span class="c"> the provider path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">Collection</span>&lt;<b>string</b>&gt; <a id="79c1f17dc6323c22" href="../R/79c1f17dc6323c22.html" target="n" data-glyph="74,1" class="i method">GetGlobbedProviderPathsFromMonadPath</a>(
            <b>string</b> <span id="r57 rd" class="r57 r">path</span>,
            <b>bool</b> <span id="r58 rd" class="r58 r">allowNonexistingPaths</span>,
            <a href="CoreCommandContext.cs.html#1e83d35d5286e174" class="t t">CmdletProviderContext</a> <span id="r59 rd" class="r59 r">context</span>,
            <b>out</b> <a href="../engine/DataStoreAdapterProvider.cs.html#dd4e1f2f8e73a1dd" class="t t">ProviderInfo</a> <span id="r60 rd" class="r60 r">provider</span>,
            <b>out</b> <a href="../P/71826561229efd99.html#71826561229efd99" class="t t">CmdletProvider</a> <span id="r61 rd" class="r61 r">providerInstance</span>)
        {
            <b>if</b> (<span class="r57 r">path</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r57 r">path</span>));
            }
 
            <b>if</b> (<span class="r59 r">context</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r59 r">context</span>));
            }
 
            <b>using</b> (<a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#ff5e86462c8f4f03" class="i method">TraceScope</a>(<span class="s">&quot;Resolving MSH path \&quot;{0}\&quot; to PROVIDER-INTERNAL path&quot;</span>, <span class="r57 r">path</span>))
            {
                <a href="#2bf2d71caf7f9287" class="i method">TraceFilters</a>(<span class="r59 r">context</span>);
 
                <span class="c">// Remove the drive from the context if this path is not associated with a drive</span>
                <b>if</b> (<a href="#45d8fc5f64551b7a" class="i method">IsProviderQualifiedPath</a>(<span class="r57 r">path</span>))
                {
                    <span class="r59 r">context</span>.<a href="CoreCommandContext.cs.html#f037b19aae477b8f" class="i property">Drive</a> = <b>null</b>;
                }
 
                <a href="../engine/DataStoreAdapter.cs.html#2d16b26a541ba185" class="t t">PSDriveInfo</a> <span id="r62 rd" class="r62 r">drive</span> = <b>null</b>;
                <b>string</b> <span id="r63 rd" class="r63 r">providerPath</span> = <a href="#db13f265cc2244b4" class="i method">GetProviderPath</a>(<span class="r57 r">path</span>, <span class="r59 r">context</span>, <b>out</b> <span class="r60 r">provider</span>, <b>out</b> <span class="r62 r">drive</span>);
 
                <b>if</b> (<span class="r63 r">providerPath</span> == <b>null</b>)
                {
                    <span class="r61 r">providerInstance</span> = <b>null</b>;
                    <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#96aaf3813a5962a0" class="i method">WriteLine</a>(<span class="s">&quot;provider returned a null path so return an empty array&quot;</span>);
 
                    <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Provider &#39;{0}&#39; returned null&quot;</span>, <span class="r60 r">provider</span>);
                    <b>return</b> <b>new</b> <span class="i">Collection</span>&lt;<b>string</b>&gt;();
                }
 
                <b>if</b> (<span class="r62 r">drive</span> != <b>null</b>)
                {
                    <span class="r59 r">context</span>.<a href="CoreCommandContext.cs.html#f037b19aae477b8f" class="i property">Drive</a> = <span class="r62 r">drive</span>;
                }
 
                <span class="i">Collection</span>&lt;<b>string</b>&gt; <span id="r64 rd" class="r64 r">paths</span> = <b>new</b> <span class="i">Collection</span>&lt;<b>string</b>&gt;();
 
                <b>foreach</b> (<a href="PathInfo.cs.html#9504cfb54420cfd7" class="t t">PathInfo</a> <span id="r65 rd" class="r65 r">currentPath</span> <b>in</b>
                    <a href="#4058cafa7013d845" class="i method">GetGlobbedMonadPathsFromMonadPath</a>(
                        <span class="r57 r">path</span>,
                        <span class="r58 r">allowNonexistingPaths</span>,
                        <span class="r59 r">context</span>,
                        <b>out</b> <span class="r61 r">providerInstance</span>))
                {
                    <span class="r64 r">paths</span>.<span class="i">Add</span>(<span class="r65 r">currentPath</span>.<a href="PathInfo.cs.html#16e3fcd7f95c1bfc" class="i property">ProviderPath</a>);
                }
 
                <b>return</b> <span class="r64 r">paths</span>;
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Provider paths from Monad path globbing
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Provider paths from provider path globbing
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Given a provider specific path that contains glob characters, this method</span>
        <span class="c">///</span><span class="c"> will perform the globbing using the specified provider and return the</span>
        <span class="c">///</span><span class="c"> matching provider specific paths.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r66 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path containing the glob characters to resolve.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r67 r">allowNonexistingPaths</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If true, a ItemNotFoundException will not be thrown for non-existing</span>
        <span class="c">///</span><span class="c"> paths. Instead an appropriate path will be returned as if it did exist.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r68 r">providerId</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The ID of the provider to use to do the resolution.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r69 r">providerInstance</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The instance of the provider that was used to resolve the path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An array of provider specific paths that match the glob path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r66 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#a58038dc730da896" class="t t">ProviderNotFoundException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r68 r">providerId</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> references a provider that does not exist.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">NotSupportedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r68 r">providerId</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> references a provider that is not</span>
        <span class="c">///</span><span class="c"> a ContainerCmdletProvider.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#35e07c15a7526bcd" class="t t">ProviderInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider used to build the path threw an exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r66 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> starts with &quot;~&quot; and the home location is not set for</span>
        <span class="c">///</span><span class="c"> the provider.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#9ed59df3c4c15193" class="t t">ItemNotFoundException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r66 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> does not contain glob characters and</span>
        <span class="c">///</span><span class="c"> could not be found.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Any exception can be thrown by the provider that is called to build</span>
        <span class="c">///</span><span class="c"> the provider path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">Collection</span>&lt;<b>string</b>&gt; <a id="503048c109cc874f" href="../R/503048c109cc874f.html" target="n" data-glyph="74,1" class="i method">GetGlobbedProviderPathsFromProviderPath</a>(
            <b>string</b> <span id="r66 rd" class="r66 r">path</span>,
            <b>bool</b> <span id="r67 rd" class="r67 r">allowNonexistingPaths</span>,
            <b>string</b> <span id="r68 rd" class="r68 r">providerId</span>,
            <b>out</b> <a href="../P/71826561229efd99.html#71826561229efd99" class="t t">CmdletProvider</a> <span id="r69 rd" class="r69 r">providerInstance</span>)
        {
            <span class="r69 r">providerInstance</span> = <b>null</b>;
 
            <b>if</b> (<span class="r66 r">path</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r66 r">path</span>));
            }
 
            <a href="CoreCommandContext.cs.html#1e83d35d5286e174" class="t t">CmdletProviderContext</a> <span id="r70 rd" class="r70 r">context</span> =
                <b>new</b> <a href="CoreCommandContext.cs.html#8a0e078b40b2fd0e" class="t constructor">CmdletProviderContext</a>(<a href="#06ecc54ac29ea6b5" class="i field">_sessionState</a>.<a href="../engine/SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../engine/SessionState.cs.html#3ddff2db6bc01805" class="i property">ExecutionContext</a>);
 
            <span class="i">Collection</span>&lt;<b>string</b>&gt; <span id="r71 rd" class="r71 r">results</span> =
                <a href="#316c771c5833f090" class="i method">GetGlobbedProviderPathsFromProviderPath</a>(
                    <span class="r66 r">path</span>,
                    <span class="r67 r">allowNonexistingPaths</span>,
                    <span class="r68 r">providerId</span>,
                    <span class="r70 r">context</span>,
                    <b>out</b> <span class="r69 r">providerInstance</span>);
 
            <b>if</b> (<span class="r70 r">context</span>.<a href="CoreCommandContext.cs.html#98adf40dae698aee" class="i method">HasErrors</a>())
            {
                <span class="c">// Throw the first error</span>
                <a href="../engine/ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r72 rd" class="r72 r">errorRecord</span> = <span class="r70 r">context</span>.<a href="CoreCommandContext.cs.html#0915d5820646740a" class="i method">GetAccumulatedErrorObjects</a>()[0];
 
                <b>if</b> (<span class="r72 r">errorRecord</span> != <b>null</b>)
                {
                    <b>throw</b> <span class="r72 r">errorRecord</span>.<a href="../engine/ErrorPackage.cs.html#2c2498db91e737eb" class="i property">Exception</a>;
                }
            }
 
            <b>return</b> <span class="r71 r">results</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Given a provider specific path that contains glob characters, this method</span>
        <span class="c">///</span><span class="c"> will perform the globbing using the specified provider and return the</span>
        <span class="c">///</span><span class="c"> matching provider specific paths.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r73 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path containing the glob characters to resolve. The path must be in the</span>
        <span class="c">///</span><span class="c"> form providerId::providerPath.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r74 r">allowNonexistingPaths</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If true, a ItemNotFoundException will not be thrown for non-existing</span>
        <span class="c">///</span><span class="c"> paths. Instead an appropriate path will be returned as if it did exist.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r75 r">providerId</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The provider identifier for the provider to use to do the globbing.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r76 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The context under which the command is occurring.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r77 r">providerInstance</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An instance of the provider that was used to perform the globbing.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An array of provider specific paths that match the glob path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r73 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">, </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r75 r">providerId</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">, or</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r76 r">context</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null.</span>
        <span class="c">///</span><span class="c">  </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#a58038dc730da896" class="t t">ProviderNotFoundException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r75 r">providerId</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> references a provider that does not exist.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">NotSupportedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r75 r">providerId</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> references a provider that is not</span>
        <span class="c">///</span><span class="c"> a ContainerCmdletProvider.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#35e07c15a7526bcd" class="t t">ProviderInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider used to build the path threw an exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r73 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> starts with &quot;~&quot; and the home location is not set for</span>
        <span class="c">///</span><span class="c"> the provider.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Any exception can be thrown by the provider that is called to build</span>
        <span class="c">///</span><span class="c"> the provider path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">Collection</span>&lt;<b>string</b>&gt; <a id="316c771c5833f090" href="../R/316c771c5833f090.html" target="n" data-glyph="74,1" class="i method">GetGlobbedProviderPathsFromProviderPath</a>(
            <b>string</b> <span id="r73 rd" class="r73 r">path</span>,
            <b>bool</b> <span id="r74 rd" class="r74 r">allowNonexistingPaths</span>,
            <b>string</b> <span id="r75 rd" class="r75 r">providerId</span>,
            <a href="CoreCommandContext.cs.html#1e83d35d5286e174" class="t t">CmdletProviderContext</a> <span id="r76 rd" class="r76 r">context</span>,
            <b>out</b> <a href="../P/71826561229efd99.html#71826561229efd99" class="t t">CmdletProvider</a> <span id="r77 rd" class="r77 r">providerInstance</span>)
        {
            <span class="r77 r">providerInstance</span> = <b>null</b>;
 
            <b>if</b> (<span class="r73 r">path</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r73 r">path</span>));
            }
 
            <b>if</b> (<span class="r75 r">providerId</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r75 r">providerId</span>));
            }
 
            <b>if</b> (<span class="r76 r">context</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r76 r">context</span>));
            }
 
            <b>using</b> (<a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#ff5e86462c8f4f03" class="i method">TraceScope</a>(<span class="s">&quot;Resolving PROVIDER-INTERNAL path \&quot;{0}\&quot; to PROVIDER-INTERNAL path&quot;</span>, <span class="r73 r">path</span>))
            {
                <a href="#2bf2d71caf7f9287" class="i method">TraceFilters</a>(<span class="r76 r">context</span>);
 
                <b>return</b> <a href="#26777aabb813c60c" class="i method">ResolveProviderPathFromProviderPath</a>(
                    <span class="r73 r">path</span>,
                    <span class="r75 r">providerId</span>,
                    <span class="r74 r">allowNonexistingPaths</span>,
                    <span class="r76 r">context</span>,
                    <b>out</b> <span class="r77 r">providerInstance</span>);
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Provider path to provider paths globbing
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Path manipulation
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets a provider specific path when given an Msh path without resolving the</span>
        <span class="c">///</span><span class="c"> glob characters.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r78 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An Msh path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A provider specific path that the Msh path represents.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r78 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#a58038dc730da896" class="t t">ProviderNotFoundException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the path is a provider-qualified path for a provider that is</span>
        <span class="c">///</span><span class="c"> not loaded into the system.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#09140e6dc875019b" class="t t">DriveNotFoundException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r78 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> refers to a drive that could not be found.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#35e07c15a7526bcd" class="t t">ProviderInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider used to build the path threw an exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">NotSupportedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider that the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r78 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> represents is not a NavigationCmdletProvider</span>
        <span class="c">///</span><span class="c"> or ContainerCmdletProvider.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r78 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> starts with &quot;~&quot; and the home location is not set for</span>
        <span class="c">///</span><span class="c"> the provider.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#35e07c15a7526bcd" class="t t">ProviderInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider specified by </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r78 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> threw an</span>
        <span class="c">///</span><span class="c"> exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Any exception can be thrown by the provider that is called to build</span>
        <span class="c">///</span><span class="c"> the provider path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal string</b> <a id="3dba41cc4d5fc83f" href="../R/3dba41cc4d5fc83f.html" target="n" data-glyph="74,1" class="i method">GetProviderPath</a>(<b>string</b> <span id="r78 rd" class="r78 r">path</span>)
        {
            <a href="../engine/DataStoreAdapterProvider.cs.html#dd4e1f2f8e73a1dd" class="t t">ProviderInfo</a> <span id="r79 rd" class="r79 r">provider</span> = <b>null</b>;
            <b>return</b> <a href="#b8ced6b564d69b01" class="i method">GetProviderPath</a>(<span class="r78 r">path</span>, <b>out</b> <span class="r79 r">provider</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets a provider specific path when given an Msh path without resolving the</span>
        <span class="c">///</span><span class="c"> glob characters.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r80 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An Msh path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r81 r">provider</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The information of the provider that was used to resolve the path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A provider specific path that the Msh path represents.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r80 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#a58038dc730da896" class="t t">ProviderNotFoundException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the path is a provider-qualified path for a provider that is</span>
        <span class="c">///</span><span class="c"> not loaded into the system.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#09140e6dc875019b" class="t t">DriveNotFoundException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r80 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> refers to a drive that could not be found.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#35e07c15a7526bcd" class="t t">ProviderInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider used to build the path threw an exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">NotSupportedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider that the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r80 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> represents is not a NavigationCmdletProvider</span>
        <span class="c">///</span><span class="c"> or ContainerCmdletProvider.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r80 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> starts with &quot;~&quot; and the home location is not set for</span>
        <span class="c">///</span><span class="c"> the provider.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#35e07c15a7526bcd" class="t t">ProviderInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider specified by </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r81 r">provider</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> threw an</span>
        <span class="c">///</span><span class="c"> exception when its GetParentPath or MakePath was called while</span>
        <span class="c">///</span><span class="c"> processing the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r80 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Any exception can be thrown by the provider that is called to build</span>
        <span class="c">///</span><span class="c"> the provider path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal string</b> <a id="b8ced6b564d69b01" href="../R/b8ced6b564d69b01.html" target="n" data-glyph="74,1" class="i method">GetProviderPath</a>(<b>string</b> <span id="r80 rd" class="r80 r">path</span>, <b>out</b> <a href="../engine/DataStoreAdapterProvider.cs.html#dd4e1f2f8e73a1dd" class="t t">ProviderInfo</a> <span id="r81 rd" class="r81 r">provider</span>)
        {
            <b>if</b> (<span class="r80 r">path</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r80 r">path</span>));
            }
 
            <a href="CoreCommandContext.cs.html#1e83d35d5286e174" class="t t">CmdletProviderContext</a> <span id="r82 rd" class="r82 r">context</span> =
                <b>new</b> <a href="CoreCommandContext.cs.html#8a0e078b40b2fd0e" class="t constructor">CmdletProviderContext</a>(<a href="#06ecc54ac29ea6b5" class="i field">_sessionState</a>.<a href="../engine/SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../engine/SessionState.cs.html#3ddff2db6bc01805" class="i property">ExecutionContext</a>);
 
            <a href="../engine/DataStoreAdapter.cs.html#2d16b26a541ba185" class="t t">PSDriveInfo</a> <span id="r83 rd" class="r83 r">drive</span> = <b>null</b>;
            <span class="r81 r">provider</span> = <b>null</b>;
 
            <b>string</b> <span id="r84 rd" class="r84 r">result</span> = <a href="#db13f265cc2244b4" class="i method">GetProviderPath</a>(<span class="r80 r">path</span>, <span class="r82 r">context</span>, <b>out</b> <span class="r81 r">provider</span>, <b>out</b> <span class="r83 r">drive</span>);
 
            <b>if</b> (<span class="r82 r">context</span>.<a href="CoreCommandContext.cs.html#98adf40dae698aee" class="i method">HasErrors</a>())
            {
                <span class="i">Collection</span>&lt;<a href="../engine/ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a>&gt; <span id="r85 rd" class="r85 r">errors</span> = <span class="r82 r">context</span>.<a href="CoreCommandContext.cs.html#0915d5820646740a" class="i method">GetAccumulatedErrorObjects</a>();
 
                <b>if</b> (<span class="r85 r">errors</span> != <b>null</b> &amp;&amp;
                    <span class="r85 r">errors</span>.<span class="i">Count</span> &gt; 0)
                {
                    <b>throw</b> <span class="r85 r">errors</span>[0].<span class="i">Exception</span>;
                }
            }
 
            <b>return</b> <span class="r84 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets a provider specific path when given an Msh path without resolving the</span>
        <span class="c">///</span><span class="c"> glob characters.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r86 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An Msh path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r87 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The context of the command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A provider specific path that the Msh path represents.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r86 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#a58038dc730da896" class="t t">ProviderNotFoundException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the path is a provider-qualified path for a provider that is</span>
        <span class="c">///</span><span class="c"> not loaded into the system.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#09140e6dc875019b" class="t t">DriveNotFoundException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r86 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> refers to a drive that could not be found.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#35e07c15a7526bcd" class="t t">ProviderInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider used to build the path threw an exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">NotSupportedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider that the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r86 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> represents is not a NavigationCmdletProvider</span>
        <span class="c">///</span><span class="c"> or ContainerCmdletProvider.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r86 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> starts with &quot;~&quot; and the home location is not set for</span>
        <span class="c">///</span><span class="c"> the provider.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#35e07c15a7526bcd" class="t t">ProviderInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider specified by </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="i">provider</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> threw an</span>
        <span class="c">///</span><span class="c"> exception when its GetParentPath or MakePath was called while</span>
        <span class="c">///</span><span class="c"> processing the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r86 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Any exception can be thrown by the provider that is called to build</span>
        <span class="c">///</span><span class="c"> the provider path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal string</b> <a id="11c999b7af9a2872" href="../R/11c999b7af9a2872.html" target="n" data-glyph="74,1" class="i method">GetProviderPath</a>(<b>string</b> <span id="r86 rd" class="r86 r">path</span>, <a href="CoreCommandContext.cs.html#1e83d35d5286e174" class="t t">CmdletProviderContext</a> <span id="r87 rd" class="r87 r">context</span>)
        {
            <b>if</b> (<span class="r86 r">path</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r86 r">path</span>));
            }
 
            <a href="../engine/DataStoreAdapter.cs.html#2d16b26a541ba185" class="t t">PSDriveInfo</a> <span id="r88 rd" class="r88 r">drive</span> = <b>null</b>;
            <a href="../engine/DataStoreAdapterProvider.cs.html#dd4e1f2f8e73a1dd" class="t t">ProviderInfo</a> <span id="r89 rd" class="r89 r">provider</span> = <b>null</b>;
 
            <b>string</b> <span id="r90 rd" class="r90 r">result</span> = <a href="#db13f265cc2244b4" class="i method">GetProviderPath</a>(<span class="r86 r">path</span>, <span class="r87 r">context</span>, <b>out</b> <span class="r89 r">provider</span>, <b>out</b> <span class="r88 r">drive</span>);
 
            <b>return</b> <span class="r90 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns a provider specific path for given PowerShell path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r91 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Either a PowerShell path or a provider path in the form providerId::providerPath</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r92 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The command context under which this operation is occurring.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r93 r">provider</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This parameter is filled with the provider information for the given path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r94 r">drive</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This parameter is filled with the PowerShell drive that represents the given path. If a</span>
        <span class="c">///</span><span class="c"> provider path is given drive will be null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The provider specific path generated from the given path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r91 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> or </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r92 r">context</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#a58038dc730da896" class="t t">ProviderNotFoundException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the path is a provider-qualified path for a provider that is</span>
        <span class="c">///</span><span class="c"> not loaded into the system.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#09140e6dc875019b" class="t t">DriveNotFoundException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r91 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> refers to a drive that could not be found.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#35e07c15a7526bcd" class="t t">ProviderInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider used to build the path threw an exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">NotSupportedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider that the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r91 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> represents is not a NavigationCmdletProvider</span>
        <span class="c">///</span><span class="c"> or ContainerCmdletProvider.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r91 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> starts with &quot;~&quot; and the home location is not set for</span>
        <span class="c">///</span><span class="c"> the provider.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#35e07c15a7526bcd" class="t t">ProviderInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider specified by </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r93 r">provider</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> threw an</span>
        <span class="c">///</span><span class="c"> exception when its GetParentPath or MakePath was called while</span>
        <span class="c">///</span><span class="c"> processing the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r91 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal string</b> <a id="db13f265cc2244b4" href="../R/db13f265cc2244b4.html" target="n" data-glyph="74,1" class="i method">GetProviderPath</a>(
            <b>string</b> <span id="r91 rd" class="r91 r">path</span>,
            <a href="CoreCommandContext.cs.html#1e83d35d5286e174" class="t t">CmdletProviderContext</a> <span id="r92 rd" class="r92 r">context</span>,
            <b>out</b> <a href="../engine/DataStoreAdapterProvider.cs.html#dd4e1f2f8e73a1dd" class="t t">ProviderInfo</a> <span id="r93 rd" class="r93 r">provider</span>,
            <b>out</b> <a href="../engine/DataStoreAdapter.cs.html#2d16b26a541ba185" class="t t">PSDriveInfo</a> <span id="r94 rd" class="r94 r">drive</span>)
        {
            <b>return</b> <a href="#f6fd2f81be49235c" class="i method">GetProviderPath</a>(
                <span class="r91 r">path</span>,
                <span class="r92 r">context</span>,
                <b>false</b>,
                <b>out</b> <span class="r93 r">provider</span>,
                <b>out</b> <span class="r94 r">drive</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns a provider specific path for given PowerShell path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r95 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Path to resolve.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r96 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Cmdlet context.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r97 r">isTrusted</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">When true bypass trust check.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r98 r">provider</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Provider.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r99 r">drive</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Drive.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal string</b> <a id="f6fd2f81be49235c" href="../R/f6fd2f81be49235c.html" target="n" data-glyph="74,1" class="i method">GetProviderPath</a>(
            <b>string</b> <span id="r95 rd" class="r95 r">path</span>,
            <a href="CoreCommandContext.cs.html#1e83d35d5286e174" class="t t">CmdletProviderContext</a> <span id="r96 rd" class="r96 r">context</span>,
            <b>bool</b> <span id="r97 rd" class="r97 r">isTrusted</span>,
            <b>out</b> <a href="../engine/DataStoreAdapterProvider.cs.html#dd4e1f2f8e73a1dd" class="t t">ProviderInfo</a> <span id="r98 rd" class="r98 r">provider</span>,
            <b>out</b> <a href="../engine/DataStoreAdapter.cs.html#2d16b26a541ba185" class="t t">PSDriveInfo</a> <span id="r99 rd" class="r99 r">drive</span>)
        {
            <b>if</b> (<span class="r95 r">path</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r95 r">path</span>));
            }
 
            <b>if</b> (<span class="r96 r">context</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r96 r">context</span>));
            }
 
            <b>string</b> <span id="r100 rd" class="r100 r">result</span> = <b>null</b>;
            <span class="r98 r">provider</span> = <b>null</b>;
            <span class="r99 r">drive</span> = <b>null</b>;
 
            <span class="c">// First check to see if the path starts with a ~ (home)</span>
            <b>if</b> (<a href="#48978d46f1040a39" class="i method">IsHomePath</a>(<span class="r95 r">path</span>))
            {
                <b>using</b> (<a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#19ce116f88d7b1c7" class="i method">TraceScope</a>(<span class="s">&quot;Resolving HOME relative path.&quot;</span>))
                {
                    <span class="r95 r">path</span> = <a href="#a5b7e35a38a3d24c" class="i method">GetHomeRelativePath</a>(<span class="r95 r">path</span>);
                }
            }
 
            <span class="c">// Now check to see if it is a provider-direct path (starts with // or \\)</span>
            <b>if</b> (<a href="#f0c7a79be5b8b12b" class="i method">IsProviderDirectPath</a>(<span class="r95 r">path</span>))
            {
                <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#96aaf3813a5962a0" class="i method">WriteLine</a>(<span class="s">&quot;Path is PROVIDER-DIRECT&quot;</span>);
 
                <span class="c">// just return the path directly using the current provider</span>
 
                <span class="r100 r">result</span> = <span class="r95 r">path</span>;
                <span class="r99 r">drive</span> = <b>null</b>;
                <span class="r98 r">provider</span> = <a href="#06ecc54ac29ea6b5" class="i field">_sessionState</a>.<a href="../engine/SessionStatePublic.cs.html#3390cfbbdcffb036" class="i property">Path</a>.<a href="../engine/PathInterfaces.cs.html#91ffa5f8fc6b1308" class="i property">CurrentLocation</a>.<a href="PathInfo.cs.html#223c6ebf64760c0d" class="i property">Provider</a>;
 
                <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;PROVIDER-INTERNAL path: {0}&quot;</span>, <span class="r100 r">result</span>);
                <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Provider: {0}&quot;</span>, <span class="r98 r">provider</span>);
            }
            <b>else</b> <b>if</b> (<a href="#45d8fc5f64551b7a" class="i method">IsProviderQualifiedPath</a>(<span class="r95 r">path</span>))
            {
                <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#96aaf3813a5962a0" class="i method">WriteLine</a>(<span class="s">&quot;Path is PROVIDER-QUALIFIED&quot;</span>);
 
                <b>string</b> <span id="r101 rd" class="r101 r">providerId</span> = <b>null</b>;
                <span class="r100 r">result</span> = <a href="#d0dba4efed9d6237" class="i method">ParseProviderPath</a>(<span class="r95 r">path</span>, <b>out</b> <span class="r101 r">providerId</span>);
                <span class="r99 r">drive</span> = <b>null</b>;
 
                <span class="c">// Get the provider info</span>
                <span class="r98 r">provider</span> = <a href="#06ecc54ac29ea6b5" class="i field">_sessionState</a>.<a href="../engine/SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../engine/SessionStateProviderAPIs.cs.html#02cfdb64abb0b450" class="i method">GetSingleProvider</a>(<span class="r101 r">providerId</span>);
 
                <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;PROVIDER-INTERNAL path: {0}&quot;</span>, <span class="r100 r">result</span>);
                <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Provider: {0}&quot;</span>, <span class="r98 r">provider</span>);
            }
            <b>else</b>
            {
                <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#96aaf3813a5962a0" class="i method">WriteLine</a>(<span class="s">&quot;Path is DRIVE-QUALIFIED&quot;</span>);
 
                <a href="../P/71826561229efd99.html#71826561229efd99" class="t t">CmdletProvider</a> <span id="r102 rd" class="r102 r">providerInstance</span> = <b>null</b>;
                <b>string</b> <span id="r103 rd" class="r103 r">relativePath</span> = <a href="#f49d56a83aca7f33" class="i method">GetDriveRootRelativePathFromPSPath</a>(<span class="r95 r">path</span>, <span class="r96 r">context</span>, <b>false</b>, <b>out</b> <span class="r99 r">drive</span>, <b>out</b> <span class="r102 r">providerInstance</span>);
 
                <span class="i n">Dbg</span>.<a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(
                    <span class="r99 r">drive</span> != <b>null</b>,
                    <span class="s">&quot;GetDriveRootRelativePathFromPSPath should always return a valid drive&quot;</span>);
 
                <span class="i n">Dbg</span>.<a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<span class="i">Assert</span>(
                    <span class="r103 r">relativePath</span> != <b>null</b>,
                    <span class="s">&quot;There should always be a way to generate a provider path for a &quot;</span> +
                    <span class="s">&quot;given path&quot;</span>);
 
                <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;DRIVE-RELATIVE path: {0}&quot;</span>, <span class="r103 r">relativePath</span>);
                <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Drive: {0}&quot;</span>, <span class="r99 r">drive</span>.<a href="../engine/DataStoreAdapter.cs.html#7c2d83a1b2b425a9" class="i property">Name</a>);
                <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Provider: {0}&quot;</span>, <span class="r99 r">drive</span>.<a href="../engine/DataStoreAdapter.cs.html#599e6ea3519fc2d6" class="i property">Provider</a>);
 
                <span class="c">// Associate the drive with the context</span>
 
                <span class="r96 r">context</span>.<a href="CoreCommandContext.cs.html#f037b19aae477b8f" class="i property">Drive</a> = <span class="r99 r">drive</span>;
 
                <b>if</b> (<span class="r99 r">drive</span>.<a href="../engine/DataStoreAdapter.cs.html#27d719becccdef1a" class="i property">Hidden</a>)
                {
                    <span class="r100 r">result</span> = <span class="r103 r">relativePath</span>;
                }
                <b>else</b>
                {
                    <span class="r100 r">result</span> = <a href="#5b38754e2493a8d5" class="i method">GetProviderSpecificPath</a>(<span class="r99 r">drive</span>, <span class="r103 r">relativePath</span>, <span class="r96 r">context</span>);
                }
 
                <span class="r98 r">provider</span> = <span class="r99 r">drive</span>.<a href="../engine/DataStoreAdapter.cs.html#599e6ea3519fc2d6" class="i property">Provider</a>;
            }
 
            <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;RESOLVED PATH: {0}&quot;</span>, <span class="r100 r">result</span>);
 
            <span class="c">// If this is a private provider, don&#39;t allow access to it directly from the runspace.</span>
            <b>if</b> ((<span class="r98 r">provider</span> != <b>null</b>) &amp;&amp;
                (<span class="r96 r">context</span> != <b>null</b>) &amp;&amp;
                (<span class="r96 r">context</span>.<a href="CoreCommandContext.cs.html#564b4e39ec1a78d8" class="i property">MyInvocation</a> != <b>null</b>) &amp;&amp;
                (<span class="r96 r">context</span>.<a href="CoreCommandContext.cs.html#6e235b353e90f247" class="i property">ExecutionContext</a> != <b>null</b>) &amp;&amp;
                (<span class="r96 r">context</span>.<a href="CoreCommandContext.cs.html#6e235b353e90f247" class="i property">ExecutionContext</a>.<a href="../engine/ExecutionContext.cs.html#2a82be710f3773ae" class="i property">InitialSessionState</a> != <b>null</b>))
            {
                <b>foreach</b> (<span class="i n">Runspaces</span>.<a href="../engine/InitialSessionState.cs.html#236a07b6fd3f0e39" class="t t">SessionStateProviderEntry</a> <span id="r104 rd" class="r104 r">sessionStateProvider</span> <b>in</b> <span class="r96 r">context</span>.<a href="CoreCommandContext.cs.html#6e235b353e90f247" class="i property">ExecutionContext</a>.<a href="../engine/ExecutionContext.cs.html#2a82be710f3773ae" class="i property">InitialSessionState</a>.<a href="../engine/InitialSessionState.cs.html#901a2e8b67c4db16" class="i property">Providers</a><a href="../engine/InitialSessionState.cs.html#8a6a2b8d34f0d716">[</a><span class="r98 r">provider</span>.<a href="../engine/DataStoreAdapterProvider.cs.html#2837d805ea30ef5c" class="i property">Name</a>])
                {
                    <b>if</b> (!<span class="r97 r">isTrusted</span> &amp;&amp;
                        (<span class="r104 r">sessionStateProvider</span>.<a href="../engine/InitialSessionState.cs.html#190a59133ab9a4ce" class="i property">Visibility</a> == <a href="../engine/SessionStatePublic.cs.html#3acdda74c688180a" class="t t">SessionStateEntryVisibility</a>.<a href="../engine/SessionStatePublic.cs.html#9412d519f56b8001" class="i field">Private</a>) &amp;&amp;
                        (<span class="r96 r">context</span>.<a href="CoreCommandContext.cs.html#564b4e39ec1a78d8" class="i property">MyInvocation</a>.<a href="../engine/InvocationInfo.cs.html#02c0f35838462a5e" class="i property">CommandOrigin</a> == <a href="../engine/SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a>.<a href="../engine/SecurityManagerBase.cs.html#66a89eb31c003ba5" class="i field">Runspace</a>))
                    {
                        <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Provider is private: {0}&quot;</span>, <span class="r98 r">provider</span>.<a href="../engine/DataStoreAdapterProvider.cs.html#2837d805ea30ef5c" class="i property">Name</a>);
 
                        <b>throw</b> <b>new</b> <span class="t">ProviderNotFoundException</span>(
                            <span class="r98 r">provider</span>.<a href="../engine/DataStoreAdapterProvider.cs.html#2837d805ea30ef5c" class="i property">Name</a>,
                            <a href="../utils/SessionStateExceptions.cs.html#22b8ef04eadcf731" class="t t">SessionStateCategory</a>.<a href="../utils/SessionStateExceptions.cs.html#3e9b2052f3ab0f37" class="i field">CmdletProvider</a>,
                            <span class="s">&quot;ProviderNotFound&quot;</span>,
                            <span class="i">SessionStateStrings</span>.<span class="i">ProviderNotFound</span>);
                    }
                }
            }
 
            <b>return</b> <span class="r100 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Determines if the specified path is a provider. This is done by looking for</span>
        <span class="c">///</span><span class="c"> two colons in a row. Anything before the colons is considered the provider ID,</span>
        <span class="c">///</span><span class="c"> and everything after is considered a namespace specific path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r105 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to check to see if it is a provider path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> True if the path is a provider path, false otherwise.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r105 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="45d8fc5f64551b7a" href="../R/45d8fc5f64551b7a.html" target="n" data-glyph="74,1" class="i method">IsProviderQualifiedPath</a>(<b>string</b> <span id="r105 rd" class="r105 r">path</span>)
        {
            <b>string</b> <span id="r106 rd" class="r106 r">providerId</span> = <b>null</b>;
            <b>return</b> <a href="#2f4f3b61ed10dbc4" class="i method">IsProviderQualifiedPath</a>(<span class="r105 r">path</span>, <b>out</b> <span class="r106 r">providerId</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Determines if the specified path is a provider. This is done by looking for</span>
        <span class="c">///</span><span class="c"> two colons in a row. Anything before the colons is considered the provider ID,</span>
        <span class="c">///</span><span class="c"> and everything after is considered a namespace specific path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r107 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to check to see if it is a provider path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r108 r">providerId</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The name of the provider if the path is a provider qualified path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> True if the path is a provider path, false otherwise.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r107 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="2f4f3b61ed10dbc4" href="../R/2f4f3b61ed10dbc4.html" target="n" data-glyph="74,1" class="i method">IsProviderQualifiedPath</a>(<b>string</b> <span id="r107 rd" class="r107 r">path</span>, <b>out string</b> <span id="r108 rd" class="r108 r">providerId</span>)
        {
            <span class="c">// Verify parameters</span>
 
            <b>if</b> (<span class="r107 r">path</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r107 r">path</span>));
            }
 
            <span class="r108 r">providerId</span> = <b>null</b>;
            <b>bool</b> <span id="r109 rd" class="r109 r">result</span> = <b>false</b>;
 
            <b>do</b>
            {
                <b>if</b> (<span class="r107 r">path</span>.<span class="i">Length</span> == 0)
                {
                    <span class="c">// The current working directory is specified</span>
 
                    <span class="r109 r">result</span> = <b>false</b>;
                    <b>break</b>;
                }
 
                <b>if</b> (<span class="r107 r">path</span>.<span class="i">StartsWith</span>(<span class="s">@&quot;.\&quot;</span>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>) ||
                    <span class="r107 r">path</span>.<span class="i">StartsWith</span>(<span class="s">@&quot;./&quot;</span>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>))
                {
                    <span class="c">// The .\ prefix basically escapes anything that follows</span>
                    <span class="c">// so treat it as a relative path no matter what comes</span>
                    <span class="c">// after it.</span>
 
                    <span class="r109 r">result</span> = <b>false</b>;
                    <b>break</b>;
                }
 
                <b>int</b> <span id="r110 rd" class="r110 r">index</span> = <span class="r107 r">path</span>.<span class="i">IndexOf</span>(<span class="s">&#39;:&#39;</span>);
                <b>if</b> (<span class="r110 r">index</span> == -1 || <span class="r110 r">index</span> + 1 &gt;= <span class="r107 r">path</span>.<span class="i">Length</span> || <span class="r107 r">path</span>[<span class="r110 r">index</span> + 1] != <span class="s">&#39;:&#39;</span>)
                {
                    <span class="c">// If there is no : then the path is relative to the</span>
                    <span class="c">// current working drive</span>
 
                    <span class="r109 r">result</span> = <b>false</b>;
                    <b>break</b>;
                }
 
                <span class="c">// If the :: is the first two character in the path then we</span>
                <span class="c">// must assume that it is part of the path, and not</span>
                <span class="c">// delimiting the drive name.</span>
 
                <b>if</b> (<span class="r110 r">index</span> &gt; 0)
                {
                    <span class="r109 r">result</span> = <b>true</b>;
 
                    <span class="c">// Get the provider ID</span>
 
                    <span class="r108 r">providerId</span> = <span class="r107 r">path</span>.<span class="i">Substring</span>(0, <span class="r110 r">index</span>);
 
                    <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;providerId = {0}&quot;</span>, <span class="r108 r">providerId</span>);
                }
            } <b>while</b> (<b>false</b>);
 
            <b>return</b> <span class="r109 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Determines if the given path is absolute while on a single root filesystem.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Porting notes: absolute paths on non-Windows filesystems start with a &#39;/&#39; (no &quot;C:&quot; drive</span>
        <span class="c">///</span><span class="c"> prefix, the slash is the prefix). We compare against both &#39;/&#39; and &#39;\&#39; (default and</span>
        <span class="c">///</span><span class="c"> alternate path separator) in order for PowerShell to be slash agnostic.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r111 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path used in the determination</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns true if we&#39;re on a single root filesystem and the path is absolute.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="8c254b695f60d50c" href="../R/8c254b695f60d50c.html" target="n" data-glyph="74,1" class="i method">IsSingleFileSystemAbsolutePath</a>(<b>string</b> <span id="r111 rd" class="r111 r">path</span>)
        {
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">UNIX</span>
<span class="e">            return path.StartsWith(StringLiterals.DefaultPathSeparator)
                || path.StartsWith(StringLiterals.AlternatePathSeparator);
</span><span class="k preprocess">#</span><span class="k preprocess">else</span>
            <b>return</b> <b>false</b>;
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Determines if the given path is relative or absolute.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r112 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path used in the determination</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> true if the path is an absolute path, false otherwise.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r112 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="4cd70f3f191704a0" href="../R/4cd70f3f191704a0.html" target="n" data-glyph="74,1" class="i method">IsAbsolutePath</a>(<b>string</b> <span id="r112 rd" class="r112 r">path</span>)
        {
            <span class="c">// Verify parameters</span>
 
            <b>if</b> (<span class="r112 r">path</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r112 r">path</span>));
            }
 
            <b>bool</b> <span id="r113 rd" class="r113 r">result</span> = <b>false</b>;
 
            <b>do</b>
            {
                <b>if</b> (<span class="r112 r">path</span>.<span class="i">Length</span> == 0)
                {
                    <span class="c">// The current working directory is specified</span>
 
                    <span class="r113 r">result</span> = <b>false</b>;
                    <b>break</b>;
                }
 
                <span class="c">// compare both to \ and / here</span>
                <b>if</b> (<span class="r112 r">path</span>.<span class="i">StartsWith</span>(<span class="s">@&quot;.\&quot;</span>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>) ||
                    <span class="r112 r">path</span>.<span class="i">StartsWith</span>(<span class="s">@&quot;./&quot;</span>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>))
                {
                    <span class="c">// The .\ prefix basically escapes anything that follows</span>
                    <span class="c">// so treat it as a relative path no matter what comes</span>
                    <span class="c">// after it.</span>
 
                    <span class="r113 r">result</span> = <b>false</b>;
                    <b>break</b>;
                }
 
                <span class="c">// check if we&#39;re on a single root filesystem and it&#39;s an absolute path</span>
                <b>if</b> (<a href="#8c254b695f60d50c" class="i method">IsSingleFileSystemAbsolutePath</a>(<span class="r112 r">path</span>))
                {
                    <span class="r113 r">result</span> = <b>true</b>;
                    <b>break</b>;
                }
 
                <b>int</b> <span id="r114 rd" class="r114 r">index</span> = <span class="r112 r">path</span>.<span class="i">IndexOf</span>(<span class="s">&#39;:&#39;</span>);
 
                <b>if</b> (<span class="r114 r">index</span> == -1)
                {
                    <span class="c">// If there is no : then the path is relative to the</span>
                    <span class="c">// current working drive</span>
 
                    <span class="r113 r">result</span> = <b>false</b>;
                    <b>break</b>;
                }
 
                <span class="c">// If the : is the first character in the path then we</span>
                <span class="c">// must assume that it is part of the path, and not</span>
                <span class="c">// delimiting the drive name.</span>
 
                <b>if</b> (<span class="r114 r">index</span> &gt; 0)
                {
                    <span class="c">// see if there are any path separators before the colon which would mean the</span>
                    <span class="c">// colon is part of a file or folder name and not a drive: ./foo:bar vs foo:bar</span>
                    <b>int</b> <span id="r115 rd" class="r115 r">separator</span> = <span class="r112 r">path</span>.<span class="i">IndexOf</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a>, 0, <span class="r114 r">index</span> - 1);
                    <b>if</b> (<span class="r115 r">separator</span> == -1)
                    {
                        <span class="r115 r">separator</span> = <span class="r112 r">path</span>.<span class="i">IndexOf</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#f2548f0f61690656" class="i field">AlternatePathSeparator</a>, 0, <span class="r114 r">index</span> - 1);
                    }
 
                    <b>if</b> (<span class="r115 r">separator</span> == -1 || <span class="r114 r">index</span> &lt; <span class="r115 r">separator</span>)
                    {
                        <span class="c">// We must have a drive specified</span>
                        <span class="r113 r">result</span> = <b>true</b>;
                    }
                }
            } <b>while</b> (<b>false</b>);
 
            <b>return</b> <span class="r113 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Determines if the given path is relative or absolute.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r116 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path used in the determination</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r117 r">driveName</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the path is absolute, this out parameter will be the</span>
        <span class="c">///</span><span class="c"> drive name of the drive that is referenced.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> true if the path is an absolute path, false otherwise.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="05183b55d060d7bb" href="../R/05183b55d060d7bb.html" target="n" data-glyph="74,1" class="i method">IsAbsolutePath</a>(<b>string</b> <span id="r116 rd" class="r116 r">path</span>, <b>out string</b> <span id="r117 rd" class="r117 r">driveName</span>)
        {
            <span class="c">// Verify parameters</span>
 
            <b>if</b> (<span class="r116 r">path</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r116 r">path</span>));
            }
 
            <b>bool</b> <span id="r118 rd" class="r118 r">result</span> = <b>false</b>;
 
            <b>if</b> (<a href="#06ecc54ac29ea6b5" class="i field">_sessionState</a>.<a href="../engine/SessionStatePublic.cs.html#49ff6e2d0769f2e2" class="i property">Drive</a>.<a href="../engine/DriveInterfaces.cs.html#ad95755a5d797edb" class="i property">Current</a> != <b>null</b>)
            {
                <span class="r117 r">driveName</span> = <a href="#06ecc54ac29ea6b5" class="i field">_sessionState</a>.<a href="../engine/SessionStatePublic.cs.html#49ff6e2d0769f2e2" class="i property">Drive</a>.<a href="../engine/DriveInterfaces.cs.html#ad95755a5d797edb" class="i property">Current</a>.<a href="../engine/DataStoreAdapter.cs.html#7c2d83a1b2b425a9" class="i property">Name</a>;
            }
            <b>else</b>
            {
                <span class="r117 r">driveName</span> = <b>null</b>;
            }
 
            <b>do</b>
            {
                <b>if</b> (<span class="r116 r">path</span>.<span class="i">Length</span> == 0)
                {
                    <span class="c">// The current working directory is specified</span>
 
                    <span class="r118 r">result</span> = <b>false</b>;
                    <b>break</b>;
                }
 
                <b>if</b> (<span class="r116 r">path</span>.<span class="i">StartsWith</span>(<span class="s">@&quot;.\&quot;</span>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>) ||
                    <span class="r116 r">path</span>.<span class="i">StartsWith</span>(<span class="s">@&quot;./&quot;</span>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>))
                {
                    <span class="c">// The .\ prefix basically escapes anything that follows</span>
                    <span class="c">// so treat it as a relative path no matter what comes</span>
                    <span class="c">// after it.</span>
 
                    <span class="r118 r">result</span> = <b>false</b>;
                    <b>break</b>;
                }
 
                <span class="c">// check if we&#39;re on a single root filesystem and it&#39;s an absolute path</span>
                <b>if</b> (<a href="#8c254b695f60d50c" class="i method">IsSingleFileSystemAbsolutePath</a>(<span class="r116 r">path</span>))
                {
                    <span class="r117 r">driveName</span> = <a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#b7c0e8f5832a0fb6" class="i field">DefaultPathSeparatorString</a>;
                    <span class="r118 r">result</span> = <b>true</b>;
                    <b>break</b>;
                }
 
                <b>int</b> <span id="r119 rd" class="r119 r">index</span> = <span class="r116 r">path</span>.<span class="i">IndexOf</span>(<span class="s">&#39;:&#39;</span>);
 
                <b>if</b> (<span class="r119 r">index</span> == -1)
                {
                    <span class="c">// If there is no : then the path is relative to the</span>
                    <span class="c">// current working drive</span>
 
                    <span class="r118 r">result</span> = <b>false</b>;
                    <b>break</b>;
                }
 
                <span class="c">// If the : is the first character in the path then we</span>
                <span class="c">// must assume that it is part of the path, and not</span>
                <span class="c">// delimiting the drive name.</span>
 
                <b>if</b> (<span class="r119 r">index</span> &gt; 0)
                {
                    <span class="c">// We must have a drive specified</span>
                    <span class="r117 r">driveName</span> = <span class="r116 r">path</span>.<span class="i">Substring</span>(0, <span class="r119 r">index</span>);
 
                    <span class="r118 r">result</span> = <b>true</b>;
                }
            } <b>while</b> (<b>false</b>);
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">DEBUG</span>
            <b>if</b> (<span class="r118 r">result</span>)
            {
                <span class="i n">Dbg</span>.<a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<span class="i">Assert</span>(
                    <span class="r117 r">driveName</span> != <b>null</b>,
                    <span class="s">&quot;The drive name should always have a value, &quot;</span> +
                    <span class="s">&quot;the default is the current working drive&quot;</span>);
 
                <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(
                    <span class="s">&quot;driveName = {0}&quot;</span>,
                    <span class="r117 r">driveName</span>);
            }
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
 
            <b>return</b> <span class="r118 r">result</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Path manipulation
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Public methods
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> private fields and methods
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The instance of session state on which this globber acts.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private readonly</b> <a href="../engine/SessionStatePublic.cs.html#0a202aa6b2d52930" class="t t">SessionState</a> <a id="06ecc54ac29ea6b5" href="../R/06ecc54ac29ea6b5.html" target="n" data-glyph="46,1" class="i field">_sessionState</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Removes the back tick &quot;`&quot; from any of the glob characters in the path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r120 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to remove the glob escaping from.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path with the glob characters unescaped.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r120 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>private static string</b> <a id="aca636e8bca803e1" href="../R/aca636e8bca803e1.html" target="n" data-glyph="76,1" class="i method">RemoveGlobEscaping</a>(<b>string</b> <span id="r120 rd" class="r120 r">path</span>)
        {
            <b>if</b> (<span class="r120 r">path</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r120 r">path</span>));
            }
 
            <b>string</b> <span id="r121 rd" class="r121 r">result</span> = <a href="../engine/regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../engine/regex.cs.html#b15b1eaf2241823c" class="i method">Unescape</a>(<span class="r120 r">path</span>);
 
            <b>return</b> <span class="r121 r">result</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Path manipulation methods
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Determines if the given drive name is a &quot;special&quot; name defined</span>
        <span class="c">///</span><span class="c"> by the shell. For instance, &quot;default&quot;, &quot;current&quot;, &quot;global&quot;, and &quot;scope[##]&quot; are scopes</span>
        <span class="c">///</span><span class="c"> for variables and are considered shell virtual drives.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r122 r">driveName</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The name of the drive to check to see if it is a shell virtual drive.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r123 r">scope</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This out parameter is filled with the scope that the drive name represents.</span>
        <span class="c">///</span><span class="c"> It will be null if the driveName does not represent a scope.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> true, if the drive name is a shell virtual drive like &quot;Default&quot; or &quot;global&quot;,</span>
        <span class="c">///</span><span class="c"> false otherwise.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r122 r">driveName</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The comparison is done using a case-insensitive comparison using the</span>
        <span class="c">///</span><span class="c"> Invariant culture.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> This is internal so that it is accessible to SessionState.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r122 r">driveName</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="6c7deaee0baa9a15" href="../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">IsShellVirtualDrive</a>(<b>string</b> <span id="r122 rd" class="r122 r">driveName</span>, <b>out</b> <a href="../engine/SessionStateScope.cs.html#460261155e0163cb" class="t t">SessionStateScope</a> <span id="r123 rd" class="r123 r">scope</span>)
        {
            <b>if</b> (<span class="r122 r">driveName</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r122 r">driveName</span>));
            }
 
            <b>bool</b> <span id="r124 rd" class="r124 r">result</span> = <b>false</b>;
 
            <b>if</b> (<b>string</b>.<span class="i">Equals</span>(
                    <span class="r122 r">driveName</span>,
                    <a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#76950d3d9588bb8a" class="i field">Global</a>,
                    <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="c">// It&#39;s the global scope.</span>
                <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;match found: {0}&quot;</span>, <a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#76950d3d9588bb8a" class="i field">Global</a>);
                <span class="r124 r">result</span> = <b>true</b>;
                <span class="r123 r">scope</span> = <a href="#06ecc54ac29ea6b5" class="i field">_sessionState</a>.<a href="../engine/SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../engine/SessionStateScopeAPIs.cs.html#2b591e85d7ead426" class="i property">GlobalScope</a>;
            }
            <b>else</b> <b>if</b> (<b>string</b>.<span class="i">Equals</span>(
                        <span class="r122 r">driveName</span>,
                        <a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#17a9ff531b8319f7" class="i field">Local</a>,
                        <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="c">// It&#39;s the local scope.</span>
                <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;match found: {0}&quot;</span>, <span class="r122 r">driveName</span>);
                <span class="r124 r">result</span> = <b>true</b>;
                <span class="r123 r">scope</span> = <a href="#06ecc54ac29ea6b5" class="i field">_sessionState</a>.<a href="../engine/SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../engine/SessionStateScopeAPIs.cs.html#224987ad36a90f88" class="i property">CurrentScope</a>;
            }
            <b>else</b>
            {
                <span class="r123 r">scope</span> = <b>null</b>;
            }
 
            <b>return</b> <span class="r124 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets a provider specific path that represents the specified path and is relative</span>
        <span class="c">///</span><span class="c"> to the root of the PowerShell drive.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r125 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Can be a relative or absolute path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r126 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The context which the core command is running.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r127 r">escapeCurrentLocation</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Escape the wildcards in the current location.  Use when this path will be</span>
        <span class="c">///</span><span class="c"> passed through globbing.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r128 r">workingDriveForPath</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This out parameter returns the drive that was specified</span>
        <span class="c">///</span><span class="c"> by the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r125 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">. If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r125 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is</span>
        <span class="c">///</span><span class="c"> an absolute path this value may be something other than</span>
        <span class="c">///</span><span class="c"> the current working drive.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> If the path refers to a non-existent drive, this parameter is set to null, and an exception is thrown.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r129 r">providerInstance</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The provider instance that was used.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A provider specific relative path to the root of the drive.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path is parsed to determine if it is a relative path to the</span>
        <span class="c">///</span><span class="c"> current working drive or if it is an absolute path. If</span>
        <span class="c">///</span><span class="c"> it is a relative path the provider specific path is generated using the current</span>
        <span class="c">///</span><span class="c"> working directory, the drive root, and the path specified.</span>
        <span class="c">///</span><span class="c"> If the path is an absolute path the provider specific path is generated by stripping</span>
        <span class="c">///</span><span class="c"> of anything before the : and using that to find the appropriate</span>
        <span class="c">///</span><span class="c"> drive. The provider specific path is then generated the same as the</span>
        <span class="c">///</span><span class="c"> relative path using the specified drive instead of the</span>
        <span class="c">///</span><span class="c"> current working drive.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> This is internal so that it can be called from SessionState</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r125 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#09140e6dc875019b" class="t t">DriveNotFoundException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r125 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> refers to a drive that could not be found.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#35e07c15a7526bcd" class="t t">ProviderInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider specified by </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="i">providerId</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> threw an</span>
        <span class="c">///</span><span class="c"> exception when its GetParentPath or MakePath was called while</span>
        <span class="c">///</span><span class="c"> processing the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r125 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">NotSupportedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider is not a NavigationCmdletProvider.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r126 r">context</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> has been signaled for</span>
        <span class="c">///</span><span class="c"> StopProcessing.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal string</b> <a id="f49d56a83aca7f33" href="../R/f49d56a83aca7f33.html" target="n" data-glyph="74,1" class="i method">GetDriveRootRelativePathFromPSPath</a>(
            <b>string</b> <span id="r125 rd" class="r125 r">path</span>,
            <a href="CoreCommandContext.cs.html#1e83d35d5286e174" class="t t">CmdletProviderContext</a> <span id="r126 rd" class="r126 r">context</span>,
            <b>bool</b> <span id="r127 rd" class="r127 r">escapeCurrentLocation</span>,
            <b>out</b> <a href="../engine/DataStoreAdapter.cs.html#2d16b26a541ba185" class="t t">PSDriveInfo</a> <span id="r128 rd" class="r128 r">workingDriveForPath</span>,
            <b>out</b> <a href="../P/71826561229efd99.html#71826561229efd99" class="t t">CmdletProvider</a> <span id="r129 rd" class="r129 r">providerInstance</span>)
        {
            <span class="c">// Verify parameters</span>
 
            <b>if</b> (<span class="r125 r">path</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r125 r">path</span>));
            }
 
            <span class="r128 r">workingDriveForPath</span> = <b>null</b>;
            <b>string</b> <span id="r130 rd" class="r130 r">driveName</span> = <b>null</b>;
 
            <b>if</b> (<a href="#06ecc54ac29ea6b5" class="i field">_sessionState</a>.<a href="../engine/SessionStatePublic.cs.html#49ff6e2d0769f2e2" class="i property">Drive</a>.<a href="../engine/DriveInterfaces.cs.html#ad95755a5d797edb" class="i property">Current</a> != <b>null</b>)
            {
                <span class="r130 r">driveName</span> = <a href="#06ecc54ac29ea6b5" class="i field">_sessionState</a>.<a href="../engine/SessionStatePublic.cs.html#49ff6e2d0769f2e2" class="i property">Drive</a>.<a href="../engine/DriveInterfaces.cs.html#ad95755a5d797edb" class="i property">Current</a>.<a href="../engine/DataStoreAdapter.cs.html#7c2d83a1b2b425a9" class="i property">Name</a>;
            }
 
            <span class="c">// Check to see if the path is relative or absolute</span>
            <b>bool</b> <span id="r131 rd" class="r131 r">isPathForCurrentDrive</span> = <b>false</b>;
 
            <b>if</b> (<a href="#05183b55d060d7bb" class="i method">IsAbsolutePath</a>(<span class="r125 r">path</span>, <b>out</b> <span class="r130 r">driveName</span>))
            {
                <span class="i n">Dbg</span>.<a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(
                    <span class="r130 r">driveName</span> != <b>null</b>,
                    <span class="s">&quot;IsAbsolutePath should be returning the drive name&quot;</span>);
 
                <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(
                    <span class="s">&quot;Drive Name: {0}&quot;</span>,
                    <span class="r130 r">driveName</span>);
 
                <span class="c">// This will resolve $GLOBAL, and $LOCAL as needed.</span>
                <span class="c">// This throws DriveNotFoundException if a drive of the specified</span>
                <span class="c">// name does not exist. Just let the exception propagate out.</span>
                <b>try</b>
                {
                    <span class="r128 r">workingDriveForPath</span> = <a href="#06ecc54ac29ea6b5" class="i field">_sessionState</a>.<a href="../engine/SessionStatePublic.cs.html#49ff6e2d0769f2e2" class="i property">Drive</a>.<a href="../engine/DriveInterfaces.cs.html#0db239b15afd650c" class="i method">Get</a>(<span class="r130 r">driveName</span>);
                }
                <b>catch</b> (<a href="../utils/SessionStateExceptions.cs.html#09140e6dc875019b" class="t t">DriveNotFoundException</a>)
                {
                    <span class="c">// Check to see if it is a path relative to the</span>
                    <span class="c">// current drive&#39;s root. This is true when a drive root</span>
                    <span class="c">// appears to be a drive (like HTTP://). The drive will not</span>
                    <span class="c">// actually exist, but this is not an absolute path.</span>
 
                    <b>if</b> (<a href="#06ecc54ac29ea6b5" class="i field">_sessionState</a>.<a href="../engine/SessionStatePublic.cs.html#49ff6e2d0769f2e2" class="i property">Drive</a>.<a href="../engine/DriveInterfaces.cs.html#ad95755a5d797edb" class="i property">Current</a> == <b>null</b>)
                    {
                        <b>throw</b>;
                    }
 
                    <b>string</b> <span id="r132 rd" class="r132 r">normalizedRoot</span> = <a href="#06ecc54ac29ea6b5" class="i field">_sessionState</a>.<a href="../engine/SessionStatePublic.cs.html#49ff6e2d0769f2e2" class="i property">Drive</a>.<a href="../engine/DriveInterfaces.cs.html#ad95755a5d797edb" class="i property">Current</a>.<a href="../engine/DataStoreAdapter.cs.html#6c8f4db73167e8f9" class="i property">Root</a>.<span class="i">Replace</span>(
                        <a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#f2548f0f61690656" class="i field">AlternatePathSeparator</a>, <a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a>);
 
                    <b>if</b> (<span class="r132 r">normalizedRoot</span>.<span class="i">Contains</span>(<span class="s">&#39;:&#39;</span>))
                    {
                        <b>string</b> <span id="r133 rd" class="r133 r">normalizedPath</span> = <span class="r125 r">path</span>.<span class="i">Replace</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#f2548f0f61690656" class="i field">AlternatePathSeparator</a>, <a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a>);
                        <b>if</b> (<span class="r133 r">normalizedPath</span>.<span class="i">StartsWith</span>(<span class="r132 r">normalizedRoot</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                        {
                            <span class="r131 r">isPathForCurrentDrive</span> = <b>true</b>;
                            <span class="r125 r">path</span> = <b>string</b>.<span class="i">Concat</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#b7c0e8f5832a0fb6" class="i field">DefaultPathSeparatorString</a>, <span class="r125 r">path</span>.<span class="i">AsSpan</span>(<span class="r132 r">normalizedRoot</span>.<span class="i">Length</span>).<span class="i">TrimStart</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a>));
                            <span class="r128 r">workingDriveForPath</span> = <a href="#06ecc54ac29ea6b5" class="i field">_sessionState</a>.<a href="../engine/SessionStatePublic.cs.html#49ff6e2d0769f2e2" class="i property">Drive</a>.<a href="../engine/DriveInterfaces.cs.html#ad95755a5d797edb" class="i property">Current</a>;
                        }
                    }
 
                    <b>if</b> (!<span class="r131 r">isPathForCurrentDrive</span>)
                    {
                        <b>throw</b>;
                    }
                }
 
                <span class="c">// Now hack off the drive component of the path</span>
                <b>if</b> (!<span class="r131 r">isPathForCurrentDrive</span>)
                {
                    <span class="c">// This functionality needs to respect if a drive uses a colon to separate the path</span>
                    <span class="c">//</span>
                    <span class="c">// what happens here is this:</span>
                    <span class="c">// - path is assumed to be drive root relative, so on Windows it would start with a</span>
                    <span class="c">//   \</span>
                    <span class="c">// - on Linux, there is no difference between drive root relative, and absolute, they</span>
                    <span class="c">//   are both the same, so we have to preserve the drive here in order to make</span>
                    <span class="c">//   sure the path will continue being drive root relative</span>
                    <b>if</b> (<span class="r128 r">workingDriveForPath</span>.<a href="../engine/DataStoreAdapter.cs.html#70ae98926d1292a8" class="i property">VolumeSeparatedByColon</a>)
                    {
                        <span class="c">// this is the default behavior for all windows drives, and all non-filesystem</span>
                        <span class="c">// drives on non-windows</span>
                        <span class="r125 r">path</span> = <span class="r125 r">path</span>.<span class="i">Substring</span>(<span class="r130 r">driveName</span>.<span class="i">Length</span> + 1);
                    }
                }
            }
            <b>else</b>
            {
                <span class="c">// it&#39;s a relative path, so the working drive is the current drive</span>
                <span class="r128 r">workingDriveForPath</span> = <a href="#06ecc54ac29ea6b5" class="i field">_sessionState</a>.<a href="../engine/SessionStatePublic.cs.html#49ff6e2d0769f2e2" class="i property">Drive</a>.<a href="../engine/DriveInterfaces.cs.html#ad95755a5d797edb" class="i property">Current</a>;
            }
 
            <b>if</b> (<span class="r128 r">workingDriveForPath</span> == <b>null</b>)
            {
                <a href="../utils/SessionStateExceptions.cs.html#9ed59df3c4c15193" class="t t">ItemNotFoundException</a> <span id="r134 rd" class="r134 r">pathNotFound</span> =
                    <b>new</b> <span class="t">ItemNotFoundException</span>(
                        <span class="r125 r">path</span>,
                        <span class="s">&quot;PathNotFound&quot;</span>,
                        <span class="i">SessionStateStrings</span>.<span class="i">PathNotFound</span>);
 
                <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#e7dd110db4bf902f" class="i method">TraceError</a>(<span class="s">&quot;Item does not exist: {0}&quot;</span>, <span class="r125 r">path</span>);
 
                <b>throw</b> <span class="r134 r">pathNotFound</span>;
            }
 
            <b>try</b>
            {
                <span class="r129 r">providerInstance</span> =
                    <a href="#06ecc54ac29ea6b5" class="i field">_sessionState</a>.<a href="../engine/SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../engine/SessionStateProviderAPIs.cs.html#effde0c1f75d8b39" class="i method">GetContainerProviderInstance</a>(<span class="r128 r">workingDriveForPath</span>.<a href="../engine/DataStoreAdapter.cs.html#599e6ea3519fc2d6" class="i property">Provider</a>);
 
                <span class="c">// Add the drive info to the context so that downstream methods</span>
                <span class="c">// have access to it.</span>
                <span class="r126 r">context</span>.<a href="CoreCommandContext.cs.html#f037b19aae477b8f" class="i property">Drive</a> = <span class="r128 r">workingDriveForPath</span>;
 
                <b>string</b> <span id="r135 rd" class="r135 r">relativePath</span> = <b>string</b>.<span class="i">Empty</span>;
 
                <span class="r135 r">relativePath</span> =
                    <a href="#8bddb644d30bf88e" class="i method">GenerateRelativePath</a>(
                        <span class="r128 r">workingDriveForPath</span>,
                        <span class="r125 r">path</span>,
                        <span class="r127 r">escapeCurrentLocation</span>,
                        <span class="r129 r">providerInstance</span>,
                        <span class="r126 r">context</span>);
 
                <b>return</b> <span class="r135 r">relativePath</span>;
            }
            <b>catch</b> (<a href="../utils/MshNotSupportedException.cs.html#55e79fbd51d0f1cb" class="t t">PSNotSupportedException</a>)
            {
                <span class="c">// If it&#39;s really not a container provider, the relative path will</span>
                <span class="c">// always be empty</span>
 
                <span class="r129 r">providerInstance</span> = <b>null</b>;
                <b>return</b> <b>string</b>.<span class="i">Empty</span>;
            }
        }
 
        <b>private string</b> <a id="c9f4b93d1b734069" href="../R/c9f4b93d1b734069.html" target="n" data-glyph="76,1" class="i method">GetDriveRootRelativePathFromProviderPath</a>(
            <b>string</b> <span id="r136 rd" class="r136 r">providerPath</span>,
            <a href="../engine/DataStoreAdapter.cs.html#2d16b26a541ba185" class="t t">PSDriveInfo</a> <span id="r137 rd" class="r137 r">drive</span>,
            <a href="CoreCommandContext.cs.html#1e83d35d5286e174" class="t t">CmdletProviderContext</a> <span id="r138 rd" class="r138 r">context</span>
            )
        {
            <b>string</b> <span id="r139 rd" class="r139 r">childPath</span> = <b>string</b>.<span class="i">Empty</span>;
 
            <a href="../P/71826561229efd99.html#71826561229efd99" class="t t">CmdletProvider</a> <span id="r140 rd" class="r140 r">providerInstance</span> =
                <a href="#06ecc54ac29ea6b5" class="i field">_sessionState</a>.<a href="../engine/SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../engine/SessionStateProviderAPIs.cs.html#effde0c1f75d8b39" class="i method">GetContainerProviderInstance</a>(<span class="r137 r">drive</span>.<a href="../engine/DataStoreAdapter.cs.html#599e6ea3519fc2d6" class="i property">Provider</a>);
            <a href="NavigationProviderBase.cs.html#7d31476313596b0b" class="t t">NavigationCmdletProvider</a> <span id="r141 rd" class="r141 r">navigationProvider</span> = <span class="r140 r">providerInstance</span> <b>as</b> <a href="NavigationProviderBase.cs.html#7d31476313596b0b" class="t t">NavigationCmdletProvider</a>;
 
            <span class="c">// Normalize the paths</span>
            <span class="r136 r">providerPath</span> = <span class="r136 r">providerPath</span>.<span class="i">Replace</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#f2548f0f61690656" class="i field">AlternatePathSeparator</a>, <a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a>);
            <span class="r136 r">providerPath</span> = <span class="r136 r">providerPath</span>.<span class="i">TrimEnd</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a>);
            <b>string</b> <span id="r142 rd" class="r142 r">driveRoot</span> = <span class="r137 r">drive</span>.<a href="../engine/DataStoreAdapter.cs.html#6c8f4db73167e8f9" class="i property">Root</a>.<span class="i">Replace</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#f2548f0f61690656" class="i field">AlternatePathSeparator</a>, <a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a>);
            <span class="r142 r">driveRoot</span> = <span class="r142 r">driveRoot</span>.<span class="i">TrimEnd</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a>);
 
            <span class="c">// Keep on lopping off children until the the remaining path</span>
            <span class="c">// is the drive root.</span>
            <b>while</b> ((!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r136 r">providerPath</span>)) &amp;&amp;
                (!<span class="r136 r">providerPath</span>.<span class="i">Equals</span>(<span class="r142 r">driveRoot</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)))
            {
                <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r139 r">childPath</span>))
                {
                    <span class="r139 r">childPath</span> = <a href="#06ecc54ac29ea6b5" class="i field">_sessionState</a>.<a href="../engine/SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../engine/SessionStateNavigation.cs.html#e5b8a31ace00fa74" class="i method">MakePath</a>(
                        <span class="r140 r">providerInstance</span>,
                        <span class="r141 r">navigationProvider</span>.<a href="NavigationProviderBase.cs.html#0fc64120846797fb" class="i method">GetChildName</a>(<span class="r136 r">providerPath</span>, <span class="r138 r">context</span>),
                        <span class="r139 r">childPath</span>,
                        <span class="r138 r">context</span>);
                }
                <b>else</b>
                {
                    <span class="r139 r">childPath</span> = <span class="r141 r">navigationProvider</span>.<a href="NavigationProviderBase.cs.html#0fc64120846797fb" class="i method">GetChildName</a>(<span class="r136 r">providerPath</span>, <span class="r138 r">context</span>);
                }
 
                <span class="r136 r">providerPath</span> = <a href="#06ecc54ac29ea6b5" class="i field">_sessionState</a>.<a href="../engine/SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../engine/SessionStateNavigation.cs.html#cbcbfd150cfff6b4" class="i method">GetParentPath</a>(
                    <span class="r140 r">providerInstance</span>,
                    <span class="r136 r">providerPath</span>,
                    <span class="r137 r">drive</span>.<a href="../engine/DataStoreAdapter.cs.html#6c8f4db73167e8f9" class="i property">Root</a>,
                    <span class="r138 r">context</span>);
            }
 
            <b>return</b> <span class="r139 r">childPath</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Builds a provider specific path from the current working</span>
        <span class="c">///</span><span class="c"> directory using the specified relative path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r143 r">drive</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The drive to generate the provider specific path from.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r144 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The relative path to add to the absolute path in the drive.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r145 r">escapeCurrentLocation</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Escape the wildcards in the current location.  Use when this path will be</span>
        <span class="c">///</span><span class="c"> passed through globbing.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r146 r">providerInstance</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An instance of the provider to use if MakePath or GetParentPath</span>
        <span class="c">///</span><span class="c"> need to be called.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r147 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The context which the core command is running.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A string with the joined current working path and relative</span>
        <span class="c">///</span><span class="c"> path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r144 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> or </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r143 r">drive</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#35e07c15a7526bcd" class="t t">ProviderInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider specified by </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="i">providerId</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> threw an</span>
        <span class="c">///</span><span class="c"> exception when its GetParentPath or MakePath was called while</span>
        <span class="c">///</span><span class="c"> processing the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r144 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">NotSupportedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider is not a NavigationCmdletProvider.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r147 r">context</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> has been signaled for</span>
        <span class="c">///</span><span class="c"> StopProcessing.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal string</b> <a id="8bddb644d30bf88e" href="../R/8bddb644d30bf88e.html" target="n" data-glyph="74,1" class="i method">GenerateRelativePath</a>(
            <a href="../engine/DataStoreAdapter.cs.html#2d16b26a541ba185" class="t t">PSDriveInfo</a> <span id="r143 rd" class="r143 r">drive</span>,
            <b>string</b> <span id="r144 rd" class="r144 r">path</span>,
            <b>bool</b> <span id="r145 rd" class="r145 r">escapeCurrentLocation</span>,
            <a href="../P/71826561229efd99.html#71826561229efd99" class="t t">CmdletProvider</a> <span id="r146 rd" class="r146 r">providerInstance</span>,
            <a href="CoreCommandContext.cs.html#1e83d35d5286e174" class="t t">CmdletProviderContext</a> <span id="r147 rd" class="r147 r">context</span>)
        {
            <span class="c">// Verify parameters</span>
 
            <b>if</b> (<span class="r144 r">path</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r144 r">path</span>));
            }
 
            <b>if</b> (<span class="r143 r">drive</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r143 r">drive</span>));
            }
 
            <span class="c">// This string will be filled in with the</span>
            <span class="c">// new root relative working directory as we process</span>
            <span class="c">// the supplied path</span>
 
            <b>string</b> <span id="r148 rd" class="r148 r">driveRootRelativeWorkingPath</span> = <span class="r143 r">drive</span>.<a href="../engine/DataStoreAdapter.cs.html#d711c9845c94045c" class="i property">CurrentLocation</a>;
            <b>if</b> ((!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r148 r">driveRootRelativeWorkingPath</span>) &amp;&amp;
                (<span class="r148 r">driveRootRelativeWorkingPath</span>.<span class="i">StartsWith</span>(<span class="r143 r">drive</span>.<a href="../engine/DataStoreAdapter.cs.html#6c8f4db73167e8f9" class="i property">Root</a>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>))))
            {
                <span class="r148 r">driveRootRelativeWorkingPath</span> = <span class="r148 r">driveRootRelativeWorkingPath</span>.<span class="i">Substring</span>(<span class="r143 r">drive</span>.<a href="../engine/DataStoreAdapter.cs.html#6c8f4db73167e8f9" class="i property">Root</a>.<span class="i">Length</span>);
            }
 
            <b>if</b> (<span class="r145 r">escapeCurrentLocation</span>) { <span class="r148 r">driveRootRelativeWorkingPath</span> = <a href="../engine/regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../engine/regex.cs.html#ec1c8a48d29314f3" class="i method">Escape</a>(<span class="r148 r">driveRootRelativeWorkingPath</span>); }
 
            <span class="c">// These are static strings that we will parse and</span>
            <span class="c">// interpret if they are leading the path. Otherwise</span>
            <span class="c">// we will just pass them on to the provider.</span>
 
            <b>const char</b> <span id="r149 rd" class="r149 r">monadRelativePathSeparatorBackslash</span> = <span class="s">&#39;\\&#39;</span>;
            <b>const char</b> <span id="r150 rd" class="r150 r">monadRelativePathSeparatorForwardslash</span> = <span class="s">&#39;/&#39;</span>;
            <b>const string</b> <span id="r151 rd" class="r151 r">currentDirSymbol</span> = <span class="s">&quot;.&quot;</span>;
            <b>const string</b> <span id="r152 rd" class="r152 r">parentDirSymbol</span> = <span class="s">&quot;..&quot;</span>;
            <b>const int</b> <span id="r153 rd" class="r153 r">parentDirSymbolLength</span> = 2;
            <b>const string</b> <span id="r154 rd" class="r154 r">currentDirRelativeSymbolBackslash</span> = <span class="s">&quot;.\\&quot;</span>;
            <b>const string</b> <span id="r155 rd" class="r155 r">currentDirRelativeSymbolForwardslash</span> = <span class="s">&quot;./&quot;</span>;
 
            <span class="c">// If the path starts with the &quot;\&quot; then it is</span>
            <span class="c">// relative to the root of the drive.</span>
            <span class="c">// We don&#39;t want to process other relative path</span>
            <span class="c">// symbols in this case</span>
 
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r144 r">path</span>))
            {
                <span class="c">// Just fall-through</span>
            }
            <b>else</b> <b>if</b> (<span class="r144 r">path</span>[0] == <span class="r149 r">monadRelativePathSeparatorBackslash</span> ||
                     <span class="r144 r">path</span>[0] == <span class="r150 r">monadRelativePathSeparatorForwardslash</span>)
            {
                <span class="c">// The root relative path was given so empty the current working path.</span>
 
                <span class="c">// Porting notes: This can happen on non-Windows, because the assumption</span>
                <span class="c">// is that for file paths a path that is already relative to the drive</span>
                <span class="c">// root is the same thing as an absolute path (both start with /).</span>
 
                <span class="r148 r">driveRootRelativeWorkingPath</span> = <b>string</b>.<span class="i">Empty</span>;
 
                <span class="c">// Remove the \ or / from the drive relative</span>
                <span class="c">// path</span>
 
                <span class="r144 r">path</span> = <span class="r144 r">path</span>.<span class="i">Substring</span>(1);
 
                <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(
                    <span class="s">&quot;path = {0}&quot;</span>,
                    <span class="r144 r">path</span>);
            }
            <b>else</b>
            {
                <span class="c">// Now process all other relative path symbols like</span>
                <span class="c">// &quot;..&quot; and &quot;.&quot;</span>
                <b>while</b> ((<span class="r144 r">path</span>.<span class="i">Length</span> &gt; 0) &amp;&amp; <a href="#e8ff951013942610" class="i method">HasRelativePathTokens</a>(<span class="r144 r">path</span>))
                {
                    <b>if</b> (<span class="r147 r">context</span>.<a href="CoreCommandContext.cs.html#649b794a0afa4fa8" class="i property">Stopping</a>)
                    {
                        <b>throw</b> <b>new</b> <a href="../utils/ExecutionExceptions.cs.html#105b0214d3aab114" class="t constructor">PipelineStoppedException</a>();
                    }
 
                    <b>bool</b> <span id="r156 rd" class="r156 r">processedSomething</span> = <b>false</b>;
 
                    <span class="c">// Process the parent directory symbol &quot;..&quot;</span>
 
                    <b>bool</b> <span id="r157 rd" class="r157 r">pathStartsWithDirSymbol</span> = <span class="r144 r">path</span>.<span class="i">StartsWith</span>(<span class="r152 r">parentDirSymbol</span>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>);
                    <b>bool</b> <span id="r158 rd" class="r158 r">pathLengthEqualsParentDirSymbol</span> = <span class="r144 r">path</span>.<span class="i">Length</span> == <span class="r153 r">parentDirSymbolLength</span>;
                    <b>bool</b> <span id="r159 rd" class="r159 r">pathDirSymbolFollowedBySeparator</span> =
                        (<span class="r144 r">path</span>.<span class="i">Length</span> &gt; <span class="r153 r">parentDirSymbolLength</span>) &amp;&amp;
                        ((<span class="r144 r">path</span>[<span class="r153 r">parentDirSymbolLength</span>] == <span class="r149 r">monadRelativePathSeparatorBackslash</span>) ||
                         (<span class="r144 r">path</span>[<span class="r153 r">parentDirSymbolLength</span>] == <span class="r150 r">monadRelativePathSeparatorForwardslash</span>));
 
                    <b>if</b> (<span class="r157 r">pathStartsWithDirSymbol</span> &amp;&amp;
                        (<span class="r158 r">pathLengthEqualsParentDirSymbol</span> ||
                         <span class="r159 r">pathDirSymbolFollowedBySeparator</span>))
                    {
                        <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r148 r">driveRootRelativeWorkingPath</span>))
                        {
                            <span class="c">// Use the provider to get the current path</span>
 
                            <span class="r148 r">driveRootRelativeWorkingPath</span> =
                                <a href="#06ecc54ac29ea6b5" class="i field">_sessionState</a>.<a href="../engine/SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../engine/SessionStateNavigation.cs.html#cbcbfd150cfff6b4" class="i method">GetParentPath</a>(
                                    <span class="r146 r">providerInstance</span>,
                                    <span class="r148 r">driveRootRelativeWorkingPath</span>,
                                    <span class="r143 r">drive</span>.<a href="../engine/DataStoreAdapter.cs.html#6c8f4db73167e8f9" class="i property">Root</a>,
                                    <span class="r147 r">context</span>);
                        }
 
                        <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(
                            <span class="s">&quot;Parent path = {0}&quot;</span>,
                            <span class="r148 r">driveRootRelativeWorkingPath</span>);
 
                        <span class="c">// remove the parent path symbol from the</span>
                        <span class="c">// relative path</span>
 
                        <span class="r144 r">path</span> =
                            <span class="r144 r">path</span>.<span class="i">Substring</span>(
                            <span class="r153 r">parentDirSymbolLength</span>);
 
                        <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(
                            <span class="s">&quot;path = {0}&quot;</span>,
                            <span class="r144 r">path</span>);
 
                        <span class="r156 r">processedSomething</span> = <b>true</b>;
                        <b>if</b> (<span class="r144 r">path</span>.<span class="i">Length</span> == 0)
                        {
                            <b>break</b>;
                        }
 
                        <span class="c">// If the &quot;..&quot; was followed by a &quot;\&quot; or &quot;/&quot; then</span>
                        <span class="c">// strip that off as well</span>
 
                        <b>if</b> (<span class="r144 r">path</span>[0] == <span class="r149 r">monadRelativePathSeparatorBackslash</span> ||
                            <span class="r144 r">path</span>[0] == <span class="r150 r">monadRelativePathSeparatorForwardslash</span>)
                        {
                            <span class="r144 r">path</span> = <span class="r144 r">path</span>.<span class="i">Substring</span>(1);
                        }
 
                        <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(
                            <span class="s">&quot;path = {0}&quot;</span>,
                            <span class="r144 r">path</span>);
 
                        <span class="c">// no more relative path to work with so break</span>
 
                        <b>if</b> (<span class="r144 r">path</span>.<span class="i">Length</span> == 0)
                        {
                            <b>break</b>;
                        }
 
                        <span class="c">// continue the loop instead of trying to process</span>
                        <span class="c">// &quot;.\&quot;. This makes the code easier for &quot;.\&quot; by</span>
                        <span class="c">// not having to check for &quot;..&quot;</span>
 
                        <b>continue</b>;
                    }
 
                    <span class="c">// Process the current directory symbol &quot;.&quot;</span>
 
                    <b>if</b> (<span class="r144 r">path</span>.<span class="i">Equals</span>(<span class="r151 r">currentDirSymbol</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                    {
                        <span class="r156 r">processedSomething</span> = <b>true</b>;
                        <span class="r144 r">path</span> = <b>string</b>.<span class="i">Empty</span>;
                        <b>break</b>;
                    }
 
                    <b>if</b> (<span class="r144 r">path</span>.<span class="i">StartsWith</span>(<span class="r154 r">currentDirRelativeSymbolBackslash</span>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>) ||
                        <span class="r144 r">path</span>.<span class="i">StartsWith</span>(<span class="r155 r">currentDirRelativeSymbolForwardslash</span>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>))
                    {
                        <span class="r144 r">path</span> = <span class="r144 r">path</span>.<span class="i">Substring</span>(<span class="r154 r">currentDirRelativeSymbolBackslash</span>.<span class="i">Length</span>);
                        <span class="r156 r">processedSomething</span> = <b>true</b>;
                        <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(
                            <span class="s">&quot;path = {0}&quot;</span>,
                            <span class="r144 r">path</span>);
 
                        <b>if</b> (<span class="r144 r">path</span>.<span class="i">Length</span> == 0)
                        {
                            <b>break</b>;
                        }
                    }
 
                    <span class="c">// If there is no more path to work with break</span>
                    <span class="c">// out of the loop</span>
 
                    <b>if</b> (<span class="r144 r">path</span>.<span class="i">Length</span> == 0)
                    {
                        <b>break</b>;
                    }
 
                    <b>if</b> (!<span class="r156 r">processedSomething</span>)
                    {
                        <span class="c">// Since that path wasn&#39;t modified, break</span>
                        <span class="c">// the loop.</span>
                        <b>break</b>;
                    }
                }
            }
 
            <span class="c">// If more relative path remains add that to</span>
            <span class="c">// the known absolute path</span>
 
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r144 r">path</span>))
            {
                <span class="r148 r">driveRootRelativeWorkingPath</span> =
                    <a href="#06ecc54ac29ea6b5" class="i field">_sessionState</a>.<a href="../engine/SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../engine/SessionStateNavigation.cs.html#e5b8a31ace00fa74" class="i method">MakePath</a>(
                        <span class="r146 r">providerInstance</span>,
                        <span class="r148 r">driveRootRelativeWorkingPath</span>,
                        <span class="r144 r">path</span>,
                        <span class="r147 r">context</span>);
            }
 
            <a href="NavigationProviderBase.cs.html#7d31476313596b0b" class="t t">NavigationCmdletProvider</a> <span id="r160 rd" class="r160 r">navigationProvider</span> = <span class="r146 r">providerInstance</span> <b>as</b> <a href="NavigationProviderBase.cs.html#7d31476313596b0b" class="t t">NavigationCmdletProvider</a>;
            <b>if</b> (<span class="r160 r">navigationProvider</span> != <b>null</b>)
            {
                <b>string</b> <span id="r161 rd" class="r161 r">rootedPath</span> = <a href="#06ecc54ac29ea6b5" class="i field">_sessionState</a>.<a href="../engine/SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../engine/SessionStateNavigation.cs.html#d830dabb37e51f31" class="i method">MakePath</a>(<span class="r147 r">context</span>.<a href="CoreCommandContext.cs.html#f037b19aae477b8f" class="i property">Drive</a>.<a href="../engine/DataStoreAdapter.cs.html#6c8f4db73167e8f9" class="i property">Root</a>, <span class="r148 r">driveRootRelativeWorkingPath</span>, <span class="r147 r">context</span>);
                <b>string</b> <span id="r162 rd" class="r162 r">normalizedRelativePath</span> = <span class="r160 r">navigationProvider</span>.<a href="NavigationProviderBase.cs.html#c0c3c593f9282ffb" class="i method">ContractRelativePath</a>(<span class="r161 r">rootedPath</span>, <span class="r147 r">context</span>.<a href="CoreCommandContext.cs.html#f037b19aae477b8f" class="i property">Drive</a>.<a href="../engine/DataStoreAdapter.cs.html#6c8f4db73167e8f9" class="i property">Root</a>, <b>false</b>, <span class="r147 r">context</span>);
 
                <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r162 r">normalizedRelativePath</span>))
                {
                    <b>if</b> (<span class="r162 r">normalizedRelativePath</span>.<span class="i">StartsWith</span>(<span class="r147 r">context</span>.<a href="CoreCommandContext.cs.html#f037b19aae477b8f" class="i property">Drive</a>.<a href="../engine/DataStoreAdapter.cs.html#6c8f4db73167e8f9" class="i property">Root</a>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>))
                        <span class="r148 r">driveRootRelativeWorkingPath</span> = <span class="r162 r">normalizedRelativePath</span>.<span class="i">Substring</span>(<span class="r147 r">context</span>.<a href="CoreCommandContext.cs.html#f037b19aae477b8f" class="i property">Drive</a>.<a href="../engine/DataStoreAdapter.cs.html#6c8f4db73167e8f9" class="i property">Root</a>.<span class="i">Length</span>);
                    <b>else</b>
                        <span class="r148 r">driveRootRelativeWorkingPath</span> = <span class="r162 r">normalizedRelativePath</span>;
                }
                <b>else</b>
                    <span class="r148 r">driveRootRelativeWorkingPath</span> = <b>string</b>.<span class="i">Empty</span>;
            }
 
            <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(
                <span class="s">&quot;result = {0}&quot;</span>,
                <span class="r148 r">driveRootRelativeWorkingPath</span>);
 
            <b>return</b> <span class="r148 r">driveRootRelativeWorkingPath</span>;
        }
 
        <b>private static bool</b> <a id="e8ff951013942610" href="../R/e8ff951013942610.html" target="n" data-glyph="76,1" class="i method">HasRelativePathTokens</a>(<b>string</b> <span id="r163 rd" class="r163 r">path</span>)
        {
            <b>string</b> <span id="r164 rd" class="r164 r">comparePath</span> = <span class="r163 r">path</span>.<span class="i">Replace</span>(<span class="s">&#39;/&#39;</span>, <span class="s">&#39;\\&#39;</span>);
 
            <b>return</b> (
                <span class="r164 r">comparePath</span>.<span class="i">Equals</span>(<span class="s">&quot;.&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) ||
                <span class="r164 r">comparePath</span>.<span class="i">Equals</span>(<span class="s">&quot;..&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) ||
                <span class="r164 r">comparePath</span>.<span class="i">Contains</span>(<span class="s">&quot;\\.\\&quot;</span>) ||
                <span class="r164 r">comparePath</span>.<span class="i">Contains</span>(<span class="s">&quot;\\..\\&quot;</span>) ||
                <span class="r164 r">comparePath</span>.<span class="i">EndsWith</span>(<span class="s">&quot;\\..&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) ||
                <span class="r164 r">comparePath</span>.<span class="i">EndsWith</span>(<span class="s">&quot;\\.&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) ||
                <span class="r164 r">comparePath</span>.<span class="i">StartsWith</span>(<span class="s">&quot;..\\&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) ||
                <span class="r164 r">comparePath</span>.<span class="i">StartsWith</span>(<span class="s">&quot;.\\&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) ||
                <span class="r164 r">comparePath</span>.<span class="i">StartsWith</span>(<span class="s">&#39;~&#39;</span>));
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Uses the drive and a relative working path to construct</span>
        <span class="c">///</span><span class="c"> a string which has a fully qualified provider specific path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r165 r">drive</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The drive to use as the root of the path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r166 r">workingPath</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The relative working directory to the specified drive.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r167 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The context which the core command is running.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A string which is contains the fully qualified path in provider</span>
        <span class="c">///</span><span class="c"> specific form.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r165 r">drive</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> or </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r166 r">workingPath</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#35e07c15a7526bcd" class="t t">ProviderInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider throws an exception when its MakePath gets</span>
        <span class="c">///</span><span class="c"> called.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>private string</b> <a id="5b38754e2493a8d5" href="../R/5b38754e2493a8d5.html" target="n" data-glyph="76,1" class="i method">GetProviderSpecificPath</a>(
            <a href="../engine/DataStoreAdapter.cs.html#2d16b26a541ba185" class="t t">PSDriveInfo</a> <span id="r165 rd" class="r165 r">drive</span>,
            <b>string</b> <span id="r166 rd" class="r166 r">workingPath</span>,
            <a href="CoreCommandContext.cs.html#1e83d35d5286e174" class="t t">CmdletProviderContext</a> <span id="r167 rd" class="r167 r">context</span>)
        {
            <b>if</b> (<span class="r165 r">drive</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r165 r">drive</span>));
            }
 
            <b>if</b> (<span class="r166 r">workingPath</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r166 r">workingPath</span>));
            }
 
            <span class="c">// Trace the inputs</span>
 
            <span class="r165 r">drive</span>.<a href="../engine/DataStoreAdapter.cs.html#08d17657703b081f" class="i method">Trace</a>();
            <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(
                <span class="s">&quot;workingPath = {0}&quot;</span>,
                <span class="r166 r">workingPath</span>);
 
            <b>string</b> <span id="r168 rd" class="r168 r">result</span> = <span class="r165 r">drive</span>.<a href="../engine/DataStoreAdapter.cs.html#6c8f4db73167e8f9" class="i property">Root</a>;
 
            <b>try</b>
            {
                <span class="r168 r">result</span> =
                    <a href="#06ecc54ac29ea6b5" class="i field">_sessionState</a>.<a href="../engine/SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../engine/SessionStateNavigation.cs.html#dc855ab62534fcda" class="i method">MakePath</a>(
                        <span class="r165 r">drive</span>.<a href="../engine/DataStoreAdapter.cs.html#599e6ea3519fc2d6" class="i property">Provider</a>,
                        <span class="r168 r">result</span>,
                        <span class="r166 r">workingPath</span>,
                        <span class="r167 r">context</span>);
            }
            <b>catch</b> (<span class="i">NotSupportedException</span>)
            {
                <span class="c">// This is valid if the provider doesn&#39;t support MakePath.  The</span>
                <span class="c">// drive should be enough.</span>
            }
 
            <b>return</b> <span class="r168 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Parses the provider-qualified path into the provider name and</span>
        <span class="c">///</span><span class="c"> the provider-internal path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r169 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The provider-qualified path to parse.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r170 r">providerId</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The name of the provider specified by the path is returned through</span>
        <span class="c">///</span><span class="c"> this out parameter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The provider-internal path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r169 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r169 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is not in the correct format.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>private static string</b> <a id="d0dba4efed9d6237" href="../R/d0dba4efed9d6237.html" target="n" data-glyph="76,1" class="i method">ParseProviderPath</a>(<b>string</b> <span id="r169 rd" class="r169 r">path</span>, <b>out string</b> <span id="r170 rd" class="r170 r">providerId</span>)
        {
            <b>if</b> (<span class="r169 r">path</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r169 r">path</span>));
            }
 
            <b>int</b> <span id="r171 rd" class="r171 r">providerIdSeparatorIndex</span> = <span class="r169 r">path</span>.<span class="i">IndexOf</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#6981dbcadad2340f" class="i field">ProviderPathSeparator</a>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>);
 
            <b>if</b> (<span class="r171 r">providerIdSeparatorIndex</span> &lt;= 0)
            {
                <span class="i">ArgumentException</span> <span id="r172 rd" class="r172 r">e</span> =
                    <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentException</span>(
                        <b>nameof</b>(<span class="r169 r">path</span>),
                        <span class="i">SessionStateStrings</span>.<span class="i">NotProviderQualifiedPath</span>);
                <b>throw</b> <span class="r172 r">e</span>;
            }
 
            <span class="r170 r">providerId</span> = <span class="r169 r">path</span>.<span class="i">Substring</span>(0, <span class="r171 r">providerIdSeparatorIndex</span>);
            <b>string</b> <span id="r173 rd" class="r173 r">result</span> = <span class="r169 r">path</span>.<span class="i">Substring</span>(<span class="r171 r">providerIdSeparatorIndex</span> + <a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#6981dbcadad2340f" class="i field">ProviderPathSeparator</a>.<span class="i">Length</span>);
 
            <b>return</b> <span class="r173 r">result</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Path manipulation methods
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> private fields and methods
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> internal methods
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Given a provider specific path that contains glob characters, this method</span>
        <span class="c">///</span><span class="c"> will perform the globbing using the specified provider and return the</span>
        <span class="c">///</span><span class="c"> matching provider specific paths.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r174 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path containing the glob characters to resolve.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r175 r">allowNonexistingPaths</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If true, a ItemNotFoundException will not be thrown for non-existing</span>
        <span class="c">///</span><span class="c"> paths. Instead an appropriate path will be returned as if it did exist.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r176 r">containerProvider</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The provider that will be used to glob the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r174 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r177 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The context under which the command is occurring.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An array of provider specific paths that match the glob path and</span>
        <span class="c">///</span><span class="c"> filter (if supplied via the context).</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This method is internal because we don&#39;t want to expose the</span>
        <span class="c">///</span><span class="c"> provider instances outside the engine.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r174 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">, </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r176 r">containerProvider</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">, or</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r177 r">context</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#35e07c15a7526bcd" class="t t">ProviderInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider used to build the path threw an exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r174 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> starts with &quot;~&quot; and the home location is not set for</span>
        <span class="c">///</span><span class="c"> the provider.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r177 r">context</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> has been signaled for</span>
        <span class="c">///</span><span class="c"> StopProcessing.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Any exception can be thrown by the provider that is called to build</span>
        <span class="c">///</span><span class="c"> the provider path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">Collection</span>&lt;<b>string</b>&gt; <a id="9b78be2dcbbaf075" href="../R/9b78be2dcbbaf075.html" target="n" data-glyph="74,1" class="i method">GetGlobbedProviderPathsFromProviderPath</a>(
            <b>string</b> <span id="r174 rd" class="r174 r">path</span>,
            <b>bool</b> <span id="r175 rd" class="r175 r">allowNonexistingPaths</span>,
            <a href="ContainerProviderBase.cs.html#bfc85492b760e757" class="t t">ContainerCmdletProvider</a> <span id="r176 rd" class="r176 r">containerProvider</span>,
            <a href="CoreCommandContext.cs.html#1e83d35d5286e174" class="t t">CmdletProviderContext</a> <span id="r177 rd" class="r177 r">context</span>)
        {
            <b>if</b> (<span class="r174 r">path</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r174 r">path</span>));
            }
 
            <b>if</b> (<span class="r176 r">containerProvider</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r176 r">containerProvider</span>));
            }
 
            <b>if</b> (<span class="r177 r">context</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r177 r">context</span>));
            }
 
            <span class="i">Collection</span>&lt;<b>string</b>&gt; <span id="r178 rd" class="r178 r">expandedPaths</span> =
                <a href="#427d751a9e698043" class="i method">ExpandGlobPath</a>(
                    <span class="r174 r">path</span>,
                    <span class="r175 r">allowNonexistingPaths</span>,
                    <span class="r176 r">containerProvider</span>,
                    <span class="r177 r">context</span>);
 
            <b>return</b> <span class="r178 r">expandedPaths</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Determines if the specified path contains any globing characters. These</span>
        <span class="c">///</span><span class="c"> characters are defined as &#39;?&#39; and &#39;*&#39;.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r179 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to search for globing characters.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> True if the path contains any of the globing characters, false otherwise.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r179 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="be9734ddba52229e" href="../R/be9734ddba52229e.html" target="n" data-glyph="74,1" class="i method">StringContainsGlobCharacters</a>(<b>string</b> <span id="r179 rd" class="r179 r">path</span>)
        {
            <b>if</b> (<span class="r179 r">path</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r179 r">path</span>));
            }
 
            <b>return</b> <a href="../engine/regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../engine/regex.cs.html#f9cf207fdd565080" class="i method">ContainsWildcardCharacters</a>(<span class="r179 r">path</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Determines if the path and context are such that we need to run through</span>
        <span class="c">///</span><span class="c"> the globbing algorithm.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r180 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to check for glob characters.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r181 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The context to check for filter, include, or exclude expressions.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> True if globbing should be performed (the path has glob characters, or the context</span>
        <span class="c">///</span><span class="c"> has either a an include, or an exclude expression). False otherwise.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="3d032868debcca0c" href="../R/3d032868debcca0c.html" target="n" data-glyph="74,1" class="i method">ShouldPerformGlobbing</a>(<b>string</b> <span id="r180 rd" class="r180 r">path</span>, <a href="CoreCommandContext.cs.html#1e83d35d5286e174" class="t t">CmdletProviderContext</a> <span id="r181 rd" class="r181 r">context</span>)
        {
            <b>bool</b> <span id="r182 rd" class="r182 r">pathContainsGlobCharacters</span> = <b>false</b>;
 
            <b>if</b> (<span class="r180 r">path</span> != <b>null</b>)
            {
                <span class="r182 r">pathContainsGlobCharacters</span> = <a href="#be9734ddba52229e" class="i method">StringContainsGlobCharacters</a>(<span class="r180 r">path</span>);
            }
 
            <b>bool</b> <span id="r183 rd" class="r183 r">contextContainsIncludeExclude</span> = <b>false</b>;
            <b>bool</b> <span id="r184 rd" class="r184 r">contextContainsNoGlob</span> = <b>false</b>;
 
            <b>if</b> (<span class="r181 r">context</span> != <b>null</b>)
            {
                <b>bool</b> <span id="r185 rd" class="r185 r">includePresent</span> = <span class="r181 r">context</span>.<a href="CoreCommandContext.cs.html#ab4bd68ec99ecaa3" class="i property">Include</a> != <b>null</b> &amp;&amp; <span class="r181 r">context</span>.<a href="CoreCommandContext.cs.html#ab4bd68ec99ecaa3" class="i property">Include</a>.<span class="i">Count</span> &gt; 0;
                <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#451d38bf8c2b6b94" class="i method">WriteLine</a>(<span class="s">&quot;INCLUDE filter present: {0}&quot;</span>, <span class="r185 r">includePresent</span>);
 
                <b>bool</b> <span id="r186 rd" class="r186 r">excludePresent</span> = <span class="r181 r">context</span>.<a href="CoreCommandContext.cs.html#93e21581391c00fc" class="i property">Exclude</a> != <b>null</b> &amp;&amp; <span class="r181 r">context</span>.<a href="CoreCommandContext.cs.html#93e21581391c00fc" class="i property">Exclude</a>.<span class="i">Count</span> &gt; 0;
                <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#451d38bf8c2b6b94" class="i method">WriteLine</a>(<span class="s">&quot;EXCLUDE filter present: {0}&quot;</span>, <span class="r186 r">excludePresent</span>);
 
                <span class="r183 r">contextContainsIncludeExclude</span> = <span class="r185 r">includePresent</span> || <span class="r186 r">excludePresent</span>;
 
                <span class="r184 r">contextContainsNoGlob</span> = <span class="r181 r">context</span>.<a href="CoreCommandContext.cs.html#b9edf955d3776935" class="i property">SuppressWildcardExpansion</a>;
                <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#451d38bf8c2b6b94" class="i method">WriteLine</a>(<span class="s">&quot;NOGLOB parameter present: {0}&quot;</span>, <span class="r184 r">contextContainsNoGlob</span>);
            }
 
            <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#451d38bf8c2b6b94" class="i method">WriteLine</a>(<span class="s">&quot;Path contains wildcard characters: {0}&quot;</span>, <span class="r182 r">pathContainsGlobCharacters</span>);
 
            <b>return</b> (<span class="r182 r">pathContainsGlobCharacters</span> || <span class="r183 r">contextContainsIncludeExclude</span>) &amp;&amp; (!<span class="r184 r">contextContainsNoGlob</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Generates an array of provider specific paths from the single provider specific</span>
        <span class="c">///</span><span class="c"> path using globing rules.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r187 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A path that may or may not contain globing characters.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r188 r">allowNonexistingPaths</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If true, a ItemNotFoundException will not be thrown for non-existing</span>
        <span class="c">///</span><span class="c"> paths. Instead an appropriate path will be returned as if it did exist.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r189 r">drive</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The drive that the path is relative to.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r190 r">provider</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The provider that implements the namespace for the path that we are globing over.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r191 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The context the provider uses when performing the operation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An array of path strings that match the globing rules applied to the path parameter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> First the path is checked to see if it contains any globing characters (&#39;?&#39; or &#39;*&#39;).</span>
        <span class="c">///</span><span class="c"> If it doesn&#39;t then the path is returned as the only element in the array.</span>
        <span class="c">///</span><span class="c"> If it does, GetParentPath and GetLeafPathName is called on the path and each element</span>
        <span class="c">///</span><span class="c"> is stored until the path doesn&#39;t contain any globing characters. At that point</span>
        <span class="c">///</span><span class="c"> GetChildNames() is called on the provider with the last parent path that doesn&#39;t</span>
        <span class="c">///</span><span class="c"> contain a globing character. All the results are then matched against leaf element</span>
        <span class="c">///</span><span class="c"> of that parent path (which did contain a glob character). We then walk out of the</span>
        <span class="c">///</span><span class="c"> recursion and apply the same procedure to each leaf element that contained globing</span>
        <span class="c">///</span><span class="c"> characters.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> The procedure above allows us to match globing strings in multiple sub-containers</span>
        <span class="c">///</span><span class="c"> in the namespace without having to have knowledge of the namespace paths, or</span>
        <span class="c">///</span><span class="c"> their syntax.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> Example:</span>
        <span class="c">///</span><span class="c"> dir c:\foo\*\bar\*a??.cs</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> Calling this method for the path above would return all files that end in &#39;a&#39; and</span>
        <span class="c">///</span><span class="c"> any other two characters followed by &quot;.cs&quot; in all the subdirectories of</span>
        <span class="c">///</span><span class="c"> foo that have a bar subdirectory.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r187 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">, </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r190 r">provider</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">, or</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r190 r">provider</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#35e07c15a7526bcd" class="t t">ProviderInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider used to build the path threw an exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">NotSupportedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider that the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r187 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> represents is not a NavigationCmdletProvider</span>
        <span class="c">///</span><span class="c"> or ContainerCmdletProvider.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r187 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> starts with &quot;~&quot; and the home location is not set for</span>
        <span class="c">///</span><span class="c"> the provider.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#35e07c15a7526bcd" class="t t">ProviderInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider associated with the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r187 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> threw an</span>
        <span class="c">///</span><span class="c"> exception when its GetParentPath or MakePath was called while</span>
        <span class="c">///</span><span class="c"> processing the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r187 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#9ed59df3c4c15193" class="t t">ItemNotFoundException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r187 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> does not contain glob characters and</span>
        <span class="c">///</span><span class="c"> could not be found.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r191 r">context</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> has been signaled for</span>
        <span class="c">///</span><span class="c"> StopProcessing.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Any exception can be thrown by the provider that is called to build</span>
        <span class="c">///</span><span class="c"> the provider path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>private</b> <span class="i">Collection</span>&lt;<b>string</b>&gt; <a id="9df1b8bf48658855" href="../R/9df1b8bf48658855.html" target="n" data-glyph="76,1" class="i method">ExpandMshGlobPath</a>(
            <b>string</b> <span id="r187 rd" class="r187 r">path</span>,
            <b>bool</b> <span id="r188 rd" class="r188 r">allowNonexistingPaths</span>,
            <a href="../engine/DataStoreAdapter.cs.html#2d16b26a541ba185" class="t t">PSDriveInfo</a> <span id="r189 rd" class="r189 r">drive</span>,
            <a href="ContainerProviderBase.cs.html#bfc85492b760e757" class="t t">ContainerCmdletProvider</a> <span id="r190 rd" class="r190 r">provider</span>,
            <a href="CoreCommandContext.cs.html#1e83d35d5286e174" class="t t">CmdletProviderContext</a> <span id="r191 rd" class="r191 r">context</span>)
        {
            <b>if</b> (<span class="r187 r">path</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r187 r">path</span>));
            }
 
            <b>if</b> (<span class="r190 r">provider</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r190 r">provider</span>));
            }
 
            <b>if</b> (<span class="r189 r">drive</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r189 r">drive</span>));
            }
 
            <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;path = {0}&quot;</span>, <span class="r187 r">path</span>);
 
            <a href="NavigationProviderBase.cs.html#7d31476313596b0b" class="t t">NavigationCmdletProvider</a> <span id="r192 rd" class="r192 r">navigationProvider</span> = <span class="r190 r">provider</span> <b>as</b> <a href="NavigationProviderBase.cs.html#7d31476313596b0b" class="t t">NavigationCmdletProvider</a>;
 
            <span class="i">Collection</span>&lt;<b>string</b>&gt; <span id="r193 rd" class="r193 r">result</span> = <b>new</b> <span class="i">Collection</span>&lt;<b>string</b>&gt;();
 
            <b>using</b> (<a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#19ce116f88d7b1c7" class="i method">TraceScope</a>(<span class="s">&quot;EXPANDING WILDCARDS&quot;</span>))
            {
                <b>if</b> (<a href="#3d032868debcca0c" class="i method">ShouldPerformGlobbing</a>(<span class="r187 r">path</span>, <span class="r191 r">context</span>))
                {
                    <span class="c">// This collection contains the directories for which a leaf is being added.</span>
                    <span class="c">// If the directories are being globed over as well, then there will be</span>
                    <span class="c">// many directories in this collection which will have to be iterated over</span>
                    <span class="c">// every time there is a child being added</span>
 
                    <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r194 rd" class="r194 r">dirs</span> = <b>new</b> <span class="i">List</span>&lt;<b>string</b>&gt;();
 
                    <span class="c">// Each leaf element that is pulled off the path is pushed on the stack in</span>
                    <span class="c">// order such that we can generate the path again.</span>
 
                    <span class="i">Stack</span>&lt;<b>string</b>&gt; <span id="r195 rd" class="r195 r">leafElements</span> = <b>new</b> <span class="i">Stack</span>&lt;<b>string</b>&gt;();
 
                    <b>using</b> (<a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#19ce116f88d7b1c7" class="i method">TraceScope</a>(<span class="s">&quot;Tokenizing path&quot;</span>))
                    {
                        <span class="c">// If the path contains glob characters then iterate through pulling the</span>
                        <span class="c">// leaf elements off and pushing them on to the leafElements stack until</span>
                        <span class="c">// there are no longer any glob characters in the path.</span>
 
                        <b>while</b> (<a href="#be9734ddba52229e" class="i method">StringContainsGlobCharacters</a>(<span class="r187 r">path</span>))
                        {
                            <span class="c">// Make sure to obey StopProcessing</span>
                            <b>if</b> (<span class="r191 r">context</span>.<a href="CoreCommandContext.cs.html#649b794a0afa4fa8" class="i property">Stopping</a>)
                            {
                                <b>throw</b> <b>new</b> <a href="../utils/ExecutionExceptions.cs.html#105b0214d3aab114" class="t constructor">PipelineStoppedException</a>();
                            }
 
                            <span class="c">// Use the provider to get the leaf element string</span>
 
                            <b>string</b> <span id="r196 rd" class="r196 r">leafElement</span> = <span class="r187 r">path</span>;
 
                            <b>if</b> (<span class="r192 r">navigationProvider</span> != <b>null</b>)
                            {
                                <span class="r196 r">leafElement</span> = <span class="r192 r">navigationProvider</span>.<a href="NavigationProviderBase.cs.html#0fc64120846797fb" class="i method">GetChildName</a>(<span class="r187 r">path</span>, <span class="r191 r">context</span>);
                            }
 
                            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r196 r">leafElement</span>))
                            {
                                <b>break</b>;
                            }
 
                            <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Pushing leaf element: {0}&quot;</span>, <span class="r196 r">leafElement</span>);
 
                            <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Leaf element: {0}&quot;</span>, <span class="r196 r">leafElement</span>);
 
                            <span class="c">// Push the leaf element onto the leaf element stack for future use</span>
 
                            <span class="r195 r">leafElements</span>.<span class="i">Push</span>(<span class="r196 r">leafElement</span>);
 
                            <span class="c">// Now use the parent path for the next iteration</span>
 
                            <b>if</b> (<span class="r192 r">navigationProvider</span> != <b>null</b>)
                            {
                                <span class="c">// Now call GetParentPath with the root</span>
 
                                <b>string</b> <span id="r197 rd" class="r197 r">newParentPath</span> = <span class="r192 r">navigationProvider</span>.<a href="NavigationProviderBase.cs.html#df8c0961560a6b0d" class="i method">GetParentPath</a>(<span class="r187 r">path</span>, <span class="r189 r">drive</span>.<a href="../engine/DataStoreAdapter.cs.html#6c8f4db73167e8f9" class="i property">Root</a>, <span class="r191 r">context</span>);
 
                                <b>if</b> (<b>string</b>.<span class="i">Equals</span>(
                                        <span class="r197 r">newParentPath</span>,
                                        <span class="r187 r">path</span>,
                                        <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                                {
                                    <span class="c">// The provider is implemented in an inconsistent way.</span>
                                    <span class="c">// GetChildName returned a non-empty/non-null result but</span>
                                    <span class="c">// GetParentPath with the same path returns the same path.</span>
                                    <span class="c">// This would cause the globber to go into an infinite loop,</span>
                                    <span class="c">// so instead an exception is thrown.</span>
 
                                    <a href="../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r198 rd" class="r198 r">invalidOperation</span> =
                                        <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(
                                            <span class="i">SessionStateStrings</span>.<span class="i">ProviderImplementationInconsistent</span>,
                                            <span class="r190 r">provider</span>.<a href="ProviderBase.cs.html#6129ef83671ead76" class="i property">ProviderInfo</a>.<a href="../engine/DataStoreAdapterProvider.cs.html#2837d805ea30ef5c" class="i property">Name</a>,
                                            <span class="r187 r">path</span>);
                                    <b>throw</b> <span class="r198 r">invalidOperation</span>;
                                }
 
                                <span class="r187 r">path</span> = <span class="r197 r">newParentPath</span>;
                            }
                            <b>else</b>
                            {
                                <span class="c">// If the provider doesn&#39;t implement NavigationCmdletProvider then at most</span>
                                <span class="c">// it can have only one segment in its path. So after removing</span>
                                <span class="c">// the leaf all we have left is the empty string.</span>
 
                                <span class="r187 r">path</span> = <b>string</b>.<span class="i">Empty</span>;
                            }
 
                            <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;New path: {0}&quot;</span>, <span class="r187 r">path</span>);
 
                            <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Parent path: {0}&quot;</span>, <span class="r187 r">path</span>);
                        }
 
                        <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Base container path: {0}&quot;</span>, <span class="r187 r">path</span>);
 
                        <span class="c">// If no glob elements were found there must be an include and/or</span>
                        <span class="c">// exclude specified. Use the parent path to iterate over to</span>
                        <span class="c">// resolve the include/exclude filters</span>
 
                        <b>if</b> (<span class="r195 r">leafElements</span>.<span class="i">Count</span> == 0)
                        {
                            <b>string</b> <span id="r199 rd" class="r199 r">leafElement</span> = <span class="r187 r">path</span>;
 
                            <b>if</b> (<span class="r192 r">navigationProvider</span> != <b>null</b>)
                            {
                                <span class="r199 r">leafElement</span> = <span class="r192 r">navigationProvider</span>.<a href="NavigationProviderBase.cs.html#0fc64120846797fb" class="i method">GetChildName</a>(<span class="r187 r">path</span>, <span class="r191 r">context</span>);
 
                                <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r199 r">leafElement</span>))
                                {
                                    <span class="r187 r">path</span> = <span class="r192 r">navigationProvider</span>.<a href="NavigationProviderBase.cs.html#df8c0961560a6b0d" class="i method">GetParentPath</a>(<span class="r187 r">path</span>, <b>null</b>, <span class="r191 r">context</span>);
                                }
                            }
                            <b>else</b>
                            {
                                <span class="r187 r">path</span> = <b>string</b>.<span class="i">Empty</span>;
                            }
 
                            <span class="r195 r">leafElements</span>.<span class="i">Push</span>(<span class="r199 r">leafElement</span>);
 
                            <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Leaf element: {0}&quot;</span>, <span class="r199 r">leafElement</span>);
                        }
 
                        <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Root path of resolution: {0}&quot;</span>, <span class="r187 r">path</span>);
                    }
 
                    <span class="c">// Once the container path with no glob characters are found store it</span>
                    <span class="c">// so that it&#39;s children can be iterated over.</span>
 
                    <span class="r194 r">dirs</span>.<span class="i">Add</span>(<span class="r187 r">path</span>);
 
                    <span class="c">// Reconstruct the path one leaf element at a time, expanding wherever</span>
                    <span class="c">// we encounter glob characters</span>
 
                    <b>while</b> (<span class="r195 r">leafElements</span>.<span class="i">Count</span> &gt; 0)
                    {
                        <span class="c">// Make sure to obey StopProcessing</span>
                        <b>if</b> (<span class="r191 r">context</span>.<a href="CoreCommandContext.cs.html#649b794a0afa4fa8" class="i property">Stopping</a>)
                        {
                            <b>throw</b> <b>new</b> <a href="../utils/ExecutionExceptions.cs.html#105b0214d3aab114" class="t constructor">PipelineStoppedException</a>();
                        }
 
                        <b>string</b> <span id="r200 rd" class="r200 r">leafElement</span> = <span class="r195 r">leafElements</span>.<span class="i">Pop</span>();
 
                        <span class="i n">Dbg</span>.<a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<span class="i">Assert</span>(
                            <span class="r200 r">leafElement</span> != <b>null</b>,
                            <span class="s">&quot;I am only pushing strings onto this stack so I should be able &quot;</span> +
                            <span class="s">&quot;to cast any Pop to a string without failure.&quot;</span>);
 
                        <span class="r194 r">dirs</span> =
                            <a href="#27e781f525800751" class="i method">GenerateNewPSPathsWithGlobLeaf</a>(
                                <span class="r194 r">dirs</span>,
                                <span class="r189 r">drive</span>,
                                <span class="r200 r">leafElement</span>,
                                <span class="r195 r">leafElements</span>.<span class="i">Count</span> == 0,
                                <span class="r190 r">provider</span>,
                                <span class="r191 r">context</span>);
 
                        <span class="c">// If there are more leaf elements in the stack we need</span>
                        <span class="c">// to make sure that only containers where added to dirs</span>
                        <span class="c">// in GenerateNewPathsWithGlobLeaf</span>
 
                        <b>if</b> (<span class="r195 r">leafElements</span>.<span class="i">Count</span> &gt; 0)
                        {
                            <b>using</b> (<a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#19ce116f88d7b1c7" class="i method">TraceScope</a>(<span class="s">&quot;Checking matches to ensure they are containers&quot;</span>))
                            {
                                <b>int</b> <span id="r201 rd" class="r201 r">index</span> = 0;
 
                                <b>while</b> (<span class="r201 r">index</span> &lt; <span class="r194 r">dirs</span>.<span class="i">Count</span>)
                                {
                                    <span class="c">// Make sure to obey StopProcessing</span>
                                    <b>if</b> (<span class="r191 r">context</span>.<a href="CoreCommandContext.cs.html#649b794a0afa4fa8" class="i property">Stopping</a>)
                                    {
                                        <b>throw</b> <b>new</b> <a href="../utils/ExecutionExceptions.cs.html#105b0214d3aab114" class="t constructor">PipelineStoppedException</a>();
                                    }
 
                                    <b>string</b> <span id="r202 rd" class="r202 r">resolvedPath</span> =
                                        <span class="i">GetMshQualifiedPath</span>(<span class="r194 r">dirs</span>[<span class="r201 r">index</span>], <span class="r189 r">drive</span>);
 
                                    <span class="c">// Check to see if the matching item is a container</span>
 
                                    <b>if</b> (<span class="r192 r">navigationProvider</span> != <b>null</b> &amp;&amp;
                                        !<a href="#06ecc54ac29ea6b5" class="i field">_sessionState</a>.<a href="../engine/SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../engine/SessionStateContainer.cs.html#46251a874d9ff012" class="i method">IsItemContainer</a>(
                                            <span class="r202 r">resolvedPath</span>,
                                            <span class="r191 r">context</span>))
                                    {
                                        <span class="c">// If not, remove it from the collection</span>
 
                                        <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<span class="i">WriteLine</span>(
                                            <span class="s">&quot;Removing {0} because it is not a container&quot;</span>,
                                            <span class="r194 r">dirs</span>[<span class="r201 r">index</span>]);
 
                                        <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<span class="i">WriteLine</span>(<span class="s">&quot;{0} is not a container&quot;</span>, <span class="r194 r">dirs</span>[<span class="r201 r">index</span>]);
                                        <span class="r194 r">dirs</span>.<span class="i">RemoveAt</span>(<span class="r201 r">index</span>);
                                    }
                                    <b>else</b> <b>if</b> (<span class="r192 r">navigationProvider</span> == <b>null</b>)
                                    {
                                        <span class="i n">Dbg</span>.<a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<span class="i">Assert</span>(
                                            <span class="r192 r">navigationProvider</span> != <b>null</b>,
                                            <span class="s">&quot;The path in the dirs should never be a container unless &quot;</span> +
                                            <span class="s">&quot;the provider implements the NavigationCmdletProvider interface. If it &quot;</span> +
                                            <span class="s">&quot;doesn&#39;t, there should be no more leafElements in the stack &quot;</span> +
                                            <span class="s">&quot;when this check is done&quot;</span>);
                                    }
                                    <b>else</b>
                                    {
                                        <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<span class="i">WriteLine</span>(<span class="s">&quot;{0} is a container&quot;</span>, <span class="r194 r">dirs</span>[<span class="r201 r">index</span>]);
 
                                        <span class="c">// If so, leave it and move on to the next one</span>
 
                                        ++<span class="r201 r">index</span>;
                                    }
                                }
                            }
                        }
                    }
 
                    <span class="i n">Dbg</span>.<a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<span class="i">Assert</span>(
                        <span class="r194 r">dirs</span> != <b>null</b>,
                        <span class="s">&quot;GenerateNewPathsWithGlobLeaf() should return the base path as an element &quot;</span> +
                        <span class="s">&quot;even if there are no globing characters&quot;</span>);
 
                    <b>foreach</b> (<b>string</b> <span id="r203 rd" class="r203 r">dir</span> <b>in</b> <span class="r194 r">dirs</span>)
                    {
                        <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;RESOLVED PATH: {0}&quot;</span>, <span class="r203 r">dir</span>);
                        <span class="r193 r">result</span>.<span class="i">Add</span>(<span class="r203 r">dir</span>);
                    }
 
                    <span class="i n">Dbg</span>.<a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<span class="i">Assert</span>(
                        <span class="r194 r">dirs</span>.<span class="i">Count</span> == <span class="r193 r">result</span>.<span class="i">Count</span>,
                        <span class="s">&quot;The result of copying the globed strings should be the same &quot;</span> +
                        <span class="s">&quot;as from the collection&quot;</span>);
                }
                <b>else</b>
                {
                    <b>string</b> <span id="r204 rd" class="r204 r">unescapedPath</span> = <span class="r191 r">context</span>.<a href="CoreCommandContext.cs.html#b9edf955d3776935" class="i property">SuppressWildcardExpansion</a> ? <span class="r187 r">path</span> : <a href="#aca636e8bca803e1" class="i method">RemoveGlobEscaping</a>(<span class="r187 r">path</span>);
 
                    <b>string</b> <span id="r205 rd" class="r205 r">formatString</span> = <span class="s">&quot;{0}:&quot;</span> + <a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a> + <span class="s">&quot;{1}&quot;</span>;
 
                    <span class="c">// Check to see if its a hidden provider drive.</span>
                    <b>if</b> (<span class="r189 r">drive</span>.<a href="../engine/DataStoreAdapter.cs.html#27d719becccdef1a" class="i property">Hidden</a>)
                    {
                        <b>if</b> (<a href="#f0c7a79be5b8b12b" class="i method">IsProviderDirectPath</a>(<span class="r204 r">unescapedPath</span>))
                        {
                            <span class="r205 r">formatString</span> = <span class="s">&quot;{1}&quot;</span>;
                        }
                        <b>else</b>
                        {
                            <span class="r205 r">formatString</span> = <span class="s">&quot;{0}::{1}&quot;</span>;
                        }
                    }
                    <b>else</b>
                    {
                        <b>if</b> (<span class="r187 r">path</span>.<span class="i">StartsWith</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a>))
                        {
                            <span class="r205 r">formatString</span> = <span class="s">&quot;{0}:{1}&quot;</span>;
                        }
                    }
 
                    <span class="c">// Porting note: if the volume is not separated by a colon (non-Windows filesystems), don&#39;t add it.</span>
                    <b>if</b> (!<span class="r189 r">drive</span>.<a href="../engine/DataStoreAdapter.cs.html#70ae98926d1292a8" class="i property">VolumeSeparatedByColon</a>)
                    {
                        <span class="r205 r">formatString</span> = <span class="s">&quot;{0}{1}&quot;</span>;
                    }
 
                    <b>string</b> <span id="r206 rd" class="r206 r">resolvedPath</span> =
                        <b>string</b>.<span class="i">Format</span>(
                            <span class="i n">System</span>.<span class="i">Globalization</span>.<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                            <span class="r205 r">formatString</span>,
                            <span class="r189 r">drive</span>.<a href="../engine/DataStoreAdapter.cs.html#7c2d83a1b2b425a9" class="i property">Name</a>,
                            <span class="r204 r">unescapedPath</span>);
 
                    <span class="c">// Since we didn&#39;t do globbing, be sure the path exists</span>
                    <b>if</b> (<span class="r188 r">allowNonexistingPaths</span> ||
                        <span class="r190 r">provider</span>.<a href="ItemProviderBase.cs.html#99dfd768e6f3aa7c" class="i method">ItemExists</a>(<a href="#11c999b7af9a2872" class="i method">GetProviderPath</a>(<span class="r206 r">resolvedPath</span>, <span class="r191 r">context</span>), <span class="r191 r">context</span>))
                    {
                        <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;RESOLVED PATH: {0}&quot;</span>, <span class="r206 r">resolvedPath</span>);
                        <span class="r193 r">result</span>.<span class="i">Add</span>(<span class="r206 r">resolvedPath</span>);
                    }
                    <b>else</b>
                    {
                        <a href="../utils/SessionStateExceptions.cs.html#9ed59df3c4c15193" class="t t">ItemNotFoundException</a> <span id="r207 rd" class="r207 r">pathNotFound</span> =
                            <b>new</b> <span class="t">ItemNotFoundException</span>(
                                <span class="r206 r">resolvedPath</span>,
                                <span class="s">&quot;PathNotFound&quot;</span>,
                                <span class="i">SessionStateStrings</span>.<span class="i">PathNotFound</span>);
 
                        <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#e7dd110db4bf902f" class="i method">TraceError</a>(<span class="s">&quot;Item does not exist: {0}&quot;</span>, <span class="r187 r">path</span>);
 
                        <b>throw</b> <span class="r207 r">pathNotFound</span>;
                    }
                }
            }
 
            <span class="i n">Dbg</span>.<a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(
                <span class="r193 r">result</span> != <b>null</b>,
                <span class="s">&quot;This method should at least return the path or more if it has glob characters&quot;</span>);
 
            <b>return</b> <span class="r193 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets either a drive-qualified or provider-qualified path based on the drive</span>
        <span class="c">///</span><span class="c"> information.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r208 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to create a qualified path from.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r209 r">drive</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The drive used to qualify the path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Either a drive-qualified or provider-qualified Msh path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The drive&#39;s Hidden property is used to determine if the path returned</span>
        <span class="c">///</span><span class="c"> should be provider (hidden=true) or drive (hidden=false) qualified.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r208 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> or </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r209 r">drive</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal static string</b> <a id="0e913e4e0948eb8f" href="../R/0e913e4e0948eb8f.html" target="n" data-glyph="74,1" class="i method">GetMshQualifiedPath</a>(<b>string</b> <span id="r208 rd" class="r208 r">path</span>, <a href="../engine/DataStoreAdapter.cs.html#2d16b26a541ba185" class="t t">PSDriveInfo</a> <span id="r209 rd" class="r209 r">drive</span>)
        {
            <span class="i n">Dbg</span>.<a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(
                <span class="r209 r">drive</span> != <b>null</b>,
                <span class="s">&quot;The caller should verify drive before calling this method&quot;</span>);
 
            <b>string</b> <span id="r210 rd" class="r210 r">result</span> = <b>null</b>;
 
            <b>if</b> (<span class="r209 r">drive</span>.<a href="../engine/DataStoreAdapter.cs.html#27d719becccdef1a" class="i property">Hidden</a>)
            {
                <b>if</b> (<a href="#6387d90abe0ca584" class="t t">LocationGlobber</a>.<a href="#f0c7a79be5b8b12b" class="i method">IsProviderDirectPath</a>(<span class="r208 r">path</span>))
                {
                    <span class="r210 r">result</span> = <span class="r208 r">path</span>;
                }
                <b>else</b>
                {
                    <span class="r210 r">result</span> = <a href="#27fa0f384ea11c27" class="i method">GetProviderQualifiedPath</a>(<span class="r208 r">path</span>, <span class="r209 r">drive</span>.<a href="../engine/DataStoreAdapter.cs.html#599e6ea3519fc2d6" class="i property">Provider</a>);
                }
            }
            <b>else</b>
            {
                <span class="r210 r">result</span> = <a href="#86d3acb1cb597023" class="i method">GetDriveQualifiedPath</a>(<span class="r208 r">path</span>, <span class="r209 r">drive</span>);
            }
 
            <b>return</b> <span class="r210 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Removes the provider or drive qualifier from a Msh path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r211 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to remove the qualifier from.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r212 r">drive</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The drive information used to determine if a provider qualifier</span>
        <span class="c">///</span><span class="c"> or drive qualifier should be removed from the path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path with the Msh qualifier removed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static string</b> <a id="614edb728fb5b176" href="../R/614edb728fb5b176.html" target="n" data-glyph="74,1" class="i method">RemoveMshQualifier</a>(<b>string</b> <span id="r211 rd" class="r211 r">path</span>, <a href="../engine/DataStoreAdapter.cs.html#2d16b26a541ba185" class="t t">PSDriveInfo</a> <span id="r212 rd" class="r212 r">drive</span>)
        {
            <span class="i n">Dbg</span>.<a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(
                <span class="r212 r">drive</span> != <b>null</b>,
                <span class="s">&quot;The caller should verify drive before calling this method&quot;</span>);
 
            <span class="i n">Dbg</span>.<a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(
                <span class="r211 r">path</span> != <b>null</b>,
                <span class="s">&quot;The caller should verify path before calling this method&quot;</span>);
 
            <b>string</b> <span id="r213 rd" class="r213 r">result</span> = <b>null</b>;
 
            <b>if</b> (<span class="r212 r">drive</span>.<a href="../engine/DataStoreAdapter.cs.html#27d719becccdef1a" class="i property">Hidden</a>)
            {
                <span class="r213 r">result</span> = <a href="#149522c936e47b53" class="i method">RemoveProviderQualifier</a>(<span class="r211 r">path</span>);
            }
            <b>else</b>
            {
                <span class="r213 r">result</span> = <a href="#688ebfbb5a0e9e10" class="i method">RemoveDriveQualifier</a>(<span class="r211 r">path</span>);
            }
 
            <b>return</b> <span class="r213 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Given an Msh relative or absolute path, returns a drive-qualified absolute path.</span>
        <span class="c">///</span><span class="c"> No globbing or relative path character expansion is done.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r214 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to get the drive qualified path from.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r215 r">drive</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The drive the path should be qualified with.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A drive-qualified absolute Msh path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r214 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> or </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r215 r">drive</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal static string</b> <a id="86d3acb1cb597023" href="../R/86d3acb1cb597023.html" target="n" data-glyph="74,1" class="i method">GetDriveQualifiedPath</a>(<b>string</b> <span id="r214 rd" class="r214 r">path</span>, <a href="../engine/DataStoreAdapter.cs.html#2d16b26a541ba185" class="t t">PSDriveInfo</a> <span id="r215 rd" class="r215 r">drive</span>)
        {
            <b>if</b> (<span class="r214 r">path</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r214 r">path</span>));
            }
 
            <b>if</b> (<span class="r215 r">drive</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r215 r">drive</span>));
            }
 
            <b>string</b> <span id="r216 rd" class="r216 r">result</span> = <span class="r214 r">path</span>;
            <b>bool</b> <span id="r217 rd" class="r217 r">treatAsRelative</span> = <b>true</b>;
 
            <b>if</b> (<span class="r215 r">drive</span>.<a href="../engine/DataStoreAdapter.cs.html#70ae98926d1292a8" class="i property">VolumeSeparatedByColon</a>)
            {
                <span class="c">// Ensure the drive name is the same as the portion of the path before</span>
                <span class="c">// :. If not add the drive name and colon as if it was a relative path</span>
 
                <b>int</b> <span id="r218 rd" class="r218 r">index</span> = <span class="r214 r">path</span>.<span class="i">IndexOf</span>(<span class="s">&#39;:&#39;</span>);
 
                <b>if</b> (<span class="r218 r">index</span> != -1)
                {
                    <b>if</b> (<span class="r215 r">drive</span>.<a href="../engine/DataStoreAdapter.cs.html#27d719becccdef1a" class="i property">Hidden</a>)
                    {
                        <span class="r217 r">treatAsRelative</span> = <b>false</b>;
                    }
                    <b>else</b>
                    {
                        <b>if</b> (<span class="r214 r">path</span>.<span class="i">AsSpan</span>(0, <span class="r218 r">index</span>).<span class="i">Equals</span>(<span class="r215 r">drive</span>.<a href="../engine/DataStoreAdapter.cs.html#7c2d83a1b2b425a9" class="i property">Name</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                        {
                            <span class="r217 r">treatAsRelative</span> = <b>false</b>;
                        }
                    }
                }
                <b>else</b>
                {
                    <span class="c">// Check if the path begins with &quot;\&quot; or &quot;/&quot; (UNC Path or Path in Unix).</span>
                    <span class="c">// Ignore if the path resolves to a drive path, this will happen when path is equal to &quot;\&quot; or &quot;/&quot;.</span>
                    <span class="c">// Drive path still need formatting, so treat them as relative.</span>
                    <b>if</b> (<span class="r214 r">path</span>.<span class="i">Length</span> &gt; 1 &amp;&amp; (<span class="r214 r">path</span>.<span class="i">StartsWith</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a>) ||
                        <span class="r214 r">path</span>.<span class="i">StartsWith</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#f2548f0f61690656" class="i field">AlternatePathSeparator</a>)))
                    {
                        <span class="r217 r">treatAsRelative</span> = <b>false</b>;
                    }
                }
            }
            <b>else</b>
            {
                <b>if</b> (<a href="#4cd70f3f191704a0" class="i method">IsAbsolutePath</a>(<span class="r214 r">path</span>))
                {
                    <span class="r217 r">treatAsRelative</span> = <b>false</b>;
                }
            }
 
            <b>if</b> (<span class="r217 r">treatAsRelative</span>)
            {
                <b>string</b> <span id="r219 rd" class="r219 r">formatString</span>;
                <b>if</b> (<span class="r215 r">drive</span>.<a href="../engine/DataStoreAdapter.cs.html#70ae98926d1292a8" class="i property">VolumeSeparatedByColon</a>)
                {
                    <span class="r219 r">formatString</span> = <span class="s">&quot;{0}:&quot;</span> + <a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a> + <span class="s">&quot;{1}&quot;</span>;
                    <b>if</b> (<span class="r214 r">path</span>.<span class="i">StartsWith</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a>))
                    {
                        <span class="r219 r">formatString</span> = <span class="s">&quot;{0}:{1}&quot;</span>;
                    }
                }
                <b>else</b>
                {
                    <span class="r219 r">formatString</span> = <span class="s">&quot;{0}{1}&quot;</span>;
                }
 
                <span class="r216 r">result</span> =
                    <b>string</b>.<span class="i">Format</span>(
                        <span class="i n">System</span>.<span class="i">Globalization</span>.<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                        <span class="r219 r">formatString</span>,
                        <span class="r215 r">drive</span>.<a href="../engine/DataStoreAdapter.cs.html#7c2d83a1b2b425a9" class="i property">Name</a>,
                        <span class="r214 r">path</span>);
            }
 
            <b>return</b> <span class="r216 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Removes the drive qualifier from a drive qualified MSH path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r220 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to remove the drive qualifier from.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path without the drive qualifier.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static string</b> <a id="688ebfbb5a0e9e10" href="../R/688ebfbb5a0e9e10.html" target="n" data-glyph="76,1" class="i method">RemoveDriveQualifier</a>(<b>string</b> <span id="r220 rd" class="r220 r">path</span>)
        {
            <span class="i n">Dbg</span>.<a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(
                <span class="r220 r">path</span> != <b>null</b>,
                <span class="s">&quot;Caller should verify path&quot;</span>);
 
            <b>string</b> <span id="r221 rd" class="r221 r">result</span> = <span class="r220 r">path</span>;
 
            <span class="c">// Find the drive separator only if it&#39;s before a path separator</span>
 
            <b>int</b> <span id="r222 rd" class="r222 r">index</span> = <span class="r220 r">path</span>.<span class="i">IndexOf</span>(<span class="s">&#39;:&#39;</span>);
            <b>if</b> (<span class="r222 r">index</span> != -1)
            {
                <b>int</b> <span id="r223 rd" class="r223 r">separator</span> = <span class="r220 r">path</span>.<span class="i">IndexOf</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a>, 0, <span class="r222 r">index</span>);
                <b>if</b> (<span class="r223 r">separator</span> == -1)
                {
                    <span class="r223 r">separator</span> = <span class="r220 r">path</span>.<span class="i">IndexOf</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#f2548f0f61690656" class="i field">AlternatePathSeparator</a>, 0, <span class="r222 r">index</span>);
                }
 
                <b>if</b> (<span class="r223 r">separator</span> == -1 || <span class="r222 r">index</span> &lt; <span class="r223 r">separator</span>)
                {
                    <span class="c">// Remove the \ or / if it follows the drive indicator</span>
                    <b>if</b> (<span class="r220 r">path</span>[<span class="r222 r">index</span> + 1] == <span class="s">&#39;\\&#39;</span> ||
                        <span class="r220 r">path</span>[<span class="r222 r">index</span> + 1] == <span class="s">&#39;/&#39;</span>)
                    {
                        ++<span class="r222 r">index</span>;
                    }
 
                    <span class="r221 r">result</span> = <span class="r220 r">path</span>.<span class="i">Substring</span>(<span class="r222 r">index</span> + 1);
                }
            }
 
            <b>return</b> <span class="r221 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Given an Msh path, returns a provider-qualified path.</span>
        <span class="c">///</span><span class="c"> No globbing or relative path character expansion is done.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r224 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to get the drive qualified path from.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r225 r">provider</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The provider the path should be qualified with.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A drive-qualified absolute Msh path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r224 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> or </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r225 r">provider</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal static string</b> <a id="27fa0f384ea11c27" href="../R/27fa0f384ea11c27.html" target="n" data-glyph="74,1" class="i method">GetProviderQualifiedPath</a>(<b>string</b> <span id="r224 rd" class="r224 r">path</span>, <a href="../engine/DataStoreAdapterProvider.cs.html#dd4e1f2f8e73a1dd" class="t t">ProviderInfo</a> <span id="r225 rd" class="r225 r">provider</span>)
        {
            <b>if</b> (<span class="r224 r">path</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r224 r">path</span>));
            }
 
            <b>if</b> (<span class="r225 r">provider</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r225 r">provider</span>));
            }
 
            <b>string</b> <span id="r226 rd" class="r226 r">result</span> = <span class="r224 r">path</span>;
            <b>bool</b> <span id="r227 rd" class="r227 r">pathResolved</span> = <b>false</b>;
 
            <span class="c">// Check to see if the path is already provider qualified</span>
 
            <b>int</b> <span id="r228 rd" class="r228 r">providerSeparatorIndex</span> = <span class="r224 r">path</span>.<span class="i">IndexOf</span>(<span class="s">&quot;::&quot;</span>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>);
            <b>if</b> (<span class="r228 r">providerSeparatorIndex</span> != -1)
            {
                <b>string</b> <span id="r229 rd" class="r229 r">possibleProvider</span> = <span class="r224 r">path</span>.<span class="i">Substring</span>(0, <span class="r228 r">providerSeparatorIndex</span>);
 
                <b>if</b> (<span class="r225 r">provider</span>.<a href="../engine/DataStoreAdapterProvider.cs.html#13e2cce7adaad137" class="i method">NameEquals</a>(<span class="r229 r">possibleProvider</span>))
                {
                    <span class="r227 r">pathResolved</span> = <b>true</b>;
                }
            }
 
            <b>if</b> (!<span class="r227 r">pathResolved</span>)
            {
                <span class="r226 r">result</span> =
                    <b>string</b>.<span class="i">Format</span>(
                        <span class="i n">System</span>.<span class="i">Globalization</span>.<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                        <span class="s">&quot;{0}{1}{2}&quot;</span>,
                        <span class="r225 r">provider</span>.<a href="../engine/DataStoreAdapterProvider.cs.html#91a8d08ee3ba5a61" class="i property">FullName</a>,
                        <a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#6981dbcadad2340f" class="i field">ProviderPathSeparator</a>,
                        <span class="r224 r">path</span>);
            }
 
            <b>return</b> <span class="r226 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Removes the provider qualifier from a provider-qualified MSH path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r230 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to remove the provider qualifier from.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path without the provider qualifier.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static string</b> <a id="149522c936e47b53" href="../R/149522c936e47b53.html" target="n" data-glyph="74,1" class="i method">RemoveProviderQualifier</a>(<b>string</b> <span id="r230 rd" class="r230 r">path</span>)
        {
            <span class="i n">Dbg</span>.<a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(
                <span class="r230 r">path</span> != <b>null</b>,
                <span class="s">&quot;Caller should verify path&quot;</span>);
 
            <b>string</b> <span id="r231 rd" class="r231 r">result</span> = <span class="r230 r">path</span>;
 
            <span class="c">// Find the drive separator</span>
 
            <b>int</b> <span id="r232 rd" class="r232 r">index</span> = <span class="r230 r">path</span>.<span class="i">IndexOf</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#6981dbcadad2340f" class="i field">ProviderPathSeparator</a>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>);
 
            <b>if</b> (<span class="r232 r">index</span> != -1)
            {
                <span class="c">// The +2 removes the ::</span>
                <span class="r231 r">result</span> = <span class="r230 r">path</span>.<span class="i">Substring</span>(<span class="r232 r">index</span> + <a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#6981dbcadad2340f" class="i field">ProviderPathSeparator</a>.<span class="i">Length</span>);
            }
 
            <b>return</b> <span class="r231 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Generates a collection of containers and/or leaves that are children of the containers</span>
        <span class="c">///</span><span class="c"> in the currentDirs parameter and match the glob expression in the</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r233 r">leafElement</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> parameter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r234 r">currentDirs</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A collection of paths that should be searched for leaves that match the</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r233 r">leafElement</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> expression.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r235 r">drive</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The drive the Msh path is relative to.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r233 r">leafElement</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A single element of a path that may or may not contain a glob expression. This parameter</span>
        <span class="c">///</span><span class="c"> is used to search the containers in </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r234 r">currentDirs</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> for children that</span>
        <span class="c">///</span><span class="c"> match the glob expression.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r236 r">isLastLeaf</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> True if the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r233 r">leafElement</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is the last element to glob over. If false, we</span>
        <span class="c">///</span><span class="c"> need to get all container names from the provider even if they don&#39;t match the filter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r237 r">provider</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The provider associated with the paths that are being passed in the</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r234 r">currentDirs</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> and </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r233 r">leafElement</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> parameters.</span>
        <span class="c">///</span><span class="c"> The provider must derive from ContainerCmdletProvider or NavigationCmdletProvider</span>
        <span class="c">///</span><span class="c"> in order to get globbing.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r238 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The context the provider uses when performing the operation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A collection of fully qualified namespace paths whose leaf element matches the</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r233 r">leafElement</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> expression.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r234 r">currentDirs</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> or </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r237 r">provider</span><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#35e07c15a7526bcd" class="t t">ProviderInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider used to build the path threw an exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">NotSupportedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider that the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="i">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> represents is not a NavigationCmdletProvider</span>
        <span class="c">///</span><span class="c"> or ContainerCmdletProvider.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="i">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> starts with &quot;~&quot; and the home location is not set for</span>
        <span class="c">///</span><span class="c"> the provider.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#35e07c15a7526bcd" class="t t">ProviderInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider associated with the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="i">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> threw an</span>
        <span class="c">///</span><span class="c"> exception when its GetParentPath or MakePath was called while</span>
        <span class="c">///</span><span class="c"> processing the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="i">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r238 r">context</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> has been signaled for</span>
        <span class="c">///</span><span class="c"> StopProcessing.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Any exception can be thrown by the provider that is called to build</span>
        <span class="c">///</span><span class="c"> the provider path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>private</b> <span class="i">List</span>&lt;<b>string</b>&gt; <a id="27e781f525800751" href="../R/27e781f525800751.html" target="n" data-glyph="76,1" class="i method">GenerateNewPSPathsWithGlobLeaf</a>(
            <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r234 rd" class="r234 r">currentDirs</span>,
            <a href="../engine/DataStoreAdapter.cs.html#2d16b26a541ba185" class="t t">PSDriveInfo</a> <span id="r235 rd" class="r235 r">drive</span>,
            <b>string</b> <span id="r233 rd" class="r233 r">leafElement</span>,
            <b>bool</b> <span id="r236 rd" class="r236 r">isLastLeaf</span>,
            <a href="ContainerProviderBase.cs.html#bfc85492b760e757" class="t t">ContainerCmdletProvider</a> <span id="r237 rd" class="r237 r">provider</span>,
            <a href="CoreCommandContext.cs.html#1e83d35d5286e174" class="t t">CmdletProviderContext</a> <span id="r238 rd" class="r238 r">context</span>)
        {
            <b>if</b> (<span class="r234 r">currentDirs</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r234 r">currentDirs</span>));
            }
 
            <b>if</b> (<span class="r237 r">provider</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r237 r">provider</span>));
            }
 
            <a href="NavigationProviderBase.cs.html#7d31476313596b0b" class="t t">NavigationCmdletProvider</a> <span id="r239 rd" class="r239 r">navigationProvider</span> = <span class="r237 r">provider</span> <b>as</b> <a href="NavigationProviderBase.cs.html#7d31476313596b0b" class="t t">NavigationCmdletProvider</a>;
 
            <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r240 rd" class="r240 r">newDirs</span> = <b>new</b> <span class="i">List</span>&lt;<b>string</b>&gt;();
 
            <span class="c">// Only loop through the child names if the leafElement contains a glob character</span>
 
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r233 r">leafElement</span>) &amp;&amp;
                <a href="#be9734ddba52229e" class="i method">StringContainsGlobCharacters</a>(<span class="r233 r">leafElement</span>) ||
                <span class="r236 r">isLastLeaf</span>)
            {
                <b>string</b> <span id="r241 rd" class="r241 r">regexEscapedLeafElement</span> = <a href="#8c81c52992842786" class="i method">ConvertMshEscapeToRegexEscape</a>(<span class="r233 r">leafElement</span>);
 
                <span class="c">// Construct the glob filter</span>
 
                <a href="../engine/regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a> <span id="r242 rd" class="r242 r">stringMatcher</span> =
                    <a href="../engine/regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../engine/regex.cs.html#03cc3ceece086129" class="i method">Get</a>(
                        <span class="r241 r">regexEscapedLeafElement</span>,
                        <a href="../engine/regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../engine/regex.cs.html#2d0521a6986208d3" class="i field">IgnoreCase</a>);
 
                <span class="c">// Construct the include filter</span>
 
                <span class="i">Collection</span>&lt;<a href="../engine/regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <span id="r243 rd" class="r243 r">includeMatcher</span> =
                    <a href="../engine/SessionStateUtils.cs.html#a64f812795996898" class="t t">SessionStateUtilities</a>.<span class="i">CreateWildcardsFromStrings</span>(
                        <span class="r238 r">context</span>.<a href="CoreCommandContext.cs.html#ab4bd68ec99ecaa3" class="i property">Include</a>,
                        <a href="../engine/regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../engine/regex.cs.html#2d0521a6986208d3" class="i field">IgnoreCase</a>);
 
                <span class="c">// Construct the exclude filter</span>
 
                <span class="i">Collection</span>&lt;<a href="../engine/regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <span id="r244 rd" class="r244 r">excludeMatcher</span> =
                    <a href="../engine/SessionStateUtils.cs.html#a64f812795996898" class="t t">SessionStateUtilities</a>.<span class="i">CreateWildcardsFromStrings</span>(
                        <span class="r238 r">context</span>.<a href="CoreCommandContext.cs.html#93e21581391c00fc" class="i property">Exclude</a>,
                        <a href="../engine/regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../engine/regex.cs.html#2d0521a6986208d3" class="i field">IgnoreCase</a>);
 
                <span class="c">// Loop through the current dirs and add the appropriate children</span>
 
                <b>foreach</b> (<b>string</b> <span id="r245 rd" class="r245 r">dir</span> <b>in</b> <span class="r234 r">currentDirs</span>)
                {
                    <b>using</b> (<a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#ff5e86462c8f4f03" class="i method">TraceScope</a>(<span class="s">&quot;Expanding wildcards for items under &#39;{0}&#39;&quot;</span>, <span class="r245 r">dir</span>))
                    {
                        <span class="c">// Make sure to obey StopProcessing</span>
                        <b>if</b> (<span class="r238 r">context</span>.<a href="CoreCommandContext.cs.html#649b794a0afa4fa8" class="i property">Stopping</a>)
                        {
                            <b>throw</b> <b>new</b> <a href="../utils/ExecutionExceptions.cs.html#105b0214d3aab114" class="t constructor">PipelineStoppedException</a>();
                        }
 
                        <span class="c">// Now continue on with the names that were returned</span>
 
                        <b>string</b> <span id="r246 rd" class="r246 r">mshQualifiedParentPath</span> = <b>string</b>.<span class="i">Empty</span>;
                        <span class="i">Collection</span>&lt;<a href="../engine/MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r247 rd" class="r247 r">childNamesObjectArray</span> =
                            <span class="i">GetChildNamesInDir</span>(
                                <span class="r245 r">dir</span>,
                                <span class="r233 r">leafElement</span>,
                                !<span class="r236 r">isLastLeaf</span>,
                                <span class="r238 r">context</span>,
                                <b>false</b>,
                                <span class="r235 r">drive</span>,
                                <span class="r237 r">provider</span>,
                                <b>out</b> <span class="r246 r">mshQualifiedParentPath</span>);
 
                        <b>if</b> (<span class="r247 r">childNamesObjectArray</span> == <b>null</b>)
                        {
                            <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#e7dd110db4bf902f" class="i method">TraceError</a>(<span class="s">&quot;GetChildNames returned a null array&quot;</span>);
                            <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;No child names returned for &#39;{0}&#39;&quot;</span>, <span class="r245 r">dir</span>);
                            <b>continue</b>;
                        }
 
                        <span class="c">// Loop through each child to see if they match the glob expression</span>
 
                        <b>foreach</b> (<a href="../engine/MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r248 rd" class="r248 r">childObject</span> <b>in</b> <span class="r247 r">childNamesObjectArray</span>)
                        {
                            <span class="c">// Make sure to obey StopProcessing</span>
                            <b>if</b> (<span class="r238 r">context</span>.<a href="CoreCommandContext.cs.html#649b794a0afa4fa8" class="i property">Stopping</a>)
                            {
                                <b>throw</b> <b>new</b> <a href="../utils/ExecutionExceptions.cs.html#105b0214d3aab114" class="t constructor">PipelineStoppedException</a>();
                            }
 
                            <b>string</b> <span id="r249 rd" class="r249 r">child</span> = <b>string</b>.<span class="i">Empty</span>;
 
                            <b>if</b> (<a href="#992997769aae123d" class="i method">IsChildNameAMatch</a>(
                                    <span class="r248 r">childObject</span>,
                                    <span class="r242 r">stringMatcher</span>,
                                    <span class="r243 r">includeMatcher</span>,
                                    <span class="r244 r">excludeMatcher</span>,
                                    <b>out</b> <span class="r249 r">child</span>))
                            {
                                <b>string</b> <span id="r250 rd" class="r250 r">childPath</span> = <span class="r249 r">child</span>;
 
                                <b>if</b> (<span class="r239 r">navigationProvider</span> != <b>null</b>)
                                {
                                    <b>string</b> <span id="r251 rd" class="r251 r">parentPath</span> = <a href="#614edb728fb5b176" class="i method">RemoveMshQualifier</a>(<span class="r246 r">mshQualifiedParentPath</span>, <span class="r235 r">drive</span>);
 
                                    <span class="r250 r">childPath</span> = <a href="#06ecc54ac29ea6b5" class="i field">_sessionState</a>.<a href="../engine/SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../engine/SessionStateNavigation.cs.html#d830dabb37e51f31" class="i method">MakePath</a>(<span class="r251 r">parentPath</span>, <span class="r249 r">child</span>, <span class="r238 r">context</span>);
 
                                    <span class="r250 r">childPath</span> = <a href="#0e913e4e0948eb8f" class="i method">GetMshQualifiedPath</a>(<span class="r250 r">childPath</span>, <span class="r235 r">drive</span>);
                                }
 
                                <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Adding child path to dirs {0}&quot;</span>, <span class="r250 r">childPath</span>);
 
                                <span class="c">// -- If there are more leafElements, the current childPath will be treated as a container path later,</span>
                                <span class="c">//    we should escape the childPath in case the actual childPath contains wildcard characters such as &#39;[&#39; or &#39;]&#39;.</span>
                                <span class="c">// -- If there is no more leafElement, the childPath will not be further processed, and we don&#39;t need to</span>
                                <span class="c">//    escape it.</span>
                                <span class="r250 r">childPath</span> = <span class="r236 r">isLastLeaf</span> ? <span class="r250 r">childPath</span> : <a href="../engine/regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../engine/regex.cs.html#ec1c8a48d29314f3" class="i method">Escape</a>(<span class="r250 r">childPath</span>);
                                <span class="r240 r">newDirs</span>.<span class="i">Add</span>(<span class="r250 r">childPath</span>);
                            }
                        }
                    }
                }
            }
            <b>else</b>
            {
                <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#96aaf3813a5962a0" class="i method">WriteLine</a>(
                    <span class="s">&quot;LeafElement does not contain any glob characters so do a MakePath&quot;</span>);
 
                <span class="c">// Loop through the current dirs and add the leafElement to each of</span>
                <span class="c">// the dirs</span>
 
                <b>foreach</b> (<b>string</b> <span id="r252 rd" class="r252 r">dir</span> <b>in</b> <span class="r234 r">currentDirs</span>)
                {
                    <b>using</b> (<a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#ff5e86462c8f4f03" class="i method">TraceScope</a>(<span class="s">&quot;Expanding intermediate containers under &#39;{0}&#39;&quot;</span>, <span class="r252 r">dir</span>))
                    {
                        <span class="c">// Make sure to obey StopProcessing</span>
                        <b>if</b> (<span class="r238 r">context</span>.<a href="CoreCommandContext.cs.html#649b794a0afa4fa8" class="i property">Stopping</a>)
                        {
                            <b>throw</b> <b>new</b> <a href="../utils/ExecutionExceptions.cs.html#105b0214d3aab114" class="t constructor">PipelineStoppedException</a>();
                        }
 
                        <b>string</b> <span id="r253 rd" class="r253 r">backslashEscapedLeafElement</span> = <a href="#8c81c52992842786" class="i method">ConvertMshEscapeToRegexEscape</a>(<span class="r233 r">leafElement</span>);
 
                        <b>string</b> <span id="r254 rd" class="r254 r">unescapedDir</span> = <span class="r238 r">context</span>.<a href="CoreCommandContext.cs.html#b9edf955d3776935" class="i property">SuppressWildcardExpansion</a> ? <span class="r252 r">dir</span> : <a href="#aca636e8bca803e1" class="i method">RemoveGlobEscaping</a>(<span class="r252 r">dir</span>);
                        <b>string</b> <span id="r255 rd" class="r255 r">resolvedPath</span> = <a href="#0e913e4e0948eb8f" class="i method">GetMshQualifiedPath</a>(<span class="r254 r">unescapedDir</span>, <span class="r235 r">drive</span>);
 
                        <b>string</b> <span id="r256 rd" class="r256 r">childPath</span> = <span class="r253 r">backslashEscapedLeafElement</span>;
 
                        <b>if</b> (<span class="r239 r">navigationProvider</span> != <b>null</b>)
                        {
                            <b>string</b> <span id="r257 rd" class="r257 r">parentPath</span> = <a href="#614edb728fb5b176" class="i method">RemoveMshQualifier</a>(<span class="r255 r">resolvedPath</span>, <span class="r235 r">drive</span>);
 
                            <span class="r256 r">childPath</span> = <a href="#06ecc54ac29ea6b5" class="i field">_sessionState</a>.<a href="../engine/SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../engine/SessionStateNavigation.cs.html#d830dabb37e51f31" class="i method">MakePath</a>(<span class="r257 r">parentPath</span>, <span class="r253 r">backslashEscapedLeafElement</span>, <span class="r238 r">context</span>);
                            <span class="r256 r">childPath</span> = <a href="#0e913e4e0948eb8f" class="i method">GetMshQualifiedPath</a>(<span class="r256 r">childPath</span>, <span class="r235 r">drive</span>);
                        }
 
                        <b>if</b> (<a href="#06ecc54ac29ea6b5" class="i field">_sessionState</a>.<a href="../engine/SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../engine/SessionStateContainer.cs.html#ae28568c35847bd7" class="i method">ItemExists</a>(<span class="r256 r">childPath</span>, <span class="r238 r">context</span>))
                        {
                            <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Adding child path to dirs {0}&quot;</span>, <span class="r256 r">childPath</span>);
                            <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Valid intermediate container: {0}&quot;</span>, <span class="r256 r">childPath</span>);
 
                            <span class="r240 r">newDirs</span>.<span class="i">Add</span>(<span class="r256 r">childPath</span>);
                        }
                    }
                }
            }
 
            <b>return</b> <span class="r240 r">newDirs</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Generates an array of provider specific paths from the single provider specific</span>
        <span class="c">///</span><span class="c"> path using globing rules.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r258 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A path that may or may not contain globing characters.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r259 r">allowNonexistingPaths</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If true, a ItemNotFoundException will not be thrown for non-existing</span>
        <span class="c">///</span><span class="c"> paths. Instead an appropriate path will be returned as if it did exist.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r260 r">provider</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The provider that implements the namespace for the path that we are globing over.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r261 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The context the provider uses when performing the operation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An array of path strings that match the globing rules applied to the path parameter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> First the path is checked to see if it contains any globing characters (&#39;?&#39; or &#39;*&#39;).</span>
        <span class="c">///</span><span class="c"> If it doesn&#39;t then the path is returned as the only element in the array.</span>
        <span class="c">///</span><span class="c"> If it does, GetParentPath and GetLeafPathName is called on the path and each element</span>
        <span class="c">///</span><span class="c"> is stored until the path doesn&#39;t contain any globing characters. At that point</span>
        <span class="c">///</span><span class="c"> GetChildPathNames() is called on the provider with the last parent path that doesn&#39;t</span>
        <span class="c">///</span><span class="c"> contain a globing character. All the results are then matched against leaf element</span>
        <span class="c">///</span><span class="c"> of that parent path (which did contain a glob character). We then walk out of the</span>
        <span class="c">///</span><span class="c"> recursion and apply the same procedure to each leaf element that contained globing</span>
        <span class="c">///</span><span class="c"> characters.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> The procedure above allows us to match globing strings in multiple sub-containers</span>
        <span class="c">///</span><span class="c"> in the namespace without having to have knowledge of the namespace paths, or</span>
        <span class="c">///</span><span class="c"> their syntax.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> Example:</span>
        <span class="c">///</span><span class="c"> dir c:\foo\*\bar\*a??.cs</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> Calling this method for the path above would return all files that end in &#39;a&#39; and</span>
        <span class="c">///</span><span class="c"> any other two characters followed by &quot;.cs&quot; in all the subdirectories of</span>
        <span class="c">///</span><span class="c"> foo that have a bar subdirectory.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r258 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> or </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r260 r">provider</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#35e07c15a7526bcd" class="t t">ProviderInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider used to build the path threw an exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r258 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> starts with &quot;~&quot; and the home location is not set for</span>
        <span class="c">///</span><span class="c"> the provider.</span>
        <span class="c">///</span><span class="c"> or if the provider is implemented in such a way as to cause the globber to go</span>
        <span class="c">///</span><span class="c"> into an infinite loop.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r261 r">context</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> has been signaled for</span>
        <span class="c">///</span><span class="c"> StopProcessing.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Any exception can be thrown by the provider that is called to build</span>
        <span class="c">///</span><span class="c"> the provider path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">Collection</span>&lt;<b>string</b>&gt; <a id="427d751a9e698043" href="../R/427d751a9e698043.html" target="n" data-glyph="74,1" class="i method">ExpandGlobPath</a>(
            <b>string</b> <span id="r258 rd" class="r258 r">path</span>,
            <b>bool</b> <span id="r259 rd" class="r259 r">allowNonexistingPaths</span>,
            <a href="ContainerProviderBase.cs.html#bfc85492b760e757" class="t t">ContainerCmdletProvider</a> <span id="r260 rd" class="r260 r">provider</span>,
            <a href="CoreCommandContext.cs.html#1e83d35d5286e174" class="t t">CmdletProviderContext</a> <span id="r261 rd" class="r261 r">context</span>)
        {
            <b>if</b> (<span class="r258 r">path</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r258 r">path</span>));
            }
 
            <b>if</b> (<span class="r260 r">provider</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r260 r">provider</span>));
            }
 
            <span class="c">// See if the provider wants to convert the path and filter</span>
            <b>string</b> <span id="r262 rd" class="r262 r">convertedPath</span> = <b>null</b>;
            <b>string</b> <span id="r263 rd" class="r263 r">convertedFilter</span> = <b>null</b>;
            <b>string</b> <span id="r264 rd" class="r264 r">originalFilter</span> = <span class="r261 r">context</span>.<a href="CoreCommandContext.cs.html#274e5d6991e70230" class="i property">Filter</a>;
            <b>bool</b> <span id="r265 rd" class="r265 r">changedPathOrFilter</span> = <span class="r260 r">provider</span>.<a href="ContainerProviderBase.cs.html#2cff6fdd715501dc" class="i method">ConvertPath</a>(<span class="r258 r">path</span>, <span class="r261 r">context</span>.<a href="CoreCommandContext.cs.html#274e5d6991e70230" class="i property">Filter</a>, <b>ref</b> <span class="r262 r">convertedPath</span>, <b>ref</b> <span class="r263 r">convertedFilter</span>, <span class="r261 r">context</span>);
 
            <b>if</b> (<span class="r265 r">changedPathOrFilter</span>)
            {
                <b>if</b> (<a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#f5f0092873f47fa1" class="i property">IsEnabled</a>)
                {
                    <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#96aaf3813a5962a0" class="i method">WriteLine</a>(<span class="s">&quot;Provider converted path and filter.&quot;</span>);
                    <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Original path: {0}&quot;</span>, <span class="r258 r">path</span>);
                    <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Converted path: {0}&quot;</span>, <span class="r262 r">convertedPath</span>);
                    <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Original filter: {0}&quot;</span>, <span class="r261 r">context</span>.<a href="CoreCommandContext.cs.html#274e5d6991e70230" class="i property">Filter</a>);
                    <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Converted filter: {0}&quot;</span>, <span class="r263 r">convertedFilter</span>);
                }
 
                <span class="r258 r">path</span> = <span class="r262 r">convertedPath</span>;
                <span class="r264 r">originalFilter</span> = <span class="r261 r">context</span>.<a href="CoreCommandContext.cs.html#274e5d6991e70230" class="i property">Filter</a>;
            }
 
            <a href="NavigationProviderBase.cs.html#7d31476313596b0b" class="t t">NavigationCmdletProvider</a> <span id="r266 rd" class="r266 r">navigationProvider</span> = <span class="r260 r">provider</span> <b>as</b> <a href="NavigationProviderBase.cs.html#7d31476313596b0b" class="t t">NavigationCmdletProvider</a>;
 
            <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;path = {0}&quot;</span>, <span class="r258 r">path</span>);
 
            <span class="i">Collection</span>&lt;<b>string</b>&gt; <span id="r267 rd" class="r267 r">result</span> = <b>new</b> <span class="i">Collection</span>&lt;<b>string</b>&gt;();
 
            <b>using</b> (<a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#19ce116f88d7b1c7" class="i method">TraceScope</a>(<span class="s">&quot;EXPANDING WILDCARDS&quot;</span>))
            {
                <b>if</b> (<a href="#3d032868debcca0c" class="i method">ShouldPerformGlobbing</a>(<span class="r258 r">path</span>, <span class="r261 r">context</span>))
                {
                    <span class="c">// This collection contains the directories for which a leaf is being added.</span>
                    <span class="c">// If the directories are being globed over as well, then there will be</span>
                    <span class="c">// many directories in this collection which will have to be iterated over</span>
                    <span class="c">// every time there is a child being added</span>
 
                    <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r268 rd" class="r268 r">dirs</span> = <b>new</b> <span class="i">List</span>&lt;<b>string</b>&gt;();
 
                    <span class="c">// Each leaf element that is pulled off the path is pushed on the stack in</span>
                    <span class="c">// order such that we can generate the path again.</span>
 
                    <span class="i">Stack</span>&lt;<b>string</b>&gt; <span id="r269 rd" class="r269 r">leafElements</span> = <b>new</b> <span class="i">Stack</span>&lt;<b>string</b>&gt;();
 
                    <b>using</b> (<a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#19ce116f88d7b1c7" class="i method">TraceScope</a>(<span class="s">&quot;Tokenizing path&quot;</span>))
                    {
                        <span class="c">// If the path contains glob characters then iterate through pulling the</span>
                        <span class="c">// leaf elements off and pushing them on to the leafElements stack until</span>
                        <span class="c">// there are no longer any glob characters in the path.</span>
 
                        <b>while</b> (<a href="#be9734ddba52229e" class="i method">StringContainsGlobCharacters</a>(<span class="r258 r">path</span>))
                        {
                            <span class="c">// Make sure to obey StopProcessing</span>
                            <b>if</b> (<span class="r261 r">context</span>.<a href="CoreCommandContext.cs.html#649b794a0afa4fa8" class="i property">Stopping</a>)
                            {
                                <b>throw</b> <b>new</b> <a href="../utils/ExecutionExceptions.cs.html#105b0214d3aab114" class="t constructor">PipelineStoppedException</a>();
                            }
 
                            <span class="c">// Use the provider to get the leaf element string</span>
 
                            <b>string</b> <span id="r270 rd" class="r270 r">leafElement</span> = <span class="r258 r">path</span>;
 
                            <b>if</b> (<span class="r266 r">navigationProvider</span> != <b>null</b>)
                            {
                                <span class="r270 r">leafElement</span> = <span class="r266 r">navigationProvider</span>.<a href="NavigationProviderBase.cs.html#0fc64120846797fb" class="i method">GetChildName</a>(<span class="r258 r">path</span>, <span class="r261 r">context</span>);
                            }
 
                            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r270 r">leafElement</span>))
                            {
                                <b>break</b>;
                            }
 
                            <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Pushing leaf element: {0}&quot;</span>, <span class="r270 r">leafElement</span>);
 
                            <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Leaf element: {0}&quot;</span>, <span class="r270 r">leafElement</span>);
 
                            <span class="c">// Push the leaf element onto the leaf element stack for future use</span>
 
                            <span class="r269 r">leafElements</span>.<span class="i">Push</span>(<span class="r270 r">leafElement</span>);
 
                            <span class="c">// Now use the parent path for the next iteration</span>
 
                            <b>if</b> (<span class="r266 r">navigationProvider</span> != <b>null</b>)
                            {
                                <span class="c">// See if we can get the root from the context</span>
 
                                <b>string</b> <span id="r271 rd" class="r271 r">root</span> = <b>string</b>.<span class="i">Empty</span>;
 
                                <b>if</b> (<span class="r261 r">context</span> != <b>null</b>)
                                {
                                    <a href="../engine/DataStoreAdapter.cs.html#2d16b26a541ba185" class="t t">PSDriveInfo</a> <span id="r272 rd" class="r272 r">drive</span> = <span class="r261 r">context</span>.<a href="CoreCommandContext.cs.html#f037b19aae477b8f" class="i property">Drive</a>;
 
                                    <b>if</b> (<span class="r272 r">drive</span> != <b>null</b>)
                                    {
                                        <span class="r271 r">root</span> = <span class="r272 r">drive</span>.<a href="../engine/DataStoreAdapter.cs.html#6c8f4db73167e8f9" class="i property">Root</a>;
                                    }
                                }
 
                                <span class="c">// Now call GetParentPath with the root</span>
 
                                <b>string</b> <span id="r273 rd" class="r273 r">newParentPath</span> = <span class="r266 r">navigationProvider</span>.<a href="NavigationProviderBase.cs.html#df8c0961560a6b0d" class="i method">GetParentPath</a>(<span class="r258 r">path</span>, <span class="r271 r">root</span>, <span class="r261 r">context</span>);
 
                                <b>if</b> (<b>string</b>.<span class="i">Equals</span>(
                                        <span class="r273 r">newParentPath</span>,
                                        <span class="r258 r">path</span>,
                                        <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                                {
                                    <span class="c">// The provider is implemented in an inconsistent way.</span>
                                    <span class="c">// GetChildName returned a non-empty/non-null result but</span>
                                    <span class="c">// GetParentPath with the same path returns the same path.</span>
                                    <span class="c">// This would cause the globber to go into an infinite loop,</span>
                                    <span class="c">// so instead an exception is thrown.</span>
 
                                    <a href="../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r274 rd" class="r274 r">invalidOperation</span> =
                                        <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(
                                            <span class="i">SessionStateStrings</span>.<span class="i">ProviderImplementationInconsistent</span>,
                                            <span class="r260 r">provider</span>.<a href="ProviderBase.cs.html#6129ef83671ead76" class="i property">ProviderInfo</a>.<a href="../engine/DataStoreAdapterProvider.cs.html#2837d805ea30ef5c" class="i property">Name</a>,
                                            <span class="r258 r">path</span>);
                                    <b>throw</b> <span class="r274 r">invalidOperation</span>;
                                }
 
                                <span class="r258 r">path</span> = <span class="r273 r">newParentPath</span>;
                            }
                            <b>else</b>
                            {
                                <span class="c">// If the provider doesn&#39;t implement NavigationCmdletProvider then at most</span>
                                <span class="c">// it can have only one segment in its path. So after removing</span>
                                <span class="c">// the leaf all we have left is the empty string.</span>
 
                                <span class="r258 r">path</span> = <b>string</b>.<span class="i">Empty</span>;
                            }
 
                            <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;New path: {0}&quot;</span>, <span class="r258 r">path</span>);
                            <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Parent path: {0}&quot;</span>, <span class="r258 r">path</span>);
                        }
 
                        <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Base container path: {0}&quot;</span>, <span class="r258 r">path</span>);
 
                        <span class="c">// If no glob elements were found there must be an include and/or</span>
                        <span class="c">// exclude specified. Use the parent path to iterate over to</span>
                        <span class="c">// resolve the include/exclude filters</span>
 
                        <b>if</b> (<span class="r269 r">leafElements</span>.<span class="i">Count</span> == 0)
                        {
                            <b>string</b> <span id="r275 rd" class="r275 r">leafElement</span> = <span class="r258 r">path</span>;
 
                            <b>if</b> (<span class="r266 r">navigationProvider</span> != <b>null</b>)
                            {
                                <span class="r275 r">leafElement</span> = <span class="r266 r">navigationProvider</span>.<a href="NavigationProviderBase.cs.html#0fc64120846797fb" class="i method">GetChildName</a>(<span class="r258 r">path</span>, <span class="r261 r">context</span>);
 
                                <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r275 r">leafElement</span>))
                                {
                                    <span class="r258 r">path</span> = <span class="r266 r">navigationProvider</span>.<a href="NavigationProviderBase.cs.html#df8c0961560a6b0d" class="i method">GetParentPath</a>(<span class="r258 r">path</span>, <b>null</b>, <span class="r261 r">context</span>);
                                }
                            }
                            <b>else</b>
                            {
                                <span class="r258 r">path</span> = <b>string</b>.<span class="i">Empty</span>;
                            }
 
                            <span class="r269 r">leafElements</span>.<span class="i">Push</span>(<span class="r275 r">leafElement</span>);
                            <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Leaf element: {0}&quot;</span>, <span class="r275 r">leafElement</span>);
                        }
 
                        <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Root path of resolution: {0}&quot;</span>, <span class="r258 r">path</span>);
                    }
                    <span class="c">// Once the container path with no glob characters are found store it</span>
                    <span class="c">// so that it&#39;s children can be iterated over.</span>
 
                    <span class="r268 r">dirs</span>.<span class="i">Add</span>(<span class="r258 r">path</span>);
 
                    <span class="c">// Reconstruct the path one leaf element at a time, expanding where-ever</span>
                    <span class="c">// we encounter glob characters</span>
 
                    <b>while</b> (<span class="r269 r">leafElements</span>.<span class="i">Count</span> &gt; 0)
                    {
                        <span class="c">// Make sure to obey StopProcessing</span>
                        <b>if</b> (<span class="r261 r">context</span>.<a href="CoreCommandContext.cs.html#649b794a0afa4fa8" class="i property">Stopping</a>)
                        {
                            <b>throw</b> <b>new</b> <a href="../utils/ExecutionExceptions.cs.html#105b0214d3aab114" class="t constructor">PipelineStoppedException</a>();
                        }
 
                        <b>string</b> <span id="r276 rd" class="r276 r">leafElement</span> = <span class="r269 r">leafElements</span>.<span class="i">Pop</span>();
 
                        <span class="i n">Dbg</span>.<a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<span class="i">Assert</span>(
                            <span class="r276 r">leafElement</span> != <b>null</b>,
                            <span class="s">&quot;I am only pushing strings onto this stack so I should be able &quot;</span> +
                            <span class="s">&quot;to cast any Pop to a string without failure.&quot;</span>);
 
                        <span class="r268 r">dirs</span> =
                            <a href="#00eb48269a4b1e11" class="i method">GenerateNewPathsWithGlobLeaf</a>(
                                <span class="r268 r">dirs</span>,
                                <span class="r276 r">leafElement</span>,
                                <span class="r269 r">leafElements</span>.<span class="i">Count</span> == 0,
                                <span class="r260 r">provider</span>,
                                <span class="r261 r">context</span>);
 
                        <span class="c">// If there are more leaf elements in the stack we need</span>
                        <span class="c">// to make sure that only containers where added to dirs</span>
                        <span class="c">// in GenerateNewPathsWithGlobLeaf</span>
 
                        <b>if</b> (<span class="r269 r">leafElements</span>.<span class="i">Count</span> &gt; 0)
                        {
                            <b>using</b> (<a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#19ce116f88d7b1c7" class="i method">TraceScope</a>(<span class="s">&quot;Checking matches to ensure they are containers&quot;</span>))
                            {
                                <b>int</b> <span id="r277 rd" class="r277 r">index</span> = 0;
 
                                <b>while</b> (<span class="r277 r">index</span> &lt; <span class="r268 r">dirs</span>.<span class="i">Count</span>)
                                {
                                    <span class="c">// Make sure to obey StopProcessing</span>
                                    <b>if</b> (<span class="r261 r">context</span>.<a href="CoreCommandContext.cs.html#649b794a0afa4fa8" class="i property">Stopping</a>)
                                    {
                                        <b>throw</b> <b>new</b> <a href="../utils/ExecutionExceptions.cs.html#105b0214d3aab114" class="t constructor">PipelineStoppedException</a>();
                                    }
 
                                    <span class="c">// Check to see if the matching item is a container</span>
 
                                    <b>if</b> (<span class="r266 r">navigationProvider</span> != <b>null</b> &amp;&amp;
                                        !<span class="r266 r">navigationProvider</span>.<span class="i">IsItemContainer</span>(
                                            <span class="r268 r">dirs</span>[<span class="r277 r">index</span>],
                                            <span class="r261 r">context</span>))
                                    {
                                        <span class="c">// If not, remove it from the collection</span>
 
                                        <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<span class="i">WriteLine</span>(
                                            <span class="s">&quot;Removing {0} because it is not a container&quot;</span>,
                                            <span class="r268 r">dirs</span>[<span class="r277 r">index</span>]);
 
                                        <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<span class="i">WriteLine</span>(<span class="s">&quot;{0} is not a container&quot;</span>, <span class="r268 r">dirs</span>[<span class="r277 r">index</span>]);
                                        <span class="r268 r">dirs</span>.<span class="i">RemoveAt</span>(<span class="r277 r">index</span>);
                                    }
                                    <b>else</b> <b>if</b> (<span class="r266 r">navigationProvider</span> == <b>null</b>)
                                    {
                                        <span class="i n">Dbg</span>.<a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<span class="i">Assert</span>(
                                            <span class="r266 r">navigationProvider</span> != <b>null</b>,
                                            <span class="s">&quot;The path in the dirs should never be a container unless &quot;</span> +
                                            <span class="s">&quot;the provider implements the NavigationCmdletProvider interface. If it &quot;</span> +
                                            <span class="s">&quot;doesn&#39;t, there should be no more leafElements in the stack &quot;</span> +
                                            <span class="s">&quot;when this check is done&quot;</span>);
                                    }
                                    <b>else</b>
                                    {
                                        <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<span class="i">WriteLine</span>(<span class="s">&quot;{0} is a container&quot;</span>, <span class="r268 r">dirs</span>[<span class="r277 r">index</span>]);
 
                                        <span class="c">// If so, leave it and move on to the next one</span>
 
                                        ++<span class="r277 r">index</span>;
                                    }
                                }
                            }
                        }
                    }
 
                    <span class="i n">Dbg</span>.<a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<span class="i">Assert</span>(
                        <span class="r268 r">dirs</span> != <b>null</b>,
                        <span class="s">&quot;GenerateNewPathsWithGlobLeaf() should return the base path as an element &quot;</span> +
                        <span class="s">&quot;even if there are no globing characters&quot;</span>);
 
                    <b>foreach</b> (<b>string</b> <span id="r278 rd" class="r278 r">dir</span> <b>in</b> <span class="r268 r">dirs</span>)
                    {
                        <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;RESOLVED PATH: {0}&quot;</span>, <span class="r278 r">dir</span>);
                        <span class="r267 r">result</span>.<span class="i">Add</span>(<span class="r278 r">dir</span>);
                    }
 
                    <span class="i n">Dbg</span>.<a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<span class="i">Assert</span>(
                        <span class="r268 r">dirs</span>.<span class="i">Count</span> == <span class="r267 r">result</span>.<span class="i">Count</span>,
                        <span class="s">&quot;The result of copying the globed strings should be the same &quot;</span> +
                        <span class="s">&quot;as from the collection&quot;</span>);
                }
                <b>else</b>
                {
                    <b>string</b> <span id="r279 rd" class="r279 r">unescapedPath</span> = <span class="r261 r">context</span>.<a href="CoreCommandContext.cs.html#b9edf955d3776935" class="i property">SuppressWildcardExpansion</a> ? <span class="r258 r">path</span> : <a href="#aca636e8bca803e1" class="i method">RemoveGlobEscaping</a>(<span class="r258 r">path</span>);
 
                    <b>if</b> (<span class="r259 r">allowNonexistingPaths</span> ||
                        <span class="r260 r">provider</span>.<a href="ItemProviderBase.cs.html#99dfd768e6f3aa7c" class="i method">ItemExists</a>(<span class="r279 r">unescapedPath</span>, <span class="r261 r">context</span>))
                    {
                        <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;RESOLVED PATH: {0}&quot;</span>, <span class="r279 r">unescapedPath</span>);
                        <span class="r267 r">result</span>.<span class="i">Add</span>(<span class="r279 r">unescapedPath</span>);
                    }
                    <b>else</b>
                    {
                        <a href="../utils/SessionStateExceptions.cs.html#9ed59df3c4c15193" class="t t">ItemNotFoundException</a> <span id="r280 rd" class="r280 r">pathNotFound</span> =
                            <b>new</b> <span class="t">ItemNotFoundException</span>(
                                <span class="r258 r">path</span>,
                                <span class="s">&quot;PathNotFound&quot;</span>,
                                <span class="i">SessionStateStrings</span>.<span class="i">PathNotFound</span>);
 
                        <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#e7dd110db4bf902f" class="i method">TraceError</a>(<span class="s">&quot;Item does not exist: {0}&quot;</span>, <span class="r258 r">path</span>);
 
                        <b>throw</b> <span class="r280 r">pathNotFound</span>;
                    }
                }
            }
 
            <span class="i n">Dbg</span>.<a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(
                <span class="r267 r">result</span> != <b>null</b>,
                <span class="s">&quot;This method should at least return the path or more if it has glob characters&quot;</span>);
 
            <b>if</b> (<span class="r265 r">changedPathOrFilter</span>)
            {
                <span class="r261 r">context</span>.<a href="CoreCommandContext.cs.html#274e5d6991e70230" class="i property">Filter</a> = <span class="r264 r">originalFilter</span>;
            }
 
            <b>return</b> <span class="r267 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Generates a collection of containers and/or leaves that are children of the containers</span>
        <span class="c">///</span><span class="c"> in the currentDirs parameter and match the glob expression in the</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r281 r">leafElement</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> parameter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r282 r">currentDirs</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A collection of paths that should be searched for leaves that match the</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r281 r">leafElement</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> expression.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r281 r">leafElement</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A single element of a path that may or may not contain a glob expression. This parameter</span>
        <span class="c">///</span><span class="c"> is used to search the containers in </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r282 r">currentDirs</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> for children that</span>
        <span class="c">///</span><span class="c"> match the glob expression.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r283 r">isLastLeaf</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> True if the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r281 r">leafElement</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is the last element to glob over. If false, we</span>
        <span class="c">///</span><span class="c"> need to get all container names from the provider even if they don&#39;t match the filter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r284 r">provider</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The provider associated with the paths that are being passed in the</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r282 r">currentDirs</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> and </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r281 r">leafElement</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> parameters.</span>
        <span class="c">///</span><span class="c"> The provider must derive from ContainerCmdletProvider or NavigationCmdletProvider</span>
        <span class="c">///</span><span class="c"> in order to get globbing.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r285 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The context the provider uses when performing the operation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A collection of fully qualified namespace paths whose leaf element matches the</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r281 r">leafElement</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> expression.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r282 r">currentDirs</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> or </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r284 r">provider</span><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#35e07c15a7526bcd" class="t t">ProviderInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider used to build the path threw an exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="i">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> starts with &quot;~&quot; and the home location is not set for</span>
        <span class="c">///</span><span class="c"> the provider.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r285 r">context</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> has been signaled for</span>
        <span class="c">///</span><span class="c"> StopProcessing.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Any exception can be thrown by the provider that is called to build</span>
        <span class="c">///</span><span class="c"> the provider path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">List</span>&lt;<b>string</b>&gt; <a id="00eb48269a4b1e11" href="../R/00eb48269a4b1e11.html" target="n" data-glyph="74,1" class="i method">GenerateNewPathsWithGlobLeaf</a>(
            <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r282 rd" class="r282 r">currentDirs</span>,
            <b>string</b> <span id="r281 rd" class="r281 r">leafElement</span>,
            <b>bool</b> <span id="r283 rd" class="r283 r">isLastLeaf</span>,
            <a href="ContainerProviderBase.cs.html#bfc85492b760e757" class="t t">ContainerCmdletProvider</a> <span id="r284 rd" class="r284 r">provider</span>,
            <a href="CoreCommandContext.cs.html#1e83d35d5286e174" class="t t">CmdletProviderContext</a> <span id="r285 rd" class="r285 r">context</span>)
        {
            <b>if</b> (<span class="r282 r">currentDirs</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r282 r">currentDirs</span>));
            }
 
            <b>if</b> (<span class="r284 r">provider</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r284 r">provider</span>));
            }
 
            <a href="NavigationProviderBase.cs.html#7d31476313596b0b" class="t t">NavigationCmdletProvider</a> <span id="r286 rd" class="r286 r">navigationProvider</span> = <span class="r284 r">provider</span> <b>as</b> <a href="NavigationProviderBase.cs.html#7d31476313596b0b" class="t t">NavigationCmdletProvider</a>;
 
            <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r287 rd" class="r287 r">newDirs</span> = <b>new</b> <span class="i">List</span>&lt;<b>string</b>&gt;();
 
            <span class="c">// Only loop through the child names if the leafElement contains a glob character</span>
 
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r281 r">leafElement</span>) &amp;&amp;
                (<a href="#be9734ddba52229e" class="i method">StringContainsGlobCharacters</a>(<span class="r281 r">leafElement</span>) ||
                 <span class="r283 r">isLastLeaf</span>))
            {
                <b>string</b> <span id="r288 rd" class="r288 r">regexEscapedLeafElement</span> = <a href="#8c81c52992842786" class="i method">ConvertMshEscapeToRegexEscape</a>(<span class="r281 r">leafElement</span>);
 
                <span class="c">// Construct the glob filter</span>
 
                <a href="../engine/regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a> <span id="r289 rd" class="r289 r">stringMatcher</span> =
                    <a href="../engine/regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../engine/regex.cs.html#03cc3ceece086129" class="i method">Get</a>(
                        <span class="r288 r">regexEscapedLeafElement</span>,
                        <a href="../engine/regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../engine/regex.cs.html#2d0521a6986208d3" class="i field">IgnoreCase</a>);
 
                <span class="c">// Construct the include filter</span>
 
                <span class="i">Collection</span>&lt;<a href="../engine/regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <span id="r290 rd" class="r290 r">includeMatcher</span> =
                    <a href="../engine/SessionStateUtils.cs.html#a64f812795996898" class="t t">SessionStateUtilities</a>.<span class="i">CreateWildcardsFromStrings</span>(
                        <span class="r285 r">context</span>.<a href="CoreCommandContext.cs.html#ab4bd68ec99ecaa3" class="i property">Include</a>,
                        <a href="../engine/regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../engine/regex.cs.html#2d0521a6986208d3" class="i field">IgnoreCase</a>);
 
                <span class="c">// Construct the exclude filter</span>
 
                <span class="i">Collection</span>&lt;<a href="../engine/regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <span id="r291 rd" class="r291 r">excludeMatcher</span> =
                    <a href="../engine/SessionStateUtils.cs.html#a64f812795996898" class="t t">SessionStateUtilities</a>.<span class="i">CreateWildcardsFromStrings</span>(
                        <span class="r285 r">context</span>.<a href="CoreCommandContext.cs.html#93e21581391c00fc" class="i property">Exclude</a>,
                        <a href="../engine/regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../engine/regex.cs.html#2d0521a6986208d3" class="i field">IgnoreCase</a>);
 
                <span class="c">// Loop through the current dirs and add the appropriate children</span>
 
                <b>foreach</b> (<b>string</b> <span id="r292 rd" class="r292 r">dir</span> <b>in</b> <span class="r282 r">currentDirs</span>)
                {
                    <b>using</b> (<a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#ff5e86462c8f4f03" class="i method">TraceScope</a>(<span class="s">&quot;Expanding wildcards for items under &#39;{0}&#39;&quot;</span>, <span class="r292 r">dir</span>))
                    {
                        <span class="c">// Make sure to obey StopProcessing</span>
                        <b>if</b> (<span class="r285 r">context</span>.<a href="CoreCommandContext.cs.html#649b794a0afa4fa8" class="i property">Stopping</a>)
                        {
                            <b>throw</b> <b>new</b> <a href="../utils/ExecutionExceptions.cs.html#105b0214d3aab114" class="t constructor">PipelineStoppedException</a>();
                        }
 
                        <b>string</b> <span id="r293 rd" class="r293 r">unescapedDir</span> = <b>null</b>;
 
                        <span class="i">Collection</span>&lt;<a href="../engine/MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r294 rd" class="r294 r">childNamesObjectArray</span> =
                            <span class="i">GetChildNamesInDir</span>(<span class="r292 r">dir</span>, <span class="r281 r">leafElement</span>, !<span class="r283 r">isLastLeaf</span>, <span class="r285 r">context</span>, <b>true</b>, <b>null</b>, <span class="r284 r">provider</span>, <b>out</b> <span class="r293 r">unescapedDir</span>);
 
                        <b>if</b> (<span class="r294 r">childNamesObjectArray</span> == <b>null</b>)
                        {
                            <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#e7dd110db4bf902f" class="i method">TraceError</a>(<span class="s">&quot;GetChildNames returned a null array&quot;</span>);
 
                            <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;No child names returned for &#39;{0}&#39;&quot;</span>, <span class="r292 r">dir</span>);
                            <b>continue</b>;
                        }
 
                        <span class="c">// Loop through each child to see if they match the glob expression</span>
 
                        <b>foreach</b> (<a href="../engine/MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r295 rd" class="r295 r">childObject</span> <b>in</b> <span class="r294 r">childNamesObjectArray</span>)
                        {
                            <span class="c">// Make sure to obey StopProcessing</span>
                            <b>if</b> (<span class="r285 r">context</span>.<a href="CoreCommandContext.cs.html#649b794a0afa4fa8" class="i property">Stopping</a>)
                            {
                                <b>throw</b> <b>new</b> <a href="../utils/ExecutionExceptions.cs.html#105b0214d3aab114" class="t constructor">PipelineStoppedException</a>();
                            }
 
                            <b>string</b> <span id="r296 rd" class="r296 r">child</span> = <b>string</b>.<span class="i">Empty</span>;
                            <b>if</b> (<a href="#992997769aae123d" class="i method">IsChildNameAMatch</a>(<span class="r295 r">childObject</span>, <span class="r289 r">stringMatcher</span>, <span class="r290 r">includeMatcher</span>, <span class="r291 r">excludeMatcher</span>, <b>out</b> <span class="r296 r">child</span>))
                            {
                                <b>string</b> <span id="r297 rd" class="r297 r">childPath</span> = <span class="r296 r">child</span>;
 
                                <b>if</b> (<span class="r286 r">navigationProvider</span> != <b>null</b>)
                                {
                                    <span class="r297 r">childPath</span> = <span class="r286 r">navigationProvider</span>.<a href="NavigationProviderBase.cs.html#17084326a3adb855" class="i method">MakePath</a>(<span class="r293 r">unescapedDir</span>, <span class="r296 r">child</span>, <span class="r285 r">context</span>);
                                }
 
                                <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Adding child path to dirs {0}&quot;</span>, <span class="r297 r">childPath</span>);
 
                                <span class="r287 r">newDirs</span>.<span class="i">Add</span>(<span class="r297 r">childPath</span>);
                            }
                        }
                    }
                }
            }
            <b>else</b>
            {
                <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#96aaf3813a5962a0" class="i method">WriteLine</a>(
                    <span class="s">&quot;LeafElement does not contain any glob characters so do a MakePath&quot;</span>);
 
                <span class="c">// Loop through the current dirs and add the leafElement to each of</span>
                <span class="c">// the dirs</span>
 
                <b>foreach</b> (<b>string</b> <span id="r298 rd" class="r298 r">dir</span> <b>in</b> <span class="r282 r">currentDirs</span>)
                {
                    <b>using</b> (<a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#ff5e86462c8f4f03" class="i method">TraceScope</a>(<span class="s">&quot;Expanding intermediate containers under &#39;{0}&#39;&quot;</span>, <span class="r298 r">dir</span>))
                    {
                        <span class="c">// Make sure to obey StopProcessing</span>
                        <b>if</b> (<span class="r285 r">context</span>.<a href="CoreCommandContext.cs.html#649b794a0afa4fa8" class="i property">Stopping</a>)
                        {
                            <b>throw</b> <b>new</b> <a href="../utils/ExecutionExceptions.cs.html#105b0214d3aab114" class="t constructor">PipelineStoppedException</a>();
                        }
 
                        <b>string</b> <span id="r299 rd" class="r299 r">backslashEscapedLeafElement</span> = <a href="#8c81c52992842786" class="i method">ConvertMshEscapeToRegexEscape</a>(<span class="r281 r">leafElement</span>);
 
                        <b>string</b> <span id="r300 rd" class="r300 r">unescapedDir</span> = <span class="r285 r">context</span>.<a href="CoreCommandContext.cs.html#b9edf955d3776935" class="i property">SuppressWildcardExpansion</a> ? <span class="r298 r">dir</span> : <a href="#aca636e8bca803e1" class="i method">RemoveGlobEscaping</a>(<span class="r298 r">dir</span>);
 
                        <b>string</b> <span id="r301 rd" class="r301 r">childPath</span> = <span class="r299 r">backslashEscapedLeafElement</span>;
 
                        <b>if</b> (<span class="r286 r">navigationProvider</span> != <b>null</b>)
                        {
                            <span class="r301 r">childPath</span> =
                                <span class="r286 r">navigationProvider</span>.
                                    <a href="NavigationProviderBase.cs.html#17084326a3adb855" class="i method">MakePath</a>(
                                        <span class="r300 r">unescapedDir</span>,
                                        <span class="r299 r">backslashEscapedLeafElement</span>,
                                        <span class="r285 r">context</span>);
                        }
 
                        <b>if</b> (<span class="r284 r">provider</span>.<a href="ItemProviderBase.cs.html#99dfd768e6f3aa7c" class="i method">ItemExists</a>(<span class="r301 r">childPath</span>, <span class="r285 r">context</span>))
                        {
                            <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Adding child path to dirs {0}&quot;</span>, <span class="r301 r">childPath</span>);
 
                            <span class="r287 r">newDirs</span>.<span class="i">Add</span>(<span class="r301 r">childPath</span>);
 
                            <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Valid intermediate container: {0}&quot;</span>, <span class="r301 r">childPath</span>);
                        }
                    }
                }
            }
 
            <b>return</b> <span class="r287 r">newDirs</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the child names in the specified path by using the provider.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r302 r">dir</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path of the directory to get the child names from. If this is an Msh Path,</span>
        <span class="c">///</span><span class="c"> dirIsProviderPath must be false, If this is a provider-internal path,</span>
        <span class="c">///</span><span class="c"> dirIsProviderPath must be true.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r303 r">leafElement</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The element that we are ultimately looking for. Used to set filters on the context</span>
        <span class="c">///</span><span class="c"> if desired.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r304 r">getAllContainers</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Determines if the GetChildNames call should get all containers even if they don&#39;t</span>
        <span class="c">///</span><span class="c"> match the filter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r305 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The context to be used for the command. The context is copied to a new context, the</span>
        <span class="c">///</span><span class="c"> results are accumulated and then returned.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r306 r">dirIsProviderPath</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Specifies whether the dir parameter is a provider-internal path (true) or Msh Path (false).</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r307 r">drive</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The drive to use to qualify the Msh path if dirIsProviderPath is false.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r308 r">provider</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The provider to use to get the child names.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r309 r">modifiedDirPath</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns the modified dir path. If dirIsProviderPath is true, this is the unescaped dir path.</span>
        <span class="c">///</span><span class="c"> If dirIsProviderPath is false, this is the unescaped resolved provider path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A collection of PSObjects whose BaseObject is a string that contains the name of the child.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r302 r">dir</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> or </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r307 r">drive</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#a58038dc730da896" class="t t">ProviderNotFoundException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the path is a provider-qualified path for a provider that is</span>
        <span class="c">///</span><span class="c"> not loaded into the system.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#09140e6dc875019b" class="t t">DriveNotFoundException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="i">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> refers to a drive that could not be found.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#35e07c15a7526bcd" class="t t">ProviderInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider used to build the path threw an exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">NotSupportedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider that the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="i">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> represents is not a NavigationCmdletProvider</span>
        <span class="c">///</span><span class="c"> or ContainerCmdletProvider.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="i">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> starts with &quot;~&quot; and the home location is not set for</span>
        <span class="c">///</span><span class="c"> the provider.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#35e07c15a7526bcd" class="t t">ProviderInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider associated with the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="i">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> threw an</span>
        <span class="c">///</span><span class="c"> exception when its GetParentPath or MakePath was called while</span>
        <span class="c">///</span><span class="c"> processing the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="i">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r305 r">context</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> has been signaled for</span>
        <span class="c">///</span><span class="c"> StopProcessing.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Any exception can be thrown by the provider that is called to build</span>
        <span class="c">///</span><span class="c"> the provider path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>private</b> <span class="i">Collection</span>&lt;<a href="../engine/MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <a id="17c5d4121345670c" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">GetChildNamesInDir</a>(
            <b>string</b> <span id="r302 rd" class="r302 r">dir</span>,
            <b>string</b> <span id="r303 rd" class="r303 r">leafElement</span>,
            <b>bool</b> <span id="r304 rd" class="r304 r">getAllContainers</span>,
            <a href="CoreCommandContext.cs.html#1e83d35d5286e174" class="t t">CmdletProviderContext</a> <span id="r305 rd" class="r305 r">context</span>,
            <b>bool</b> <span id="r306 rd" class="r306 r">dirIsProviderPath</span>,
            <a href="../engine/DataStoreAdapter.cs.html#2d16b26a541ba185" class="t t">PSDriveInfo</a> <span id="r307 rd" class="r307 r">drive</span>,
            <a href="ContainerProviderBase.cs.html#bfc85492b760e757" class="t t">ContainerCmdletProvider</a> <span id="r308 rd" class="r308 r">provider</span>,
            <b>out string</b> <span id="r309 rd" class="r309 r">modifiedDirPath</span>)
        {
            <span class="c">// See if the provider wants to convert the path and filter</span>
            <b>string</b> <span id="r310 rd" class="r310 r">convertedPath</span> = <b>null</b>;
            <b>string</b> <span id="r311 rd" class="r311 r">convertedFilter</span> = <b>null</b>;
            <b>string</b> <span id="r312 rd" class="r312 r">originalFilter</span> = <span class="r305 r">context</span>.<a href="CoreCommandContext.cs.html#274e5d6991e70230" class="i property">Filter</a>;
            <b>bool</b> <span id="r313 rd" class="r313 r">changedPathOrFilter</span> = <span class="r308 r">provider</span>.<a href="ContainerProviderBase.cs.html#2cff6fdd715501dc" class="i method">ConvertPath</a>(<span class="r303 r">leafElement</span>, <span class="r305 r">context</span>.<a href="CoreCommandContext.cs.html#274e5d6991e70230" class="i property">Filter</a>, <b>ref</b> <span class="r310 r">convertedPath</span>, <b>ref</b> <span class="r311 r">convertedFilter</span>, <span class="r305 r">context</span>);
 
            <b>if</b> (<span class="r313 r">changedPathOrFilter</span>)
            {
                <b>if</b> (<a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#f5f0092873f47fa1" class="i property">IsEnabled</a>)
                {
                    <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#96aaf3813a5962a0" class="i method">WriteLine</a>(<span class="s">&quot;Provider converted path and filter.&quot;</span>);
                    <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Original path: {0}&quot;</span>, <span class="r303 r">leafElement</span>);
                    <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Converted path: {0}&quot;</span>, <span class="r310 r">convertedPath</span>);
                    <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Original filter: {0}&quot;</span>, <span class="r305 r">context</span>.<a href="CoreCommandContext.cs.html#274e5d6991e70230" class="i property">Filter</a>);
                    <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Converted filter: {0}&quot;</span>, <span class="r311 r">convertedFilter</span>);
                }
 
                <span class="r303 r">leafElement</span> = <span class="r310 r">convertedPath</span>;
                <span class="r305 r">context</span>.<a href="CoreCommandContext.cs.html#274e5d6991e70230" class="i property">Filter</a> = <span class="r311 r">convertedFilter</span>;
            }
 
            <a href="../engine/ChildrenCmdletProviderInterfaces.cs.html#33becc108c70a3e1" class="t t">ReturnContainers</a> <span id="r314 rd" class="r314 r">returnContainers</span> = <a href="../engine/ChildrenCmdletProviderInterfaces.cs.html#33becc108c70a3e1" class="t t">ReturnContainers</a>.<a href="../engine/ChildrenCmdletProviderInterfaces.cs.html#1b66c2d2e8f051dd" class="i field">ReturnAllContainers</a>;
            <b>if</b> (!<span class="r304 r">getAllContainers</span>)
            {
                <span class="r314 r">returnContainers</span> = <a href="../engine/ChildrenCmdletProviderInterfaces.cs.html#33becc108c70a3e1" class="t t">ReturnContainers</a>.<a href="../engine/ChildrenCmdletProviderInterfaces.cs.html#b4f5c0ad509c47b2" class="i field">ReturnMatchingContainers</a>;
            }
 
            <a href="CoreCommandContext.cs.html#1e83d35d5286e174" class="t t">CmdletProviderContext</a> <span id="r315 rd" class="r315 r">getChildNamesContext</span> =
                <b>new</b> <a href="CoreCommandContext.cs.html#1f17a9746c926c80" class="t constructor">CmdletProviderContext</a>(<span class="r305 r">context</span>);
 
            <span class="c">// Remove the include/exclude filters from the new context</span>
            <span class="r315 r">getChildNamesContext</span>.<a href="CoreCommandContext.cs.html#44c8a66ad9db4cf4" class="i method">SetFilters</a>(
                <b>new</b> <span class="i">Collection</span>&lt;<b>string</b>&gt;(),
                <b>new</b> <span class="i">Collection</span>&lt;<b>string</b>&gt;(),
                <span class="r305 r">context</span>.<a href="CoreCommandContext.cs.html#274e5d6991e70230" class="i property">Filter</a>);
 
            <b>try</b>
            {
                <span class="c">// Use the provider to get the children</span>
                <b>string</b> <span id="r316 rd" class="r316 r">unescapedDir</span> = <b>null</b>;
                <span class="r309 r">modifiedDirPath</span> = <b>null</b>;
 
                <b>if</b> (<span class="r306 r">dirIsProviderPath</span>)
                {
                    <span class="r309 r">modifiedDirPath</span> = <span class="r316 r">unescapedDir</span> = <span class="r305 r">context</span>.<a href="CoreCommandContext.cs.html#b9edf955d3776935" class="i property">SuppressWildcardExpansion</a> ? <span class="r302 r">dir</span> : <a href="#aca636e8bca803e1" class="i method">RemoveGlobEscaping</a>(<span class="r302 r">dir</span>);
                }
                <b>else</b>
                {
                    <span class="i n">Dbg</span>.<a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(
                        <span class="r307 r">drive</span> != <b>null</b>,
                        <span class="s">&quot;Caller should verify that drive is not null when dirIsProviderPath is false&quot;</span>);
 
                    <span class="c">// If the directory is an MSH path we must resolve it before calling GetChildNames()</span>
                    <span class="c">// -- If the path is passed in by LiteralPath (context.SuppressWildcardExpansion == false), we surely should use &#39;dir&#39; unchanged.</span>
                    <span class="c">// -- If the path is passed in by Path (context.SuppressWildcardExpansion == true), we still should use &#39;dir&#39; unchanged, in case that the special character</span>
                    <span class="c">//    in &#39;dir&#39; is escaped</span>
                    <span class="r309 r">modifiedDirPath</span> = <a href="#0e913e4e0948eb8f" class="i method">GetMshQualifiedPath</a>(<span class="r302 r">dir</span>, <span class="r307 r">drive</span>);
 
                    <a href="../engine/DataStoreAdapterProvider.cs.html#dd4e1f2f8e73a1dd" class="t t">ProviderInfo</a> <span id="r317 rd" class="r317 r">providerIgnored</span> = <b>null</b>;
                    <a href="../P/71826561229efd99.html#71826561229efd99" class="t t">CmdletProvider</a> <span id="r318 rd" class="r318 r">providerInstanceIgnored</span> = <b>null</b>;
                    <span class="i">Collection</span>&lt;<b>string</b>&gt; <span id="r319 rd" class="r319 r">resolvedPaths</span> =
                        <a href="#79c1f17dc6323c22" class="i method">GetGlobbedProviderPathsFromMonadPath</a>(
                            <span class="r309 r">modifiedDirPath</span>,
                            <b>false</b>,
                            <span class="r315 r">getChildNamesContext</span>,
                            <b>out</b> <span class="r317 r">providerIgnored</span>,
                            <b>out</b> <span class="r318 r">providerInstanceIgnored</span>);
 
                    <span class="c">// After resolving the path, we unescape the modifiedDirPath if necessary.</span>
                    <span class="r309 r">modifiedDirPath</span> = <span class="r305 r">context</span>.<a href="CoreCommandContext.cs.html#b9edf955d3776935" class="i property">SuppressWildcardExpansion</a>
                                          ? <span class="r309 r">modifiedDirPath</span>
                                          : <a href="#aca636e8bca803e1" class="i method">RemoveGlobEscaping</a>(<span class="r309 r">modifiedDirPath</span>);
                    <b>if</b> (<span class="r319 r">resolvedPaths</span>.<span class="i">Count</span> &gt; 0)
                    {
                        <span class="r316 r">unescapedDir</span> = <span class="r319 r">resolvedPaths</span>[0];
                    }
                    <b>else</b>
                    {
                        <span class="c">// If there were no results from globbing but no</span>
                        <span class="c">// exception was thrown, that means there was filtering.</span>
                        <span class="c">// So return an empty collection and let the caller deal</span>
                        <span class="c">// with it.</span>
 
                        <b>if</b> (<span class="r313 r">changedPathOrFilter</span>)
                        {
                            <span class="r305 r">context</span>.<a href="CoreCommandContext.cs.html#274e5d6991e70230" class="i property">Filter</a> = <span class="r312 r">originalFilter</span>;
                        }
 
                        <b>return</b> <b>new</b> <span class="i">Collection</span>&lt;<a href="../engine/MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;();
                    }
                }
 
                <b>if</b> (<span class="r308 r">provider</span>.<a href="ContainerProviderBase.cs.html#91b7cd1405e24e4e" class="i method">HasChildItems</a>(<span class="r316 r">unescapedDir</span>, <span class="r315 r">getChildNamesContext</span>))
                {
                    <span class="r308 r">provider</span>.<a href="ContainerProviderBase.cs.html#0289661d677940b6" class="i method">GetChildNames</a>(
                        <span class="r316 r">unescapedDir</span>,
                        <span class="r314 r">returnContainers</span>,
                        <span class="r315 r">getChildNamesContext</span>);
                }
 
                <span class="c">// First check to see if there were any errors, and write them</span>
                <span class="c">// to the real context if there are.</span>
 
                <b>if</b> (<span class="r315 r">getChildNamesContext</span>.<a href="CoreCommandContext.cs.html#98adf40dae698aee" class="i method">HasErrors</a>())
                {
                    <span class="i">Collection</span>&lt;<a href="../engine/ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a>&gt; <span id="r320 rd" class="r320 r">errors</span> = <span class="r315 r">getChildNamesContext</span>.<a href="CoreCommandContext.cs.html#0915d5820646740a" class="i method">GetAccumulatedErrorObjects</a>();
 
                    <b>if</b> (<span class="r320 r">errors</span> != <b>null</b> &amp;&amp;
                        <span class="r320 r">errors</span>.<span class="i">Count</span> &gt; 0)
                    {
                        <b>foreach</b> (<a href="../engine/ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r321 rd" class="r321 r">errorRecord</span> <b>in</b> <span class="r320 r">errors</span>)
                        {
                            <span class="r305 r">context</span>.<a href="CoreCommandContext.cs.html#97661a296df11e6d" class="i method">WriteError</a>(<span class="r321 r">errorRecord</span>);
                        }
                    }
                }
 
                <span class="i">Collection</span>&lt;<a href="../engine/MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r322 rd" class="r322 r">childNamesObjectArray</span> = <span class="r315 r">getChildNamesContext</span>.<a href="CoreCommandContext.cs.html#c2d4b021c21c5144" class="i method">GetAccumulatedObjects</a>();
 
                <b>if</b> (<span class="r313 r">changedPathOrFilter</span>)
                {
                    <span class="r305 r">context</span>.<a href="CoreCommandContext.cs.html#274e5d6991e70230" class="i property">Filter</a> = <span class="r312 r">originalFilter</span>;
                }
 
                <b>return</b> <span class="r322 r">childNamesObjectArray</span>;
            }
            <b>finally</b>
            {
                <span class="r315 r">getChildNamesContext</span>.<a href="CoreCommandContext.cs.html#d67d95295b027157" class="i method">RemoveStopReferral</a>();
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Determines if the specified PSObject contains a string that matches the specified</span>
        <span class="c">///</span><span class="c"> wildcard patterns.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r323 r">childObject</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The PSObject that contains the child names.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r324 r">stringMatcher</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The glob matcher.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r325 r">includeMatcher</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The include matcher wildcard patterns.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r326 r">excludeMatcher</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The exclude matcher wildcard patterns.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r327 r">childName</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The name of the child which was extracted from the childObject and used for the matches.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> True if the string in the childObject matches the stringMatcher and includeMatcher wildcard patterns,</span>
        <span class="c">///</span><span class="c"> and does not match the exclude wildcard patterns. False otherwise.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static bool</b> <a id="992997769aae123d" href="../R/992997769aae123d.html" target="n" data-glyph="76,1" class="i method">IsChildNameAMatch</a>(
            <a href="../engine/MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r323 rd" class="r323 r">childObject</span>,
            <a href="../engine/regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a> <span id="r324 rd" class="r324 r">stringMatcher</span>,
            <span class="i">Collection</span>&lt;<a href="../engine/regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <span id="r325 rd" class="r325 r">includeMatcher</span>,
            <span class="i">Collection</span>&lt;<a href="../engine/regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <span id="r326 rd" class="r326 r">excludeMatcher</span>,
            <b>out string</b> <span id="r327 rd" class="r327 r">childName</span>)
        {
            <b>bool</b> <span id="r328 rd" class="r328 r">result</span> = <b>false</b>;
 
            <b>do</b> <span class="c">// false loop</span>
            {
                <span class="r327 r">childName</span> = <b>null</b>;
                <b>object</b> <span id="r329 rd" class="r329 r">baseObject</span> = <span class="r323 r">childObject</span>.<a href="../engine/MshObject.cs.html#d854d13536b70a12" class="i property">BaseObject</a>;
                <b>if</b> (<span class="r329 r">baseObject</span> <b>is</b> <a href="../engine/MshObject.cs.html#4a84ee8edc4d53a0" class="t t">PSCustomObject</a>)
                {
                    <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#e7dd110db4bf902f" class="i method">TraceError</a>(<span class="s">&quot;GetChildNames returned a null object&quot;</span>);
                    <b>break</b>;
                }
 
                <span class="r327 r">childName</span> = <span class="r329 r">baseObject</span> <b>as string</b>;
 
                <b>if</b> (<span class="r327 r">childName</span> == <b>null</b>)
                {
                    <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#e7dd110db4bf902f" class="i method">TraceError</a>(<span class="s">&quot;GetChildNames returned an object that wasn&#39;t a string&quot;</span>);
                    <b>break</b>;
                }
 
                <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Name returned from provider: {0}&quot;</span>, <span class="r327 r">childName</span>);
 
                <span class="c">// Check the glob expression</span>
 
                <span class="c">// First see if the child matches the glob expression</span>
                <b>bool</b> <span id="r330 rd" class="r330 r">isGlobbed</span> = <a href="../engine/regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../engine/regex.cs.html#f9cf207fdd565080" class="i method">ContainsWildcardCharacters</a>(<span class="r324 r">stringMatcher</span>.<a href="../engine/regex.cs.html#e6587610f807da5a" class="i property">Pattern</a>);
                <b>bool</b> <span id="r331 rd" class="r331 r">isChildMatch</span> = <span class="r324 r">stringMatcher</span>.<a href="../engine/regex.cs.html#02e7d1c913f3c256" class="i method">IsMatch</a>(<span class="r327 r">childName</span>);
                <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#451d38bf8c2b6b94" class="i method">WriteLine</a>(<span class="s">&quot;isChildMatch = {0}&quot;</span>, <span class="r331 r">isChildMatch</span>);
 
                <b>bool</b> <span id="r332 rd" class="r332 r">isIncludeSpecified</span> = (<span class="r325 r">includeMatcher</span>.<span class="i">Count</span> &gt; 0);
                <b>bool</b> <span id="r333 rd" class="r333 r">isExcludeSpecified</span> = (<span class="r326 r">excludeMatcher</span>.<span class="i">Count</span> &gt; 0);
                <b>bool</b> <span id="r334 rd" class="r334 r">isIncludeMatch</span> =
                     <a href="../engine/SessionStateUtils.cs.html#a64f812795996898" class="t t">SessionStateUtilities</a>.<span class="i">MatchesAnyWildcardPattern</span>(
                        <span class="r327 r">childName</span>,
                        <span class="r325 r">includeMatcher</span>,
                        <b>true</b>);
 
                <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#451d38bf8c2b6b94" class="i method">WriteLine</a>(<span class="s">&quot;isIncludeMatch = {0}&quot;</span>, <span class="r334 r">isIncludeMatch</span>);
 
                <span class="c">// Check if the child name matches, or the include matches</span>
                <b>if</b> (<span class="r331 r">isChildMatch</span> || (<span class="r330 r">isGlobbed</span> &amp;&amp; <span class="r332 r">isIncludeSpecified</span> &amp;&amp; <span class="r334 r">isIncludeMatch</span>))
                {
                    <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Path wildcard match: {0}&quot;</span>, <span class="r327 r">childName</span>);
                    <span class="r328 r">result</span> = <b>true</b>;
 
                    <span class="c">// See if it should not be included</span>
                    <b>if</b> (<span class="r332 r">isIncludeSpecified</span> &amp;&amp; !<span class="r334 r">isIncludeMatch</span>)
                    {
                        <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Not included match: {0}&quot;</span>, <span class="r327 r">childName</span>);
                        <span class="r328 r">result</span> = <b>false</b>;
                    }
 
                    <span class="c">// See if it should be excluded</span>
                    <b>if</b> (<span class="r333 r">isExcludeSpecified</span> &amp;&amp;
                        <a href="../engine/SessionStateUtils.cs.html#a64f812795996898" class="t t">SessionStateUtilities</a>.<span class="i">MatchesAnyWildcardPattern</span>(<span class="r327 r">childName</span>, <span class="r326 r">excludeMatcher</span>, <b>false</b>))
                    {
                        <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Excluded match: {0}&quot;</span>, <span class="r327 r">childName</span>);
                        <span class="r328 r">result</span> = <b>false</b>;
                    }
                }
                <b>else</b>
                {
                    <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;NOT path wildcard match: {0}&quot;</span>, <span class="r327 r">childName</span>);
                }
            } <b>while</b> (<b>false</b>);
 
            <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<span class="i">WriteLine</span>(<span class="s">&quot;result = {0}; childName = {1}&quot;</span>, <span class="r328 r">result</span>.<span class="i">ToString</span>(), <span class="r327 r">childName</span>);
            <b>return</b> <span class="r328 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Converts a back tick &#39;`&#39; escape into back slash escape for</span>
        <span class="c">///</span><span class="c"> all occurrences in the string.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r335 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A string that may or may not have back ticks as escape characters.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A string that has the back ticks replaced with back slashes except</span>
        <span class="c">///</span><span class="c"> in the case where there are two back ticks in a row. In that case a single</span>
        <span class="c">///</span><span class="c"> back tick is returned.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The following rules apply to the conversion:</span>
        <span class="c">///</span><span class="c"> 1. All \ characters are expanded to be \\</span>
        <span class="c">///</span><span class="c"> 2. Any ` not followed by a ` is converted to a \</span>
        <span class="c">///</span><span class="c"> 3. Any ` that is followed by a ` collapses the two into a single `</span>
        <span class="c">///</span><span class="c"> 4. Any other character is immediately appended to the result.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r335 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>private static string</b> <a id="8c81c52992842786" href="../R/8c81c52992842786.html" target="n" data-glyph="76,1" class="i method">ConvertMshEscapeToRegexEscape</a>(<b>string</b> <span id="r335 rd" class="r335 r">path</span>)
        {
            <b>if</b> (<span class="r335 r">path</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r335 r">path</span>));
            }
 
            <b>const char</b> <span id="r336 rd" class="r336 r">mshEscapeChar</span> = <span class="s">&#39;`&#39;</span>;
            <b>const char</b> <span id="r337 rd" class="r337 r">regexEscapeChar</span> = <span class="s">&#39;\\&#39;</span>;
 
            <span class="i">ReadOnlySpan</span>&lt;<b>char</b>&gt; <span id="r338 rd" class="r338 r">workerArray</span> = <span class="r335 r">path</span>;
 
            <span class="i">StringBuilder</span> <span id="r339 rd" class="r339 r">result</span> = <b>new</b> <span class="i">StringBuilder</span>();
 
            <b>for</b> (<b>int</b> <span id="r340 rd" class="r340 r">index</span> = 0; <span class="r340 r">index</span> &lt; <span class="r338 r">workerArray</span>.<span class="i">Length</span>; ++<span class="r340 r">index</span>)
            {
                <span class="c">// look for an escape character</span>
 
                <b>if</b> (<span class="r338 r">workerArray</span>[<span class="r340 r">index</span>] == <span class="r336 r">mshEscapeChar</span>)
                {
                    <b>if</b> (<span class="r340 r">index</span> + 1 &lt; <span class="r338 r">workerArray</span>.<span class="i">Length</span>)
                    {
                        <b>if</b> (<span class="r338 r">workerArray</span>[<span class="r340 r">index</span> + 1] == <span class="r336 r">mshEscapeChar</span>)
                        {
                            <span class="c">// Since there are two escape characters in a row,</span>
                            <span class="c">// the string really wanted a back tick so add that to</span>
                            <span class="c">// the result and continue.</span>
 
                            <span class="r339 r">result</span>.<span class="i">Append</span>(<span class="r336 r">mshEscapeChar</span>);
 
                            <span class="c">// Skip the next character since it has already been processed.</span>
 
                            ++<span class="r340 r">index</span>;
                        }
                        <b>else</b>
                        {
                            <span class="c">// Since the escape character wasn&#39;t followed by another</span>
                            <span class="c">// escape character, convert it to a back slash and continue.</span>
 
                            <span class="r339 r">result</span>.<span class="i">Append</span>(<span class="r337 r">regexEscapeChar</span>);
                        }
                    }
                    <b>else</b>
                    {
                        <span class="c">// Since the escape character was the last character in the string</span>
                        <span class="c">// just convert it. Most likely this is an error condition in the</span>
                        <span class="c">// Regex class but I will let that fail instead of pretending to</span>
                        <span class="c">// know what the user meant.</span>
 
                        <span class="r339 r">result</span>.<span class="i">Append</span>(<span class="r337 r">regexEscapeChar</span>);
                    }
                }
                <b>else</b> <b>if</b> (<span class="r338 r">workerArray</span>[<span class="r340 r">index</span>] == <span class="r337 r">regexEscapeChar</span>)
                {
                    <span class="c">// For backslashes we need to append two back slashes so that</span>
                    <span class="c">// the regex processor doesn&#39;t think its an escape character</span>
 
                    <span class="r339 r">result</span>.<span class="i">Append</span>(<span class="s">&quot;\\\\&quot;</span>);
                }
                <b>else</b>
                {
                    <span class="c">// The character is not an escape character so add it to the result</span>
                    <span class="c">// and continue.</span>
 
                    <span class="r339 r">result</span>.<span class="i">Append</span>(<span class="r338 r">workerArray</span>[<span class="r340 r">index</span>]);
                }
            }
 
            <a href="#52218724c4b84b4d" class="i field">s_tracer</a>.<span class="i">WriteLine</span>(
                <span class="s">&quot;Original path: {0} Converted to: {1}&quot;</span>,
                <span class="r335 r">path</span>,
                <span class="r339 r">result</span>.<span class="i">ToString</span>());
 
            <b>return</b> <span class="r339 r">result</span>.<span class="i">ToString</span>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Determines if the path is relative to a provider home based on</span>
        <span class="c">///</span><span class="c"> the ~ character.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r341 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to determine if it is a home path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> True if the path contains a ~ at the beginning of the path or immediately</span>
        <span class="c">///</span><span class="c"> following a provider designator (&quot;provider::&quot;)</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Is </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r341 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="48978d46f1040a39" href="../R/48978d46f1040a39.html" target="n" data-glyph="74,1" class="i method">IsHomePath</a>(<b>string</b> <span id="r341 rd" class="r341 r">path</span>)
        {
            <b>if</b> (<span class="r341 r">path</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r341 r">path</span>));
            }
 
            <b>bool</b> <span id="r342 rd" class="r342 r">result</span> = <b>false</b>;
 
            <b>if</b> (<a href="#45d8fc5f64551b7a" class="i method">IsProviderQualifiedPath</a>(<span class="r341 r">path</span>))
            {
                <span class="c">// Strip off the provider portion of the path</span>
 
                <b>int</b> <span id="r343 rd" class="r343 r">index</span> = <span class="r341 r">path</span>.<span class="i">IndexOf</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#6981dbcadad2340f" class="i field">ProviderPathSeparator</a>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>);
 
                <b>if</b> (<span class="r343 r">index</span> != -1)
                {
                    <span class="r341 r">path</span> = <span class="r341 r">path</span>.<span class="i">Substring</span>(<span class="r343 r">index</span> + <a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#6981dbcadad2340f" class="i field">ProviderPathSeparator</a>.<span class="i">Length</span>);
                }
            }
 
            <b>if</b> (<span class="r341 r">path</span>.<span class="i">IndexOf</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#09a3c99751dbad80" class="i field">HomePath</a>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>) == 0)
            {
                <span class="c">// Support the single &quot;~&quot;</span>
                <b>if</b> (<span class="r341 r">path</span>.<span class="i">Length</span> == 1)
                    <span class="r342 r">result</span> = <b>true</b>;
                <span class="c">// Support &quot;~/&quot; or &quot;~\&quot;</span>
                <b>else</b> <b>if</b> ((<span class="r341 r">path</span>.<span class="i">Length</span> &gt; 1) &amp;&amp;
                        (<span class="r341 r">path</span>[1] == <span class="s">&#39;\\&#39;</span> ||
                         <span class="r341 r">path</span>[1] == <span class="s">&#39;/&#39;</span>))
                    <span class="r342 r">result</span> = <b>true</b>;
            }
 
            <b>return</b> <span class="r342 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Determines if the specified path looks like a remote path. (starts with</span>
        <span class="c">///</span><span class="c"> // or \\.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r344 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to check to determine if it is a remote path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> True if the path starts with // or \\, or false otherwise.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r344 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="f0c7a79be5b8b12b" href="../R/f0c7a79be5b8b12b.html" target="n" data-glyph="74,1" class="i method">IsProviderDirectPath</a>(<b>string</b> <span id="r344 rd" class="r344 r">path</span>)
        {
            <b>if</b> (<span class="r344 r">path</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r344 r">path</span>));
            }
 
            <b>return</b> <span class="r344 r">path</span>.<span class="i">StartsWith</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#a125c05e6b0f352a" class="i field">DefaultRemotePathPrefix</a>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>) ||
                   <span class="r344 r">path</span>.<span class="i">StartsWith</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#66b878defbfecec1" class="i field">AlternateRemotePathPrefix</a>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Generates the path for the home location for a provider when given a</span>
        <span class="c">///</span><span class="c"> path starting with ~ or &quot;provider:~&quot; followed by a relative path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r345 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to generate into a home path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path representing the path to the home location for a provider. This</span>
        <span class="c">///</span><span class="c"> may be either a fully qualified provider path or a PowerShell path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r345 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#a58038dc730da896" class="t t">ProviderNotFoundException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r345 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is a provider-qualified path</span>
        <span class="c">///</span><span class="c"> and the specified provider does not exist.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/SessionStateExceptions.cs.html#35e07c15a7526bcd" class="t t">ProviderInvocationException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider throws an exception when its MakePath gets</span>
        <span class="c">///</span><span class="c"> called.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">NotSupportedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the provider does not support multiple items.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the home location for the provider is not set and</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r345 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> starts with a &quot;~&quot;.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal string</b> <a id="a5b7e35a38a3d24c" href="../R/a5b7e35a38a3d24c.html" target="n" data-glyph="74,1" class="i method">GetHomeRelativePath</a>(<b>string</b> <span id="r345 rd" class="r345 r">path</span>)
        {
            <b>if</b> (<span class="r345 r">path</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r345 r">path</span>));
            }
 
            <b>string</b> <span id="r346 rd" class="r346 r">result</span> = <span class="r345 r">path</span>;
 
            <b>if</b> (<a href="#48978d46f1040a39" class="i method">IsHomePath</a>(<span class="r345 r">path</span>) &amp;&amp; <a href="#06ecc54ac29ea6b5" class="i field">_sessionState</a>.<a href="../engine/SessionStatePublic.cs.html#49ff6e2d0769f2e2" class="i property">Drive</a>.<a href="../engine/DriveInterfaces.cs.html#ad95755a5d797edb" class="i property">Current</a> != <b>null</b>)
            {
                <a href="../engine/DataStoreAdapterProvider.cs.html#dd4e1f2f8e73a1dd" class="t t">ProviderInfo</a> <span id="r347 rd" class="r347 r">provider</span> = <a href="#06ecc54ac29ea6b5" class="i field">_sessionState</a>.<a href="../engine/SessionStatePublic.cs.html#49ff6e2d0769f2e2" class="i property">Drive</a>.<a href="../engine/DriveInterfaces.cs.html#ad95755a5d797edb" class="i property">Current</a>.<a href="../engine/DataStoreAdapter.cs.html#599e6ea3519fc2d6" class="i property">Provider</a>;
 
                <b>if</b> (<a href="#45d8fc5f64551b7a" class="i method">IsProviderQualifiedPath</a>(<span class="r345 r">path</span>))
                {
                    <span class="c">// Strip off the provider portion of the path</span>
 
                    <b>int</b> <span id="r348 rd" class="r348 r">index</span> = <span class="r345 r">path</span>.<span class="i">IndexOf</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#6981dbcadad2340f" class="i field">ProviderPathSeparator</a>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>);
 
                    <b>if</b> (<span class="r348 r">index</span> != -1)
                    {
                        <span class="c">// Since the provider was specified store it and remove it</span>
                        <span class="c">// from the path.</span>
 
                        <b>string</b> <span id="r349 rd" class="r349 r">providerName</span> = <span class="r345 r">path</span>.<span class="i">Substring</span>(0, <span class="r348 r">index</span>);
 
                        <span class="r347 r">provider</span> = <a href="#06ecc54ac29ea6b5" class="i field">_sessionState</a>.<a href="../engine/SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../engine/SessionStateProviderAPIs.cs.html#02cfdb64abb0b450" class="i method">GetSingleProvider</a>(<span class="r349 r">providerName</span>);
                        <span class="r345 r">path</span> = <span class="r345 r">path</span>.<span class="i">Substring</span>(<span class="r348 r">index</span> + <a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#6981dbcadad2340f" class="i field">ProviderPathSeparator</a>.<span class="i">Length</span>);
                    }
                }
 
                <b>if</b> (<span class="r345 r">path</span>.<span class="i">IndexOf</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#09a3c99751dbad80" class="i field">HomePath</a>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>) == 0)
                {
                    <span class="c">// Strip of the ~ and the \ or / if present</span>
 
                    <b>if</b> (<span class="r345 r">path</span>.<span class="i">Length</span> &gt; 1 &amp;&amp;
                        (<span class="r345 r">path</span>[1] == <span class="s">&#39;\\&#39;</span> ||
                         <span class="r345 r">path</span>[1] == <span class="s">&#39;/&#39;</span>))
                    {
                        <span class="r345 r">path</span> = <span class="r345 r">path</span>.<span class="i">Substring</span>(2);
                    }
                    <b>else</b>
                    {
                        <span class="r345 r">path</span> = <span class="r345 r">path</span>.<span class="i">Substring</span>(1);
                    }
 
                    <span class="c">// Now piece together the provider&#39;s home path and the remaining</span>
                    <span class="c">// portion of the passed in path</span>
 
                    <b>if</b> (<span class="r347 r">provider</span>.<a href="../engine/DataStoreAdapterProvider.cs.html#589a26e592ac4153" class="i property">Home</a> != <b>null</b> &amp;&amp;
                        <span class="r347 r">provider</span>.<a href="../engine/DataStoreAdapterProvider.cs.html#589a26e592ac4153" class="i property">Home</a>.<span class="i">Length</span> &gt; 0)
                    {
                        <a href="CoreCommandContext.cs.html#1e83d35d5286e174" class="t t">CmdletProviderContext</a> <span id="r350 rd" class="r350 r">context</span> =
                            <b>new</b> <a href="CoreCommandContext.cs.html#8a0e078b40b2fd0e" class="t constructor">CmdletProviderContext</a>(<a href="#06ecc54ac29ea6b5" class="i field">_sessionState</a>.<a href="../engine/SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../engine/SessionState.cs.html#3ddff2db6bc01805" class="i property">ExecutionContext</a>);
 
                        <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Getting home path for provider: {0}&quot;</span>, <span class="r347 r">provider</span>.<a href="../engine/DataStoreAdapterProvider.cs.html#2837d805ea30ef5c" class="i property">Name</a>);
                        <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Provider HOME path: {0}&quot;</span>, <span class="r347 r">provider</span>.<a href="../engine/DataStoreAdapterProvider.cs.html#589a26e592ac4153" class="i property">Home</a>);
 
                        <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r345 r">path</span>))
                        {
                            <span class="r345 r">path</span> = <span class="r347 r">provider</span>.<a href="../engine/DataStoreAdapterProvider.cs.html#589a26e592ac4153" class="i property">Home</a>;
                        }
                        <b>else</b>
                        {
                            <span class="r345 r">path</span> = <a href="#06ecc54ac29ea6b5" class="i field">_sessionState</a>.<a href="../engine/SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../engine/SessionStateNavigation.cs.html#dc855ab62534fcda" class="i method">MakePath</a>(<span class="r347 r">provider</span>, <span class="r347 r">provider</span>.<a href="../engine/DataStoreAdapterProvider.cs.html#589a26e592ac4153" class="i property">Home</a>, <span class="r345 r">path</span>, <span class="r350 r">context</span>);
                        }
 
                        <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;HOME relative path: {0}&quot;</span>, <span class="r345 r">path</span>);
                    }
                    <b>else</b>
                    {
                        <span class="i">InvalidOperationException</span> <span id="r351 rd" class="r351 r">e</span> =
                            <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(
                                <span class="i">SessionStateStrings</span>.<span class="i">HomePathNotSet</span>,
                                <span class="r347 r">provider</span>.<a href="../engine/DataStoreAdapterProvider.cs.html#2837d805ea30ef5c" class="i property">Name</a>);
 
                        <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#e7dd110db4bf902f" class="i method">TraceError</a>(<span class="s">&quot;HOME path not set for provider: {0}&quot;</span>, <span class="r347 r">provider</span>.<a href="../engine/DataStoreAdapterProvider.cs.html#2837d805ea30ef5c" class="i property">Name</a>);
                        <b>throw</b> <span class="r351 r">e</span>;
                    }
                }
 
                <span class="r346 r">result</span> = <span class="r345 r">path</span>;
            }
 
            <b>return</b> <span class="r346 r">result</span>;
        }
 
        <b>private static void</b> <a id="2bf2d71caf7f9287" href="../R/2bf2d71caf7f9287.html" target="n" data-glyph="76,1" class="i method">TraceFilters</a>(<a href="CoreCommandContext.cs.html#1e83d35d5286e174" class="t t">CmdletProviderContext</a> <span id="r352 rd" class="r352 r">context</span>)
        {
            <b>if</b> ((<a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#39a46fbab64bf75b" class="i property">Options</a> &amp; <a href="../utils/StructuredTraceSource.cs.html#8dccd9e1e9512b25" class="t t">PSTraceSourceOptions</a>.<a href="../utils/StructuredTraceSource.cs.html#d9418c516f830881" class="i field">WriteLine</a>) != 0)
            {
                <span class="c">// Trace the filter</span>
                <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<span class="i">WriteLine</span>(<span class="s">&quot;Filter: {0}&quot;</span>, <span class="r352 r">context</span>.<a href="CoreCommandContext.cs.html#274e5d6991e70230" class="i property">Filter</a> ?? <b>string</b>.<span class="i">Empty</span>);
 
                <b>if</b> (<span class="r352 r">context</span>.<a href="CoreCommandContext.cs.html#ab4bd68ec99ecaa3" class="i property">Include</a> != <b>null</b>)
                {
                    <span class="c">// Trace the include filters</span>
                    <span class="i">StringBuilder</span> <span id="r353 rd" class="r353 r">includeString</span> = <b>new</b> <span class="i">StringBuilder</span>();
                    <b>foreach</b> (<b>string</b> <span id="r354 rd" class="r354 r">includeFilter</span> <b>in</b> <span class="r352 r">context</span>.<a href="CoreCommandContext.cs.html#ab4bd68ec99ecaa3" class="i property">Include</a>)
                    {
                        <span class="r353 r">includeString</span>.<span class="i">AppendFormat</span>(<span class="s">&quot;{0} &quot;</span>, <span class="r354 r">includeFilter</span>);
                    }
 
                    <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<span class="i">WriteLine</span>(<span class="s">&quot;Include: {0}&quot;</span>, <span class="r353 r">includeString</span>.<span class="i">ToString</span>());
                }
 
                <b>if</b> (<span class="r352 r">context</span>.<a href="CoreCommandContext.cs.html#93e21581391c00fc" class="i property">Exclude</a> != <b>null</b>)
                {
                    <span class="c">// Trace the exclude filters</span>
                    <span class="i">StringBuilder</span> <span id="r355 rd" class="r355 r">excludeString</span> = <b>new</b> <span class="i">StringBuilder</span>();
                    <b>foreach</b> (<b>string</b> <span id="r356 rd" class="r356 r">excludeFilter</span> <b>in</b> <span class="r352 r">context</span>.<a href="CoreCommandContext.cs.html#93e21581391c00fc" class="i property">Exclude</a>)
                    {
                        <span class="r355 r">excludeString</span>.<span class="i">AppendFormat</span>(<span class="s">&quot;{0} &quot;</span>, <span class="r356 r">excludeFilter</span>);
                    }
 
                    <a href="#9dce9630a6e8ca4b" class="i field">s_pathResolutionTracer</a>.<span class="i">WriteLine</span>(<span class="s">&quot;Exclude: {0}&quot;</span>, <span class="r355 r">excludeString</span>.<span class="i">ToString</span>());
                }
            }
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> internal methods
 
    }
}
</pre></td></tr></table></div></body></html>
