<!DOCTYPE html>
<html><head><title>NavigationProviderBase.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(1095);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#System.Management.Automation/namespaces/NavigationProviderBase.cs" target="_top">namespaces\NavigationProviderBase.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#System.Management.Automation" target="_top">src\System.Management.Automation\System.Management.Automation.csproj</a> (System.Management.Automation)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Internal</span>;
 
<b>namespace</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Provider</span>
{
    <span class="k preprocess">#</span><span class="k preprocess">region</span> NavigationCmdletProvider
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> The base class for a Cmdlet provider that expose a hierarchy of items and containers.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> The NavigationCmdletProvider class is a base class that provider can derive from</span>
    <span class="c">///</span><span class="c"> to implement a set of methods that allow</span>
    <span class="c">///</span><span class="c"> the use of a set of core commands against the data store that the provider</span>
    <span class="c">///</span><span class="c"> gives access to. By implementing this interface users can take advantage</span>
    <span class="c">///</span><span class="c"> the recursive commands, nested containers, and relative paths.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
    <b>public abstract class</b> <a id="7d31476313596b0b" href="../R/7d31476313596b0b.html" target="n" data-glyph="0,0" class="t t"><span id="b07fdccffd5f2d09">NavigationCmdletProvider</span></a> : <a href="ContainerProviderBase.cs.html#bfc85492b760e757" class="t t">ContainerCmdletProvider</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Internal methods
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Internal wrapper for the MakePath protected method. It is called instead</span>
        <span class="c">///</span><span class="c"> of the protected method that is overridden by derived classes so that the</span>
        <span class="c">///</span><span class="c"> context of the command can be set.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">parent</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The parent segment of a path to be joined with the child.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">child</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The child segment of a path to be joined with the parent.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r2 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The context under which this method is being called.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A string that represents the parent and child segments of the path</span>
        <span class="c">///</span><span class="c"> joined by a path separator.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This method should use lexical joining of two path segments with a path</span>
        <span class="c">///</span><span class="c"> separator character. It should not validate the path as a legal fully</span>
        <span class="c">///</span><span class="c"> qualified path in the provider namespace as each parameter could be only</span>
        <span class="c">///</span><span class="c"> partial segments of a path and joined they may not generate a fully</span>
        <span class="c">///</span><span class="c"> qualified path.</span>
        <span class="c">///</span><span class="c"> Example: the file system provider may get &quot;windows\system32&quot; as the parent</span>
        <span class="c">///</span><span class="c"> parameter and &quot;foo.dll&quot; as the child parameter. The method should join these</span>
        <span class="c">///</span><span class="c"> with the &quot;\&quot; separator and return &quot;windows\system32\foo.dll&quot;. Note that</span>
        <span class="c">///</span><span class="c"> the returned path is not a fully qualified file system path.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> Also beware that the path segments may contain characters that are illegal</span>
        <span class="c">///</span><span class="c"> in the provider namespace. These characters are most likely being used</span>
        <span class="c">///</span><span class="c"> for globbing and should not be removed by the implementation of this method.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>internal string</b> <a id="17084326a3adb855" href="../R/17084326a3adb855.html" target="n" data-glyph="74,1" class="i method">MakePath</a>(
            <b>string</b> <span id="r0 rd" class="r0 r">parent</span>,
            <b>string</b> <span id="r1 rd" class="r1 r">child</span>,
            <a href="CoreCommandContext.cs.html#1e83d35d5286e174" class="t t">CmdletProviderContext</a> <span id="r2 rd" class="r2 r">context</span>)
        {
            <a href="ProviderBase.cs.html#70e6bb9df8f94746" class="i property">Context</a> = <span class="r2 r">context</span>;
 
            <span class="c">// Call virtual method</span>
 
            <b>return</b> <a href="#6133115f9f4a066d" class="i method">MakePath</a>(<span class="r0 r">parent</span>, <span class="r1 r">child</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Internal wrapper for the GetParentPath protected method. It is called instead</span>
        <span class="c">///</span><span class="c"> of the protected method that is overridden by derived classes so that the</span>
        <span class="c">///</span><span class="c"> context of the command can be set.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r3 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A fully qualified provider specific path to an item. The item may or</span>
        <span class="c">///</span><span class="c"> may not exist.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r4 r">root</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The fully qualified path to the root of a drive. This parameter may be null</span>
        <span class="c">///</span><span class="c"> or empty if a mounted drive is not in use for this operation. If this parameter</span>
        <span class="c">///</span><span class="c"> is not null or empty the result of the method should not be a path to a container</span>
        <span class="c">///</span><span class="c"> that is a parent or in a different tree than the root.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r5 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The context under which this method is being called.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path of the parent of the path parameter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This should be a lexical splitting of the path on the path separator character</span>
        <span class="c">///</span><span class="c"> for the provider namespace. For example, the file system provider should look</span>
        <span class="c">///</span><span class="c"> for the last &quot;\&quot; and return everything to the left of the &quot;\&quot;.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>internal string</b> <a id="df8c0961560a6b0d" href="../R/df8c0961560a6b0d.html" target="n" data-glyph="74,1" class="i method">GetParentPath</a>(
            <b>string</b> <span id="r3 rd" class="r3 r">path</span>,
            <b>string</b> <span id="r4 rd" class="r4 r">root</span>,
            <a href="CoreCommandContext.cs.html#1e83d35d5286e174" class="t t">CmdletProviderContext</a> <span id="r5 rd" class="r5 r">context</span>)
        {
            <a href="ProviderBase.cs.html#70e6bb9df8f94746" class="i property">Context</a> = <span class="r5 r">context</span>;
 
            <span class="c">// Call virtual method</span>
 
            <b>return</b> <a href="#ae5182f675ef4491" class="i method">GetParentPath</a>(<span class="r3 r">path</span>, <span class="r4 r">root</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Internal wrapper for the NormalizeRelativePath method. It is called instead</span>
        <span class="c">///</span><span class="c"> of the protected method that is overridden by derived classes so that the</span>
        <span class="c">///</span><span class="c"> context of the command can be set.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r6 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A fully qualified provider specific path to an item. The item should exist</span>
        <span class="c">///</span><span class="c"> or the provider should write out an error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r7 r">basePath</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path that the return value should be relative to.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r8 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The context under which this method is being called.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A normalized path that is relative to the basePath that was passed. The</span>
        <span class="c">///</span><span class="c"> provider should parse the path parameter, normalize the path, and then</span>
        <span class="c">///</span><span class="c"> return the normalized path relative to the basePath.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This method does not have to be purely syntactical parsing of the path. It</span>
        <span class="c">///</span><span class="c"> is encouraged that the provider actually use the path to lookup in its store</span>
        <span class="c">///</span><span class="c"> and create a relative path that matches the casing, and standardized path syntax.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>internal string</b> <a id="2c554f8e462915ca" href="../R/2c554f8e462915ca.html" target="n" data-glyph="74,1" class="i method">NormalizeRelativePath</a>(
            <b>string</b> <span id="r6 rd" class="r6 r">path</span>,
            <b>string</b> <span id="r7 rd" class="r7 r">basePath</span>,
            <a href="CoreCommandContext.cs.html#1e83d35d5286e174" class="t t">CmdletProviderContext</a> <span id="r8 rd" class="r8 r">context</span>)
        {
            <a href="ProviderBase.cs.html#70e6bb9df8f94746" class="i property">Context</a> = <span class="r8 r">context</span>;
 
            <span class="c">// Call virtual method</span>
 
            <b>return</b> <a href="#30d286c316d0534c" class="i method">NormalizeRelativePath</a>(<span class="r6 r">path</span>, <span class="r7 r">basePath</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Internal wrapper for the GetChildName protected method. It is called instead</span>
        <span class="c">///</span><span class="c"> of the protected method that is overridden by derived classes so that the</span>
        <span class="c">///</span><span class="c"> context of the command can be set.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r9 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The fully qualified path to the item</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The leaf element in the path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r10 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The context under which this method is being called.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This should be implemented as a split on the path separator. The characters</span>
        <span class="c">///</span><span class="c"> in the fullPath may not be legal characters in the namespace but may be</span>
        <span class="c">///</span><span class="c"> used in globing or regular expression matching. The provider should not error</span>
        <span class="c">///</span><span class="c"> unless there are no path separators in the fully qualified path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>internal string</b> <a id="0fc64120846797fb" href="../R/0fc64120846797fb.html" target="n" data-glyph="74,1" class="i method">GetChildName</a>(
            <b>string</b> <span id="r9 rd" class="r9 r">path</span>,
            <a href="CoreCommandContext.cs.html#1e83d35d5286e174" class="t t">CmdletProviderContext</a> <span id="r10 rd" class="r10 r">context</span>)
        {
            <a href="ProviderBase.cs.html#70e6bb9df8f94746" class="i property">Context</a> = <span class="r10 r">context</span>;
 
            <span class="c">// Call virtual method</span>
 
            <b>return</b> <a href="#dbded73c0d368b0d" class="i method">GetChildName</a>(<span class="r9 r">path</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Internal wrapper for the IsItemContainer protected method. It is called instead</span>
        <span class="c">///</span><span class="c"> of the protected method that is overridden by derived classes so that the</span>
        <span class="c">///</span><span class="c"> context of the command can be set.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r11 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to the item to determine if it is a container.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r12 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The context under which this method is being called.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> true if the item specified by path is a container, false otherwise.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="777ee519c6c5b47b" href="../R/777ee519c6c5b47b.html" target="n" data-glyph="74,1" class="i method">IsItemContainer</a>(
            <b>string</b> <span id="r11 rd" class="r11 r">path</span>,
            <a href="CoreCommandContext.cs.html#1e83d35d5286e174" class="t t">CmdletProviderContext</a> <span id="r12 rd" class="r12 r">context</span>)
        {
            <a href="ProviderBase.cs.html#70e6bb9df8f94746" class="i property">Context</a> = <span class="r12 r">context</span>;
 
            <span class="c">// Call virtual method</span>
 
            <b>return</b> <a href="#9b9dc6b4f4687790" class="i method">IsItemContainer</a>(<span class="r11 r">path</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Internal wrapper for the MoveItem protected method. It is called instead</span>
        <span class="c">///</span><span class="c"> of the protected method that is overridden by derived classes so that the</span>
        <span class="c">///</span><span class="c"> context of the command can be set.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r13 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to the item to be moved.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r14 r">destination</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path of the destination container.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r15 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The context under which this method is being called.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Nothing. All objects that are moved should be written to the WriteObject method.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="0a02b5a71f2790e4" href="../R/0a02b5a71f2790e4.html" target="n" data-glyph="74,1" class="i method">MoveItem</a>(
            <b>string</b> <span id="r13 rd" class="r13 r">path</span>,
            <b>string</b> <span id="r14 rd" class="r14 r">destination</span>,
            <a href="CoreCommandContext.cs.html#1e83d35d5286e174" class="t t">CmdletProviderContext</a> <span id="r15 rd" class="r15 r">context</span>)
        {
            <a href="ProviderBase.cs.html#70e6bb9df8f94746" class="i property">Context</a> = <span class="r15 r">context</span>;
 
            <span class="c">// Call virtual method</span>
 
            <a href="#8d0b2554e518ab2e" class="i method">MoveItem</a>(<span class="r13 r">path</span>, <span class="r14 r">destination</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gives the provider to attach additional parameters to</span>
        <span class="c">///</span><span class="c"> the move-item cmdlet.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r16 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the path was specified on the command line, this is the path</span>
        <span class="c">///</span><span class="c"> to the item to get the dynamic parameters for.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r17 r">destination</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path of the destination container.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r18 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The context under which this method is being called.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An object that has properties and fields decorated with</span>
        <span class="c">///</span><span class="c"> parsing attributes similar to a cmdlet class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal object</b> <a id="38c2ea04379af562" href="../R/38c2ea04379af562.html" target="n" data-glyph="74,1" class="i method">MoveItemDynamicParameters</a>(
            <b>string</b> <span id="r16 rd" class="r16 r">path</span>,
            <b>string</b> <span id="r17 rd" class="r17 r">destination</span>,
            <a href="CoreCommandContext.cs.html#1e83d35d5286e174" class="t t">CmdletProviderContext</a> <span id="r18 rd" class="r18 r">context</span>)
        {
            <a href="ProviderBase.cs.html#70e6bb9df8f94746" class="i property">Context</a> = <span class="r18 r">context</span>;
            <b>return</b> <a href="#082758e0d3f39658" class="i method">MoveItemDynamicParameters</a>(<span class="r16 r">path</span>, <span class="r17 r">destination</span>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Internal methods
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> protected methods
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Joins two strings with a path a provider specific path separator.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r19 r">parent</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The parent segment of a path to be joined with the child.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r20 r">child</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The child segment of a path to be joined with the parent.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A string that represents the parent and child segments of the path</span>
        <span class="c">///</span><span class="c"> joined by a path separator.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This method should use lexical joining of two path segments with a path</span>
        <span class="c">///</span><span class="c"> separator character. It should not validate the path as a legal fully</span>
        <span class="c">///</span><span class="c"> qualified path in the provider namespace as each parameter could be only</span>
        <span class="c">///</span><span class="c"> partial segments of a path and joined they may not generate a fully</span>
        <span class="c">///</span><span class="c"> qualified path.</span>
        <span class="c">///</span><span class="c"> Example: the file system provider may get &quot;windows\system32&quot; as the parent</span>
        <span class="c">///</span><span class="c"> parameter and &quot;foo.dll&quot; as the child parameter. The method should join these</span>
        <span class="c">///</span><span class="c"> with the &quot;\&quot; separator and return &quot;windows\system32\foo.dll&quot;. Note that</span>
        <span class="c">///</span><span class="c"> the returned path is not a fully qualified file system path.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> Also beware that the path segments may contain characters that are illegal</span>
        <span class="c">///</span><span class="c"> in the provider namespace. These characters are most likely being used</span>
        <span class="c">///</span><span class="c"> for globbing and should not be removed by the implementation of this method.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>protected virtual string</b> <a id="6133115f9f4a066d" href="../R/6133115f9f4a066d.html" target="n" data-glyph="75,1" class="i method">MakePath</a>(<b>string</b> <span id="r19 rd" class="r19 r">parent</span>, <b>string</b> <span id="r20 rd" class="r20 r">child</span>)
        {
            <b>return</b> <a href="#61e394b168b406c8" class="i method">MakePath</a>(<span class="r19 r">parent</span>, <span class="r20 r">child</span>, <span class="r21 r">childIsLeaf</span>: <b>false</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Joins two strings with a path a provider specific path separator.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r22 r">parent</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The parent segment of a path to be joined with the child.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r23 r">child</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The child segment of a path to be joined with the parent.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r21 r">childIsLeaf</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Indicate that the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r23 r">child</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is the name of a child item that&#39;s guaranteed to exist</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r21 r">childIsLeaf</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is True, then we don&#39;t normalize the child path, and would do</span>
        <span class="c">///</span><span class="c"> some checks to decide whether to normalize the parent path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">New path string.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>protected string</b> <a id="61e394b168b406c8" href="../R/61e394b168b406c8.html" target="n" data-glyph="75,1" class="i method">MakePath</a>(<b>string</b> <span id="r22 rd" class="r22 r">parent</span>, <b>string</b> <span id="r23 rd" class="r23 r">child</span>, <b>bool</b> <span id="r21 rd" class="r21 r">childIsLeaf</span>)
        {
            <b>using</b> (<a href="../CoreCLR/CorePsStub.cs.html#6d758ac5b09394e4" class="t t">PSTransactionManager</a>.<a href="../CoreCLR/CorePsStub.cs.html#d6d4cf3db02d03bb" class="i method">GetEngineProtectionScope</a>())
            {
                <b>string</b> <span id="r24 rd" class="r24 r">result</span> = <b>null</b>;
 
                <b>if</b> (<span class="r22 r">parent</span> == <b>null</b> &amp;&amp;
                    <span class="r23 r">child</span> == <b>null</b>)
                {
                    <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fed5f40dc0075d41" class="i method">NewArgumentException</a>(<b>nameof</b>(<span class="r22 r">parent</span>));
                }
 
                <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r22 r">parent</span>) &amp;&amp;
                    <b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r23 r">child</span>))
                {
                    <span class="r24 r">result</span> = <b>string</b>.<span class="i">Empty</span>;
                }
                <b>else</b> <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r22 r">parent</span>) &amp;&amp;
                         !<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r23 r">child</span>))
                {
                    <span class="r24 r">result</span> = <a href="#e4ed2b91c70745a0" class="i method">NormalizePath</a>(<span class="r23 r">child</span>);
                }
                <b>else</b> <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r22 r">parent</span>) &amp;&amp;
                         (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r23 r">child</span>) ||
                          <span class="r23 r">child</span>.<span class="i">Equals</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#b7c0e8f5832a0fb6" class="i field">DefaultPathSeparatorString</a>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>) ||
                          <span class="r23 r">child</span>.<span class="i">Equals</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#dffdd2c23e223601" class="i field">AlternatePathSeparatorString</a>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>)))
                {
                    <b>if</b> (<span class="r22 r">parent</span>.<span class="i">EndsWith</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a>))
                    {
                        <span class="r24 r">result</span> = <span class="r22 r">parent</span>;
                    }
                    <b>else</b>
                    {
                        <span class="r24 r">result</span> = <span class="r22 r">parent</span> + <a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a>;
                    }
                }
                <b>else</b>
                {
                    <span class="c">// Both parts are not empty so join them</span>
                    <span class="c">// &#39;childIsLeaf == true&#39; indicates that &#39;child&#39; is actually the name of a child item and</span>
                    <span class="c">// guaranteed to exist. In this case, we don&#39;t normalize the child path.</span>
                    <b>if</b> (<span class="r21 r">childIsLeaf</span>)
                    {
                        <span class="r22 r">parent</span> = <a href="#e4ed2b91c70745a0" class="i method">NormalizePath</a>(<span class="r22 r">parent</span>);
                    }
                    <b>else</b>
                    {
                        <span class="c">// Normalize the path so that only the default path separator is used as a</span>
                        <span class="c">// separator even if the user types the alternate slash.</span>
                        <span class="r22 r">parent</span> = <a href="#e4ed2b91c70745a0" class="i method">NormalizePath</a>(<span class="r22 r">parent</span>);
                        <span class="r23 r">child</span> = <a href="#e4ed2b91c70745a0" class="i method">NormalizePath</a>(<span class="r23 r">child</span>);
                    }
 
                    <span class="i">ReadOnlySpan</span>&lt;<b>char</b>&gt; <span id="r25 rd" class="r25 r">appendChild</span> = <span class="r23 r">child</span>.<span class="i">AsSpan</span>();
                    <b>if</b> (<span class="r23 r">child</span>.<span class="i">StartsWith</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a>))
                    {
                        <span class="r25 r">appendChild</span> = <span class="r25 r">appendChild</span>.<span class="i">Slice</span>(1);
                    }
 
                    <span class="r24 r">result</span> = <span class="i">IO</span>.<span class="i">Path</span>.<span class="i">Join</span>(<span class="r22 r">parent</span>.<span class="i">AsSpan</span>(), <span class="r25 r">appendChild</span>);
                }
 
                <b>return</b> <span class="r24 r">result</span>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Removes the child segment of a path and returns the remaining parent</span>
        <span class="c">///</span><span class="c"> portion.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r26 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A fully qualified provider specific path to an item. The item may or</span>
        <span class="c">///</span><span class="c"> may not exist.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r27 r">root</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The fully qualified path to the root of a drive. This parameter may be null</span>
        <span class="c">///</span><span class="c"> or empty if a mounted drive is not in use for this operation. If this parameter</span>
        <span class="c">///</span><span class="c"> is not null or empty the result of the method should not be a path to a container</span>
        <span class="c">///</span><span class="c"> that is a parent or in a different tree than the root.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path of the parent of the path parameter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This should be a lexical splitting of the path on the path separator character</span>
        <span class="c">///</span><span class="c"> for the provider namespace. For example, the file system provider should look</span>
        <span class="c">///</span><span class="c"> for the last &quot;\&quot; and return everything to the left of the &quot;\&quot;.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>protected virtual string</b> <a id="ae5182f675ef4491" href="../R/ae5182f675ef4491.html" target="n" data-glyph="75,1" class="i method">GetParentPath</a>(<b>string</b> <span id="r26 rd" class="r26 r">path</span>, <b>string</b> <span id="r27 rd" class="r27 r">root</span>)
        {
            <b>using</b> (<a href="../CoreCLR/CorePsStub.cs.html#6d758ac5b09394e4" class="t t">PSTransactionManager</a>.<a href="../CoreCLR/CorePsStub.cs.html#d6d4cf3db02d03bb" class="i method">GetEngineProtectionScope</a>())
            {
                <b>string</b> <span id="r28 rd" class="r28 r">parentPath</span> = <b>null</b>;
 
                <span class="c">// Verify the parameters</span>
 
                <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r26 r">path</span>))
                {
                    <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fed5f40dc0075d41" class="i method">NewArgumentException</a>(<b>nameof</b>(<span class="r26 r">path</span>));
                }
 
                <b>if</b> (<span class="r27 r">root</span> == <b>null</b>)
                {
                    <b>if</b> (<a href="ProviderBase.cs.html#bf1d5d8dfd4808db" class="i property">PSDriveInfo</a> != <b>null</b>)
                    {
                        <span class="r27 r">root</span> = <a href="ProviderBase.cs.html#bf1d5d8dfd4808db" class="i property">PSDriveInfo</a>.<a href="../engine/DataStoreAdapter.cs.html#6c8f4db73167e8f9" class="i property">Root</a>;
                    }
                }
 
                <span class="c">// Normalize the path</span>
 
                <span class="r26 r">path</span> = <a href="#e4ed2b91c70745a0" class="i method">NormalizePath</a>(<span class="r26 r">path</span>);
                <span class="r26 r">path</span> = <span class="r26 r">path</span>.<span class="i">TrimEnd</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a>);
                <b>string</b> <span id="r29 rd" class="r29 r">rootPath</span> = <b>string</b>.<span class="i">Empty</span>;
 
                <b>if</b> (<span class="r27 r">root</span> != <b>null</b>)
                {
                    <span class="r29 r">rootPath</span> = <a href="#e4ed2b91c70745a0" class="i method">NormalizePath</a>(<span class="r27 r">root</span>);
                }
 
                <span class="c">// Check to see if the path is equal to the root</span>
                <span class="c">// of the virtual drive</span>
 
                <b>if</b> (<b>string</b>.<span class="i">Equals</span>(
                    <span class="r26 r">path</span>,
                    <span class="r29 r">rootPath</span>,
                    <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <span class="r28 r">parentPath</span> = <b>string</b>.<span class="i">Empty</span>;
                }
                <b>else</b>
                {
                    <b>int</b> <span id="r30 rd" class="r30 r">lastIndex</span> = <span class="r26 r">path</span>.<span class="i">LastIndexOf</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a>);
 
                    <b>if</b> (<span class="r30 r">lastIndex</span> != -1)
                    {
                        <b>if</b> (<span class="r30 r">lastIndex</span> == 0)
                        {
                            ++<span class="r30 r">lastIndex</span>;
                        }
                        <span class="c">// Get the parent directory</span>
 
                        <span class="r28 r">parentPath</span> = <span class="r26 r">path</span>.<span class="i">Substring</span>(0, <span class="r30 r">lastIndex</span>);
                    }
                    <b>else</b>
                    {
                        <span class="r28 r">parentPath</span> = <b>string</b>.<span class="i">Empty</span>;
                    }
                }
 
                <b>return</b> <span class="r28 r">parentPath</span>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Normalizes the path that was passed in and returns the normalized path</span>
        <span class="c">///</span><span class="c"> as a relative path to the basePath that was passed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r31 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A fully qualified provider specific path to an item. The item should exist</span>
        <span class="c">///</span><span class="c"> or the provider should write out an error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r32 r">basePath</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path that the return value should be relative to.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A normalized path that is relative to the basePath that was passed. The</span>
        <span class="c">///</span><span class="c"> provider should parse the path parameter, normalize the path, and then</span>
        <span class="c">///</span><span class="c"> return the normalized path relative to the basePath.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This method does not have to be purely syntactical parsing of the path. It</span>
        <span class="c">///</span><span class="c"> is encouraged that the provider actually use the path to lookup in its store</span>
        <span class="c">///</span><span class="c"> and create a relative path that matches the casing, and standardized path syntax.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> Note, the base class implementation uses GetParentPath, GetChildName, and MakePath</span>
        <span class="c">///</span><span class="c"> to normalize the path and then make it relative to basePath. All string comparisons</span>
        <span class="c">///</span><span class="c"> are done using StringComparison.InvariantCultureIgnoreCase.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>protected virtual string</b> <a id="30d286c316d0534c" href="../R/30d286c316d0534c.html" target="n" data-glyph="75,1" class="i method">NormalizeRelativePath</a>(
            <b>string</b> <span id="r31 rd" class="r31 r">path</span>,
            <b>string</b> <span id="r32 rd" class="r32 r">basePath</span>)
        {
            <b>using</b> (<a href="../CoreCLR/CorePsStub.cs.html#6d758ac5b09394e4" class="t t">PSTransactionManager</a>.<a href="../CoreCLR/CorePsStub.cs.html#d6d4cf3db02d03bb" class="i method">GetEngineProtectionScope</a>())
            {
                <b>return</b> <a href="#c0c3c593f9282ffb" class="i method">ContractRelativePath</a>(<span class="r31 r">path</span>, <span class="r32 r">basePath</span>, <b>false</b>, <a href="ProviderBase.cs.html#70e6bb9df8f94746" class="i property">Context</a>);
            }
        }
 
        <b>internal string</b> <a id="c0c3c593f9282ffb" href="../R/c0c3c593f9282ffb.html" target="n" data-glyph="74,1" class="i method">ContractRelativePath</a>(
            <b>string</b> <span id="r33 rd" class="r33 r">path</span>,
            <b>string</b> <span id="r34 rd" class="r34 r">basePath</span>,
            <b>bool</b> <span id="r35 rd" class="r35 r">allowNonExistingPaths</span>,
            <a href="CoreCommandContext.cs.html#1e83d35d5286e174" class="t t">CmdletProviderContext</a> <span id="r36 rd" class="r36 r">context</span>)
        {
            <a href="ProviderBase.cs.html#70e6bb9df8f94746" class="i property">Context</a> = <span class="r36 r">context</span>;
 
            <b>if</b> (<span class="r33 r">path</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r33 r">path</span>));
            }
 
            <b>if</b> (<span class="r33 r">path</span>.<span class="i">Length</span> == 0)
            {
                <b>return</b> <b>string</b>.<span class="i">Empty</span>;
            }
 
            <b>if</b> (<span class="r34 r">basePath</span> == <b>null</b>)
            {
                <span class="r34 r">basePath</span> = <b>string</b>.<span class="i">Empty</span>;
            }
 
            <a href="ProviderBase.cs.html#212052e68534d09f" class="i field">providerBaseTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;basePath = {0}&quot;</span>, <span class="r34 r">basePath</span>);
 
            <b>string</b> <span id="r37 rd" class="r37 r">result</span> = <span class="r33 r">path</span>;
            <b>bool</b> <span id="r38 rd" class="r38 r">originalPathHadTrailingSlash</span> = <b>false</b>;
 
            <b>string</b> <span id="r39 rd" class="r39 r">normalizedPath</span> = <span class="r33 r">path</span>;
            <b>string</b> <span id="r40 rd" class="r40 r">normalizedBasePath</span> = <span class="r34 r">basePath</span>;
 
            <span class="c">// NTRAID#Windows 7-697922-2009/06/29-leeholm</span>
            <span class="c">// WORKAROUND WORKAROUND WORKAROUND WORKAROUND WORKAROUND WORKAROUND WORKAROUND WORKAROUND WORKAROUND</span>
            <span class="c">//</span>
            <span class="c">// This path normalization got moved here from the MakePath override in V2 to prevent</span>
            <span class="c">// over-normalization of paths. This was a net-improvement for providers that use the default</span>
            <span class="c">// implementations, but now incorrectly replaces forward slashes with back slashes during the call to</span>
            <span class="c">// GetParentPath and GetChildName. This breaks providers that are sensitive to slash direction, the only</span>
            <span class="c">// one we are aware of being the Active Directory provider. This change prevents this over-normalization</span>
            <span class="c">// from being done on AD paths.</span>
            <span class="c">//</span>
            <span class="c">// For more information, see Win7:695292. Do not change this code without closely working with the</span>
            <span class="c">// Active Directory team.</span>
            <span class="c">//</span>
            <span class="c">// WORKAROUND WORKAROUND WORKAROUND WORKAROUND WORKAROUND WORKAROUND WORKAROUND WORKAROUND WORKAROUND</span>
            <b>if</b> (!<b>string</b>.<span class="i">Equals</span>(<span class="r36 r">context</span>.<a href="CoreCommandContext.cs.html#fc5b658eeb4ac721" class="i property">ProviderInstance</a>.<a href="ProviderBase.cs.html#6129ef83671ead76" class="i property">ProviderInfo</a>.<a href="../engine/DataStoreAdapterProvider.cs.html#91a8d08ee3ba5a61" class="i property">FullName</a>,
                <span class="s">@&quot;Microsoft.ActiveDirectory.Management\ActiveDirectory&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="r39 r">normalizedPath</span> = <a href="#e4ed2b91c70745a0" class="i method">NormalizePath</a>(<span class="r33 r">path</span>);
                <span class="r40 r">normalizedBasePath</span> = <a href="#e4ed2b91c70745a0" class="i method">NormalizePath</a>(<span class="r34 r">basePath</span>);
            }
 
            <b>do</b> <span class="c">// false loop</span>
            {
                <span class="c">// Convert to the correct path separators and trim trailing separators</span>
                <b>string</b> <span id="r41 rd" class="r41 r">originalPath</span> = <span class="r33 r">path</span>;
                <span class="i">Stack</span>&lt;<b>string</b>&gt; <span id="r42 rd" class="r42 r">tokenizedPathStack</span> = <b>null</b>;
 
                <b>if</b> (<span class="r33 r">path</span>.<span class="i">EndsWith</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a>))
                {
                    <span class="r33 r">path</span> = <span class="r33 r">path</span>.<span class="i">TrimEnd</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a>);
                    <span class="r38 r">originalPathHadTrailingSlash</span> = <b>true</b>;
                }
 
                <span class="r34 r">basePath</span> = <span class="r34 r">basePath</span>.<span class="i">TrimEnd</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a>);
 
                <span class="c">// See if the base and the path are already the same. We resolve this to</span>
                <span class="c">// ..\Leaf, since resolving &quot;.&quot; to &quot;.&quot; doesn&#39;t offer much information.</span>
                <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<span class="r39 r">normalizedPath</span>, <span class="r40 r">normalizedBasePath</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) &amp;&amp;
                    (!<span class="r41 r">originalPath</span>.<span class="i">EndsWith</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a>)))
                {
                    <b>string</b> <span id="r43 rd" class="r43 r">childName</span> = <a href="#dbded73c0d368b0d" class="i method">GetChildName</a>(<span class="r33 r">path</span>);
                    <span class="r37 r">result</span> = <a href="#6133115f9f4a066d" class="i method">MakePath</a>(<span class="s">&quot;..&quot;</span>, <span class="r43 r">childName</span>);
                    <b>break</b>;
                }
 
                <span class="c">// If the base path isn&#39;t really a base, then we resolve to a parent</span>
                <span class="c">// path (such as ../../foo)</span>
                <b>if</b> (!<span class="r39 r">normalizedPath</span>.<span class="i">StartsWith</span>(<span class="r40 r">normalizedBasePath</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) &amp;&amp;
                    (<span class="r34 r">basePath</span>.<span class="i">Length</span> &gt; 0))
                {
                    <span class="r37 r">result</span> = <b>string</b>.<span class="i">Empty</span>;
                    <b>string</b> <span id="r44 rd" class="r44 r">commonBase</span> = <a href="#8b6d934321f2d895" class="i method">GetCommonBase</a>(<span class="r39 r">normalizedPath</span>, <span class="r40 r">normalizedBasePath</span>);
 
                    <span class="i">Stack</span>&lt;<b>string</b>&gt; <span id="r45 rd" class="r45 r">parentNavigationStack</span> = <a href="#70f8ea6b910dcc4c" class="i method">TokenizePathToStack</a>(<span class="r40 r">normalizedBasePath</span>, <span class="r44 r">commonBase</span>);
                    <b>int</b> <span id="r46 rd" class="r46 r">parentPopCount</span> = <span class="r45 r">parentNavigationStack</span>.<span class="i">Count</span>;
 
                    <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r44 r">commonBase</span>))
                    {
                        <span class="r46 r">parentPopCount</span>--;
                    }
 
                    <b>for</b> (<b>int</b> <span id="r47 rd" class="r47 r">leafCounter</span> = 0; <span class="r47 r">leafCounter</span> &lt; <span class="r46 r">parentPopCount</span>; <span class="r47 r">leafCounter</span>++)
                    {
                        <span class="r37 r">result</span> = <a href="#6133115f9f4a066d" class="i method">MakePath</a>(<span class="s">&quot;..&quot;</span>, <span class="r37 r">result</span>);
                    }
 
                    <span class="c">// This is true if we get passed a base path like:</span>
                    <span class="c">//    c:\directory1\directory2</span>
                    <span class="c">// and an actual path of</span>
                    <span class="c">//    c:\directory1</span>
                    <span class="c">// Which happens when the user is in c:\directory1\directory2</span>
                    <span class="c">// and wants to resolve something like:</span>
                    <span class="c">// ..\..\dir*</span>
                    <span class="c">// In that case (as above,) we keep the ..\..\directory1</span>
                    <span class="c">// instead of &quot;..&quot; as would usually be returned</span>
                    <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r44 r">commonBase</span>))
                    {
                        <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<span class="r39 r">normalizedPath</span>, <span class="r44 r">commonBase</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) &amp;&amp;
                            (!<span class="r39 r">normalizedPath</span>.<span class="i">EndsWith</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a>)))
                        {
                            <b>string</b> <span id="r48 rd" class="r48 r">childName</span> = <a href="#dbded73c0d368b0d" class="i method">GetChildName</a>(<span class="r33 r">path</span>);
                            <span class="r37 r">result</span> = <a href="#6133115f9f4a066d" class="i method">MakePath</a>(<span class="s">&quot;..&quot;</span>, <span class="r37 r">result</span>);
                            <span class="r37 r">result</span> = <a href="#6133115f9f4a066d" class="i method">MakePath</a>(<span class="r37 r">result</span>, <span class="r48 r">childName</span>);
                        }
                        <b>else</b>
                        {
                            <b>string</b>[] <span id="r49 rd" class="r49 r">childNavigationItems</span> = <a href="#70f8ea6b910dcc4c" class="i method">TokenizePathToStack</a>(<span class="r39 r">normalizedPath</span>, <span class="r44 r">commonBase</span>).<span class="i">ToArray</span>();
 
                            <b>for</b> (<b>int</b> <span id="r50 rd" class="r50 r">leafCounter</span> = 0; <span class="r50 r">leafCounter</span> &lt; <span class="r49 r">childNavigationItems</span>.<span class="i">Length</span>; <span class="r50 r">leafCounter</span>++)
                            {
                                <span class="r37 r">result</span> = <a href="#6133115f9f4a066d" class="i method">MakePath</a>(<span class="r37 r">result</span>, <span class="r49 r">childNavigationItems</span>[<span class="r50 r">leafCounter</span>]);
                            }
                        }
                    }
                }
                <span class="c">// Otherwise, we resolve to a child path (such as foo/bar)</span>
                <b>else</b>
                {
                    <span class="r42 r">tokenizedPathStack</span> = <a href="#70f8ea6b910dcc4c" class="i method">TokenizePathToStack</a>(<span class="r33 r">path</span>, <span class="r34 r">basePath</span>);
 
                    <span class="c">// Now we have to normalize the path</span>
                    <span class="c">// by processing each token on the stack</span>
                    <span class="i">Stack</span>&lt;<b>string</b>&gt; <span id="r51 rd" class="r51 r">normalizedPathStack</span>;
 
                    <b>try</b>
                    {
                        <span class="r51 r">normalizedPathStack</span> = <a href="#e5c14b619518827b" class="i method">NormalizeThePath</a>(<span class="r42 r">tokenizedPathStack</span>, <span class="r33 r">path</span>, <span class="r34 r">basePath</span>, <span class="r35 r">allowNonExistingPaths</span>);
                    }
                    <b>catch</b> (<span class="i">ArgumentException</span> <span id="r52 rd" class="r52 r">argumentException</span>)
                    {
                        <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r52 r">argumentException</span>, <span class="r52 r">argumentException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#846d2b572f2c4820" class="i field">InvalidArgument</a>, <b>null</b>));
                        <span class="r37 r">result</span> = <b>null</b>;
                        <b>break</b>;
                    }
 
                    <span class="c">// Now that the path has been normalized, create the relative path</span>
                    <span class="r37 r">result</span> = <a href="#f358a23bcad8d928" class="i method">CreateNormalizedRelativePathFromStack</a>(<span class="r51 r">normalizedPathStack</span>);
                }
            } <b>while</b> (<b>false</b>);
 
            <b>if</b> (<span class="r38 r">originalPathHadTrailingSlash</span>)
            {
                <span class="r37 r">result</span> += <a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a>;
            }
 
            <b>return</b> <span class="r37 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Get the common base path of two paths.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r53 r">path1</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">One path.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r54 r">path2</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Another path.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private string</b> <a id="8b6d934321f2d895" href="../R/8b6d934321f2d895.html" target="n" data-glyph="76,1" class="i method">GetCommonBase</a>(<b>string</b> <span id="r53 rd" class="r53 r">path1</span>, <b>string</b> <span id="r54 rd" class="r54 r">path2</span>)
        {
            <span class="c">// Always see if the shorter path is a substring of the</span>
            <span class="c">// longer path. If it is not, take the child off of the longer</span>
            <span class="c">// path and compare again.</span>
 
            <b>while</b> (!<b>string</b>.<span class="i">Equals</span>(<span class="r53 r">path1</span>, <span class="r54 r">path2</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <b>if</b> (<span class="r54 r">path2</span>.<span class="i">Length</span> &gt; <span class="r53 r">path1</span>.<span class="i">Length</span>)
                {
                    <span class="r54 r">path2</span> = <a href="#ae5182f675ef4491" class="i method">GetParentPath</a>(<span class="r54 r">path2</span>, <b>null</b>);
                }
                <b>else</b>
                {
                    <span class="r53 r">path1</span> = <a href="#ae5182f675ef4491" class="i method">GetParentPath</a>(<span class="r53 r">path1</span>, <b>null</b>);
                }
            }
 
            <b>return</b> <span class="r53 r">path1</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the name of the leaf element in the specified path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r55 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The fully qualified path to the item</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The leaf element in the path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This should be implemented as a split on the path separator. The characters</span>
        <span class="c">///</span><span class="c"> in the fullPath may not be legal characters in the namespace but may be</span>
        <span class="c">///</span><span class="c"> used in globing or regular expression matching. The provider should not error</span>
        <span class="c">///</span><span class="c"> unless there are no path separators in the fully qualified path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>protected virtual string</b> <a id="dbded73c0d368b0d" href="../R/dbded73c0d368b0d.html" target="n" data-glyph="75,1" class="i method">GetChildName</a>(<b>string</b> <span id="r55 rd" class="r55 r">path</span>)
        {
            <b>using</b> (<a href="../CoreCLR/CorePsStub.cs.html#6d758ac5b09394e4" class="t t">PSTransactionManager</a>.<a href="../CoreCLR/CorePsStub.cs.html#d6d4cf3db02d03bb" class="i method">GetEngineProtectionScope</a>())
            {
                <span class="c">// Verify the parameters</span>
 
                <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r55 r">path</span>))
                {
                    <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fed5f40dc0075d41" class="i method">NewArgumentException</a>(<b>nameof</b>(<span class="r55 r">path</span>));
                }
 
                <span class="c">// Normalize the path</span>
                <span class="r55 r">path</span> = <a href="#e4ed2b91c70745a0" class="i method">NormalizePath</a>(<span class="r55 r">path</span>);
                <span class="c">// Trim trailing back slashes</span>
                <span class="r55 r">path</span> = <span class="r55 r">path</span>.<span class="i">TrimEnd</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a>);
                <b>string</b> <span id="r56 rd" class="r56 r">result</span> = <b>null</b>;
 
                <b>int</b> <span id="r57 rd" class="r57 r">separatorIndex</span> = <span class="r55 r">path</span>.<span class="i">LastIndexOf</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a>);
 
                <span class="c">// Since there was no path separator return the entire path</span>
                <b>if</b> (<span class="r57 r">separatorIndex</span> == -1)
                {
                    <span class="r56 r">result</span> = <span class="r55 r">path</span>;
                }
                <span class="c">// If the full path existed, we must semantically evaluate the parent path</span>
                <b>else</b> <b>if</b> (<a href="ItemProviderBase.cs.html#99dfd768e6f3aa7c" class="i method">ItemExists</a>(<span class="r55 r">path</span>, <a href="ProviderBase.cs.html#70e6bb9df8f94746" class="i property">Context</a>))
                {
                    <b>string</b> <span id="r58 rd" class="r58 r">parentPath</span> = <a href="#ae5182f675ef4491" class="i method">GetParentPath</a>(<span class="r55 r">path</span>, <b>null</b>);
 
                    <span class="c">// No parent, return the entire path</span>
                    <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r58 r">parentPath</span>))
                        <span class="r56 r">result</span> = <span class="r55 r">path</span>;
                    <span class="c">// If the parent path ends with the path separator, we can&#39;t split</span>
                    <span class="c">// the path based on that</span>
                    <b>else</b> <b>if</b> (<span class="r58 r">parentPath</span>.<span class="i">IndexOf</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a>) == (<span class="r58 r">parentPath</span>.<span class="i">Length</span> - 1))
                    {
                        <span class="r57 r">separatorIndex</span> = <span class="r55 r">path</span>.<span class="i">IndexOf</span>(<span class="r58 r">parentPath</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) + <span class="r58 r">parentPath</span>.<span class="i">Length</span>;
                        <span class="r56 r">result</span> = <span class="r55 r">path</span>.<span class="i">Substring</span>(<span class="r57 r">separatorIndex</span>);
                    }
                    <b>else</b>
                    {
                        <span class="r57 r">separatorIndex</span> = <span class="r55 r">path</span>.<span class="i">IndexOf</span>(<span class="r58 r">parentPath</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) + <span class="r58 r">parentPath</span>.<span class="i">Length</span>;
                        <span class="r56 r">result</span> = <span class="r55 r">path</span>.<span class="i">Substring</span>(<span class="r57 r">separatorIndex</span> + 1);
                    }
                }
                <span class="c">// Otherwise, use lexical parsing</span>
                <b>else</b>
                {
                    <span class="r56 r">result</span> = <span class="r55 r">path</span>.<span class="i">Substring</span>(<span class="r57 r">separatorIndex</span> + 1);
                }
 
                <b>return</b> <span class="r56 r">result</span>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Determines if the item specified by the path is a container.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r59 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to the item to determine if it is a container.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> true if the item specified by path is a container, false otherwise.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Providers override this method to give the user the ability to check</span>
        <span class="c">///</span><span class="c"> to see if a provider object is a container using the test-path -container cmdlet.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> Providers that declare </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Provider</span>.<a href="ProviderDeclarationAttribute.cs.html#a29c0c50418632fb" class="t t">ProviderCapabilities</a><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> of ExpandWildcards, Filter, Include, or Exclude should ensure that the path passed meets those</span>
        <span class="c">///</span><span class="c"> requirements by accessing the appropriate property from the base class.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> The default implementation of this method throws an </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../utils/MshNotSupportedException.cs.html#55e79fbd51d0f1cb" class="t t">PSNotSupportedException</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>protected virtual bool</b> <a id="9b9dc6b4f4687790" href="../R/9b9dc6b4f4687790.html" target="n" data-glyph="75,1" class="i method">IsItemContainer</a>(<b>string</b> <span id="r59 rd" class="r59 r">path</span>)
        {
            <b>using</b> (<a href="../CoreCLR/CorePsStub.cs.html#6d758ac5b09394e4" class="t t">PSTransactionManager</a>.<a href="../CoreCLR/CorePsStub.cs.html#d6d4cf3db02d03bb" class="i method">GetEngineProtectionScope</a>())
            {
                <b>throw</b>
                    <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewNotSupportedException</span>(
                        <span class="i">SessionStateStrings</span>.<span class="i">CmdletProvider_NotSupported</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Moves the item specified by path to the specified destination.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r60 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to the item to be moved.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r61 r">destination</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path of the destination container.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Nothing is returned, but all the objects that were moved should be written to the WriteItemObject method.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Providers override this method to give the user the ability to move provider objects using</span>
        <span class="c">///</span><span class="c"> the move-item cmdlet.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> Providers that declare </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Provider</span>.<a href="ProviderDeclarationAttribute.cs.html#a29c0c50418632fb" class="t t">ProviderCapabilities</a><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> of ExpandWildcards, Filter, Include, or Exclude should ensure that the path and items being moved</span>
        <span class="c">///</span><span class="c"> meets those requirements by accessing the appropriate property from the base class.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> By default overrides of this method should not move objects over existing items unless the Force</span>
        <span class="c">///</span><span class="c"> property is set to true. For instance, the FileSystem provider should not move c:\temp\foo.txt over</span>
        <span class="c">///</span><span class="c"> c:\bar.txt if c:\bar.txt already exists unless the Force parameter is true.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r61 r">destination</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> exists and is a container then Force isn&#39;t required and </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r60 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> should be moved into the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r61 r">destination</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> container as a child.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> The default implementation of this method throws an </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../utils/MshNotSupportedException.cs.html#55e79fbd51d0f1cb" class="t t">PSNotSupportedException</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>protected virtual void</b> <a id="8d0b2554e518ab2e" href="../R/8d0b2554e518ab2e.html" target="n" data-glyph="75,1" class="i method">MoveItem</a>(
            <b>string</b> <span id="r60 rd" class="r60 r">path</span>,
            <b>string</b> <span id="r61 rd" class="r61 r">destination</span>)
        {
            <b>using</b> (<a href="../CoreCLR/CorePsStub.cs.html#6d758ac5b09394e4" class="t t">PSTransactionManager</a>.<a href="../CoreCLR/CorePsStub.cs.html#d6d4cf3db02d03bb" class="i method">GetEngineProtectionScope</a>())
            {
                <b>throw</b>
                    <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewNotSupportedException</span>(
                        <span class="i">SessionStateStrings</span>.<span class="i">CmdletProvider_NotSupported</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gives the provider an opportunity to attach additional parameters to</span>
        <span class="c">///</span><span class="c"> the move-item cmdlet.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r62 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the path was specified on the command line, this is the path</span>
        <span class="c">///</span><span class="c"> to the item to get the dynamic parameters for.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r63 r">destination</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path of the destination container.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Overrides of this method should return an object that has properties and fields decorated with</span>
        <span class="c">///</span><span class="c"> parsing attributes similar to a cmdlet class or a</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../engine/PseudoParameters.cs.html#d55a14219c7e096c" class="t t">RuntimeDefinedParameterDictionary</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> The default implementation returns null. (no additional parameters)</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>protected virtual object</b> <a id="082758e0d3f39658" href="../R/082758e0d3f39658.html" target="n" data-glyph="75,1" class="i method">MoveItemDynamicParameters</a>(
            <b>string</b> <span id="r62 rd" class="r62 r">path</span>,
            <b>string</b> <span id="r63 rd" class="r63 r">destination</span>)
        {
            <b>using</b> (<a href="../CoreCLR/CorePsStub.cs.html#6d758ac5b09394e4" class="t t">PSTransactionManager</a>.<a href="../CoreCLR/CorePsStub.cs.html#d6d4cf3db02d03bb" class="i method">GetEngineProtectionScope</a>())
            {
                <b>return</b> <b>null</b>;
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Protected methods
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> private members
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> When a path contains both forward slash and backslash, we may introduce some errors by</span>
        <span class="c">///</span><span class="c"> normalizing the path. This method does some smart checks to reduce the chances of making</span>
        <span class="c">///</span><span class="c"> those errors.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r64 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to normalize.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Normalized path or the original path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private string</b> <a id="e4ed2b91c70745a0" href="../R/e4ed2b91c70745a0.html" target="n" data-glyph="76,1" class="i method">NormalizePath</a>(<b>string</b> <span id="r64 rd" class="r64 r">path</span>)
        {
            <span class="c">// If we have a mix of slashes, then we may introduce an error by normalizing the path.</span>
            <span class="c">// For example: path HKCU:\Test\/ is pointing to a subkey &#39;/&#39; of &#39;HKCU:\Test&#39;, if we</span>
            <span class="c">// normalize it, then we will get a wrong path.</span>
            <span class="c">//</span>
            <span class="c">// Fast return if nothing to normalize.</span>
            <b>if</b> (!<span class="r64 r">path</span>.<span class="i">Contains</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#f2548f0f61690656" class="i field">AlternatePathSeparator</a>))
            {
                <b>return</b> <span class="r64 r">path</span>;
            }
 
            <b>bool</b> <span id="r65 rd" class="r65 r">pathHasBackSlash</span> = <span class="r64 r">path</span>.<span class="i">Contains</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a>);
            <b>string</b> <span id="r66 rd" class="r66 r">normalizedPath</span>;
 
            <span class="c">// There is a mix of slashes &amp; the path is rooted &amp; the path exists without normalization.</span>
            <span class="c">// In this case, we might want to skip the normalization to the path.</span>
            <b>if</b> (<span class="r65 r">pathHasBackSlash</span> &amp;&amp; <a href="#e2d400e3d97396dc" class="i method">IsAbsolutePath</a>(<span class="r64 r">path</span>) &amp;&amp; <a href="ItemProviderBase.cs.html#c7d82b43d88d3461" class="i method">ItemExists</a>(<span class="r64 r">path</span>))
            {
                <span class="c">// 1. The path exists and ends with a forward slash, in this case, it&#39;s very possible the ending forward slash</span>
                <span class="c">//    make sense to the underlying provider, so we skip normalization</span>
                <span class="c">// 2. The path exists, but not anymore after normalization, then we skip normalization</span>
                <b>if</b> (<span class="r64 r">path</span>.<span class="i">EndsWith</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#f2548f0f61690656" class="i field">AlternatePathSeparator</a>))
                {
                    <b>return</b> <span class="r64 r">path</span>;
                }
 
                <span class="r66 r">normalizedPath</span> = <span class="r64 r">path</span>.<span class="i">Replace</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#f2548f0f61690656" class="i field">AlternatePathSeparator</a>, <a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a>);
 
                <b>if</b> (!<a href="ItemProviderBase.cs.html#c7d82b43d88d3461" class="i method">ItemExists</a>(<span class="r66 r">normalizedPath</span>))
                {
                    <b>return</b> <span class="r64 r">path</span>;
                }
                <b>else</b>
                {
                    <b>return</b> <span class="r66 r">normalizedPath</span>;
                }
            }
 
            <span class="r66 r">normalizedPath</span> = <span class="r64 r">path</span>.<span class="i">Replace</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#f2548f0f61690656" class="i field">AlternatePathSeparator</a>, <a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a>);
 
            <b>return</b> <span class="r66 r">normalizedPath</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Test if the path is an absolute path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r67 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="e2d400e3d97396dc" href="../R/e2d400e3d97396dc.html" target="n" data-glyph="76,1" class="i method">IsAbsolutePath</a>(<b>string</b> <span id="r67 rd" class="r67 r">path</span>)
        {
            <b>bool</b> <span id="r68 rd" class="r68 r">result</span> = <b>false</b>;
 
            <b>if</b> (<a href="LocationGlobber.cs.html#6387d90abe0ca584" class="t t">LocationGlobber</a>.<a href="LocationGlobber.cs.html#4cd70f3f191704a0" class="i method">IsAbsolutePath</a>(<span class="r67 r">path</span>))
            {
                <span class="r68 r">result</span> = <b>true</b>;
            }
            <b>else</b> <b>if</b> (<a href="#7d31476313596b0b" class="k">this</a>.<a href="ProviderBase.cs.html#bf1d5d8dfd4808db" class="i property">PSDriveInfo</a> != <b>null</b> &amp;&amp; !<b>string</b>.<span class="i">IsNullOrEmpty</span>(<a href="#7d31476313596b0b" class="k">this</a>.<a href="ProviderBase.cs.html#bf1d5d8dfd4808db" class="i property">PSDriveInfo</a>.<a href="../engine/DataStoreAdapter.cs.html#6c8f4db73167e8f9" class="i property">Root</a>) &amp;&amp;
                     <span class="r67 r">path</span>.<span class="i">StartsWith</span>(<a href="#7d31476313596b0b" class="k">this</a>.<a href="ProviderBase.cs.html#bf1d5d8dfd4808db" class="i property">PSDriveInfo</a>.<a href="../engine/DataStoreAdapter.cs.html#6c8f4db73167e8f9" class="i property">Root</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="r68 r">result</span> = <b>true</b>;
            }
 
            <b>return</b> <span class="r68 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Tokenizes the specified path onto a stack.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r69 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to tokenize.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r70 r">basePath</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The base part of the path that should not be tokenized.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A stack containing the tokenized path with leaf elements on the bottom</span>
        <span class="c">///</span><span class="c"> of the stack and the most ancestral parent at the top.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private</b> <span class="i">Stack</span>&lt;<b>string</b>&gt; <a id="70f8ea6b910dcc4c" href="../R/70f8ea6b910dcc4c.html" target="n" data-glyph="76,1" class="i method">TokenizePathToStack</a>(<b>string</b> <span id="r69 rd" class="r69 r">path</span>, <b>string</b> <span id="r70 rd" class="r70 r">basePath</span>)
        {
            <span class="i">Stack</span>&lt;<b>string</b>&gt; <span id="r71 rd" class="r71 r">tokenizedPathStack</span> = <b>new</b> <span class="i">Stack</span>&lt;<b>string</b>&gt;();
            <b>string</b> <span id="r72 rd" class="r72 r">tempPath</span> = <span class="r69 r">path</span>;
            <b>string</b> <span id="r73 rd" class="r73 r">previousParent</span> = <span class="r69 r">path</span>;
 
            <b>while</b> (<span class="r72 r">tempPath</span>.<span class="i">Length</span> &gt; <span class="r70 r">basePath</span>.<span class="i">Length</span>)
            {
                <span class="c">// Get the child name and push it onto the stack</span>
                <span class="c">// if its valid</span>
 
                <b>string</b> <span id="r74 rd" class="r74 r">childName</span> = <a href="#dbded73c0d368b0d" class="i method">GetChildName</a>(<span class="r72 r">tempPath</span>);
                <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r74 r">childName</span>))
                {
                    <span class="c">// Push the parent on and then stop</span>
                    <span class="r71 r">tokenizedPathStack</span>.<span class="i">Push</span>(<span class="r72 r">tempPath</span>);
                    <b>break</b>;
                }
 
                <a href="ProviderBase.cs.html#212052e68534d09f" class="i field">providerBaseTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;tokenizedPathStack.Push({0})&quot;</span>, <span class="r74 r">childName</span>);
                <span class="r71 r">tokenizedPathStack</span>.<span class="i">Push</span>(<span class="r74 r">childName</span>);
 
                <span class="c">// Get the parent path and verify if we have to continue</span>
                <span class="c">// tokenizing</span>
 
                <span class="r72 r">tempPath</span> = <a href="#ae5182f675ef4491" class="i method">GetParentPath</a>(<span class="r72 r">tempPath</span>, <span class="r70 r">basePath</span>);
                <b>if</b> (<span class="r72 r">tempPath</span>.<span class="i">Length</span> &gt;= <span class="r73 r">previousParent</span>.<span class="i">Length</span>)
                {
                    <b>break</b>;
                }
 
                <span class="r73 r">previousParent</span> = <span class="r72 r">tempPath</span>;
            }
 
            <b>return</b> <span class="r71 r">tokenizedPathStack</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Given the tokenized path, the relative path elements are removed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r75 r">tokenizedPathStack</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A stack containing path elements where the leaf most element is at</span>
        <span class="c">///</span><span class="c"> the bottom of the stack and the most ancestral parent is on the top.</span>
        <span class="c">///</span><span class="c"> Generally this stack comes from TokenizePathToStack().</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r76 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path being normalized. Just used for error reporting.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r77 r">basePath</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The base path to make the path relative to. Just used for error reporting.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r78 r">allowNonExistingPaths</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Determines whether to throw an exception on non-existing paths.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A stack in reverse order with the path elements normalized and all relative</span>
        <span class="c">///</span><span class="c"> path tokens removed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static</b> <span class="i">Stack</span>&lt;<b>string</b>&gt; <a id="e5c14b619518827b" href="../R/e5c14b619518827b.html" target="n" data-glyph="76,1" class="i method">NormalizeThePath</a>(
            <span class="i">Stack</span>&lt;<b>string</b>&gt; <span id="r75 rd" class="r75 r">tokenizedPathStack</span>, <b>string</b> <span id="r76 rd" class="r76 r">path</span>,
            <b>string</b> <span id="r77 rd" class="r77 r">basePath</span>, <b>bool</b> <span id="r78 rd" class="r78 r">allowNonExistingPaths</span>)
        {
            <span class="i">Stack</span>&lt;<b>string</b>&gt; <span id="r79 rd" class="r79 r">normalizedPathStack</span> = <b>new</b> <span class="i">Stack</span>&lt;<b>string</b>&gt;();
 
            <b>while</b> (<span class="r75 r">tokenizedPathStack</span>.<span class="i">Count</span> &gt; 0)
            {
                <b>string</b> <span id="r80 rd" class="r80 r">childName</span> = <span class="r75 r">tokenizedPathStack</span>.<span class="i">Pop</span>();
 
                <a href="ProviderBase.cs.html#212052e68534d09f" class="i field">providerBaseTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;childName = {0}&quot;</span>, <span class="r80 r">childName</span>);
 
                <span class="c">// Ignore the current directory token</span>
                <b>if</b> (<span class="r80 r">childName</span>.<span class="i">Equals</span>(<span class="s">&quot;.&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <span class="c">// Just ignore it and move on.</span>
                    <b>continue</b>;
                }
 
                <span class="c">// Make sure we don&#39;t have</span>
                <b>if</b> (<span class="r80 r">childName</span>.<span class="i">Equals</span>(<span class="s">&quot;..&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <b>if</b> (<span class="r79 r">normalizedPathStack</span>.<span class="i">Count</span> &gt; 0)
                    {
                        <span class="c">// Pop the result and continue processing</span>
                        <b>string</b> <span id="r81 rd" class="r81 r">poppedName</span> = <span class="r79 r">normalizedPathStack</span>.<span class="i">Pop</span>();
                        <a href="ProviderBase.cs.html#212052e68534d09f" class="i field">providerBaseTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;normalizedPathStack.Pop() : {0}&quot;</span>, <span class="r81 r">poppedName</span>);
                        <b>continue</b>;
                    }
                    <b>else</b>
                    {
                        <b>if</b> (!<span class="r78 r">allowNonExistingPaths</span>)
                        {
                            <a href="../utils/MshArgumentException.cs.html#581bd9b947689819" class="t t">PSArgumentException</a> <span id="r82 rd" class="r82 r">e</span> =
                                (<a href="../utils/MshArgumentException.cs.html#581bd9b947689819" class="t t">PSArgumentException</a>)<a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentException</span>(
                                    <b>nameof</b>(<span class="r76 r">path</span>),
                                    <span class="i">SessionStateStrings</span>.<span class="i">NormalizeRelativePathOutsideBase</span>,
                                    <span class="r76 r">path</span>,
                                    <span class="r77 r">basePath</span>);
                            <b>throw</b> <span class="r82 r">e</span>;
                        }
                    }
                }
 
                <a href="ProviderBase.cs.html#212052e68534d09f" class="i field">providerBaseTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;normalizedPathStack.Push({0})&quot;</span>, <span class="r80 r">childName</span>);
                <span class="r79 r">normalizedPathStack</span>.<span class="i">Push</span>(<span class="r80 r">childName</span>);
            }
 
            <b>return</b> <span class="r79 r">normalizedPathStack</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Pops each leaf element of the stack and uses MakePath to generate the relative path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r83 r">normalizedPathStack</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The stack containing the leaf elements of the path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A path that is made up of the leaf elements on the given stack.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The elements on the stack start from the leaf element followed by its parent</span>
        <span class="c">///</span><span class="c"> followed by its parent, etc. Each following element on the stack is the parent</span>
        <span class="c">///</span><span class="c"> of the one before it.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>private string</b> <a id="f358a23bcad8d928" href="../R/f358a23bcad8d928.html" target="n" data-glyph="76,1" class="i method">CreateNormalizedRelativePathFromStack</a>(<span class="i">Stack</span>&lt;<b>string</b>&gt; <span id="r83 rd" class="r83 r">normalizedPathStack</span>)
        {
            <b>string</b> <span id="r84 rd" class="r84 r">leafElement</span> = <b>string</b>.<span class="i">Empty</span>;
 
            <b>while</b> (<span class="r83 r">normalizedPathStack</span>.<span class="i">Count</span> &gt; 0)
            {
                <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r84 r">leafElement</span>))
                {
                    <span class="r84 r">leafElement</span> = <span class="r83 r">normalizedPathStack</span>.<span class="i">Pop</span>();
                }
                <b>else</b>
                {
                    <b>string</b> <span id="r85 rd" class="r85 r">parentElement</span> = <span class="r83 r">normalizedPathStack</span>.<span class="i">Pop</span>();
                    <span class="r84 r">leafElement</span> = <a href="#6133115f9f4a066d" class="i method">MakePath</a>(<span class="r85 r">parentElement</span>, <span class="r84 r">leafElement</span>);
                }
            }
 
            <b>return</b> <span class="r84 r">leafElement</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> private members
    }
 
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span> NavigationCmdletProvider
}
</pre></td></tr></table></div></body></html>
