<!DOCTYPE html>
<html><head><title>RegistryProvider.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(4170);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#System.Management.Automation/namespaces/RegistryProvider.cs" target="_top">namespaces\RegistryProvider.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#System.Management.Automation" target="_top">src\System.Management.Automation\System.Management.Automation.csproj</a> (System.Management.Automation)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">UNIX</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">ObjectModel</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Globalization</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Text</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i">Win32</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Internal</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Provider</span>;
<b>using</b> <span class="i">Dbg</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Commands</span>.<span class="i n">Internal</span>;
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Commands</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Provider that provides access to Registry through cmdlets. This provider</span>
    <span class="c">///</span><span class="c"> implements </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Provider</span>.<a href="NavigationProviderBase.cs.html#7d31476313596b0b" class="t t">NavigationCmdletProvider</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">,</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Provider</span>.<a href="IPropertiesProvider.cs.html#c7893da413e1ec16" class="t t">IPropertyCmdletProvider</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">,</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Provider</span>.<a href="IDynamicPropertyProvider.cs.html#f158754e6d9c0f36" class="t t">IDynamicPropertyCmdletProvider</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">,</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Provider</span>.<a href="IPermissionProvider.cs.html#355bd4bb5306aef0" class="t t">ISecurityDescriptorCmdletProvider</a><span class="c">&quot;</span><span class="c">/&gt;</span>
    <span class="c">///</span><span class="c"> interfaces.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;!--</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c"> INSTALLATION:</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c"> Type the following at an msh prompt:</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c"> new-PSProvider -Path &quot;REG.cmdletprovider&quot; -description &quot;My registry navigation provider&quot;</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c"> TO EXERCISE THE PROVIDER:</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c"> Get-PSDrive</span>
    <span class="c">///</span><span class="c"> set-location HKLM:\software</span>
    <span class="c">///</span><span class="c"> get-childitem</span>
    <span class="c">///</span><span class="c"> New-PSDrive -PSProvider REG -name HKCR -root HKEY_CLASSES_ROOT\CLSID</span>
    <span class="c">///</span><span class="c"> set-location HKCR:</span>
    <span class="c">///</span><span class="c"> get-childitem &quot;{0000*&quot;</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c"> The CmdletProvider attribute defines the name and capabilities of the provider.</span>
    <span class="c">///</span><span class="c"> The first parameter is the default friendly name for the provider. The second parameter</span>
    <span class="c">///</span><span class="c"> is the provider name which, along with some assembly information like version, company, etc.</span>
    <span class="c">///</span><span class="c"> is used as a fully-qualified provider name which can be used for disambiguation.</span>
    <span class="c">///</span><span class="c"> The third parameter states the capabilities of the provider.</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c"> </span><span class="c">--&gt;</span>
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">CORECLR</span> <span class="c">// System.Transaction namespace is not in CoreClr.</span>
    [<span class="i">CmdletProvider</span>(<a href="../P/92d0bdbab09c8afa.html#92d0bdbab09c8afa" class="t t">RegistryProvider</a>.<a href="#980666972f1a5ee8" class="i field">ProviderName</a>, <a href="ProviderDeclarationAttribute.cs.html#a29c0c50418632fb" class="t t">ProviderCapabilities</a>.<a href="ProviderDeclarationAttribute.cs.html#1c74e44e7cb58abe" class="i field">ShouldProcess</a>)]
<span class="k preprocess">#</span><span class="k preprocess">else</span>
<span class="e">    [CmdletProvider(RegistryProvider.ProviderName, ProviderCapabilities.ShouldProcess | ProviderCapabilities.Transactions)]
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
    [<span class="i">OutputType</span>(<b>typeof</b>(<b>string</b>), <a href="../engine/Attributes.cs.html#d8d80d601118095c" class="i property">ProviderCmdlet</a> = <a href="../utils/CoreProviderCmdlets.cs.html#148012d7a65af04c" class="t t">ProviderCmdlet</a>.<a href="../utils/CoreProviderCmdlets.cs.html#e11cca7f014c63a5" class="i field">MoveItemProperty</a>)]
    [<span class="i">OutputType</span>(<b>typeof</b>(<span class="i">RegistryKey</span>), <b>typeof</b>(<b>string</b>), <a href="../engine/Attributes.cs.html#d8d80d601118095c" class="i property">ProviderCmdlet</a> = <a href="../utils/CoreProviderCmdlets.cs.html#148012d7a65af04c" class="t t">ProviderCmdlet</a>.<a href="../utils/CoreProviderCmdlets.cs.html#077ace411238b46a" class="i field">GetChildItem</a>)]
    [<span class="i">OutputType</span>(<b>typeof</b>(<span class="i">RegistryKey</span>), <a href="../engine/Attributes.cs.html#d8d80d601118095c" class="i property">ProviderCmdlet</a> = <a href="../utils/CoreProviderCmdlets.cs.html#148012d7a65af04c" class="t t">ProviderCmdlet</a>.<a href="../utils/CoreProviderCmdlets.cs.html#d5a1345545ad36b3" class="i field">GetItem</a>)]
    [<span class="i">OutputType</span>(<b>typeof</b>(<span class="i n">System</span>.<span class="i">Security</span>.<span class="i">AccessControl</span>.<span class="i">RegistrySecurity</span>), <a href="../engine/Attributes.cs.html#d8d80d601118095c" class="i property">ProviderCmdlet</a> = <a href="../utils/CoreProviderCmdlets.cs.html#148012d7a65af04c" class="t t">ProviderCmdlet</a>.<a href="../utils/CoreProviderCmdlets.cs.html#455f2e7a3536bee8" class="i field">GetAcl</a>)]
    [<span class="i">OutputType</span>(<b>typeof</b>(<span class="i n">Microsoft</span>.<span class="i">Win32</span>.<span class="i">RegistryKey</span>), <a href="../engine/Attributes.cs.html#d8d80d601118095c" class="i property">ProviderCmdlet</a> = <a href="../utils/CoreProviderCmdlets.cs.html#148012d7a65af04c" class="t t">ProviderCmdlet</a>.<a href="../utils/CoreProviderCmdlets.cs.html#077ace411238b46a" class="i field">GetChildItem</a>)]
    [<span class="i">OutputType</span>(<b>typeof</b>(<span class="i">RegistryKey</span>), <a href="../engine/Attributes.cs.html#d8d80d601118095c" class="i property">ProviderCmdlet</a> = <a href="../utils/CoreProviderCmdlets.cs.html#148012d7a65af04c" class="t t">ProviderCmdlet</a>.<a href="../utils/CoreProviderCmdlets.cs.html#d5a1345545ad36b3" class="i field">GetItem</a>)]
    [<span class="i">OutputType</span>(<b>typeof</b>(<span class="i">RegistryKey</span>), <b>typeof</b>(<b>string</b>), <b>typeof</b>(<span class="i">Int32</span>), <b>typeof</b>(<span class="i">Int64</span>), <a href="../engine/Attributes.cs.html#d8d80d601118095c" class="i property">ProviderCmdlet</a> = <a href="../utils/CoreProviderCmdlets.cs.html#148012d7a65af04c" class="t t">ProviderCmdlet</a>.<a href="../utils/CoreProviderCmdlets.cs.html#90caa5e4e47f72e3" class="i field">GetItemProperty</a>)]
    [<span class="i">OutputType</span>(<b>typeof</b>(<span class="i">RegistryKey</span>), <a href="../engine/Attributes.cs.html#d8d80d601118095c" class="i property">ProviderCmdlet</a> = <a href="../utils/CoreProviderCmdlets.cs.html#148012d7a65af04c" class="t t">ProviderCmdlet</a>.<a href="../utils/CoreProviderCmdlets.cs.html#2b8534a269ab6547" class="i field">NewItem</a>)]
    <b>public sealed</b> <a href="../P/92d0bdbab09c8afa.html" target="s" class="k">partial</a> <b>class</b> <a id="92d0bdbab09c8afa" href="../R/92d0bdbab09c8afa.html" target="n" data-glyph="0,0" class="t t"><span id="b4a2b279f4f33bce">RegistryProvider</span></a> :
        <a href="NavigationProviderBase.cs.html#7d31476313596b0b" class="t t">NavigationCmdletProvider</a>,
        <a href="IPropertiesProvider.cs.html#c7893da413e1ec16" class="t t">IPropertyCmdletProvider</a>,
        <a href="IDynamicPropertyProvider.cs.html#f158754e6d9c0f36" class="t t">IDynamicPropertyCmdletProvider</a>,
        <a href="IPermissionProvider.cs.html#355bd4bb5306aef0" class="t t">ISecurityDescriptorCmdletProvider</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> tracer
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An instance of the PSTraceSource class used for trace output</span>
        <span class="c">///</span><span class="c"> using &quot;ProviderProvider&quot; as the category.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i n">Dbg</span>.<span class="i">TraceSourceAttribute</span>(
            <span class="s">&quot;RegistryProvider&quot;</span>,
            <span class="s">&quot;The namespace navigation provider for the Windows Registry&quot;</span>)]
        <b>private static readonly</b> <span class="i n">Dbg</span>.<a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a> <a id="c78d8c98bad069ff" href="../R/c78d8c98bad069ff.html" target="n" data-glyph="46,1" class="i field">s_tracer</a> =
            <span class="i n">Dbg</span>.<a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#697b06ec70e3c537" class="i method">GetTracer</a>(<span class="s">&quot;RegistryProvider&quot;</span>,
            <span class="s">&quot;The namespace navigation provider for the Windows Registry&quot;</span>);
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> tracer
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the name of the provider.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public const string</b> <a id="980666972f1a5ee8" href="../R/980666972f1a5ee8.html" target="n" data-glyph="6,1" class="i field">ProviderName</a> = <span class="s">&quot;Registry&quot;</span>;
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> CmdletProvider overrides
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the alternate item separator character for this provider.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public override char</b> <a id="a2458c79d9a375f1" href="../R/a2458c79d9a375f1.html" target="n" data-glyph="102,1" class="i property">AltItemSeparator</a> =&gt; <a href="ProviderBase.cs.html#6ac88c2001286ea1" class="i property">ItemSeparator</a>;
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> DriveCmdletProvider overrides
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Verifies that the new drive has a valid root.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A PSDriveInfo object.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;!--</span>
        <span class="c">///</span><span class="c"> It also givesthe provider an opportunity to return a</span>
        <span class="c">///</span><span class="c"> derived class of PSDriveInfo which can contain provider specific</span>
        <span class="c">///</span><span class="c"> information about the drive.This may be done for performance</span>
        <span class="c">///</span><span class="c"> or reliability reasons or toprovide extra data to all calls</span>
        <span class="c">///</span><span class="c"> using the drive</span>
        <span class="c">///</span><span class="c"> </span><span class="c">--&gt;</span>
        <b>protected override</b> <a href="../engine/DataStoreAdapter.cs.html#2d16b26a541ba185" class="t t">PSDriveInfo</a> <a id="b69fda80e1541893" href="../R/b69fda80e1541893.html" target="n" data-glyph="75,1" class="i method">NewDrive</a>(<a href="../engine/DataStoreAdapter.cs.html#2d16b26a541ba185" class="t t">PSDriveInfo</a> <span id="r0 rd" class="r0 r">drive</span>)
        {
            <b>if</b> (<span class="r0 r">drive</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r0 r">drive</span>));
            }
 
            <b>if</b> (!<a href="#edf415002ed92ac3" class="i method">ItemExists</a>(<span class="r0 r">drive</span>.<a href="../engine/DataStoreAdapter.cs.html#6c8f4db73167e8f9" class="i property">Root</a>))
            {
                <span class="i">Exception</span> <span id="r1 rd" class="r1 r">e</span> = <b>new</b> <span class="i">ArgumentException</span>(<span class="i">RegistryProviderStrings</span>.<span class="i">NewDriveRootDoesNotExist</span>);
                <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(
                    <span class="r1 r">e</span>,
                    <span class="r1 r">e</span>.<span class="i">GetType</span>().<span class="i">FullName</span>,
                    <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#846d2b572f2c4820" class="i field">InvalidArgument</a>,
                    <span class="r0 r">drive</span>.<a href="../engine/DataStoreAdapter.cs.html#6c8f4db73167e8f9" class="i property">Root</a>));
            }
 
            <b>return</b> <span class="r0 r">drive</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates HKEY_LOCAL_MACHINE and HKEY_CURRENT_USER registry drives during provider initialization.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> After the Start method is called on a provider, the InitializeDefaultDrives</span>
        <span class="c">///</span><span class="c"> method is called. This is an opportunity for the provider to</span>
        <span class="c">///</span><span class="c"> mount drives that are important to it. For instance, the Active Directory</span>
        <span class="c">///</span><span class="c"> provider might mount a drive for the defaultNamingContext if the</span>
        <span class="c">///</span><span class="c"> machine is joined to a domain.  The FileSystem mounts all drives then available.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>protected override</b> <span class="i">Collection</span>&lt;<a href="../engine/DataStoreAdapter.cs.html#2d16b26a541ba185" class="t t">PSDriveInfo</a>&gt; <a id="45215aa3a225dcde" href="../R/45215aa3a225dcde.html" target="n" data-glyph="75,1" class="i method">InitializeDefaultDrives</a>()
        {
            <span class="i">Collection</span>&lt;<a href="../engine/DataStoreAdapter.cs.html#2d16b26a541ba185" class="t t">PSDriveInfo</a>&gt; <span id="r2 rd" class="r2 r">drives</span> = <b>new</b> <span class="i">Collection</span>&lt;<a href="../engine/DataStoreAdapter.cs.html#2d16b26a541ba185" class="t t">PSDriveInfo</a>&gt;();
 
            <span class="r2 r">drives</span>.<span class="i">Add</span>(
                <b>new</b> <span class="t">PSDriveInfo</span>(
                    <span class="s">&quot;HKLM&quot;</span>,
                    <a href="ProviderBase.cs.html#6129ef83671ead76" class="i property">ProviderInfo</a>,
                    <span class="s">&quot;HKEY_LOCAL_MACHINE&quot;</span>,
                    <span class="i">RegistryProviderStrings</span>.<span class="i">HKLMDriveDescription</span>,
                    <b>null</b>));
 
            <span class="r2 r">drives</span>.<span class="i">Add</span>(
                <b>new</b> <span class="t">PSDriveInfo</span>(
                    <span class="s">&quot;HKCU&quot;</span>,
                    <a href="ProviderBase.cs.html#6129ef83671ead76" class="i property">ProviderInfo</a>,
                    <span class="s">&quot;HKEY_CURRENT_USER&quot;</span>,
                    <span class="i">RegistryProviderStrings</span>.<span class="i">HKCUDriveDescription</span>,
                    <b>null</b>));
 
            <b>return</b> <span class="r2 r">drives</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> DriveCmdletProvider overrides
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> ItemCmdletProvider overrides
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Determines if the specified </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r3 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is syntactically and semantically valid.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r3 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to validate.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> True if the path is valid, or False otherwise.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>protected override bool</b> <a id="5a1c67e0be7b5e4f" href="../R/5a1c67e0be7b5e4f.html" target="n" data-glyph="75,1" class="i method">IsValidPath</a>(<b>string</b> <span id="r3 rd" class="r3 r">path</span>)
        {
            <b>bool</b> <span id="r4 rd" class="r4 r">result</span> = <b>true</b>;
 
            <b>do</b> <span class="c">// false loop</span>
            {
                <span class="c">// There really aren&#39;t any illegal characters or syntactical patterns</span>
                <span class="c">// to validate, so just ensure that the path starts with one of the hive roots.</span>
 
                <b>string</b> <span id="r5 rd" class="r5 r">root</span> = <a href="#0971305882b81414" class="i method">NormalizePath</a>(<span class="r3 r">path</span>);
                <span class="r5 r">root</span> = <span class="r5 r">root</span>.<span class="i">TrimStart</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a>);
                <span class="r5 r">root</span> = <span class="r5 r">root</span>.<span class="i">TrimEnd</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a>);
 
                <b>int</b> <span id="r6 rd" class="r6 r">pathSeparator</span> = <span class="r5 r">root</span>.<span class="i">IndexOf</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a>);
 
                <b>if</b> (<span class="r6 r">pathSeparator</span> != -1)
                {
                    <span class="r5 r">root</span> = <span class="r5 r">root</span>.<span class="i">Substring</span>(0, <span class="r6 r">pathSeparator</span>);
                }
 
                <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r5 r">root</span>))
                {
                    <span class="c">// An empty path means that we are at the root and should</span>
                    <span class="c">// enumerate the hives. So that is a valid path.</span>
                    <span class="r4 r">result</span> = <b>true</b>;
                    <b>break</b>;
                }
 
                <b>if</b> (<a href="#94f0806b961a628c" class="i method">GetHiveRoot</a>(<span class="r5 r">root</span>) == <b>null</b>)
                {
                    <span class="r4 r">result</span> = <b>false</b>;
                }
            } <b>while</b> (<b>false</b>);
 
            <b>return</b> <span class="r4 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the RegistryKey item at the specified </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r7 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> and writes it to the pipeline using the WriteObject method.</span>
        <span class="c">///</span><span class="c"> Any non-terminating exceptions are written to the WriteError method.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r7 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to the key to retrieve.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="b7e98c32c507b8e3" href="../R/b7e98c32c507b8e3.html" target="n" data-glyph="75,1" class="i method">GetItem</a>(<b>string</b> <span id="r7 rd" class="r7 r">path</span>)
        {
            <span class="c">// Get the registry item</span>
 
            <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r8 rd" class="r8 r">result</span> = <a href="#65df19fb203b78a1" class="i method">GetRegkeyForPathWriteIfError</a>(<span class="r7 r">path</span>, <b>false</b>);
 
            <b>if</b> (<span class="r8 r">result</span> == <b>null</b>)
            {
                <b>return</b>;
            }
 
            <span class="c">// Write out the result</span>
 
            <a href="#b1dbe0e69487f77f" class="i method">WriteRegistryItemObject</a>(<span class="r8 r">result</span>, <span class="r7 r">path</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Sets registry values at </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r9 r">path</span> <span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r10 r">value</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> specified.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r9 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to the item that is to be set. Only registry values can be set using</span>
        <span class="c">///</span><span class="c"> this method.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r10 r">value</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The new value for the registry value.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="9d2ae8298ee5df40" href="../R/9d2ae8298ee5df40.html" target="n" data-glyph="75,1" class="i method">SetItem</a>(<b>string</b> <span id="r9 rd" class="r9 r">path</span>, <b>object</b> <span id="r10 rd" class="r10 r">value</span>)
        {
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r9 r">path</span>))
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fed5f40dc0075d41" class="i method">NewArgumentException</a>(<b>nameof</b>(<span class="r9 r">path</span>));
            }
 
            <span class="c">// Confirm the set item with the user</span>
 
            <b>string</b> <span id="r11 rd" class="r11 r">action</span> = <span class="i">RegistryProviderStrings</span>.<span class="i">SetItemAction</span>;
 
            <b>string</b> <span id="r12 rd" class="r12 r">resourceTemplate</span> = <span class="i">RegistryProviderStrings</span>.<span class="i">SetItemResourceTemplate</span>;
 
            <b>string</b> <span id="r13 rd" class="r13 r">resource</span> =
                <b>string</b>.<span class="i">Format</span>(
                    <a href="ProviderBase.cs.html#be8557754a3bdef0" class="i property">Host</a>.<a href="../engine/hostifaces/MshHost.cs.html#d531244924cf2614" class="i property">CurrentCulture</a>,
                    <span class="r12 r">resourceTemplate</span>,
                    <span class="r9 r">path</span>,
                    <span class="r10 r">value</span>);
 
            <b>if</b> (<a href="ProviderBase.cs.html#4cb6a9cf0567d153" class="i method">ShouldProcess</a>(<span class="r13 r">resource</span>, <span class="r11 r">action</span>))
            {
                <span class="c">// Get the registry item</span>
 
                <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r14 rd" class="r14 r">key</span> = <a href="#65df19fb203b78a1" class="i method">GetRegkeyForPathWriteIfError</a>(<span class="r9 r">path</span>, <b>true</b>);
 
                <b>if</b> (<span class="r14 r">key</span> == <b>null</b>)
                {
                    <b>return</b>;
                }
 
                <span class="c">// Check to see if the type was specified by the user</span>
 
                <b>bool</b> <span id="r15 rd" class="r15 r">valueSet</span> = <b>false</b>;
                <b>if</b> (<a href="ProviderBase.cs.html#57d60aa2d2bc908d" class="i property">DynamicParameters</a> != <b>null</b>)
                {
                    <a href="#4fe5568fafb46b4c" class="t t">RegistryProviderSetItemDynamicParameter</a> <span id="r16 rd" class="r16 r">dynParams</span> =
                        <a href="ProviderBase.cs.html#57d60aa2d2bc908d" class="i property">DynamicParameters</a> <b>as</b> <a href="#4fe5568fafb46b4c" class="t t">RegistryProviderSetItemDynamicParameter</a>;
 
                    <b>if</b> (<span class="r16 r">dynParams</span> != <b>null</b>)
                    {
                        <b>try</b>
                        {
                            <span class="c">// Convert the parameter to a RegistryValueKind</span>
 
                            <span class="i">RegistryValueKind</span> <span id="r17 rd" class="r17 r">kind</span> = <span class="r16 r">dynParams</span>.<a href="#e98a47a65659cb0e" class="i property">Type</a>;
 
                            <span class="r14 r">key</span>.<a href="RegistryWrapper.cs.html#1536e2de1a6f6107" class="i method">SetValue</a>(<b>null</b>, <span class="r10 r">value</span>, <span class="r17 r">kind</span>);
                            <span class="r15 r">valueSet</span> = <b>true</b>;
                        }
                        <b>catch</b> (<span class="i">ArgumentException</span> <span id="r18 rd" class="r18 r">argException</span>)
                        {
                            <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r18 r">argException</span>, <span class="r18 r">argException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#846d2b572f2c4820" class="i field">InvalidArgument</a>, <b>null</b>));
                            <span class="r14 r">key</span>.<a href="RegistryWrapper.cs.html#7c1978c037f5b66c" class="i method">Close</a>();
                            <b>return</b>;
                        }
                        <b>catch</b> (<span class="i n">System</span>.<span class="i">IO</span>.<span class="i">IOException</span> <span id="r19 rd" class="r19 r">ioException</span>)
                        {
                            <span class="c">// An exception occurred while trying to get the key. Write</span>
                            <span class="c">// out the error.</span>
 
                            <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r19 r">ioException</span>, <span class="r19 r">ioException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#0c2f4b9c74e5b7c2" class="i field">WriteError</a>, <span class="r9 r">path</span>));
                            <span class="r14 r">key</span>.<a href="RegistryWrapper.cs.html#7c1978c037f5b66c" class="i method">Close</a>();
                            <b>return</b>;
                        }
                        <b>catch</b> (<span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span> <span id="r20 rd" class="r20 r">securityException</span>)
                        {
                            <span class="c">// An exception occurred while trying to get the key. Write</span>
                            <span class="c">// out the error.</span>
 
                            <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r20 r">securityException</span>, <span class="r20 r">securityException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r9 r">path</span>));
                            <span class="r14 r">key</span>.<a href="RegistryWrapper.cs.html#7c1978c037f5b66c" class="i method">Close</a>();
                            <b>return</b>;
                        }
                        <b>catch</b> (<span class="i n">System</span>.<span class="i">UnauthorizedAccessException</span> <span id="r21 rd" class="r21 r">unauthorizedAccessException</span>)
                        {
                            <span class="c">// An exception occurred while trying to get the key. Write</span>
                            <span class="c">// out the error.</span>
                            <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r21 r">unauthorizedAccessException</span>, <span class="r21 r">unauthorizedAccessException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r9 r">path</span>));
                            <span class="r14 r">key</span>.<a href="RegistryWrapper.cs.html#7c1978c037f5b66c" class="i method">Close</a>();
                            <b>return</b>;
                        }
                    }
                }
 
                <b>if</b> (!<span class="r15 r">valueSet</span>)
                {
                    <b>try</b>
                    {
                        <span class="c">// Set the value</span>
                        <span class="r14 r">key</span>.<a href="RegistryWrapper.cs.html#6b7fc4f6567e1803" class="i method">SetValue</a>(<b>null</b>, <span class="r10 r">value</span>);
                    }
                    <b>catch</b> (<span class="i n">System</span>.<span class="i">IO</span>.<span class="i">IOException</span> <span id="r22 rd" class="r22 r">ioException</span>)
                    {
                        <span class="c">// An exception occurred while trying to get the key. Write</span>
                        <span class="c">// out the error.</span>
 
                        <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r22 r">ioException</span>, <span class="r22 r">ioException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#0c2f4b9c74e5b7c2" class="i field">WriteError</a>, <span class="r9 r">path</span>));
                        <span class="r14 r">key</span>.<a href="RegistryWrapper.cs.html#7c1978c037f5b66c" class="i method">Close</a>();
                        <b>return</b>;
                    }
                    <b>catch</b> (<span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span> <span id="r23 rd" class="r23 r">securityException</span>)
                    {
                        <span class="c">// An exception occurred while trying to get the key. Write</span>
                        <span class="c">// out the error.</span>
 
                        <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r23 r">securityException</span>, <span class="r23 r">securityException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r9 r">path</span>));
                        <span class="r14 r">key</span>.<a href="RegistryWrapper.cs.html#7c1978c037f5b66c" class="i method">Close</a>();
                        <b>return</b>;
                    }
                    <b>catch</b> (<span class="i n">System</span>.<span class="i">UnauthorizedAccessException</span> <span id="r24 rd" class="r24 r">unauthorizedAccessException</span>)
                    {
                        <span class="c">// An exception occurred while trying to get the key. Write</span>
                        <span class="c">// out the error.</span>
 
                        <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r24 r">unauthorizedAccessException</span>, <span class="r24 r">unauthorizedAccessException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r9 r">path</span>));
                        <span class="r14 r">key</span>.<a href="RegistryWrapper.cs.html#7c1978c037f5b66c" class="i method">Close</a>();
                        <b>return</b>;
                    }
                }
 
                <span class="c">// Write out the result</span>
                <b>object</b> <span id="r25 rd" class="r25 r">result</span> = <span class="r10 r">value</span>;
 
                <span class="c">// Since SetValue can munge the data to a specified</span>
                <span class="c">// type (RegistryValueKind), retrieve the value again</span>
                <span class="c">// to output it in the correct form to the user.</span>
                <span class="r25 r">result</span> = <a href="#d94f15e5a20da89d" class="i method">ReadExistingKeyValue</a>(<span class="r14 r">key</span>, <b>null</b>);
                <span class="r14 r">key</span>.<a href="RegistryWrapper.cs.html#7c1978c037f5b66c" class="i method">Close</a>();
 
                <a href="ProviderBase.cs.html#ed0f1f879dd50c77" class="i method">WriteItemObject</a>(<span class="r25 r">result</span>, <span class="r9 r">path</span>, <b>false</b>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the dynamic parameters for the SetItem method.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r26 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Ignored.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r27 r">value</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Ignored.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Commands</span>.<a href="#4fe5568fafb46b4c" class="t t">RegistryProviderSetItemDynamicParameter</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> class which</span>
        <span class="c">///</span><span class="c"> contains a parameter for the Type.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>protected override object</b> <a id="2f541a64deed9222" href="../R/2f541a64deed9222.html" target="n" data-glyph="75,1" class="i method">SetItemDynamicParameters</a>(<b>string</b> <span id="r26 rd" class="r26 r">path</span>, <b>object</b> <span id="r27 rd" class="r27 r">value</span>)
        {
            <b>return</b> <b>new</b> <span class="t">RegistryProviderSetItemDynamicParameter</span>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Clears the item at the specified </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r28 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r28 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to the item that is to be cleared. Only registry values can be cleared using</span>
        <span class="c">///</span><span class="c"> this method.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The registry provider implements this by removing all the values for the specified key.</span>
        <span class="c">///</span><span class="c"> The item that is cleared is written to the WriteObject method.</span>
        <span class="c">///</span><span class="c"> If the path is to a value, then an ArgumentException is written.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="761aa4b5e3ee2472" href="../R/761aa4b5e3ee2472.html" target="n" data-glyph="75,1" class="i method">ClearItem</a>(<b>string</b> <span id="r28 rd" class="r28 r">path</span>)
        {
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r28 r">path</span>))
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fed5f40dc0075d41" class="i method">NewArgumentException</a>(<b>nameof</b>(<span class="r28 r">path</span>));
            }
 
            <span class="c">// Confirm the clear item with the user</span>
 
            <b>string</b> <span id="r29 rd" class="r29 r">action</span> = <span class="i">RegistryProviderStrings</span>.<span class="i">ClearItemAction</span>;
 
            <b>string</b> <span id="r30 rd" class="r30 r">resourceTemplate</span> = <span class="i">RegistryProviderStrings</span>.<span class="i">ClearItemResourceTemplate</span>;
 
            <b>string</b> <span id="r31 rd" class="r31 r">resource</span> =
                <b>string</b>.<span class="i">Format</span>(
                    <a href="ProviderBase.cs.html#be8557754a3bdef0" class="i property">Host</a>.<a href="../engine/hostifaces/MshHost.cs.html#d531244924cf2614" class="i property">CurrentCulture</a>,
                    <span class="r30 r">resourceTemplate</span>,
                    <span class="r28 r">path</span>);
 
            <b>if</b> (<a href="ProviderBase.cs.html#4cb6a9cf0567d153" class="i method">ShouldProcess</a>(<span class="r31 r">resource</span>, <span class="r29 r">action</span>))
            {
                <span class="c">// Get the registry item</span>
 
                <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r32 rd" class="r32 r">key</span> = <a href="#65df19fb203b78a1" class="i method">GetRegkeyForPathWriteIfError</a>(<span class="r28 r">path</span>, <b>true</b>);
 
                <b>if</b> (<span class="r32 r">key</span> == <b>null</b>)
                {
                    <b>return</b>;
                }
 
                <b>string</b>[] <span id="r33 rd" class="r33 r">valueNames</span>;
 
                <b>try</b>
                {
                    <span class="c">// Remove each value</span>
                    <span class="r33 r">valueNames</span> = <span class="r32 r">key</span>.<a href="RegistryWrapper.cs.html#06b6f0abd2e99fdb" class="i method">GetValueNames</a>();
                }
                <b>catch</b> (<span class="i n">System</span>.<span class="i">IO</span>.<span class="i">IOException</span> <span id="r34 rd" class="r34 r">ioException</span>)
                {
                    <span class="c">// An exception occurred while trying to get the key. Write</span>
                    <span class="c">// out the error.</span>
 
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r34 r">ioException</span>, <span class="r34 r">ioException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#cad1e0e3e13dc1f3" class="i field">ReadError</a>, <span class="r28 r">path</span>));
                    <b>return</b>;
                }
                <b>catch</b> (<span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span> <span id="r35 rd" class="r35 r">securityException</span>)
                {
                    <span class="c">// An exception occurred while trying to get the key. Write</span>
                    <span class="c">// out the error.</span>
 
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r35 r">securityException</span>, <span class="r35 r">securityException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r28 r">path</span>));
                    <b>return</b>;
                }
                <b>catch</b> (<span class="i n">System</span>.<span class="i">UnauthorizedAccessException</span> <span id="r36 rd" class="r36 r">unauthorizedAccessException</span>)
                {
                    <span class="c">// An exception occurred while trying to get the key. Write</span>
                    <span class="c">// out the error.</span>
 
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r36 r">unauthorizedAccessException</span>, <span class="r36 r">unauthorizedAccessException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r28 r">path</span>));
                    <b>return</b>;
                }
 
                <b>for</b> (<b>int</b> <span id="r37 rd" class="r37 r">index</span> = 0; <span class="r37 r">index</span> &lt; <span class="r33 r">valueNames</span>.<span class="i">Length</span>; ++<span class="r37 r">index</span>)
                {
                    <b>try</b>
                    {
                        <span class="r32 r">key</span>.<a href="RegistryWrapper.cs.html#1d59298a0843fbfd" class="i method">DeleteValue</a>(<span class="r33 r">valueNames</span>[<span class="r37 r">index</span>]);
                    }
                    <b>catch</b> (<span class="i n">System</span>.<span class="i">IO</span>.<span class="i">IOException</span> <span id="r38 rd" class="r38 r">ioException</span>)
                    {
                        <span class="c">// An exception occurred while trying to delete the value. Write</span>
                        <span class="c">// out the error.</span>
 
                        <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r38 r">ioException</span>, <span class="r38 r">ioException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#0c2f4b9c74e5b7c2" class="i field">WriteError</a>, <span class="r28 r">path</span>));
                    }
                    <b>catch</b> (<span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span> <span id="r39 rd" class="r39 r">securityException</span>)
                    {
                        <span class="c">// An exception occurred while trying to delete the value. Write</span>
                        <span class="c">// out the error.</span>
 
                        <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r39 r">securityException</span>, <span class="r39 r">securityException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r28 r">path</span>));
                    }
                    <b>catch</b> (<span class="i n">System</span>.<span class="i">UnauthorizedAccessException</span> <span id="r40 rd" class="r40 r">unauthorizedAccessException</span>)
                    {
                        <span class="c">// An exception occurred while trying to get the key. Write</span>
                        <span class="c">// out the error.</span>
 
                        <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r40 r">unauthorizedAccessException</span>, <span class="r40 r">unauthorizedAccessException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r28 r">path</span>));
                    }
                }
 
                <span class="c">// Write out the key</span>
 
                <a href="#b1dbe0e69487f77f" class="i method">WriteRegistryItemObject</a>(<span class="r32 r">key</span>, <span class="r28 r">path</span>);
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> ItemCmdletProvider overrides
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> ContainerCmdletProvider overrides
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets all the child keys and values of the key at the specified </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r41 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r41 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to the key to get the child keys of.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span><span class="c">/</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r42 r">recurse</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Determines if the call should be recursive. If true, all subkeys of</span>
        <span class="c">///</span><span class="c"> the key at the specified path will be written. If false, only the</span>
        <span class="c">///</span><span class="c"> immediate children of the key at the specified path will be written.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r43 r">depth</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Current depth of recursion; special case uint.MaxValue performs full recursion.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="ecc5be7b56e81a8f" href="../R/ecc5be7b56e81a8f.html" target="n" data-glyph="75,1" class="i method">GetChildItems</a>(
            <b>string</b> <span id="r41 rd" class="r41 r">path</span>,
            <b>bool</b> <span id="r42 rd" class="r42 r">recurse</span>,
            <b>uint</b> <span id="r43 rd" class="r43 r">depth</span>)
        {
            <a href="#c78d8c98bad069ff" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#49bf988885074437" class="i method">WriteLine</a>(<span class="s">&quot;recurse = {0}, depth = {1}&quot;</span>, <span class="r42 r">recurse</span>, <span class="r43 r">depth</span>);
 
            <b>if</b> (<span class="r41 r">path</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r41 r">path</span>));
            }
 
            <b>if</b> (<a href="#f94bb031403ae9d4" class="i method">IsHiveContainer</a>(<span class="r41 r">path</span>))
            {
                <span class="c">// If the path is empty or it is / or \, return all the hives</span>
 
                <b>foreach</b> (<b>string</b> <span id="r44 rd" class="r44 r">hiveName</span> <b>in</b> <a href="#7045e589383555d5" class="i field">s_hiveNames</a>)
                {
                    <span class="c">// Making sure to obey the StopProcessing.</span>
                    <b>if</b> (<a href="ProviderBase.cs.html#7f198513b75d23b5" class="i property">Stopping</a>)
                    {
                        <b>return</b>;
                    }
 
                    <a href="#b7e98c32c507b8e3" class="i method">GetItem</a>(<span class="r44 r">hiveName</span>);
                }
            }
            <b>else</b>
            {
                <span class="c">// Get the key at the specified path</span>
 
                <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r45 rd" class="r45 r">key</span> = <a href="#65df19fb203b78a1" class="i method">GetRegkeyForPathWriteIfError</a>(<span class="r41 r">path</span>, <b>false</b>);
 
                <b>if</b> (<span class="r45 r">key</span> == <b>null</b>)
                {
                    <b>return</b>;
                }
 
                <b>try</b>
                {
                    <span class="c">// Get all the subkeys of the specified path</span>
 
                    <b>string</b>[] <span id="r46 rd" class="r46 r">keyNames</span> = <span class="r45 r">key</span>.<a href="RegistryWrapper.cs.html#2c4d41c8498d8435" class="i method">GetSubKeyNames</a>();
                    <span class="r45 r">key</span>.<a href="RegistryWrapper.cs.html#7c1978c037f5b66c" class="i method">Close</a>();
 
                    <b>if</b> (<span class="r46 r">keyNames</span> != <b>null</b>)
                    {
                        <b>foreach</b> (<b>string</b> <span id="r47 rd" class="r47 r">subkeyName</span> <b>in</b> <span class="r46 r">keyNames</span>)
                        {
                            <span class="c">// Making sure to obey the StopProcessing.</span>
                            <b>if</b> (<a href="ProviderBase.cs.html#7f198513b75d23b5" class="i property">Stopping</a>)
                            {
                                <b>return</b>;
                            }
 
                            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r47 r">subkeyName</span>))
                            {
                                <b>string</b> <span id="r48 rd" class="r48 r">keypath</span> = <span class="r41 r">path</span>;
 
                                <b>try</b>
                                {
                                    <span class="c">// Generate the path for each key name</span>
 
                                    <span class="r48 r">keypath</span> = <a href="NavigationProviderBase.cs.html#61e394b168b406c8" class="i method">MakePath</a>(<span class="r41 r">path</span>, <span class="r47 r">subkeyName</span>, <span class="r49 r">childIsLeaf</span>: <b>true</b>);
 
                                    <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r48 r">keypath</span>))
                                    {
                                        <span class="c">// Call GetItem to retrieve the RegistryKey object</span>
                                        <span class="c">// and write it to the WriteObject method.</span>
 
                                        <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r50 rd" class="r50 r">resultKey</span> = <a href="#be7cff769479eaa7" class="i method">GetRegkeyForPath</a>(<span class="r48 r">keypath</span>, <b>false</b>);
 
                                        <b>if</b> (<span class="r50 r">resultKey</span> != <b>null</b>)
                                        {
                                            <a href="#b1dbe0e69487f77f" class="i method">WriteRegistryItemObject</a>(<span class="r50 r">resultKey</span>, <span class="r48 r">keypath</span>);
                                        }
 
                                        <span class="c">// Now recurse if necessary</span>
 
                                        <b>if</b> (<span class="r42 r">recurse</span>)
                                        {
                                            <span class="c">// Limiter for recursion</span>
                                            <b>if</b> (<span class="r43 r">depth</span> &gt; 0) <span class="c">// this includes special case &#39;depth == uint.MaxValue&#39; for unlimited recursion</span>
                                            {
                                                <span class="i">GetChildItems</span>(<span class="r48 r">keypath</span>, <span class="r42 r">recurse</span>, <span class="r43 r">depth</span> - 1);
                                            }
                                        }
                                    }
                                }
                                <b>catch</b> (<span class="i n">System</span>.<span class="i">IO</span>.<span class="i">IOException</span> <span id="r51 rd" class="r51 r">ioException</span>)
                                {
                                    <span class="c">// An exception occurred while trying to get the key. Write</span>
                                    <span class="c">// out the error.</span>
 
                                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r51 r">ioException</span>, <span class="r51 r">ioException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#cad1e0e3e13dc1f3" class="i field">ReadError</a>, <span class="r48 r">keypath</span>));
                                }
                                <b>catch</b> (<span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span> <span id="r52 rd" class="r52 r">securityException</span>)
                                {
                                    <span class="c">// An exception occurred while trying to get the key. Write</span>
                                    <span class="c">// out the error.</span>
 
                                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r52 r">securityException</span>, <span class="r52 r">securityException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r48 r">keypath</span>));
                                }
                                <b>catch</b> (<span class="i n">System</span>.<span class="i">UnauthorizedAccessException</span> <span id="r53 rd" class="r53 r">unauthorizedAccessException</span>)
                                {
                                    <span class="c">// An exception occurred while trying to get the key. Write</span>
                                    <span class="c">// out the error.</span>
 
                                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r53 r">unauthorizedAccessException</span>, <span class="r53 r">unauthorizedAccessException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r48 r">keypath</span>));
                                }
                            }
                        }
                    }
                }
                <b>catch</b> (<span class="i n">System</span>.<span class="i">IO</span>.<span class="i">IOException</span> <span id="r54 rd" class="r54 r">ioException</span>)
                {
                    <span class="c">// An exception occurred while trying to get the key. Write</span>
                    <span class="c">// out the error.</span>
 
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r54 r">ioException</span>, <span class="r54 r">ioException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#cad1e0e3e13dc1f3" class="i field">ReadError</a>, <span class="r41 r">path</span>));
                }
                <b>catch</b> (<span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span> <span id="r55 rd" class="r55 r">securityException</span>)
                {
                    <span class="c">// An exception occurred while trying to get the key. Write</span>
                    <span class="c">// out the error.</span>
 
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r55 r">securityException</span>, <span class="r55 r">securityException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r41 r">path</span>));
                }
                <b>catch</b> (<span class="i n">System</span>.<span class="i">UnauthorizedAccessException</span> <span id="r56 rd" class="r56 r">unauthorizedAccessException</span>)
                {
                    <span class="c">// An exception occurred while trying to get the key. Write</span>
                    <span class="c">// out the error.</span>
 
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r56 r">unauthorizedAccessException</span>, <span class="r56 r">unauthorizedAccessException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r41 r">path</span>));
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets all the child key and value names of the key at the specified </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r57 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r57 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to the key to get the child names from.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r58 r">returnContainers</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Ignored since the registry provider does not implement filtering.</span>
        <span class="c">///</span><span class="c"> Normally, if this parameter is ReturnAllContainers then all subkeys should be</span>
        <span class="c">///</span><span class="c"> returned. If it is false, then only those subkeys that match the</span>
        <span class="c">///</span><span class="c"> filter should be returned.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="38470f93591f8637" href="../R/38470f93591f8637.html" target="n" data-glyph="75,1" class="i method">GetChildNames</a>(
            <b>string</b> <span id="r57 rd" class="r57 r">path</span>,
            <a href="../engine/ChildrenCmdletProviderInterfaces.cs.html#33becc108c70a3e1" class="t t">ReturnContainers</a> <span id="r58 rd" class="r58 r">returnContainers</span>)
        {
            <b>if</b> (<span class="r57 r">path</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r57 r">path</span>));
            }
 
            <b>if</b> (<span class="r57 r">path</span>.<span class="i">Length</span> == 0)
            {
                <span class="c">// If the path is empty get the names of the hives</span>
 
                <b>foreach</b> (<b>string</b> <span id="r59 rd" class="r59 r">hiveName</span> <b>in</b> <a href="#7045e589383555d5" class="i field">s_hiveNames</a>)
                {
                    <span class="c">// Making sure to obey the StopProcessing.</span>
                    <b>if</b> (<a href="ProviderBase.cs.html#7f198513b75d23b5" class="i property">Stopping</a>)
                    {
                        <b>return</b>;
                    }
 
                    <a href="ProviderBase.cs.html#ed0f1f879dd50c77" class="i method">WriteItemObject</a>(<span class="r59 r">hiveName</span>, <span class="r59 r">hiveName</span>, <b>true</b>);
                }
            }
            <b>else</b>
            {
                <span class="c">// Get the key at the specified path</span>
 
                <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r60 rd" class="r60 r">key</span> = <a href="#65df19fb203b78a1" class="i method">GetRegkeyForPathWriteIfError</a>(<span class="r57 r">path</span>, <b>false</b>);
 
                <b>if</b> (<span class="r60 r">key</span> == <b>null</b>)
                {
                    <b>return</b>;
                }
 
                <b>try</b>
                {
                    <span class="c">// Get the child key names</span>
 
                    <b>string</b>[] <span id="r61 rd" class="r61 r">results</span> = <span class="r60 r">key</span>.<a href="RegistryWrapper.cs.html#2c4d41c8498d8435" class="i method">GetSubKeyNames</a>();
                    <span class="r60 r">key</span>.<a href="RegistryWrapper.cs.html#7c1978c037f5b66c" class="i method">Close</a>();
 
                    <span class="c">// Write the child key names to the WriteItemObject method</span>
 
                    <b>for</b> (<b>int</b> <span id="r62 rd" class="r62 r">index</span> = 0; <span class="r62 r">index</span> &lt; <span class="r61 r">results</span>.<span class="i">Length</span>; ++<span class="r62 r">index</span>)
                    {
                        <span class="c">// Making sure to obey the StopProcessing.</span>
                        <b>if</b> (<a href="ProviderBase.cs.html#7f198513b75d23b5" class="i property">Stopping</a>)
                        {
                            <b>return</b>;
                        }
 
                        <b>string</b> <span id="r63 rd" class="r63 r">childName</span> = <a href="#8764bc530b3d9a76" class="i method">EscapeChildName</a>(<span class="r61 r">results</span>[<span class="r62 r">index</span>]);
                        <b>string</b> <span id="r64 rd" class="r64 r">childPath</span> = <a href="NavigationProviderBase.cs.html#61e394b168b406c8" class="i method">MakePath</a>(<span class="r57 r">path</span>, <span class="r63 r">childName</span>, <span class="r49 r">childIsLeaf</span>: <b>true</b>);
 
                        <a href="ProviderBase.cs.html#ed0f1f879dd50c77" class="i method">WriteItemObject</a>(<span class="r63 r">childName</span>, <span class="r64 r">childPath</span>, <b>true</b>);
                    }
                }
                <b>catch</b> (<span class="i n">System</span>.<span class="i">IO</span>.<span class="i">IOException</span> <span id="r65 rd" class="r65 r">ioException</span>)
                {
                    <span class="c">// An exception occurred while trying to get the key. Write</span>
                    <span class="c">// out the error.</span>
 
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r65 r">ioException</span>, <span class="r65 r">ioException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#cad1e0e3e13dc1f3" class="i field">ReadError</a>, <span class="r57 r">path</span>));
                }
                <b>catch</b> (<span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span> <span id="r66 rd" class="r66 r">securityException</span>)
                {
                    <span class="c">// An exception occurred while trying to get the key. Write</span>
                    <span class="c">// out the error.</span>
 
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r66 r">securityException</span>, <span class="r66 r">securityException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r57 r">path</span>));
                }
                <b>catch</b> (<span class="i n">System</span>.<span class="i">UnauthorizedAccessException</span> <span id="r67 rd" class="r67 r">unauthorizedAccessException</span>)
                {
                    <span class="c">// An exception occurred while trying to get the key. Write</span>
                    <span class="c">// out the error.</span>
 
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r67 r">unauthorizedAccessException</span>, <span class="r67 r">unauthorizedAccessException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r57 r">path</span>));
                }
            }
        }
 
        <b>private const string</b> <a id="c9c3b5c1e9013a0f" href="../R/c9c3b5c1e9013a0f.html" target="n" data-glyph="10,1" class="i field">charactersThatNeedEscaping</a> = <span class="s">&quot;.*?[]:&quot;</span>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Escapes the characters in the registry key path that are used by globbing and</span>
        <span class="c">///</span><span class="c"> path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r68 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to escape.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The escaped path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This method handles surrogate pairs. Please see msdn documentation</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>private static string</b> <a id="26aed69c2c9d86d0" href="../R/26aed69c2c9d86d0.html" target="n" data-glyph="76,1" class="i method">EscapeSpecialChars</a>(<b>string</b> <span id="r68 rd" class="r68 r">path</span>)
        {
            <span class="i">StringBuilder</span> <span id="r69 rd" class="r69 r">result</span> = <b>new</b> <span class="i">StringBuilder</span>();
 
            <span class="c">// Get the text enumerator..this will iterate through each character</span>
            <span class="c">// the character can be a surrogate pair</span>
            <span class="i n">System</span>.<span class="i">Globalization</span>.<span class="i">TextElementEnumerator</span> <span id="r70 rd" class="r70 r">textEnumerator</span> =
                <span class="i n">System</span>.<span class="i">Globalization</span>.<span class="i">StringInfo</span>.<span class="i">GetTextElementEnumerator</span>(<span class="r68 r">path</span>);
 
            <span class="i n">Dbg</span>.<a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<span class="i">Assert</span>(
                <span class="r70 r">textEnumerator</span> != <b>null</b>,
                <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>, <span class="s">&quot;Cannot get a text enumerator for name {0}&quot;</span>, <span class="r68 r">path</span>));
 
            <b>while</b> (<span class="r70 r">textEnumerator</span>.<span class="i">MoveNext</span>())
            {
                <span class="c">// Iterate through each element and findout whether</span>
                <span class="c">// any text needs escaping</span>
                <b>string</b> <span id="r71 rd" class="r71 r">textElement</span> = <span class="r70 r">textEnumerator</span>.<span class="i">GetTextElement</span>();
 
                <span class="c">// NTRAID#Windows Out of Band Releases-939036-2006/07/12-LeeHolm</span>
                <span class="c">// A single character can never contain a string of</span>
                <span class="c">// charactersThatNeedEscaping, so this method does nothing.  The fix</span>
                <span class="c">// is to remove all calls to this escaping code, though, as this escaping</span>
                <span class="c">// should not be done.</span>
                <b>if</b> (<span class="r71 r">textElement</span>.<span class="i">Contains</span>(<a href="#c9c3b5c1e9013a0f" class="i field">charactersThatNeedEscaping</a>))
                {
                    <span class="c">// This text element needs espacing</span>
                    <span class="r69 r">result</span>.<span class="i">Append</span>(<span class="s">&#39;`&#39;</span>);
                }
 
                <span class="r69 r">result</span>.<span class="i">Append</span>(<span class="r71 r">textElement</span>);
            }
 
            <b>return</b> <span class="r69 r">result</span>.<span class="i">ToString</span>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Escapes the characters in the registry key name that are used by globbing and</span>
        <span class="c">///</span><span class="c"> path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r72 r">name</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The name to escape.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The escaped name.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This method handles surrogate pairs. Please see msdn documentation</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>private static string</b> <a id="8764bc530b3d9a76" href="../R/8764bc530b3d9a76.html" target="n" data-glyph="76,1" class="i method">EscapeChildName</a>(<b>string</b> <span id="r72 rd" class="r72 r">name</span>)
        {
            <span class="i">StringBuilder</span> <span id="r73 rd" class="r73 r">result</span> = <b>new</b> <span class="i">StringBuilder</span>();
 
            <span class="c">// Get the text enumerator..this will iterate through each character</span>
            <span class="c">// the character can be a surrogate pair</span>
            <span class="i n">System</span>.<span class="i">Globalization</span>.<span class="i">TextElementEnumerator</span> <span id="r74 rd" class="r74 r">textEnumerator</span> =
                <span class="i n">System</span>.<span class="i">Globalization</span>.<span class="i">StringInfo</span>.<span class="i">GetTextElementEnumerator</span>(<span class="r72 r">name</span>);
 
            <span class="i n">Dbg</span>.<a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<span class="i">Assert</span>(
                <span class="r74 r">textEnumerator</span> != <b>null</b>,
                <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>, <span class="s">&quot;Cannot get a text enumerator for name {0}&quot;</span>, <span class="r72 r">name</span>));
 
            <b>while</b> (<span class="r74 r">textEnumerator</span>.<span class="i">MoveNext</span>())
            {
                <span class="c">// Iterate through each element and findout whether</span>
                <span class="c">// any text needs escaping</span>
                <b>string</b> <span id="r75 rd" class="r75 r">textElement</span> = <span class="r74 r">textEnumerator</span>.<span class="i">GetTextElement</span>();
 
                <span class="c">// NTRAID#Windows Out of Band Releases-939036-2006/07/12-LeeHolm</span>
                <span class="c">// A single character can never contain a string of</span>
                <span class="c">// charactersThatNeedEscaping, so this method does nothing.  The fix</span>
                <span class="c">// is to remove all calls to this escaping code, though, as this escaping</span>
                <span class="c">// should not be done.</span>
                <b>if</b> (<span class="r75 r">textElement</span>.<span class="i">Contains</span>(<a href="#c9c3b5c1e9013a0f" class="i field">charactersThatNeedEscaping</a>))
                {
                    <span class="c">// This text element needs espacing</span>
                    <span class="r73 r">result</span>.<span class="i">Append</span>(<span class="s">&#39;`&#39;</span>);
                }
 
                <span class="r73 r">result</span>.<span class="i">Append</span>(<span class="r75 r">textElement</span>);
            }
 
            <b>return</b> <span class="r73 r">result</span>.<span class="i">ToString</span>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Renames the key at the specified </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r76 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r77 r">newName</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r76 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to the key to rename.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r77 r">newName</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The new name of the key.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="a95585396158214f" href="../R/a95585396158214f.html" target="n" data-glyph="75,1" class="i method">RenameItem</a>(
            <b>string</b> <span id="r76 rd" class="r76 r">path</span>,
            <b>string</b> <span id="r77 rd" class="r77 r">newName</span>)
        {
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r76 r">path</span>))
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fed5f40dc0075d41" class="i method">NewArgumentException</a>(<b>nameof</b>(<span class="r76 r">path</span>));
            }
 
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r77 r">newName</span>))
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fed5f40dc0075d41" class="i method">NewArgumentException</a>(<b>nameof</b>(<span class="r77 r">newName</span>));
            }
 
            <a href="#c78d8c98bad069ff" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;newName = {0}&quot;</span>, <span class="r77 r">newName</span>);
 
            <b>string</b> <span id="r78 rd" class="r78 r">parentPath</span> = <a href="#a7fede66d53a4ef7" class="i method">GetParentPath</a>(<span class="r76 r">path</span>, <b>null</b>);
            <b>string</b> <span id="r79 rd" class="r79 r">newPath</span> = <a href="NavigationProviderBase.cs.html#6133115f9f4a066d" class="i method">MakePath</a>(<span class="r78 r">parentPath</span>, <span class="r77 r">newName</span>);
 
            <span class="c">// Make sure we aren&#39;t going to overwrite an existing item</span>
 
            <b>bool</b> <span id="r80 rd" class="r80 r">exists</span> = <a href="#edf415002ed92ac3" class="i method">ItemExists</a>(<span class="r79 r">newPath</span>);
 
            <b>if</b> (<span class="r80 r">exists</span>)
            {
                <span class="i">Exception</span> <span id="r81 rd" class="r81 r">e</span> = <b>new</b> <span class="i">ArgumentException</span>(<span class="i">RegistryProviderStrings</span>.<span class="i">RenameItemAlreadyExists</span>);
                <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(
                    <span class="r81 r">e</span>,
                    <span class="r81 r">e</span>.<span class="i">GetType</span>().<span class="i">FullName</span>,
                    <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#846d2b572f2c4820" class="i field">InvalidArgument</a>,
                    <span class="r79 r">newPath</span>));
 
                <b>return</b>;
            }
            <span class="c">// Confirm the rename item with the user</span>
 
            <b>string</b> <span id="r82 rd" class="r82 r">action</span> = <span class="i">RegistryProviderStrings</span>.<span class="i">RenameItemAction</span>;
 
            <b>string</b> <span id="r83 rd" class="r83 r">resourceTemplate</span> = <span class="i">RegistryProviderStrings</span>.<span class="i">RenameItemResourceTemplate</span>;
 
            <b>string</b> <span id="r84 rd" class="r84 r">resource</span> =
                <b>string</b>.<span class="i">Format</span>(
                    <a href="ProviderBase.cs.html#be8557754a3bdef0" class="i property">Host</a>.<a href="../engine/hostifaces/MshHost.cs.html#d531244924cf2614" class="i property">CurrentCulture</a>,
                    <span class="r83 r">resourceTemplate</span>,
                    <span class="r76 r">path</span>,
                    <span class="r79 r">newPath</span>);
 
            <b>if</b> (<a href="ProviderBase.cs.html#4cb6a9cf0567d153" class="i method">ShouldProcess</a>(<span class="r84 r">resource</span>, <span class="r82 r">action</span>))
            {
                <span class="c">// Implement rename as a move operation</span>
 
                <a href="#b43277e551ec6de3" class="i method">MoveRegistryItem</a>(<span class="r76 r">path</span>, <span class="r79 r">newPath</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates a new registry key or value at the specified </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r85 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r85 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to the new key to create.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r86 r">type</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The type is ignored because this provider only creates</span>
        <span class="c">///</span><span class="c"> registry keys.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r87 r">newItem</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The newItem is ignored because the provider creates the</span>
        <span class="c">///</span><span class="c"> key based on the path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="9b694e244bee23f2" href="../R/9b694e244bee23f2.html" target="n" data-glyph="75,1" class="i method">NewItem</a>(
            <b>string</b> <span id="r85 rd" class="r85 r">path</span>,
            <b>string</b> <span id="r86 rd" class="r86 r">type</span>,
            <b>object</b> <span id="r87 rd" class="r87 r">newItem</span>)
        {
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r85 r">path</span>))
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fed5f40dc0075d41" class="i method">NewArgumentException</a>(<b>nameof</b>(<span class="r85 r">path</span>));
            }
 
            <span class="c">// Confirm the new item with the user</span>
 
            <b>string</b> <span id="r88 rd" class="r88 r">action</span> = <span class="i">RegistryProviderStrings</span>.<span class="i">NewItemAction</span>;
 
            <b>string</b> <span id="r89 rd" class="r89 r">resourceTemplate</span> = <span class="i">RegistryProviderStrings</span>.<span class="i">NewItemResourceTemplate</span>;
 
            <b>string</b> <span id="r90 rd" class="r90 r">resource</span> =
                <b>string</b>.<span class="i">Format</span>(
                    <a href="ProviderBase.cs.html#be8557754a3bdef0" class="i property">Host</a>.<a href="../engine/hostifaces/MshHost.cs.html#d531244924cf2614" class="i property">CurrentCulture</a>,
                    <span class="r89 r">resourceTemplate</span>,
                    <span class="r85 r">path</span>);
            <b>if</b> (<a href="ProviderBase.cs.html#4cb6a9cf0567d153" class="i method">ShouldProcess</a>(<span class="r90 r">resource</span>, <span class="r88 r">action</span>))
            {
                <span class="c">// Check to see if the key already exists</span>
                <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r91 rd" class="r91 r">resultKey</span> = <a href="#be7cff769479eaa7" class="i method">GetRegkeyForPath</a>(<span class="r85 r">path</span>, <b>false</b>);
 
                <b>if</b> (<span class="r91 r">resultKey</span> != <b>null</b>)
                {
                    <b>if</b> (!<a href="ProviderBase.cs.html#e3c4d51f13fbfcaa" class="i property">Force</a>)
                    {
                        <span class="i">Exception</span> <span id="r92 rd" class="r92 r">e</span> = <b>new</b> <span class="i n">System</span>.<span class="i">IO</span>.<span class="i">IOException</span>(<span class="i">RegistryProviderStrings</span>.<span class="i">KeyAlreadyExists</span>);
                        <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(
                            <span class="r92 r">e</span>,
                            <span class="r92 r">e</span>.<span class="i">GetType</span>().<span class="i">FullName</span>,
                            <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#22cb3b8b80f740be" class="i field">ResourceExists</a>,
                            <span class="r91 r">resultKey</span>));
 
                        <span class="r91 r">resultKey</span>.<a href="RegistryWrapper.cs.html#7c1978c037f5b66c" class="i method">Close</a>();
                        <b>return</b>;
                    }
                    <b>else</b>
                    {
                        <span class="c">// Remove the existing key before creating the new one</span>
                        <span class="r91 r">resultKey</span>.<a href="RegistryWrapper.cs.html#7c1978c037f5b66c" class="i method">Close</a>();
                        <a href="#539fff15d1cebcf7" class="i method">RemoveItem</a>(<span class="r85 r">path</span>, <b>false</b>);
                    }
                }
 
                <b>if</b> (<a href="ProviderBase.cs.html#e3c4d51f13fbfcaa" class="i property">Force</a>)
                {
                    <b>if</b> (!<a href="#e2c024a073823c46" class="i method">CreateIntermediateKeys</a>(<span class="r85 r">path</span>))
                    {
                        <span class="c">// We are unable to create Intermediate keys. Just return.</span>
                        <b>return</b>;
                    }
                }
 
                <span class="c">// Get the parent and child portions of the path</span>
 
                <b>string</b> <span id="r93 rd" class="r93 r">parentPath</span> = <a href="#a7fede66d53a4ef7" class="i method">GetParentPath</a>(<span class="r85 r">path</span>, <b>null</b>);
                <b>string</b> <span id="r94 rd" class="r94 r">childName</span> = <a href="#3497b2446ca4afca" class="i method">GetChildName</a>(<span class="r85 r">path</span>);
 
                <span class="c">// Get the key at the specified path</span>
                <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r95 rd" class="r95 r">key</span> = <a href="#65df19fb203b78a1" class="i method">GetRegkeyForPathWriteIfError</a>(<span class="r93 r">parentPath</span>, <b>true</b>);
 
                <b>if</b> (<span class="r95 r">key</span> == <b>null</b>)
                {
                    <b>return</b>;
                }
 
                <b>try</b>
                {
                    <span class="c">// Create the new subkey</span>
                    <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r96 rd" class="r96 r">newKey</span> = <span class="r95 r">key</span>.<a href="RegistryWrapper.cs.html#ebdaef77a73f3b70" class="i method">CreateSubKey</a>(<span class="r94 r">childName</span>);
                    <span class="r95 r">key</span>.<a href="RegistryWrapper.cs.html#7c1978c037f5b66c" class="i method">Close</a>();
 
                    <b>try</b>
                    {
                        <span class="c">// Set the default key value if the value and type were specified</span>
 
                        <b>if</b> (<span class="r87 r">newItem</span> != <b>null</b>)
                        {
                            <span class="i">RegistryValueKind</span> <span id="r97 rd" class="r97 r">kind</span>;
                            <b>if</b> (!<a href="#38e317bebf0af6b3" class="i method">ParseKind</a>(<span class="r86 r">type</span>, <b>out</b> <span class="r97 r">kind</span>))
                            {
                                <b>return</b>;
                            }
 
                            <span class="i">SetRegistryValue</span>(<span class="r96 r">newKey</span>, <b>string</b>.<span class="i">Empty</span>, <span class="r87 r">newItem</span>, <span class="r97 r">kind</span>, <span class="r85 r">path</span>, <b>false</b>);
                        }
                    }
                    <b>catch</b> (<span class="i">Exception</span> <span id="r98 rd" class="r98 r">exception</span>)
                    {
                        <span class="c">// The key has been created, but the default value failed to be set.</span>
                        <span class="c">// If possible, just write an error instead of failing the entire operation.</span>
 
                        <b>if</b> ((<span class="r98 r">exception</span> <b>is</b> <span class="i">ArgumentException</span>) ||
                            (<span class="r98 r">exception</span> <b>is</b> <span class="i">InvalidCastException</span>) ||
                            (<span class="r98 r">exception</span> <b>is</b> <span class="i n">System</span>.<span class="i">IO</span>.<span class="i">IOException</span>) ||
                            (<span class="r98 r">exception</span> <b>is</b> <span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span>) ||
                            (<span class="r98 r">exception</span> <b>is</b> <span class="i n">System</span>.<span class="i">UnauthorizedAccessException</span>) ||
                            (<span class="r98 r">exception</span> <b>is</b> <span class="i">NotSupportedException</span>))
                        {
                            <a href="../engine/ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r99 rd" class="r99 r">rec</span> = <b>new</b> <span class="t">ErrorRecord</span>(
                                <span class="r98 r">exception</span>,
                                <span class="r98 r">exception</span>.<span class="i">GetType</span>().<span class="i">FullName</span>,
                                <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#0c2f4b9c74e5b7c2" class="i field">WriteError</a>,
                                <span class="r96 r">newKey</span>);
                            <span class="r99 r">rec</span>.<a href="../engine/ErrorPackage.cs.html#4e9df045b6372ce0" class="i property">ErrorDetails</a> = <b>new</b> <a href="../engine/ErrorPackage.cs.html#908615d662085fc6" class="t constructor">ErrorDetails</a>(<a href="../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RegistryProviderStrings</span>.<span class="i">KeyCreatedValueFailed</span>, <span class="r94 r">childName</span>));
                            <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<span class="r99 r">rec</span>);
                        }
                        <b>else</b>
                            <b>throw</b>;
                    }
 
                    <span class="c">// Write the new key out.</span>
                    <a href="#b1dbe0e69487f77f" class="i method">WriteRegistryItemObject</a>(<span class="r96 r">newKey</span>, <span class="r85 r">path</span>);
                }
                <b>catch</b> (<span class="i n">System</span>.<span class="i">IO</span>.<span class="i">IOException</span> <span id="r100 rd" class="r100 r">ioException</span>)
                {
                    <span class="c">// An exception occurred while trying to get the key. Write</span>
                    <span class="c">// out the error.</span>
 
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r100 r">ioException</span>, <span class="r100 r">ioException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#0c2f4b9c74e5b7c2" class="i field">WriteError</a>, <span class="r85 r">path</span>));
                }
                <b>catch</b> (<span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span> <span id="r101 rd" class="r101 r">securityException</span>)
                {
                    <span class="c">// An exception occurred while trying to get the key. Write</span>
                    <span class="c">// out the error.</span>
 
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r101 r">securityException</span>, <span class="r101 r">securityException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r85 r">path</span>));
                }
                <b>catch</b> (<span class="i n">System</span>.<span class="i">UnauthorizedAccessException</span> <span id="r102 rd" class="r102 r">unauthorizedAccessException</span>)
                {
                    <span class="c">// An exception occurred while trying to get the key. Write</span>
                    <span class="c">// out the error.</span>
 
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r102 r">unauthorizedAccessException</span>, <span class="r102 r">unauthorizedAccessException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r85 r">path</span>));
                }
                <b>catch</b> (<span class="i">ArgumentException</span> <span id="r103 rd" class="r103 r">argException</span>)
                {
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r103 r">argException</span>, <span class="r103 r">argException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#846d2b572f2c4820" class="i field">InvalidArgument</a>, <span class="r85 r">path</span>));
                }
                <b>catch</b> (<span class="i">NotSupportedException</span> <span id="r104 rd" class="r104 r">notSupportedException</span>)
                {
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r104 r">notSupportedException</span>, <span class="r104 r">notSupportedException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>, <span class="r85 r">path</span>));
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Removes the specified registry key and all sub-keys.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r105 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to the key to remove.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r106 r">recurse</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Ignored. All removes are recursive because the</span>
        <span class="c">///</span><span class="c"> registry provider does not support filters.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="539fff15d1cebcf7" href="../R/539fff15d1cebcf7.html" target="n" data-glyph="75,1" class="i method">RemoveItem</a>(
            <b>string</b> <span id="r105 rd" class="r105 r">path</span>,
            <b>bool</b> <span id="r106 rd" class="r106 r">recurse</span>)
        {
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r105 r">path</span>))
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fed5f40dc0075d41" class="i method">NewArgumentException</a>(<b>nameof</b>(<span class="r105 r">path</span>));
            }
 
            <a href="#c78d8c98bad069ff" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#451d38bf8c2b6b94" class="i method">WriteLine</a>(<span class="s">&quot;recurse = {0}&quot;</span>, <span class="r106 r">recurse</span>);
 
            <span class="c">// Get the parent and child portions of the path</span>
 
            <b>string</b> <span id="r107 rd" class="r107 r">parentPath</span> = <a href="#a7fede66d53a4ef7" class="i method">GetParentPath</a>(<span class="r105 r">path</span>, <b>null</b>);
            <b>string</b> <span id="r108 rd" class="r108 r">childName</span> = <a href="#3497b2446ca4afca" class="i method">GetChildName</a>(<span class="r105 r">path</span>);
 
            <span class="c">// Get the parent key</span>
 
            <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r109 rd" class="r109 r">key</span> = <a href="#65df19fb203b78a1" class="i method">GetRegkeyForPathWriteIfError</a>(<span class="r107 r">parentPath</span>, <b>true</b>);
 
            <b>if</b> (<span class="r109 r">key</span> == <b>null</b>)
            {
                <b>return</b>;
            }
 
            <span class="c">// Confirm the remove item with the user</span>
 
            <b>string</b> <span id="r110 rd" class="r110 r">action</span> = <span class="i">RegistryProviderStrings</span>.<span class="i">RemoveKeyAction</span>;
 
            <b>string</b> <span id="r111 rd" class="r111 r">resourceTemplate</span> = <span class="i">RegistryProviderStrings</span>.<span class="i">RemoveKeyResourceTemplate</span>;
 
            <b>string</b> <span id="r112 rd" class="r112 r">resource</span> =
                    <b>string</b>.<span class="i">Format</span>(
                        <a href="ProviderBase.cs.html#be8557754a3bdef0" class="i property">Host</a>.<a href="../engine/hostifaces/MshHost.cs.html#d531244924cf2614" class="i property">CurrentCulture</a>,
                        <span class="r111 r">resourceTemplate</span>,
                        <span class="r105 r">path</span>);
 
            <b>if</b> (<a href="ProviderBase.cs.html#4cb6a9cf0567d153" class="i method">ShouldProcess</a>(<span class="r112 r">resource</span>, <span class="r110 r">action</span>))
            {
                <b>try</b>
                {
                    <span class="r109 r">key</span>.<a href="RegistryWrapper.cs.html#642347a5990646e1" class="i method">DeleteSubKeyTree</a>(<span class="r108 r">childName</span>);
                }
                <b>catch</b> (<span class="i">ArgumentException</span> <span id="r113 rd" class="r113 r">argumentException</span>)
                {
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r113 r">argumentException</span>, <span class="r113 r">argumentException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#0c2f4b9c74e5b7c2" class="i field">WriteError</a>, <span class="r105 r">path</span>));
                }
                <b>catch</b> (<span class="i n">System</span>.<span class="i">IO</span>.<span class="i">IOException</span> <span id="r114 rd" class="r114 r">ioException</span>)
                {
                    <span class="c">// An exception occurred while trying to get the key. Write</span>
                    <span class="c">// out the error.</span>
 
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r114 r">ioException</span>, <span class="r114 r">ioException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#0c2f4b9c74e5b7c2" class="i field">WriteError</a>, <span class="r105 r">path</span>));
                }
                <b>catch</b> (<span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span> <span id="r115 rd" class="r115 r">securityException</span>)
                {
                    <span class="c">// An exception occurred while trying to get the key. Write</span>
                    <span class="c">// out the error.</span>
 
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r115 r">securityException</span>, <span class="r115 r">securityException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r105 r">path</span>));
                }
                <b>catch</b> (<span class="i n">System</span>.<span class="i">UnauthorizedAccessException</span> <span id="r116 rd" class="r116 r">unauthorizedAccessException</span>)
                {
                    <span class="c">// An exception occurred while trying to get the key. Write</span>
                    <span class="c">// out the error.</span>
 
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r116 r">unauthorizedAccessException</span>, <span class="r116 r">unauthorizedAccessException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r105 r">path</span>));
                }
                <b>catch</b> (<span class="i">NotSupportedException</span> <span id="r117 rd" class="r117 r">notSupportedException</span>)
                {
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r117 r">notSupportedException</span>, <span class="r117 r">notSupportedException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>, <span class="r105 r">path</span>));
                }
            }
 
            <span class="r109 r">key</span>.<a href="RegistryWrapper.cs.html#7c1978c037f5b66c" class="i method">Close</a>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Determines if the key at the specified path exists.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r118 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to the key to determine if it exists.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> True if the key at the specified path exists, false otherwise.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>protected override bool</b> <a id="edf415002ed92ac3" href="../R/edf415002ed92ac3.html" target="n" data-glyph="75,1" class="i method">ItemExists</a>(<b>string</b> <span id="r118 rd" class="r118 r">path</span>)
        {
            <b>bool</b> <span id="r119 rd" class="r119 r">result</span> = <b>false</b>;
 
            <b>if</b> (<span class="r118 r">path</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r118 r">path</span>));
            }
 
            <b>try</b>
            {
                <b>if</b> (<a href="#f94bb031403ae9d4" class="i method">IsHiveContainer</a>(<span class="r118 r">path</span>))
                {
                    <span class="c">// an empty path, \ or / are valid because</span>
                    <span class="c">// we will enumerate all the hives</span>
                    <span class="r119 r">result</span> = <b>true</b>;
                }
                <b>else</b>
                {
                    <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r120 rd" class="r120 r">key</span> = <a href="#be7cff769479eaa7" class="i method">GetRegkeyForPath</a>(<span class="r118 r">path</span>, <b>false</b>);
 
                    <b>if</b> (<span class="r120 r">key</span> != <b>null</b>)
                    {
                        <span class="r119 r">result</span> = <b>true</b>;
                        <span class="r120 r">key</span>.<a href="RegistryWrapper.cs.html#7c1978c037f5b66c" class="i method">Close</a>();
                    }
                }
            }
            <span class="c">// Catch known non-terminating exceptions</span>
            <b>catch</b> (<span class="i n">System</span>.<span class="i">IO</span>.<span class="i">IOException</span>)
            {
            }
            <span class="c">// In these cases, the item does exist</span>
            <b>catch</b> (<span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span>)
            {
                <span class="r119 r">result</span> = <b>true</b>;
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i">UnauthorizedAccessException</span>)
            {
                <span class="r119 r">result</span> = <b>true</b>;
            }
 
            <b>return</b> <span class="r119 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Determines if the specified key has subkeys.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r121 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to the key to determine if it has sub keys.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> True if the specified key has subkeys, false otherwise.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>protected override bool</b> <a id="0517890a5654be58" href="../R/0517890a5654be58.html" target="n" data-glyph="75,1" class="i method">HasChildItems</a>(<b>string</b> <span id="r121 rd" class="r121 r">path</span>)
        {
            <b>bool</b> <span id="r122 rd" class="r122 r">result</span> = <b>false</b>;
 
            <b>if</b> (<span class="r121 r">path</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r121 r">path</span>));
            }
 
            <b>try</b>
            {
                <b>if</b> (<a href="#f94bb031403ae9d4" class="i method">IsHiveContainer</a>(<span class="r121 r">path</span>))
                {
                    <span class="c">// An empty path will enumerate the hives</span>
 
                    <span class="r122 r">result</span> = <a href="#7045e589383555d5" class="i field">s_hiveNames</a>.<span class="i">Length</span> &gt; 0;
                }
                <b>else</b>
                {
                    <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r123 rd" class="r123 r">key</span> = <a href="#be7cff769479eaa7" class="i method">GetRegkeyForPath</a>(<span class="r121 r">path</span>, <b>false</b>);
 
                    <b>if</b> (<span class="r123 r">key</span> != <b>null</b>)
                    {
                        <span class="r122 r">result</span> = <span class="r123 r">key</span>.<a href="RegistryWrapper.cs.html#c447e5c4284601a9" class="i property">SubKeyCount</a> &gt; 0;
                        <span class="r123 r">key</span>.<a href="RegistryWrapper.cs.html#7c1978c037f5b66c" class="i method">Close</a>();
                    }
                }
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i">IO</span>.<span class="i">IOException</span>)
            {
                <span class="r122 r">result</span> = <b>false</b>;
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span>)
            {
                <span class="r122 r">result</span> = <b>false</b>;
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i">UnauthorizedAccessException</span>)
            {
                <span class="r122 r">result</span> = <b>false</b>;
            }
 
            <b>return</b> <span class="r122 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Copies the specified registry key to the specified </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r124 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r124 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path of the registry key to copy.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r125 r">destination</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to copy the key to.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r126 r">recurse</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If true all subkeys should be copied. If false, only the</span>
        <span class="c">///</span><span class="c"> specified key should be copied.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="9a6b31bb1d1e417c" href="../R/9a6b31bb1d1e417c.html" target="n" data-glyph="75,1" class="i method">CopyItem</a>(
            <b>string</b> <span id="r124 rd" class="r124 r">path</span>,
            <b>string</b> <span id="r125 rd" class="r125 r">destination</span>,
            <b>bool</b> <span id="r126 rd" class="r126 r">recurse</span>)
        {
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r124 r">path</span>))
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fed5f40dc0075d41" class="i method">NewArgumentException</a>(<b>nameof</b>(<span class="r124 r">path</span>));
            }
 
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r125 r">destination</span>))
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fed5f40dc0075d41" class="i method">NewArgumentException</a>(<b>nameof</b>(<span class="r125 r">destination</span>));
            }
 
            <a href="#c78d8c98bad069ff" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;destination = {0}&quot;</span>, <span class="r125 r">destination</span>);
            <a href="#c78d8c98bad069ff" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#451d38bf8c2b6b94" class="i method">WriteLine</a>(<span class="s">&quot;recurse = {0}&quot;</span>, <span class="r126 r">recurse</span>);
 
            <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r127 rd" class="r127 r">key</span> = <a href="#65df19fb203b78a1" class="i method">GetRegkeyForPathWriteIfError</a>(<span class="r124 r">path</span>, <b>false</b>);
 
            <b>if</b> (<span class="r127 r">key</span> == <b>null</b>)
            {
                <b>return</b>;
            }
 
            <b>try</b>
            {
                <a href="#c614e4471b018f7c" class="i method">CopyRegistryKey</a>(<span class="r127 r">key</span>, <span class="r124 r">path</span>, <span class="r125 r">destination</span>, <span class="r126 r">recurse</span>, <b>true</b>, <b>false</b>);
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i">IO</span>.<span class="i">IOException</span> <span id="r128 rd" class="r128 r">ioException</span>)
            {
                <span class="c">// An exception occurred while trying to get the key. Write</span>
                <span class="c">// out the error.</span>
 
                <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r128 r">ioException</span>, <span class="r128 r">ioException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#0c2f4b9c74e5b7c2" class="i field">WriteError</a>, <span class="r124 r">path</span>));
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span> <span id="r129 rd" class="r129 r">securityException</span>)
            {
                <span class="c">// An exception occurred while trying to get the key. Write</span>
                <span class="c">// out the error.</span>
 
                <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r129 r">securityException</span>, <span class="r129 r">securityException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r124 r">path</span>));
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i">UnauthorizedAccessException</span> <span id="r130 rd" class="r130 r">unauthorizedAccessException</span>)
            {
                <span class="c">// An exception occurred while trying to get the key. Write</span>
                <span class="c">// out the error.</span>
 
                <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r130 r">unauthorizedAccessException</span>, <span class="r130 r">unauthorizedAccessException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r124 r">path</span>));
            }
 
            <span class="r127 r">key</span>.<a href="RegistryWrapper.cs.html#7c1978c037f5b66c" class="i method">Close</a>();
        }
 
        <b>private bool</b> <a id="c614e4471b018f7c" href="../R/c614e4471b018f7c.html" target="n" data-glyph="76,1" class="i method">CopyRegistryKey</a>(
            <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r131 rd" class="r131 r">key</span>,
            <b>string</b> <span id="r132 rd" class="r132 r">path</span>,
            <b>string</b> <span id="r133 rd" class="r133 r">destination</span>,
            <b>bool</b> <span id="r134 rd" class="r134 r">recurse</span>,
            <b>bool</b> <span id="r135 rd" class="r135 r">streamResult</span>,
            <b>bool</b> <span id="r136 rd" class="r136 r">streamFirstOnly</span>)
        {
            <b>bool</b> <span id="r137 rd" class="r137 r">result</span> = <b>true</b>;
 
            <span class="c">// Make sure we are not trying to do a recursive copy of a key</span>
            <span class="c">// to itself or a child of itself.</span>
 
            <b>if</b> (<span class="r134 r">recurse</span>)
            {
                <b>if</b> (<a href="#a09359b7d498d939" class="i method">ErrorIfDestinationIsSourceOrChildOfSource</a>(<span class="r132 r">path</span>, <span class="r133 r">destination</span>))
                {
                    <b>return</b> <b>false</b>;
                }
            }
 
            <span class="i n">Dbg</span>.<a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(
                <span class="r131 r">key</span> != <b>null</b>,
                <span class="s">&quot;The key should have been validated by the caller&quot;</span>);
 
            <span class="i n">Dbg</span>.<a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<span class="i">Assert</span>(
                !<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r132 r">path</span>),
                <span class="s">&quot;The path should have been validated by the caller&quot;</span>);
 
            <span class="i n">Dbg</span>.<a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<span class="i">Assert</span>(
                !<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r133 r">destination</span>),
                <span class="s">&quot;The destination should have been validated by the caller&quot;</span>);
 
            <a href="#c78d8c98bad069ff" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;destination = {0}&quot;</span>, <span class="r133 r">destination</span>);
 
            <span class="c">// Get the parent key of the destination</span>
            <span class="c">// If the destination already exists and is a key, then it becomes</span>
            <span class="c">// the container of the source. If the key doesn&#39;t already exist</span>
            <span class="c">// the parent of the destination path becomes the container of source.</span>
 
            <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r138 rd" class="r138 r">newParentKey</span> = <a href="#be7cff769479eaa7" class="i method">GetRegkeyForPath</a>(<span class="r133 r">destination</span>, <b>true</b>);
            <b>string</b> <span id="r139 rd" class="r139 r">destinationName</span> = <a href="#3497b2446ca4afca" class="i method">GetChildName</a>(<span class="r132 r">path</span>);
            <b>string</b> <span id="r140 rd" class="r140 r">destinationParent</span> = <span class="r133 r">destination</span>;
 
            <b>if</b> (<span class="r138 r">newParentKey</span> == <b>null</b>)
            {
                <span class="r140 r">destinationParent</span> = <a href="#a7fede66d53a4ef7" class="i method">GetParentPath</a>(<span class="r133 r">destination</span>, <b>null</b>);
                <span class="r139 r">destinationName</span> = <a href="#3497b2446ca4afca" class="i method">GetChildName</a>(<span class="r133 r">destination</span>);
 
                <span class="r138 r">newParentKey</span> = <a href="#65df19fb203b78a1" class="i method">GetRegkeyForPathWriteIfError</a>(<span class="r140 r">destinationParent</span>, <b>true</b>);
            }
 
            <b>if</b> (<span class="r138 r">newParentKey</span> == <b>null</b>)
            {
                <span class="c">// The key was not found.</span>
                <span class="c">// An error should have been written by GetRegkeyForPathWriteIfError</span>
                <b>return</b> <b>false</b>;
            }
 
            <b>string</b> <span id="r141 rd" class="r141 r">destinationPath</span> = <a href="NavigationProviderBase.cs.html#6133115f9f4a066d" class="i method">MakePath</a>(<span class="r140 r">destinationParent</span>, <span class="r139 r">destinationName</span>);
 
            <span class="c">// Confirm the copy item with the user</span>
 
            <b>string</b> <span id="r142 rd" class="r142 r">action</span> = <span class="i">RegistryProviderStrings</span>.<span class="i">CopyKeyAction</span>;
 
            <b>string</b> <span id="r143 rd" class="r143 r">resourceTemplate</span> = <span class="i">RegistryProviderStrings</span>.<span class="i">CopyKeyResourceTemplate</span>;
 
            <b>string</b> <span id="r144 rd" class="r144 r">resource</span> =
                    <b>string</b>.<span class="i">Format</span>(
                        <a href="ProviderBase.cs.html#be8557754a3bdef0" class="i property">Host</a>.<a href="../engine/hostifaces/MshHost.cs.html#d531244924cf2614" class="i property">CurrentCulture</a>,
                        <span class="r143 r">resourceTemplate</span>,
                        <span class="r132 r">path</span>,
                        <span class="r133 r">destination</span>);
 
            <b>if</b> (<a href="ProviderBase.cs.html#4cb6a9cf0567d153" class="i method">ShouldProcess</a>(<span class="r144 r">resource</span>, <span class="r142 r">action</span>))
            {
                <span class="c">// Create new key under the parent</span>
 
                <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r145 rd" class="r145 r">newKey</span> = <b>null</b>;
                <b>try</b>
                {
                    <span class="r145 r">newKey</span> = <span class="r138 r">newParentKey</span>.<a href="RegistryWrapper.cs.html#ebdaef77a73f3b70" class="i method">CreateSubKey</a>(<span class="r139 r">destinationName</span>);
                }
                <b>catch</b> (<span class="i">NotSupportedException</span> <span id="r146 rd" class="r146 r">e</span>)
                {
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r146 r">e</span>, <span class="r146 r">e</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>, <span class="r139 r">destinationName</span>));
                }
 
                <b>if</b> (<span class="r145 r">newKey</span> != <b>null</b>)
                {
                    <span class="c">// Now copy all the properties from the source to the destination</span>
 
                    <b>string</b>[] <span id="r147 rd" class="r147 r">valueNames</span> = <span class="r131 r">key</span>.<a href="RegistryWrapper.cs.html#06b6f0abd2e99fdb" class="i method">GetValueNames</a>();
 
                    <b>for</b> (<b>int</b> <span id="r148 rd" class="r148 r">index</span> = 0; <span class="r148 r">index</span> &lt; <span class="r147 r">valueNames</span>.<span class="i">Length</span>; ++<span class="r148 r">index</span>)
                    {
                        <span class="c">// Making sure to obey the StopProcessing.</span>
                        <b>if</b> (<a href="ProviderBase.cs.html#7f198513b75d23b5" class="i property">Stopping</a>)
                        {
                            <span class="r138 r">newParentKey</span>.<a href="RegistryWrapper.cs.html#7c1978c037f5b66c" class="i method">Close</a>();
                            <span class="r145 r">newKey</span>.<a href="RegistryWrapper.cs.html#7c1978c037f5b66c" class="i method">Close</a>();
                            <b>return</b> <b>false</b>;
                        }
 
                        <span class="r145 r">newKey</span>.<span class="i">SetValue</span>(
                            <span class="r147 r">valueNames</span>[<span class="r148 r">index</span>],
                            <span class="r131 r">key</span>.<span class="i">GetValue</span>(<span class="r147 r">valueNames</span>[<span class="r148 r">index</span>], <b>null</b>, <span class="i">RegistryValueOptions</span>.<span class="i">DoNotExpandEnvironmentNames</span>),
                            <span class="r131 r">key</span>.<span class="i">GetValueKind</span>(<span class="r147 r">valueNames</span>[<span class="r148 r">index</span>]));
                    }
 
                    <b>if</b> (<span class="r135 r">streamResult</span>)
                    {
                        <span class="c">// Write out the key that was copied</span>
 
                        <a href="#b1dbe0e69487f77f" class="i method">WriteRegistryItemObject</a>(<span class="r145 r">newKey</span>, <span class="r141 r">destinationPath</span>);
 
                        <b>if</b> (<span class="r136 r">streamFirstOnly</span>)
                        {
                            <span class="r135 r">streamResult</span> = <b>false</b>;
                        }
                    }
                }
            }
 
            <span class="r138 r">newParentKey</span>.<a href="RegistryWrapper.cs.html#7c1978c037f5b66c" class="i method">Close</a>();
 
            <b>if</b> (<span class="r134 r">recurse</span>)
            {
                <span class="c">// Copy all the subkeys</span>
 
                <b>string</b>[] <span id="r149 rd" class="r149 r">subkeyNames</span> = <span class="r131 r">key</span>.<a href="RegistryWrapper.cs.html#2c4d41c8498d8435" class="i method">GetSubKeyNames</a>();
 
                <b>for</b> (<b>int</b> <span id="r150 rd" class="r150 r">keyIndex</span> = 0; <span class="r150 r">keyIndex</span> &lt; <span class="r149 r">subkeyNames</span>.<span class="i">Length</span>; ++<span class="r150 r">keyIndex</span>)
                {
                    <span class="c">// Making sure to obey the StopProcessing.</span>
                    <b>if</b> (<a href="ProviderBase.cs.html#7f198513b75d23b5" class="i property">Stopping</a>)
                    {
                        <b>return</b> <b>false</b>;
                    }
 
                    <span class="c">// Make the new path under the copy path.</span>
 
                    <b>string</b> <span id="r151 rd" class="r151 r">subKeyPath</span> = <a href="NavigationProviderBase.cs.html#6133115f9f4a066d" class="i method">MakePath</a>(<span class="r132 r">path</span>, <span class="r149 r">subkeyNames</span>[<span class="r150 r">keyIndex</span>]);
                    <b>string</b> <span id="r152 rd" class="r152 r">newSubKeyPath</span> = <a href="NavigationProviderBase.cs.html#6133115f9f4a066d" class="i method">MakePath</a>(<span class="r141 r">destinationPath</span>, <span class="r149 r">subkeyNames</span>[<span class="r150 r">keyIndex</span>]);
 
                    <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r153 rd" class="r153 r">childKey</span> = <a href="#be7cff769479eaa7" class="i method">GetRegkeyForPath</a>(<span class="r151 r">subKeyPath</span>, <b>false</b>);
 
                    <b>bool</b> <span id="r154 rd" class="r154 r">subtreeResult</span> = <a href="#c614e4471b018f7c" class="i method">CopyRegistryKey</a>(<span class="r153 r">childKey</span>, <span class="r151 r">subKeyPath</span>, <span class="r152 r">newSubKeyPath</span>, <span class="r134 r">recurse</span>, <span class="r135 r">streamResult</span>, <span class="r136 r">streamFirstOnly</span>);
 
                    <span class="r153 r">childKey</span>.<a href="RegistryWrapper.cs.html#7c1978c037f5b66c" class="i method">Close</a>();
 
                    <b>if</b> (!<span class="r154 r">subtreeResult</span>)
                    {
                        <span class="r137 r">result</span> = <span class="r154 r">subtreeResult</span>;
                    }
                }
            }
 
            <b>return</b> <span class="r137 r">result</span>;
        }
 
        <b>private bool</b> <a id="a09359b7d498d939" href="../R/a09359b7d498d939.html" target="n" data-glyph="76,1" class="i method">ErrorIfDestinationIsSourceOrChildOfSource</a>(
            <b>string</b> <span id="r155 rd" class="r155 r">sourcePath</span>,
            <b>string</b> <span id="r156 rd" class="r156 r">destinationPath</span>)
        {
            <a href="#c78d8c98bad069ff" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;destinationPath = {0}&quot;</span>, <span class="r156 r">destinationPath</span>);
 
            <span class="c">// Note the paths have already been normalized so case-insensitive</span>
            <span class="c">// comparisons should be sufficient</span>
 
            <b>bool</b> <span id="r157 rd" class="r157 r">result</span> = <b>false</b>;
 
            <b>while</b> (<b>true</b>)
            {
                <span class="c">// See if the paths are equal</span>
 
                <b>if</b> (<b>string</b>.<span class="i">Equals</span>(
                        <span class="r155 r">sourcePath</span>,
                        <span class="r156 r">destinationPath</span>,
                        <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <span class="r157 r">result</span> = <b>true</b>;
                    <b>break</b>;
                }
 
                <b>string</b> <span id="r158 rd" class="r158 r">newDestinationPath</span> = <a href="#a7fede66d53a4ef7" class="i method">GetParentPath</a>(<span class="r156 r">destinationPath</span>, <b>null</b>);
 
                <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r158 r">newDestinationPath</span>))
                {
                    <span class="c">// We reached the root so the destination must not be a child</span>
                    <span class="c">// of the source</span>
                    <b>break</b>;
                }
 
                <b>if</b> (<b>string</b>.<span class="i">Equals</span>(
                        <span class="r158 r">newDestinationPath</span>,
                        <span class="r156 r">destinationPath</span>,
                        <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <span class="c">// We reached the root so the destination must not be a child</span>
                    <span class="c">// of the source</span>
                    <b>break</b>;
                }
 
                <span class="r156 r">destinationPath</span> = <span class="r158 r">newDestinationPath</span>;
            }
 
            <b>if</b> (<span class="r157 r">result</span>)
            {
                <span class="i">Exception</span> <span id="r159 rd" class="r159 r">e</span> =
                    <b>new</b> <span class="i">ArgumentException</span>(
                        <span class="i">RegistryProviderStrings</span>.<span class="i">DestinationChildOfSource</span>);
                <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(
                    <span class="r159 r">e</span>,
                    <span class="r159 r">e</span>.<span class="i">GetType</span>().<span class="i">FullName</span>,
                    <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#846d2b572f2c4820" class="i field">InvalidArgument</a>,
                    <span class="r156 r">destinationPath</span>));
            }
 
            <b>return</b> <span class="r157 r">result</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> ContainerCmdletProvider overrides
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> NavigationCmdletProvider overrides
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Determines if the key at the specified </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r160 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is a container.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r160 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to a key.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Since all registry keys are containers this method just checks</span>
        <span class="c">///</span><span class="c"> to see if the key exists and returns true if it is does or</span>
        <span class="c">///</span><span class="c"> false otherwise.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>protected override bool</b> <a id="0486ab34a99aed17" href="../R/0486ab34a99aed17.html" target="n" data-glyph="75,1" class="i method">IsItemContainer</a>(<b>string</b> <span id="r160 rd" class="r160 r">path</span>)
        {
            <b>if</b> (<span class="r160 r">path</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r160 r">path</span>));
            }
 
            <b>bool</b> <span id="r161 rd" class="r161 r">result</span> = <b>false</b>;
 
            <b>if</b> (<a href="#f94bb031403ae9d4" class="i method">IsHiveContainer</a>(<span class="r160 r">path</span>))
            {
                <span class="r161 r">result</span> = <b>true</b>;
            }
            <b>else</b>
            {
                <b>try</b>
                {
                    <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r162 rd" class="r162 r">key</span> = <a href="#be7cff769479eaa7" class="i method">GetRegkeyForPath</a>(<span class="r160 r">path</span>, <b>false</b>);
 
                    <b>if</b> (<span class="r162 r">key</span> != <b>null</b>)
                    {
                        <span class="c">// All registry keys can be containers. Values are considered</span>
                        <span class="c">// properties</span>
                        <span class="r162 r">key</span>.<a href="RegistryWrapper.cs.html#7c1978c037f5b66c" class="i method">Close</a>();
                        <span class="r161 r">result</span> = <b>true</b>;
                    }
                }
                <span class="c">// Catch known exceptions that are not terminating</span>
                <b>catch</b> (<span class="i n">System</span>.<span class="i">IO</span>.<span class="i">IOException</span> <span id="r163 rd" class="r163 r">ioException</span>)
                {
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r163 r">ioException</span>, <span class="r163 r">ioException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#cad1e0e3e13dc1f3" class="i field">ReadError</a>, <span class="r160 r">path</span>));
                }
                <b>catch</b> (<span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span> <span id="r164 rd" class="r164 r">securityException</span>)
                {
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r164 r">securityException</span>, <span class="r164 r">securityException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r160 r">path</span>));
                }
                <b>catch</b> (<span class="i">UnauthorizedAccessException</span> <span id="r165 rd" class="r165 r">unauthorizedAccess</span>)
                {
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r165 r">unauthorizedAccess</span>, <span class="r165 r">unauthorizedAccess</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r160 r">path</span>));
                }
            }
 
            <b>return</b> <span class="r161 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Moves the specified key.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r166 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path of the key to move.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r167 r">destination</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to move the key to.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="8ca0b628b8bc760b" href="../R/8ca0b628b8bc760b.html" target="n" data-glyph="75,1" class="i method">MoveItem</a>(
            <b>string</b> <span id="r166 rd" class="r166 r">path</span>,
            <b>string</b> <span id="r167 rd" class="r167 r">destination</span>)
        {
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r166 r">path</span>))
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fed5f40dc0075d41" class="i method">NewArgumentException</a>(<b>nameof</b>(<span class="r166 r">path</span>));
            }
 
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r167 r">destination</span>))
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fed5f40dc0075d41" class="i method">NewArgumentException</a>(<b>nameof</b>(<span class="r167 r">destination</span>));
            }
 
            <a href="#c78d8c98bad069ff" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;destination = {0}&quot;</span>, <span class="r167 r">destination</span>);
 
            <span class="c">// Confirm the rename item with the user</span>
 
            <b>string</b> <span id="r168 rd" class="r168 r">action</span> = <span class="i">RegistryProviderStrings</span>.<span class="i">MoveItemAction</span>;
 
            <b>string</b> <span id="r169 rd" class="r169 r">resourceTemplate</span> = <span class="i">RegistryProviderStrings</span>.<span class="i">MoveItemResourceTemplate</span>;
 
            <b>string</b> <span id="r170 rd" class="r170 r">resource</span> =
                <b>string</b>.<span class="i">Format</span>(
                    <a href="ProviderBase.cs.html#be8557754a3bdef0" class="i property">Host</a>.<a href="../engine/hostifaces/MshHost.cs.html#d531244924cf2614" class="i property">CurrentCulture</a>,
                    <span class="r169 r">resourceTemplate</span>,
                    <span class="r166 r">path</span>,
                    <span class="r167 r">destination</span>);
 
            <b>if</b> (<a href="ProviderBase.cs.html#4cb6a9cf0567d153" class="i method">ShouldProcess</a>(<span class="r170 r">resource</span>, <span class="r168 r">action</span>))
            {
                <a href="#b43277e551ec6de3" class="i method">MoveRegistryItem</a>(<span class="r166 r">path</span>, <span class="r167 r">destination</span>);
            }
        }
 
        <b>private void</b> <a id="b43277e551ec6de3" href="../R/b43277e551ec6de3.html" target="n" data-glyph="76,1" class="i method">MoveRegistryItem</a>(<b>string</b> <span id="r171 rd" class="r171 r">path</span>, <b>string</b> <span id="r172 rd" class="r172 r">destination</span>)
        {
            <span class="c">// Implement move by copying the item and then removing it.</span>
            <span class="c">// The copy will write the item to the pipeline</span>
 
            <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r173 rd" class="r173 r">key</span> = <a href="#65df19fb203b78a1" class="i method">GetRegkeyForPathWriteIfError</a>(<span class="r171 r">path</span>, <b>false</b>);
 
            <b>if</b> (<span class="r173 r">key</span> == <b>null</b>)
            {
                <b>return</b>;
            }
 
            <b>bool</b> <span id="r174 rd" class="r174 r">continueWithRemove</span> = <b>false</b>;
            <b>try</b>
            {
                <span class="r174 r">continueWithRemove</span> = <a href="#c614e4471b018f7c" class="i method">CopyRegistryKey</a>(<span class="r173 r">key</span>, <span class="r171 r">path</span>, <span class="r172 r">destination</span>, <b>true</b>, <b>true</b>, <b>true</b>);
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i">IO</span>.<span class="i">IOException</span> <span id="r175 rd" class="r175 r">ioException</span>)
            {
                <span class="c">// An exception occurred while trying to get the key. Write</span>
                <span class="c">// out the error.</span>
 
                <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r175 r">ioException</span>, <span class="r175 r">ioException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#0c2f4b9c74e5b7c2" class="i field">WriteError</a>, <span class="r171 r">path</span>));
                <span class="r173 r">key</span>.<a href="RegistryWrapper.cs.html#7c1978c037f5b66c" class="i method">Close</a>();
                <b>return</b>;
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span> <span id="r176 rd" class="r176 r">securityException</span>)
            {
                <span class="c">// An exception occurred while trying to get the key. Write</span>
                <span class="c">// out the error.</span>
 
                <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r176 r">securityException</span>, <span class="r176 r">securityException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r171 r">path</span>));
                <span class="r173 r">key</span>.<a href="RegistryWrapper.cs.html#7c1978c037f5b66c" class="i method">Close</a>();
                <b>return</b>;
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i">UnauthorizedAccessException</span> <span id="r177 rd" class="r177 r">unauthorizedAccessException</span>)
            {
                <span class="c">// An exception occurred while trying to get the key. Write</span>
                <span class="c">// out the error.</span>
 
                <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r177 r">unauthorizedAccessException</span>, <span class="r177 r">unauthorizedAccessException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r171 r">path</span>));
                <span class="r173 r">key</span>.<a href="RegistryWrapper.cs.html#7c1978c037f5b66c" class="i method">Close</a>();
                <b>return</b>;
            }
 
            <span class="r173 r">key</span>.<a href="RegistryWrapper.cs.html#7c1978c037f5b66c" class="i method">Close</a>();
 
            <b>string</b> <span id="r178 rd" class="r178 r">sourceParent</span> = <a href="#a7fede66d53a4ef7" class="i method">GetParentPath</a>(<span class="r171 r">path</span>, <b>null</b>);
 
            <span class="c">// If the destination is the same container as the source container don&#39;t do remove</span>
            <span class="c">// the source item because the source and destination are the same.</span>
 
            <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<span class="r178 r">sourceParent</span>, <span class="r172 r">destination</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="r174 r">continueWithRemove</span> = <b>false</b>;
            }
 
            <b>if</b> (<span class="r174 r">continueWithRemove</span>)
            {
                <b>try</b>
                {
                    <a href="#539fff15d1cebcf7" class="i method">RemoveItem</a>(<span class="r171 r">path</span>, <b>true</b>);
                }
                <b>catch</b> (<span class="i n">System</span>.<span class="i">IO</span>.<span class="i">IOException</span> <span id="r179 rd" class="r179 r">ioException</span>)
                {
                    <span class="c">// An exception occurred while trying to get the key. Write</span>
                    <span class="c">// out the error.</span>
 
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r179 r">ioException</span>, <span class="r179 r">ioException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#0c2f4b9c74e5b7c2" class="i field">WriteError</a>, <span class="r171 r">path</span>));
                    <b>return</b>;
                }
                <b>catch</b> (<span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span> <span id="r180 rd" class="r180 r">securityException</span>)
                {
                    <span class="c">// An exception occurred while trying to get the key. Write</span>
                    <span class="c">// out the error.</span>
 
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r180 r">securityException</span>, <span class="r180 r">securityException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r171 r">path</span>));
                    <b>return</b>;
                }
                <b>catch</b> (<span class="i n">System</span>.<span class="i">UnauthorizedAccessException</span> <span id="r181 rd" class="r181 r">unauthorizedAccessException</span>)
                {
                    <span class="c">// An exception occurred while trying to get the key. Write</span>
                    <span class="c">// out the error.</span>
 
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r181 r">unauthorizedAccessException</span>, <span class="r181 r">unauthorizedAccessException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r171 r">path</span>));
                    <b>return</b>;
                }
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> NavigationCmdletProvider overrides
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> IPropertyCmdletProvider
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the properties of the item specified by the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r182 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r182 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to the item to retrieve properties from.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r183 r">providerSpecificPickList</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A list of properties that should be retrieved. If this parameter is null</span>
        <span class="c">///</span><span class="c"> or empty, all properties should be retrieved.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Nothing. An instance of PSObject representing the properties that were retrieved</span>
        <span class="c">///</span><span class="c"> should be passed to the WriteObject() method.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public void</b> <a id="b51e0fbf41cd3ccc" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetProperty</a>(
            <b>string</b> <span id="r182 rd" class="r182 r">path</span>,
            <span class="i">Collection</span>&lt;<b>string</b>&gt; <span id="r183 rd" class="r183 r">providerSpecificPickList</span>)
        {
            <b>if</b> (<span class="r182 r">path</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r182 r">path</span>));
            }
 
            <b>if</b> (!<a href="#3da3273886675e19" class="i method">CheckOperationNotAllowedOnHiveContainer</a>(<span class="r182 r">path</span>))
            {
                <b>return</b>;
            }
 
            <span class="c">// get a set of matching properties on the key itself</span>
            <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r184 rd" class="r184 r">key</span>;
            <span class="i">Collection</span>&lt;<b>string</b>&gt; <span id="r185 rd" class="r185 r">filteredPropertyCollection</span>;
            <a href="#45c6e2d0e9e3a30e" class="i method">GetFilteredRegistryKeyProperties</a>(<span class="r182 r">path</span>,
                                            <span class="r183 r">providerSpecificPickList</span>,
                                            <b>true</b>,
                                            <b>false</b>,
                                            <b>out</b> <span class="r184 r">key</span>,
                                            <b>out</b> <span class="r185 r">filteredPropertyCollection</span>);
            <b>if</b> (<span class="r184 r">key</span> == <b>null</b>)
            {
                <b>return</b>;
            }
 
            <b>bool</b> <span id="r186 rd" class="r186 r">valueAdded</span> = <b>false</b>;
            <a href="../engine/MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r187 rd" class="r187 r">propertyResults</span> = <b>new</b> <a href="../engine/MshObject.cs.html#cbbe437e20e8b8b8" class="t constructor">PSObject</a>();
            <b>foreach</b> (<b>string</b> <span id="r188 rd" class="r188 r">valueName</span> <b>in</b> <span class="r185 r">filteredPropertyCollection</span>)
            {
                <b>string</b> <span id="r189 rd" class="r189 r">notePropertyName</span> = <span class="r188 r">valueName</span>;
                <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r188 r">valueName</span>))
                {
                    <span class="c">// If the value name is empty then using &quot;(default)&quot;</span>
                    <span class="c">// as the property name when adding the note, as</span>
                    <span class="c">// PSObject does not allow an empty propertyName</span>
 
                    <span class="r189 r">notePropertyName</span> = <a href="#6b51649572209f2e" class="i property">LocalizedDefaultToken</a>;
                }
 
                <span class="r187 r">propertyResults</span>.<a href="../engine/MshObject.cs.html#59e9cd1ad57ccd34" class="i property">Properties</a>.<a href="../engine/MshMemberInfo.cs.html#a9e3a2dc56d98237" class="i method">Add</a>(<b>new</b> <span class="t">PSNoteProperty</span>(<span class="r189 r">notePropertyName</span>, <span class="r184 r">key</span>.<span class="i">GetValue</span>(<span class="r188 r">valueName</span>)));
                <span class="r186 r">valueAdded</span> = <b>true</b>;
            }
 
            <span class="r184 r">key</span>.<a href="RegistryWrapper.cs.html#7c1978c037f5b66c" class="i method">Close</a>();
 
            <b>if</b> (<span class="r186 r">valueAdded</span>)
            {
                <a href="ProviderBase.cs.html#23d43fdf180baa8e" class="i method">WritePropertyObject</a>(<span class="r187 r">propertyResults</span>, <span class="r182 r">path</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Sets the specified properties of the item at the specified </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r190 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r190 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to the item to set the properties on.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r191 r">propertyValue</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A PSObject which contains a collection of the name, type, value</span>
        <span class="c">///</span><span class="c"> of the properties to be set.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Nothing. An instance of PSObject representing the properties that were set</span>
        <span class="c">///</span><span class="c"> should be passed to the WriteObject() method.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public void</b> <a id="12b05815deb37929" href="../R/12b05815deb37929.html" target="n" data-glyph="72,1" class="i method">SetProperty</a>(
            <b>string</b> <span id="r190 rd" class="r190 r">path</span>,
            <a href="../engine/MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r191 rd" class="r191 r">propertyValue</span>)
        {
            <b>if</b> (<span class="r190 r">path</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r190 r">path</span>));
            }
 
            <b>if</b> (!<a href="#3da3273886675e19" class="i method">CheckOperationNotAllowedOnHiveContainer</a>(<span class="r190 r">path</span>))
            {
                <b>return</b>;
            }
 
            <b>if</b> (<span class="r191 r">propertyValue</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r191 r">propertyValue</span>));
            }
 
            <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r192 rd" class="r192 r">key</span> = <a href="#65df19fb203b78a1" class="i method">GetRegkeyForPathWriteIfError</a>(<span class="r190 r">path</span>, <b>true</b>);
 
            <b>if</b> (<span class="r192 r">key</span> == <b>null</b>)
            {
                <b>return</b>;
            }
 
            <span class="i">RegistryValueKind</span> <span id="r193 rd" class="r193 r">kind</span> = <span class="i">RegistryValueKind</span>.<span class="i">Unknown</span>;
 
            <span class="c">// Get the kind of the value using the dynamic parameters</span>
 
            <b>if</b> (<a href="ProviderBase.cs.html#57d60aa2d2bc908d" class="i property">DynamicParameters</a> != <b>null</b>)
            {
                <a href="#4fe5568fafb46b4c" class="t t">RegistryProviderSetItemDynamicParameter</a> <span id="r194 rd" class="r194 r">dynParams</span> =
                    <a href="ProviderBase.cs.html#57d60aa2d2bc908d" class="i property">DynamicParameters</a> <b>as</b> <a href="#4fe5568fafb46b4c" class="t t">RegistryProviderSetItemDynamicParameter</a>;
 
                <b>if</b> (<span class="r194 r">dynParams</span> != <b>null</b>)
                {
                    <span class="r193 r">kind</span> = <span class="r194 r">dynParams</span>.<a href="#e98a47a65659cb0e" class="i property">Type</a>;
                }
            }
 
            <b>string</b> <span id="r195 rd" class="r195 r">action</span> = <span class="i">RegistryProviderStrings</span>.<span class="i">SetPropertyAction</span>;
 
            <b>string</b> <span id="r196 rd" class="r196 r">resourceTemplate</span> = <span class="i">RegistryProviderStrings</span>.<span class="i">SetPropertyResourceTemplate</span>;
 
            <b>foreach</b> (<a href="../engine/MshMemberInfo.cs.html#fbee845d6706f8da" class="t t">PSMemberInfo</a> <span id="r197 rd" class="r197 r">property</span> <b>in</b> <span class="r191 r">propertyValue</span>.<a href="../engine/MshObject.cs.html#59e9cd1ad57ccd34" class="i property">Properties</a>)
            {
                <b>object</b> <span id="r198 rd" class="r198 r">newPropertyValue</span> = <span class="r197 r">property</span>.<a href="../engine/MshMemberInfo.cs.html#cd3a9989baedf3dd" class="i property">Value</a>;
 
                <b>string</b> <span id="r199 rd" class="r199 r">resource</span> =
                    <b>string</b>.<span class="i">Format</span>(
                        <a href="ProviderBase.cs.html#be8557754a3bdef0" class="i property">Host</a>.<a href="../engine/hostifaces/MshHost.cs.html#d531244924cf2614" class="i property">CurrentCulture</a>,
                        <span class="r196 r">resourceTemplate</span>,
                        <span class="r190 r">path</span>,
                        <span class="r197 r">property</span>.<a href="../engine/MshMemberInfo.cs.html#02d8236d3d236301" class="i property">Name</a>);
 
                <b>if</b> (<a href="ProviderBase.cs.html#4cb6a9cf0567d153" class="i method">ShouldProcess</a>(<span class="r199 r">resource</span>, <span class="r195 r">action</span>))
                {
                    <b>try</b>
                    {
                        <a href="#4221e5e388824541" class="i method">SetRegistryValue</a>(<span class="r192 r">key</span>, <span class="r197 r">property</span>.<a href="../engine/MshMemberInfo.cs.html#02d8236d3d236301" class="i property">Name</a>, <span class="r198 r">newPropertyValue</span>, <span class="r193 r">kind</span>, <span class="r190 r">path</span>);
                    }
                    <b>catch</b> (<span class="i">InvalidCastException</span> <span id="r200 rd" class="r200 r">invalidCast</span>)
                    {
                        <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r200 r">invalidCast</span>, <span class="r200 r">invalidCast</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#0c2f4b9c74e5b7c2" class="i field">WriteError</a>, <span class="r190 r">path</span>));
                    }
                    <b>catch</b> (<span class="i n">System</span>.<span class="i">IO</span>.<span class="i">IOException</span> <span id="r201 rd" class="r201 r">ioException</span>)
                    {
                        <span class="c">// An exception occurred while trying to set the value. Write</span>
                        <span class="c">// out the error.</span>
 
                        <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r201 r">ioException</span>, <span class="r201 r">ioException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#0c2f4b9c74e5b7c2" class="i field">WriteError</a>, <span class="r197 r">property</span>.<a href="../engine/MshMemberInfo.cs.html#02d8236d3d236301" class="i property">Name</a>));
                    }
                    <b>catch</b> (<span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span> <span id="r202 rd" class="r202 r">securityException</span>)
                    {
                        <span class="c">// An exception occurred while trying to set the value. Write</span>
                        <span class="c">// out the error.</span>
 
                        <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r202 r">securityException</span>, <span class="r202 r">securityException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r197 r">property</span>.<a href="../engine/MshMemberInfo.cs.html#02d8236d3d236301" class="i property">Name</a>));
                    }
                    <b>catch</b> (<span class="i n">System</span>.<span class="i">UnauthorizedAccessException</span> <span id="r203 rd" class="r203 r">unauthorizedAccessException</span>)
                    {
                        <span class="c">// An exception occurred while trying to get the key. Write</span>
                        <span class="c">// out the error.</span>
 
                        <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r203 r">unauthorizedAccessException</span>, <span class="r203 r">unauthorizedAccessException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r197 r">property</span>.<a href="../engine/MshMemberInfo.cs.html#02d8236d3d236301" class="i property">Name</a>));
                    }
                }
            }
 
            <span class="r192 r">key</span>.<a href="RegistryWrapper.cs.html#7c1978c037f5b66c" class="i method">Close</a>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gives the provider a chance to attach additional parameters to the</span>
        <span class="c">///</span><span class="c"> get-itemproperty cmdlet.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r204 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the path was specified on the command line, this is the path</span>
        <span class="c">///</span><span class="c"> to the item to get the dynamic parameters for.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r205 r">propertyValue</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A PSObject which contains a collection of the name, type, value</span>
        <span class="c">///</span><span class="c"> of the properties to be set.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An object that has properties and fields decorated with</span>
        <span class="c">///</span><span class="c"> parsing attributes similar to a cmdlet class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public object</b> <a id="eaa9ceac004259bf" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">SetPropertyDynamicParameters</a>(
            <b>string</b> <span id="r204 rd" class="r204 r">path</span>,
            <a href="../engine/MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r205 rd" class="r205 r">propertyValue</span>)
        {
            <b>return</b> <b>new</b> <span class="t">RegistryProviderSetItemDynamicParameter</span>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Clears a property of the item at the specified </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r206 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r206 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to the item on which to clear the property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r207 r">propertyToClear</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The name of the property to clear.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public void</b> <a id="f9de25adae41ab81" href="../R/f9de25adae41ab81.html" target="n" data-glyph="72,1" class="i method">ClearProperty</a>(
            <b>string</b> <span id="r206 rd" class="r206 r">path</span>,
            <span class="i">Collection</span>&lt;<b>string</b>&gt; <span id="r207 rd" class="r207 r">propertyToClear</span>)
        {
            <b>if</b> (<span class="r206 r">path</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r206 r">path</span>));
            }
 
            <b>if</b> (!<a href="#3da3273886675e19" class="i method">CheckOperationNotAllowedOnHiveContainer</a>(<span class="r206 r">path</span>))
            {
                <b>return</b>;
            }
 
            <span class="c">// get a set of matching properties on the key itself</span>
            <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r208 rd" class="r208 r">key</span>;
            <span class="i">Collection</span>&lt;<b>string</b>&gt; <span id="r209 rd" class="r209 r">filteredPropertyCollection</span>;
            <a href="#45c6e2d0e9e3a30e" class="i method">GetFilteredRegistryKeyProperties</a>(<span class="r206 r">path</span>,
                                            <span class="r207 r">propertyToClear</span>,
                                            <b>false</b>,
                                            <b>true</b>,
                                            <b>out</b> <span class="r208 r">key</span>,
                                            <b>out</b> <span class="r209 r">filteredPropertyCollection</span>);
            <b>if</b> (<span class="r208 r">key</span> == <b>null</b>)
            {
                <b>return</b>;
            }
 
            <b>string</b> <span id="r210 rd" class="r210 r">action</span> = <span class="i">RegistryProviderStrings</span>.<span class="i">ClearPropertyAction</span>;
 
            <b>string</b> <span id="r211 rd" class="r211 r">resourceTemplate</span> = <span class="i">RegistryProviderStrings</span>.<span class="i">ClearPropertyResourceTemplate</span>;
 
            <b>bool</b> <span id="r212 rd" class="r212 r">addedOnce</span> = <b>false</b>;
            <a href="../engine/MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r213 rd" class="r213 r">result</span> = <b>new</b> <a href="../engine/MshObject.cs.html#cbbe437e20e8b8b8" class="t constructor">PSObject</a>();
 
            <b>foreach</b> (<b>string</b> <span id="r214 rd" class="r214 r">valueName</span> <b>in</b> <span class="r209 r">filteredPropertyCollection</span>)
            {
                <b>string</b> <span id="r215 rd" class="r215 r">resource</span> =
                <b>string</b>.<span class="i">Format</span>(
                    <a href="ProviderBase.cs.html#be8557754a3bdef0" class="i property">Host</a>.<a href="../engine/hostifaces/MshHost.cs.html#d531244924cf2614" class="i property">CurrentCulture</a>,
                    <span class="r211 r">resourceTemplate</span>,
                    <span class="r206 r">path</span>,
                    <span class="r214 r">valueName</span>);
 
                <b>if</b> (<a href="ProviderBase.cs.html#4cb6a9cf0567d153" class="i method">ShouldProcess</a>(<span class="r215 r">resource</span>, <span class="r210 r">action</span>))
                {
                    <span class="c">// reset the value of the property to its default value</span>
                    <b>object</b> <span id="r216 rd" class="r216 r">defaultValue</span> = <a href="#e39de18f966df5fc" class="i method">ResetRegistryKeyValue</a>(<span class="r208 r">key</span>, <span class="r214 r">valueName</span>);
                    <b>string</b> <span id="r217 rd" class="r217 r">propertyNameToAdd</span> = <span class="r214 r">valueName</span>;
                    <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r214 r">valueName</span>))
                    {
                        <span class="r217 r">propertyNameToAdd</span> = <a href="#6b51649572209f2e" class="i property">LocalizedDefaultToken</a>;
                    }
 
                    <span class="r213 r">result</span>.<a href="../engine/MshObject.cs.html#59e9cd1ad57ccd34" class="i property">Properties</a>.<a href="../engine/MshMemberInfo.cs.html#a9e3a2dc56d98237" class="i method">Add</a>(<b>new</b> <a href="../engine/MshMemberInfo.cs.html#f4e5bccf8ccb9f2a" class="t constructor">PSNoteProperty</a>(<span class="r217 r">propertyNameToAdd</span>, <span class="r216 r">defaultValue</span>));
                    <span class="r212 r">addedOnce</span> = <b>true</b>;
                }
            }
 
            <span class="r208 r">key</span>.<a href="RegistryWrapper.cs.html#7c1978c037f5b66c" class="i method">Close</a>();
 
            <b>if</b> (<span class="r212 r">addedOnce</span>)
            {
                <a href="ProviderBase.cs.html#23d43fdf180baa8e" class="i method">WritePropertyObject</a>(<span class="r213 r">result</span>, <span class="r206 r">path</span>);
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Unimplemented methods
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gives the provider a chance to attach additional parameters to the</span>
        <span class="c">///</span><span class="c"> get-itemproperty cmdlet.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r218 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the path was specified on the command line, this is the path</span>
        <span class="c">///</span><span class="c"> to the item to get the dynamic parameters for.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r219 r">providerSpecificPickList</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A list of properties that should be retrieved. If this parameter is null</span>
        <span class="c">///</span><span class="c"> or empty, all properties should be retrieved.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An object that has properties and fields decorated with</span>
        <span class="c">///</span><span class="c"> parsing attributes similar to a cmdlet class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public object</b> <a id="f22f0fc51f40a6dd" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetPropertyDynamicParameters</a>(
            <b>string</b> <span id="r218 rd" class="r218 r">path</span>,
            <span class="i">Collection</span>&lt;<b>string</b>&gt; <span id="r219 rd" class="r219 r">providerSpecificPickList</span>)
        {
            <b>return</b> <b>null</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gives the provider a chance to attach additional parameters to the</span>
        <span class="c">///</span><span class="c"> clear-itemproperty cmdlet.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r220 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the path was specified on the command line, this is the path</span>
        <span class="c">///</span><span class="c"> to the item to get the dynamic parameters for.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r221 r">propertyToClear</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The name of the property to clear.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An object that has properties and fields decorated with</span>
        <span class="c">///</span><span class="c"> parsing attributes similar to a cmdlet class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public object</b> <a id="d3d246f0d68878fb" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ClearPropertyDynamicParameters</a>(
            <b>string</b> <span id="r220 rd" class="r220 r">path</span>,
            <span class="i">Collection</span>&lt;<b>string</b>&gt; <span id="r221 rd" class="r221 r">propertyToClear</span>)
        {
            <b>return</b> <b>null</b>;
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Unimplemented methods
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> IPropertyCmdletProvider
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> IDynamicPropertyCmdletProvider
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates a new property on the specified item.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r222 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to the item on which the new property should be created.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r223 r">propertyName</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The name of the property that should be created.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r224 r">type</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The type of the property that should be created.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r225 r">value</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The new value of the property that should be created.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Nothing. A PSObject representing the property that was created should</span>
        <span class="c">///</span><span class="c"> be passed to the WriteObject() method.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;!--</span>
        <span class="c">///</span><span class="c"> Implement this method when you are providing access to a data store</span>
        <span class="c">///</span><span class="c"> that allows dynamic creation of properties.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">--&gt;</span>
        <b>public void</b> <a id="eb61f21736a8898f" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">NewProperty</a>(
            <b>string</b> <span id="r222 rd" class="r222 r">path</span>,
            <b>string</b> <span id="r223 rd" class="r223 r">propertyName</span>,
            <b>string</b> <span id="r224 rd" class="r224 r">type</span>,
            <b>object</b> <span id="r225 rd" class="r225 r">value</span>)
        {
            <b>if</b> (<span class="r222 r">path</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r222 r">path</span>));
            }
 
            <b>if</b> (!<a href="#3da3273886675e19" class="i method">CheckOperationNotAllowedOnHiveContainer</a>(<span class="r222 r">path</span>))
            {
                <b>return</b>;
            }
 
            <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r226 rd" class="r226 r">key</span> = <a href="#65df19fb203b78a1" class="i method">GetRegkeyForPathWriteIfError</a>(<span class="r222 r">path</span>, <b>true</b>);
 
            <b>if</b> (<span class="r226 r">key</span> == <b>null</b>)
            {
                <b>return</b>;
            }
 
            <span class="c">// Confirm the set item with the user</span>
 
            <b>string</b> <span id="r227 rd" class="r227 r">action</span> = <span class="i">RegistryProviderStrings</span>.<span class="i">NewPropertyAction</span>;
 
            <b>string</b> <span id="r228 rd" class="r228 r">resourceTemplate</span> = <span class="i">RegistryProviderStrings</span>.<span class="i">NewPropertyResourceTemplate</span>;
 
            <b>string</b> <span id="r229 rd" class="r229 r">resource</span> =
                <b>string</b>.<span class="i">Format</span>(
                    <a href="ProviderBase.cs.html#be8557754a3bdef0" class="i property">Host</a>.<a href="../engine/hostifaces/MshHost.cs.html#d531244924cf2614" class="i property">CurrentCulture</a>,
                    <span class="r228 r">resourceTemplate</span>,
                    <span class="r222 r">path</span>,
                    <span class="r223 r">propertyName</span>);
 
            <b>if</b> (<a href="ProviderBase.cs.html#4cb6a9cf0567d153" class="i method">ShouldProcess</a>(<span class="r229 r">resource</span>, <span class="r227 r">action</span>))
            {
                <span class="c">// convert the type to a RegistryValueKind</span>
                <span class="i">RegistryValueKind</span> <span id="r230 rd" class="r230 r">kind</span>;
                <b>if</b> (!<a href="#38e317bebf0af6b3" class="i method">ParseKind</a>(<span class="r224 r">type</span>, <b>out</b> <span class="r230 r">kind</span>))
                {
                    <span class="r226 r">key</span>.<a href="RegistryWrapper.cs.html#7c1978c037f5b66c" class="i method">Close</a>();
                    <b>return</b>;
                }
 
                <b>try</b>
                {
                    <span class="c">// Check to see if the property already exists</span>
                    <span class="c">// or overwrite if frce is on</span>
                    <b>if</b> (<a href="ProviderBase.cs.html#e3c4d51f13fbfcaa" class="i property">Force</a> || <span class="r226 r">key</span>.<span class="i">GetValue</span>(<span class="r223 r">propertyName</span>) == <b>null</b>)
                    {
                        <span class="c">// Create the value</span>
                        <a href="#4221e5e388824541" class="i method">SetRegistryValue</a>(<span class="r226 r">key</span>, <span class="r223 r">propertyName</span>, <span class="r225 r">value</span>, <span class="r230 r">kind</span>, <span class="r222 r">path</span>);
                    }
                    <b>else</b>
                    {
                        <span class="c">// The property already exists</span>
 
                        <span class="i n">System</span>.<span class="i">IO</span>.<span class="i">IOException</span> <span id="r231 rd" class="r231 r">e</span> =
                            <b>new</b> <span class="i n">System</span>.<span class="i">IO</span>.<span class="i">IOException</span>(
                                <span class="i">RegistryProviderStrings</span>.<span class="i">PropertyAlreadyExists</span>);
                        <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r231 r">e</span>, <span class="r231 r">e</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#22cb3b8b80f740be" class="i field">ResourceExists</a>, <span class="r222 r">path</span>));
                        <span class="r226 r">key</span>.<a href="RegistryWrapper.cs.html#7c1978c037f5b66c" class="i method">Close</a>();
                        <b>return</b>;
                    }
                }
                <b>catch</b> (<span class="i">ArgumentException</span> <span id="r232 rd" class="r232 r">argumentException</span>)
                {
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r232 r">argumentException</span>, <span class="r232 r">argumentException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#0c2f4b9c74e5b7c2" class="i field">WriteError</a>, <span class="r222 r">path</span>));
                }
                <b>catch</b> (<span class="i">InvalidCastException</span> <span id="r233 rd" class="r233 r">invalidCast</span>)
                {
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r233 r">invalidCast</span>, <span class="r233 r">invalidCast</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#0c2f4b9c74e5b7c2" class="i field">WriteError</a>, <span class="r222 r">path</span>));
                }
                <b>catch</b> (<span class="i n">System</span>.<span class="i">IO</span>.<span class="i">IOException</span> <span id="r234 rd" class="r234 r">ioException</span>)
                {
                    <span class="c">// An exception occurred while trying to get the key. Write</span>
                    <span class="c">// out the error.</span>
 
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r234 r">ioException</span>, <span class="r234 r">ioException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#0c2f4b9c74e5b7c2" class="i field">WriteError</a>, <span class="r222 r">path</span>));
                }
                <b>catch</b> (<span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span> <span id="r235 rd" class="r235 r">securityException</span>)
                {
                    <span class="c">// An exception occurred while trying to get the key. Write</span>
                    <span class="c">// out the error.</span>
 
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r235 r">securityException</span>, <span class="r235 r">securityException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r222 r">path</span>));
                }
                <b>catch</b> (<span class="i n">System</span>.<span class="i">UnauthorizedAccessException</span> <span id="r236 rd" class="r236 r">unauthorizedAccessException</span>)
                {
                    <span class="c">// An exception occurred while trying to get the key. Write</span>
                    <span class="c">// out the error.</span>
 
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r236 r">unauthorizedAccessException</span>, <span class="r236 r">unauthorizedAccessException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r222 r">path</span>));
                }
            }
 
            <span class="r226 r">key</span>.<a href="RegistryWrapper.cs.html#7c1978c037f5b66c" class="i method">Close</a>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Removes a property on the item specified by the path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r237 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to the item on which the property should be removed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r238 r">propertyName</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The name of the property to be removed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Implement this method when you are providing access to a data store</span>
        <span class="c">///</span><span class="c"> that allows dynamic removal of properties.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>public void</b> <a id="857d646b8460a77e" href="../R/857d646b8460a77e.html" target="n" data-glyph="72,1" class="i method">RemoveProperty</a>(
            <b>string</b> <span id="r237 rd" class="r237 r">path</span>,
            <b>string</b> <span id="r238 rd" class="r238 r">propertyName</span>)
        {
            <b>if</b> (<span class="r237 r">path</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r237 r">path</span>));
            }
 
            <b>if</b> (!<a href="#3da3273886675e19" class="i method">CheckOperationNotAllowedOnHiveContainer</a>(<span class="r237 r">path</span>))
            {
                <b>return</b>;
            }
 
            <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r239 rd" class="r239 r">key</span> = <a href="#65df19fb203b78a1" class="i method">GetRegkeyForPathWriteIfError</a>(<span class="r237 r">path</span>, <b>true</b>);
 
            <b>if</b> (<span class="r239 r">key</span> == <b>null</b>)
            {
                <b>return</b>;
            }
 
            <a href="../engine/regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a> <span id="r240 rd" class="r240 r">propertyNamePattern</span> =
                <a href="../engine/regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../engine/regex.cs.html#03cc3ceece086129" class="i method">Get</a>(<span class="r238 r">propertyName</span>, <a href="../engine/regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../engine/regex.cs.html#2d0521a6986208d3" class="i field">IgnoreCase</a>);
 
            <b>bool</b> <span id="r241 rd" class="r241 r">hadAMatch</span> = <b>false</b>;
 
            <b>foreach</b> (<b>string</b> <span id="r242 rd" class="r242 r">valueName</span> <b>in</b> <span class="r239 r">key</span>.<a href="RegistryWrapper.cs.html#06b6f0abd2e99fdb" class="i method">GetValueNames</a>())
            {
                <b>if</b> (
                    ((!<a href="ProviderBase.cs.html#70e6bb9df8f94746" class="i property">Context</a>.<a href="CoreCommandContext.cs.html#b9edf955d3776935" class="i property">SuppressWildcardExpansion</a>) &amp;&amp; (!<span class="r240 r">propertyNamePattern</span>.<a href="../engine/regex.cs.html#02e7d1c913f3c256" class="i method">IsMatch</a>(<span class="r242 r">valueName</span>))) ||
                    (<a href="ProviderBase.cs.html#70e6bb9df8f94746" class="i property">Context</a>.<a href="CoreCommandContext.cs.html#b9edf955d3776935" class="i property">SuppressWildcardExpansion</a> &amp;&amp; (!<b>string</b>.<span class="i">Equals</span>(<span class="r242 r">valueName</span>, <span class="r238 r">propertyName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))))
                {
                    <b>continue</b>;
                }
 
                <span class="r241 r">hadAMatch</span> = <b>true</b>;
                <span class="c">// Confirm the set item with the user</span>
 
                <b>string</b> <span id="r243 rd" class="r243 r">action</span> = <span class="i">RegistryProviderStrings</span>.<span class="i">RemovePropertyAction</span>;
 
                <b>string</b> <span id="r244 rd" class="r244 r">resourceTemplate</span> = <span class="i">RegistryProviderStrings</span>.<span class="i">RemovePropertyResourceTemplate</span>;
 
                <b>string</b> <span id="r245 rd" class="r245 r">resource</span> =
                    <b>string</b>.<span class="i">Format</span>(
                        <a href="ProviderBase.cs.html#be8557754a3bdef0" class="i property">Host</a>.<a href="../engine/hostifaces/MshHost.cs.html#d531244924cf2614" class="i property">CurrentCulture</a>,
                        <span class="r244 r">resourceTemplate</span>,
                        <span class="r237 r">path</span>,
                        <span class="r242 r">valueName</span>);
 
                <b>if</b> (<a href="ProviderBase.cs.html#4cb6a9cf0567d153" class="i method">ShouldProcess</a>(<span class="r245 r">resource</span>, <span class="r243 r">action</span>))
                {
                    <b>string</b> <span id="r246 rd" class="r246 r">propertyNameToRemove</span> = <a href="#92a550bda7199bdf" class="i method">GetPropertyName</a>(<span class="r242 r">valueName</span>);
 
                    <b>try</b>
                    {
                        <span class="c">// Remove the value</span>
                        <span class="r239 r">key</span>.<a href="RegistryWrapper.cs.html#1d59298a0843fbfd" class="i method">DeleteValue</a>(<span class="r246 r">propertyNameToRemove</span>);
                    }
                    <b>catch</b> (<span class="i n">System</span>.<span class="i">IO</span>.<span class="i">IOException</span> <span id="r247 rd" class="r247 r">ioException</span>)
                    {
                        <span class="c">// An exception occurred while trying to get the key. Write</span>
                        <span class="c">// out the error.</span>
 
                        <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r247 r">ioException</span>, <span class="r247 r">ioException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#0c2f4b9c74e5b7c2" class="i field">WriteError</a>, <span class="r246 r">propertyNameToRemove</span>));
                    }
                    <b>catch</b> (<span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span> <span id="r248 rd" class="r248 r">securityException</span>)
                    {
                        <span class="c">// An exception occurred while trying to get the key. Write</span>
                        <span class="c">// out the error.</span>
 
                        <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r248 r">securityException</span>, <span class="r248 r">securityException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r246 r">propertyNameToRemove</span>));
                    }
                    <b>catch</b> (<span class="i n">System</span>.<span class="i">UnauthorizedAccessException</span> <span id="r249 rd" class="r249 r">unauthorizedAccessException</span>)
                    {
                        <span class="c">// An exception occurred while trying to get the key. Write</span>
                        <span class="c">// out the error.</span>
 
                        <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r249 r">unauthorizedAccessException</span>, <span class="r249 r">unauthorizedAccessException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r246 r">propertyNameToRemove</span>));
                    }
                }
            }
 
            <span class="r239 r">key</span>.<a href="RegistryWrapper.cs.html#7c1978c037f5b66c" class="i method">Close</a>();
            <a href="#15d573055757335d" class="i method">WriteErrorIfPerfectMatchNotFound</a>(<span class="r241 r">hadAMatch</span>, <span class="r237 r">path</span>, <span class="r238 r">propertyName</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Renames a property of the item at the specified </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r250 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r250 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to the item on which to rename the property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r251 r">sourceProperty</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The property to rename.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r252 r">destinationProperty</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The new name of the property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Nothing. A PSObject that represents the property that was renamed should be</span>
        <span class="c">///</span><span class="c"> passed to the WriteObject() method.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public void</b> <a id="a5977c81b9f8be6b" href="../R/a5977c81b9f8be6b.html" target="n" data-glyph="72,1" class="i method">RenameProperty</a>(
            <b>string</b> <span id="r250 rd" class="r250 r">path</span>,
            <b>string</b> <span id="r251 rd" class="r251 r">sourceProperty</span>,
            <b>string</b> <span id="r252 rd" class="r252 r">destinationProperty</span>)
        {
            <b>if</b> (<span class="r250 r">path</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r250 r">path</span>));
            }
 
            <b>if</b> (!<a href="#3da3273886675e19" class="i method">CheckOperationNotAllowedOnHiveContainer</a>(<span class="r250 r">path</span>))
            {
                <b>return</b>;
            }
 
            <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r253 rd" class="r253 r">key</span> = <a href="#65df19fb203b78a1" class="i method">GetRegkeyForPathWriteIfError</a>(<span class="r250 r">path</span>, <b>true</b>);
 
            <b>if</b> (<span class="r253 r">key</span> == <b>null</b>)
            {
                <b>return</b>;
            }
 
            <span class="c">// Confirm the set item with the user</span>
 
            <b>string</b> <span id="r254 rd" class="r254 r">action</span> = <span class="i">RegistryProviderStrings</span>.<span class="i">RenamePropertyAction</span>;
 
            <b>string</b> <span id="r255 rd" class="r255 r">resourceTemplate</span> = <span class="i">RegistryProviderStrings</span>.<span class="i">RenamePropertyResourceTemplate</span>;
 
            <b>string</b> <span id="r256 rd" class="r256 r">resource</span> =
                <b>string</b>.<span class="i">Format</span>(
                    <a href="ProviderBase.cs.html#be8557754a3bdef0" class="i property">Host</a>.<a href="../engine/hostifaces/MshHost.cs.html#d531244924cf2614" class="i property">CurrentCulture</a>,
                    <span class="r255 r">resourceTemplate</span>,
                    <span class="r250 r">path</span>,
                    <span class="r251 r">sourceProperty</span>,
                    <span class="r252 r">destinationProperty</span>);
 
            <b>if</b> (<a href="ProviderBase.cs.html#4cb6a9cf0567d153" class="i method">ShouldProcess</a>(<span class="r256 r">resource</span>, <span class="r254 r">action</span>))
            {
                <b>try</b>
                {
                    <a href="#64fc5b6161807815" class="i method">MoveProperty</a>(<span class="r253 r">key</span>, <span class="r253 r">key</span>, <span class="r251 r">sourceProperty</span>, <span class="r252 r">destinationProperty</span>);
                }
                <b>catch</b> (<span class="i n">System</span>.<span class="i">IO</span>.<span class="i">IOException</span> <span id="r257 rd" class="r257 r">ioException</span>)
                {
                    <span class="c">// An exception occurred while trying to get the key. Write</span>
                    <span class="c">// out the error.</span>
 
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r257 r">ioException</span>, <span class="r257 r">ioException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#0c2f4b9c74e5b7c2" class="i field">WriteError</a>, <span class="r250 r">path</span>));
                }
                <b>catch</b> (<span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span> <span id="r258 rd" class="r258 r">securityException</span>)
                {
                    <span class="c">// An exception occurred while trying to get the key. Write</span>
                    <span class="c">// out the error.</span>
 
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r258 r">securityException</span>, <span class="r258 r">securityException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r250 r">path</span>));
                }
                <b>catch</b> (<span class="i n">System</span>.<span class="i">UnauthorizedAccessException</span> <span id="r259 rd" class="r259 r">unauthorizedAccessException</span>)
                {
                    <span class="c">// An exception occurred while trying to get the key. Write</span>
                    <span class="c">// out the error.</span>
 
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r259 r">unauthorizedAccessException</span>, <span class="r259 r">unauthorizedAccessException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r250 r">path</span>));
                }
            }
 
            <span class="r253 r">key</span>.<a href="RegistryWrapper.cs.html#7c1978c037f5b66c" class="i method">Close</a>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Copies a property of the item at the specified </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="i">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to a new property on the</span>
        <span class="c">///</span><span class="c"> destination </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="i">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r260 r">sourcePath</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to the item on which to copy the property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r261 r">sourceProperty</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The name of the property to copy.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r262 r">destinationPath</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to the item on which to copy the property to.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r263 r">destinationProperty</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The destination property to copy to.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Nothing. A PSObject that represents the property that was copied should be</span>
        <span class="c">///</span><span class="c"> passed to the WriteObject() method.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public void</b> <a id="752d3a70bc67c346" href="../R/752d3a70bc67c346.html" target="n" data-glyph="72,1" class="i method">CopyProperty</a>(
            <b>string</b> <span id="r260 rd" class="r260 r">sourcePath</span>,
            <b>string</b> <span id="r261 rd" class="r261 r">sourceProperty</span>,
            <b>string</b> <span id="r262 rd" class="r262 r">destinationPath</span>,
            <b>string</b> <span id="r263 rd" class="r263 r">destinationProperty</span>)
        {
            <b>if</b> (<span class="r260 r">sourcePath</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r260 r">sourcePath</span>));
            }
 
            <b>if</b> (<span class="r262 r">destinationPath</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r262 r">destinationPath</span>));
            }
 
            <b>if</b> (!<a href="#05d7c22d7ca3ac09" class="i method">CheckOperationNotAllowedOnHiveContainer</a>(<span class="r260 r">sourcePath</span>, <span class="r262 r">destinationPath</span>))
            {
                <b>return</b>;
            }
 
            <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r264 rd" class="r264 r">key</span> = <a href="#65df19fb203b78a1" class="i method">GetRegkeyForPathWriteIfError</a>(<span class="r260 r">sourcePath</span>, <b>false</b>);
 
            <b>if</b> (<span class="r264 r">key</span> == <b>null</b>)
            {
                <b>return</b>;
            }
 
            <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r265 rd" class="r265 r">destinationKey</span> = <a href="#65df19fb203b78a1" class="i method">GetRegkeyForPathWriteIfError</a>(<span class="r262 r">destinationPath</span>, <b>true</b>);
            <b>if</b> (<span class="r265 r">destinationKey</span> == <b>null</b>)
            {
                <b>return</b>;
            }
 
            <span class="c">// Confirm the set item with the user</span>
 
            <b>string</b> <span id="r266 rd" class="r266 r">action</span> = <span class="i">RegistryProviderStrings</span>.<span class="i">CopyPropertyAction</span>;
 
            <b>string</b> <span id="r267 rd" class="r267 r">resourceTemplate</span> = <span class="i">RegistryProviderStrings</span>.<span class="i">CopyPropertyResourceTemplate</span>;
 
            <b>string</b> <span id="r268 rd" class="r268 r">resource</span> =
                <b>string</b>.<span class="i">Format</span>(
                    <a href="ProviderBase.cs.html#be8557754a3bdef0" class="i property">Host</a>.<a href="../engine/hostifaces/MshHost.cs.html#d531244924cf2614" class="i property">CurrentCulture</a>,
                    <span class="r267 r">resourceTemplate</span>,
                    <span class="r260 r">sourcePath</span>,
                    <span class="r261 r">sourceProperty</span>,
                    <span class="r262 r">destinationPath</span>,
                    <span class="r263 r">destinationProperty</span>);
 
            <b>if</b> (<a href="ProviderBase.cs.html#4cb6a9cf0567d153" class="i method">ShouldProcess</a>(<span class="r268 r">resource</span>, <span class="r266 r">action</span>))
            {
                <b>try</b>
                {
                    <a href="#daf4cfab5ae52367" class="i method">CopyProperty</a>(<span class="r264 r">key</span>, <span class="r265 r">destinationKey</span>, <span class="r261 r">sourceProperty</span>, <span class="r263 r">destinationProperty</span>, <b>true</b>);
                }
                <b>catch</b> (<span class="i n">System</span>.<span class="i">IO</span>.<span class="i">IOException</span> <span id="r269 rd" class="r269 r">ioException</span>)
                {
                    <span class="c">// An exception occurred while trying to get the key. Write</span>
                    <span class="c">// out the error.</span>
 
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r269 r">ioException</span>, <span class="r269 r">ioException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#0c2f4b9c74e5b7c2" class="i field">WriteError</a>, <span class="r260 r">sourcePath</span>));
                }
                <b>catch</b> (<span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span> <span id="r270 rd" class="r270 r">securityException</span>)
                {
                    <span class="c">// An exception occurred while trying to get the key. Write</span>
                    <span class="c">// out the error.</span>
 
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r270 r">securityException</span>, <span class="r270 r">securityException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r260 r">sourcePath</span>));
                }
                <b>catch</b> (<span class="i n">System</span>.<span class="i">UnauthorizedAccessException</span> <span id="r271 rd" class="r271 r">unauthorizedAccessException</span>)
                {
                    <span class="c">// An exception occurred while trying to get the key. Write</span>
                    <span class="c">// out the error.</span>
 
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r271 r">unauthorizedAccessException</span>, <span class="r271 r">unauthorizedAccessException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r260 r">sourcePath</span>));
                }
            }
 
            <span class="r264 r">key</span>.<a href="RegistryWrapper.cs.html#7c1978c037f5b66c" class="i method">Close</a>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Moves a property on an item specified by </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r272 r">sourcePath</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r272 r">sourcePath</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to the item on which to move the property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r273 r">sourceProperty</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The name of the property to move.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r274 r">destinationPath</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to the item on which to move the property to.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r275 r">destinationProperty</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The destination property to move to.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Nothing. A PSObject that represents the property that was moved should be</span>
        <span class="c">///</span><span class="c"> passed to the WriteObject() method.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public void</b> <a id="b770bd6872ac59af" href="../R/b770bd6872ac59af.html" target="n" data-glyph="72,1" class="i method">MoveProperty</a>(
            <b>string</b> <span id="r272 rd" class="r272 r">sourcePath</span>,
            <b>string</b> <span id="r273 rd" class="r273 r">sourceProperty</span>,
            <b>string</b> <span id="r274 rd" class="r274 r">destinationPath</span>,
            <b>string</b> <span id="r275 rd" class="r275 r">destinationProperty</span>)
        {
            <b>if</b> (<span class="r272 r">sourcePath</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r272 r">sourcePath</span>));
            }
 
            <b>if</b> (<span class="r274 r">destinationPath</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r274 r">destinationPath</span>));
            }
 
            <b>if</b> (!<a href="#05d7c22d7ca3ac09" class="i method">CheckOperationNotAllowedOnHiveContainer</a>(<span class="r272 r">sourcePath</span>, <span class="r274 r">destinationPath</span>))
            {
                <b>return</b>;
            }
 
            <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r276 rd" class="r276 r">key</span> = <a href="#65df19fb203b78a1" class="i method">GetRegkeyForPathWriteIfError</a>(<span class="r272 r">sourcePath</span>, <b>true</b>);
 
            <b>if</b> (<span class="r276 r">key</span> == <b>null</b>)
            {
                <b>return</b>;
            }
 
            <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r277 rd" class="r277 r">destinationKey</span> = <a href="#65df19fb203b78a1" class="i method">GetRegkeyForPathWriteIfError</a>(<span class="r274 r">destinationPath</span>, <b>true</b>);
            <b>if</b> (<span class="r277 r">destinationKey</span> == <b>null</b>)
            {
                <b>return</b>;
            }
 
            <span class="c">// Confirm the set item with the user</span>
 
            <b>string</b> <span id="r278 rd" class="r278 r">action</span> = <span class="i">RegistryProviderStrings</span>.<span class="i">MovePropertyAction</span>;
 
            <b>string</b> <span id="r279 rd" class="r279 r">resourceTemplate</span> = <span class="i">RegistryProviderStrings</span>.<span class="i">MovePropertyResourceTemplate</span>;
 
            <b>string</b> <span id="r280 rd" class="r280 r">resource</span> =
                <b>string</b>.<span class="i">Format</span>(
                    <a href="ProviderBase.cs.html#be8557754a3bdef0" class="i property">Host</a>.<a href="../engine/hostifaces/MshHost.cs.html#d531244924cf2614" class="i property">CurrentCulture</a>,
                    <span class="r279 r">resourceTemplate</span>,
                    <span class="r272 r">sourcePath</span>,
                    <span class="r273 r">sourceProperty</span>,
                    <span class="r274 r">destinationPath</span>,
                    <span class="r275 r">destinationProperty</span>);
 
            <b>if</b> (<a href="ProviderBase.cs.html#4cb6a9cf0567d153" class="i method">ShouldProcess</a>(<span class="r280 r">resource</span>, <span class="r278 r">action</span>))
            {
                <b>try</b>
                {
                    <a href="#64fc5b6161807815" class="i method">MoveProperty</a>(<span class="r276 r">key</span>, <span class="r277 r">destinationKey</span>, <span class="r273 r">sourceProperty</span>, <span class="r275 r">destinationProperty</span>);
                }
                <b>catch</b> (<span class="i n">System</span>.<span class="i">IO</span>.<span class="i">IOException</span> <span id="r281 rd" class="r281 r">ioException</span>)
                {
                    <span class="c">// An exception occurred while trying to get the key. Write</span>
                    <span class="c">// out the error.</span>
 
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r281 r">ioException</span>, <span class="r281 r">ioException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#0c2f4b9c74e5b7c2" class="i field">WriteError</a>, <span class="r272 r">sourcePath</span>));
                }
                <b>catch</b> (<span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span> <span id="r282 rd" class="r282 r">securityException</span>)
                {
                    <span class="c">// An exception occurred while trying to get the key. Write</span>
                    <span class="c">// out the error.</span>
 
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r282 r">securityException</span>, <span class="r282 r">securityException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r272 r">sourcePath</span>));
                }
                <b>catch</b> (<span class="i n">System</span>.<span class="i">UnauthorizedAccessException</span> <span id="r283 rd" class="r283 r">unauthorizedAccessException</span>)
                {
                    <span class="c">// An exception occurred while trying to get the key. Write</span>
                    <span class="c">// out the error.</span>
 
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r283 r">unauthorizedAccessException</span>, <span class="r283 r">unauthorizedAccessException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r272 r">sourcePath</span>));
                }
            }
 
            <span class="r276 r">key</span>.<a href="RegistryWrapper.cs.html#7c1978c037f5b66c" class="i method">Close</a>();
            <span class="r277 r">destinationKey</span>.<a href="RegistryWrapper.cs.html#7c1978c037f5b66c" class="i method">Close</a>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the parent path of the given </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r284 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r284 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to get the parent of.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r285 r">root</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The root of the drive.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The parent path of the given path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Since the base class implementation of GetParentPath of HKLM:\foo would return</span>
        <span class="c">///</span><span class="c"> HKLM: we must add the \ back on.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>protected override string</b> <a id="a7fede66d53a4ef7" href="../R/a7fede66d53a4ef7.html" target="n" data-glyph="75,1" class="i method">GetParentPath</a>(<b>string</b> <span id="r284 rd" class="r284 r">path</span>, <b>string</b> <span id="r285 rd" class="r285 r">root</span>)
        {
            <b>string</b> <span id="r286 rd" class="r286 r">parentPath</span> = <a href="NavigationProviderBase.cs.html#7d31476313596b0b" class="k">base</a>.<a href="NavigationProviderBase.cs.html#ae5182f675ef4491" class="i method">GetParentPath</a>(<span class="r284 r">path</span>, <span class="r285 r">root</span>);
 
            <span class="c">// If the main path existed, we must do a semantic analysis</span>
            <span class="c">// to find the parent -- since path elements may contain</span>
            <span class="c">// path delimiters. We only need to do this comparison</span>
            <span class="c">// if the base implementation returns something in our namespace.</span>
            <b>if</b> (!<b>string</b>.<span class="i">Equals</span>(<span class="r286 r">parentPath</span>, <span class="r285 r">root</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <b>bool</b> <span id="r287 rd" class="r287 r">originalPathExists</span> = <a href="#edf415002ed92ac3" class="i method">ItemExists</a>(<span class="r284 r">path</span>);
                <b>bool</b> <span id="r288 rd" class="r288 r">originalPathExistsWithRoot</span> = <b>false</b>;
 
                <span class="c">// This is an expensive test, only do it if we need to.</span>
                <b>if</b> (!<span class="r287 r">originalPathExists</span>)
                    <span class="r288 r">originalPathExistsWithRoot</span> = <a href="#edf415002ed92ac3" class="i method">ItemExists</a>(<a href="NavigationProviderBase.cs.html#6133115f9f4a066d" class="i method">MakePath</a>(<span class="r285 r">root</span>, <span class="r284 r">path</span>));
 
                <b>if</b> ((!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r286 r">parentPath</span>)) &amp;&amp; (<span class="r287 r">originalPathExists</span> || <span class="r288 r">originalPathExistsWithRoot</span>))
                {
                    <b>string</b> <span id="r289 rd" class="r289 r">parentPathToTest</span> = <span class="r286 r">parentPath</span>;
 
                    <b>do</b>
                    {
                        <span class="r289 r">parentPathToTest</span> = <span class="r286 r">parentPath</span>;
                        <b>if</b> (<span class="r288 r">originalPathExistsWithRoot</span>)
                            <span class="r289 r">parentPathToTest</span> = <a href="NavigationProviderBase.cs.html#6133115f9f4a066d" class="i method">MakePath</a>(<span class="r285 r">root</span>, <span class="r286 r">parentPath</span>);
 
                        <b>if</b> (<a href="#edf415002ed92ac3" class="i method">ItemExists</a>(<span class="r289 r">parentPathToTest</span>))
                            <b>break</b>;
 
                        <span class="r286 r">parentPath</span> = <a href="NavigationProviderBase.cs.html#7d31476313596b0b" class="k">base</a>.<a href="NavigationProviderBase.cs.html#ae5182f675ef4491" class="i method">GetParentPath</a>(<span class="r286 r">parentPath</span>, <span class="r285 r">root</span>);
                    } <b>while</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r286 r">parentPath</span>));
                }
            }
 
            <b>return</b> <a href="#d603b8e865efa0a0" class="i method">EnsureDriveIsRooted</a>(<span class="r286 r">parentPath</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the child name for the given </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r290 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r290 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to get the leaf element of.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The leaf element of the given path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Since the base class implementation of GetChildName will return</span>
        <span class="c">///</span><span class="c"> normalized paths (with \), we must change them to forward slashes..</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>protected override string</b> <a id="3497b2446ca4afca" href="../R/3497b2446ca4afca.html" target="n" data-glyph="75,1" class="i method">GetChildName</a>(<b>string</b> <span id="r290 rd" class="r290 r">path</span>)
        {
            <b>string</b> <span id="r291 rd" class="r291 r">childName</span> = <a href="NavigationProviderBase.cs.html#7d31476313596b0b" class="k">base</a>.<a href="NavigationProviderBase.cs.html#dbded73c0d368b0d" class="i method">GetChildName</a>(<span class="r290 r">path</span>);
            <b>return</b> <span class="r291 r">childName</span>.<span class="i">Replace</span>(<span class="s">&#39;\\&#39;</span>, <span class="s">&#39;/&#39;</span>);
        }
 
        <b>private static string</b> <a id="d603b8e865efa0a0" href="../R/d603b8e865efa0a0.html" target="n" data-glyph="76,1" class="i method">EnsureDriveIsRooted</a>(<b>string</b> <span id="r292 rd" class="r292 r">path</span>)
        {
            <b>string</b> <span id="r293 rd" class="r293 r">result</span> = <span class="r292 r">path</span>;
 
            <span class="c">// Find the drive separator</span>
 
            <b>int</b> <span id="r294 rd" class="r294 r">index</span> = <span class="r292 r">path</span>.<span class="i">IndexOf</span>(<span class="s">&#39;:&#39;</span>);
 
            <b>if</b> (<span class="r294 r">index</span> != -1)
            {
                <span class="c">// if the drive separator is the end of the path, add</span>
                <span class="c">// the root path separator back</span>
 
                <b>if</b> (<span class="r294 r">index</span> + 1 == <span class="r292 r">path</span>.<span class="i">Length</span>)
                {
                    <span class="r293 r">result</span> = <span class="r292 r">path</span> + <a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a>;
                }
            }
 
            <b>return</b> <span class="r293 r">result</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Unimplemented methods
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gives the provider a chance to attach additional parameters to the</span>
        <span class="c">///</span><span class="c"> new-itemproperty cmdlet.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r295 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the path was specified on the command line, this is the path</span>
        <span class="c">///</span><span class="c"> to the item to get the dynamic parameters for.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r296 r">propertyName</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The name of the property that should be created.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r297 r">type</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The type of the property that should be created.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r298 r">value</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The new value of the property that should be created.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An object that has properties and fields decorated with</span>
        <span class="c">///</span><span class="c"> parsing attributes similar to a cmdlet class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public object</b> <a id="0d8edb88fc3ebf1c" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">NewPropertyDynamicParameters</a>(
            <b>string</b> <span id="r295 rd" class="r295 r">path</span>,
            <b>string</b> <span id="r296 rd" class="r296 r">propertyName</span>,
            <b>string</b> <span id="r297 rd" class="r297 r">type</span>,
            <b>object</b> <span id="r298 rd" class="r298 r">value</span>)
        {
            <b>return</b> <b>null</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gives the provider a chance to attach additional parameters to the</span>
        <span class="c">///</span><span class="c"> remove-itemproperty cmdlet.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r299 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the path was specified on the command line, this is the path</span>
        <span class="c">///</span><span class="c"> to the item to get the dynamic parameters for.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r300 r">propertyName</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The name of the property that should be removed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An object that has properties and fields decorated with</span>
        <span class="c">///</span><span class="c"> parsing attributes similar to a cmdlet class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public object</b> <a id="cc6ca41329b51c85" href="../R/cc6ca41329b51c85.html" target="n" data-glyph="72,1" class="i method">RemovePropertyDynamicParameters</a>(
            <b>string</b> <span id="r299 rd" class="r299 r">path</span>,
            <b>string</b> <span id="r300 rd" class="r300 r">propertyName</span>)
        {
            <b>return</b> <b>null</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gives the provider a chance to attach additional parameters to the</span>
        <span class="c">///</span><span class="c"> rename-itemproperty cmdlet.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r301 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the path was specified on the command line, this is the path</span>
        <span class="c">///</span><span class="c"> to the item to get the dynamic parameters for.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r302 r">sourceProperty</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The property to rename.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r303 r">destinationProperty</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The new name of the property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An object that has properties and fields decorated with</span>
        <span class="c">///</span><span class="c"> parsing attributes similar to a cmdlet class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public object</b> <a id="8922129e601d8895" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">RenamePropertyDynamicParameters</a>(
            <b>string</b> <span id="r301 rd" class="r301 r">path</span>,
            <b>string</b> <span id="r302 rd" class="r302 r">sourceProperty</span>,
            <b>string</b> <span id="r303 rd" class="r303 r">destinationProperty</span>)
        {
            <b>return</b> <b>null</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gives the provider a chance to attach additional parameters to the</span>
        <span class="c">///</span><span class="c"> copy-itemproperty cmdlet.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r304 r">sourcePath</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the path was specified on the command line, this is the path</span>
        <span class="c">///</span><span class="c"> to the item to get the dynamic parameters for.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r305 r">sourceProperty</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The name of the property to copy.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r306 r">destinationPath</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to the item on which to copy the property to.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r307 r">destinationProperty</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The destination property to copy to.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An object that has properties and fields decorated with</span>
        <span class="c">///</span><span class="c"> parsing attributes similar to a cmdlet class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public object</b> <a id="c4e5a4715d10cac6" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">CopyPropertyDynamicParameters</a>(
            <b>string</b> <span id="r304 rd" class="r304 r">sourcePath</span>,
            <b>string</b> <span id="r305 rd" class="r305 r">sourceProperty</span>,
            <b>string</b> <span id="r306 rd" class="r306 r">destinationPath</span>,
            <b>string</b> <span id="r307 rd" class="r307 r">destinationProperty</span>)
        {
            <b>return</b> <b>null</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gives the provider a chance to attach additional parameters to the</span>
        <span class="c">///</span><span class="c"> move-itemproperty cmdlet.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r308 r">sourcePath</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the path was specified on the command line, this is the path</span>
        <span class="c">///</span><span class="c"> to the item to get the dynamic parameters for.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r309 r">sourceProperty</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The name of the property to copy.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r310 r">destinationPath</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to the item on which to copy the property to.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r311 r">destinationProperty</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The destination property to copy to.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An object that has properties and fields decorated with</span>
        <span class="c">///</span><span class="c"> parsing attributes similar to a cmdlet class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public object</b> <a id="5471d1e5d4e5e229" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">MovePropertyDynamicParameters</a>(
            <b>string</b> <span id="r308 rd" class="r308 r">sourcePath</span>,
            <b>string</b> <span id="r309 rd" class="r309 r">sourceProperty</span>,
            <b>string</b> <span id="r310 rd" class="r310 r">destinationPath</span>,
            <b>string</b> <span id="r311 rd" class="r311 r">destinationProperty</span>)
        {
            <b>return</b> <b>null</b>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Unimplemented methods
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> IDynamicPropertyCmdletProvider
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Private members
 
        <b>private void</b> <a id="daf4cfab5ae52367" href="../R/daf4cfab5ae52367.html" target="n" data-glyph="76,1" class="i method">CopyProperty</a>(
            <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r312 rd" class="r312 r">sourceKey</span>,
            <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r313 rd" class="r313 r">destinationKey</span>,
            <b>string</b> <span id="r314 rd" class="r314 r">sourceProperty</span>,
            <b>string</b> <span id="r315 rd" class="r315 r">destinationProperty</span>,
            <b>bool</b> <span id="r316 rd" class="r316 r">writeOnSuccess</span>)
        {
            <b>string</b> <span id="r317 rd" class="r317 r">realSourceProperty</span> = <a href="#92a550bda7199bdf" class="i method">GetPropertyName</a>(<span class="r314 r">sourceProperty</span>);
            <b>string</b> <span id="r318 rd" class="r318 r">realDestinationProperty</span> = <a href="#92a550bda7199bdf" class="i method">GetPropertyName</a>(<span class="r315 r">destinationProperty</span>);
 
            <b>object</b> <span id="r319 rd" class="r319 r">sourceValue</span> = <span class="r312 r">sourceKey</span>.<span class="i">GetValue</span>(<span class="r314 r">sourceProperty</span>);
            <span class="i">RegistryValueKind</span> <span id="r320 rd" class="r320 r">sourceKind</span> = <span class="r312 r">sourceKey</span>.<span class="i">GetValueKind</span>(<span class="r314 r">sourceProperty</span>);
 
            <span class="r313 r">destinationKey</span>.<span class="i">SetValue</span>(<span class="r315 r">destinationProperty</span>, <span class="r319 r">sourceValue</span>, <span class="r320 r">sourceKind</span>);
 
            <b>if</b> (<span class="r316 r">writeOnSuccess</span>)
            {
                <a href="#7d95e712eb8e02f0" class="i method">WriteWrappedPropertyObject</a>(<span class="r319 r">sourceValue</span>, <span class="r317 r">realSourceProperty</span>, <span class="r312 r">sourceKey</span>.<a href="RegistryWrapper.cs.html#8e86306264fdcf47" class="i property">Name</a>);
            }
        }
 
        <b>private void</b> <a id="64fc5b6161807815" href="../R/64fc5b6161807815.html" target="n" data-glyph="76,1" class="i method">MoveProperty</a>(
            <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r321 rd" class="r321 r">sourceKey</span>,
            <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r322 rd" class="r322 r">destinationKey</span>,
            <b>string</b> <span id="r323 rd" class="r323 r">sourceProperty</span>,
            <b>string</b> <span id="r324 rd" class="r324 r">destinationProperty</span>)
        {
            <b>string</b> <span id="r325 rd" class="r325 r">realSourceProperty</span> = <a href="#92a550bda7199bdf" class="i method">GetPropertyName</a>(<span class="r323 r">sourceProperty</span>);
            <b>string</b> <span id="r326 rd" class="r326 r">realDestinationProperty</span> = <a href="#92a550bda7199bdf" class="i method">GetPropertyName</a>(<span class="r324 r">destinationProperty</span>);
 
            <b>try</b>
            {
                <span class="c">// If sourceProperty and destinationProperty happens to be the same</span>
                <span class="c">// then we shouldn&#39;t remove the property</span>
                <b>bool</b> <span id="r327 rd" class="r327 r">continueWithRemove</span> = <b>true</b>;
 
                <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<span class="r321 r">sourceKey</span>.<a href="RegistryWrapper.cs.html#8e86306264fdcf47" class="i property">Name</a>, <span class="r322 r">destinationKey</span>.<a href="RegistryWrapper.cs.html#8e86306264fdcf47" class="i property">Name</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) &amp;&amp;
                    <b>string</b>.<span class="i">Equals</span>(<span class="r325 r">realSourceProperty</span>, <span class="r326 r">realDestinationProperty</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <span class="r327 r">continueWithRemove</span> = <b>false</b>;
                }
 
                <span class="c">// Move is implemented by copying the value and then deleting the original</span>
                <span class="c">// Copy property will throw an exception if it fails</span>
 
                <a href="#daf4cfab5ae52367" class="i method">CopyProperty</a>(
                    <span class="r321 r">sourceKey</span>,
                    <span class="r322 r">destinationKey</span>,
                    <span class="r325 r">realSourceProperty</span>,
                    <span class="r326 r">realDestinationProperty</span>,
                    <b>false</b>);
 
                <span class="c">// Delete sourceproperty only if it is not same as destination property</span>
                <b>if</b> (<span class="r327 r">continueWithRemove</span>)
                {
                    <span class="r321 r">sourceKey</span>.<a href="RegistryWrapper.cs.html#1d59298a0843fbfd" class="i method">DeleteValue</a>(<span class="r325 r">realSourceProperty</span>);
                }
 
                <b>object</b> <span id="r328 rd" class="r328 r">newValue</span> = <span class="r322 r">destinationKey</span>.<span class="i">GetValue</span>(<span class="r326 r">realDestinationProperty</span>);
                <a href="#7d95e712eb8e02f0" class="i method">WriteWrappedPropertyObject</a>(<span class="r328 r">newValue</span>, <span class="r324 r">destinationProperty</span>, <span class="r322 r">destinationKey</span>.<a href="RegistryWrapper.cs.html#8e86306264fdcf47" class="i property">Name</a>);
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i">IO</span>.<span class="i">IOException</span> <span id="r329 rd" class="r329 r">ioException</span>)
            {
                <span class="c">// An exception occurred while trying to get the key. Write</span>
                <span class="c">// out the error.</span>
 
                <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r329 r">ioException</span>, <span class="r329 r">ioException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#0c2f4b9c74e5b7c2" class="i field">WriteError</a>, <span class="r321 r">sourceKey</span>.<a href="RegistryWrapper.cs.html#8e86306264fdcf47" class="i property">Name</a>));
                <b>return</b>;
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span> <span id="r330 rd" class="r330 r">securityException</span>)
            {
                <span class="c">// An exception occurred while trying to get the key. Write</span>
                <span class="c">// out the error.</span>
 
                <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r330 r">securityException</span>, <span class="r330 r">securityException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r321 r">sourceKey</span>.<a href="RegistryWrapper.cs.html#8e86306264fdcf47" class="i property">Name</a>));
                <b>return</b>;
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i">UnauthorizedAccessException</span> <span id="r331 rd" class="r331 r">unauthorizedAccessException</span>)
            {
                <span class="c">// An exception occurred while trying to get the key. Write</span>
                <span class="c">// out the error.</span>
 
                <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r331 r">unauthorizedAccessException</span>, <span class="r331 r">unauthorizedAccessException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r321 r">sourceKey</span>.<a href="RegistryWrapper.cs.html#8e86306264fdcf47" class="i property">Name</a>));
                <b>return</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Converts all / in the path to \</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r332 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to normalize.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path with all / normalized to \</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private string</b> <a id="0971305882b81414" href="../R/0971305882b81414.html" target="n" data-glyph="76,1" class="i method">NormalizePath</a>(<b>string</b> <span id="r332 rd" class="r332 r">path</span>)
        {
            <b>string</b> <span id="r333 rd" class="r333 r">result</span> = <span class="r332 r">path</span>;
 
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r332 r">path</span>))
            {
                <span class="r333 r">result</span> = <span class="r332 r">path</span>.<span class="i">Replace</span>(<a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#f2548f0f61690656" class="i field">AlternatePathSeparator</a>, <a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a>);
 
                <span class="c">// Remove relative path tokens</span>
                <b>if</b> (<a href="#e06c7075a59c5e5e" class="i method">HasRelativePathTokens</a>(<span class="r332 r">path</span>))
                {
                    <span class="r333 r">result</span> = <a href="NavigationProviderBase.cs.html#30d286c316d0534c" class="i method">NormalizeRelativePath</a>(<span class="r333 r">result</span>, <b>null</b>);
                }
            }
 
            <b>return</b> <span class="r333 r">result</span>;
        }
 
        <b>private static bool</b> <a id="e06c7075a59c5e5e" href="../R/e06c7075a59c5e5e.html" target="n" data-glyph="76,1" class="i method">HasRelativePathTokens</a>(<b>string</b> <span id="r334 rd" class="r334 r">path</span>)
        {
            <b>return</b> (
                <span class="r334 r">path</span>.<span class="i">StartsWith</span>(<span class="s">&#39;\\&#39;</span>) ||
                <span class="r334 r">path</span>.<span class="i">Contains</span>(<span class="s">&quot;\\.\\&quot;</span>) ||
                <span class="r334 r">path</span>.<span class="i">Contains</span>(<span class="s">&quot;\\..\\&quot;</span>) ||
                <span class="r334 r">path</span>.<span class="i">EndsWith</span>(<span class="s">&quot;\\..&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) ||
                <span class="r334 r">path</span>.<span class="i">EndsWith</span>(<span class="s">&quot;\\.&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) ||
                <span class="r334 r">path</span>.<span class="i">StartsWith</span>(<span class="s">&quot;..\\&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) ||
                <span class="r334 r">path</span>.<span class="i">StartsWith</span>(<span class="s">&quot;.\\&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) ||
                <span class="r334 r">path</span>.<span class="i">StartsWith</span>(<span class="s">&#39;~&#39;</span>));
        }
 
        <b>private void</b> <a id="45c6e2d0e9e3a30e" href="../R/45c6e2d0e9e3a30e.html" target="n" data-glyph="76,1" class="i method">GetFilteredRegistryKeyProperties</a>(<b>string</b> <span id="r335 rd" class="r335 r">path</span>,
                                                                    <span class="i">Collection</span>&lt;<b>string</b>&gt; <span id="r336 rd" class="r336 r">propertyNames</span>,
                                                                    <b>bool</b> <span id="r337 rd" class="r337 r">getAll</span>,
                                                                    <b>bool</b> <span id="r338 rd" class="r338 r">writeAccess</span>,
                                                                    <b>out</b> <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r339 rd" class="r339 r">key</span>,
                                                                    <b>out</b> <span class="i">Collection</span>&lt;<b>string</b>&gt; <span id="r340 rd" class="r340 r">filteredCollection</span>)
        {
            <b>bool</b> <span id="r341 rd" class="r341 r">expandAll</span> = <b>false</b>;
 
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r335 r">path</span>))
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fed5f40dc0075d41" class="i method">NewArgumentException</a>(<b>nameof</b>(<span class="r335 r">path</span>));
            }
 
            <span class="r340 r">filteredCollection</span> = <b>new</b> <span class="i">Collection</span>&lt;<b>string</b>&gt;();
            <span class="r339 r">key</span> = <a href="#65df19fb203b78a1" class="i method">GetRegkeyForPathWriteIfError</a>(<span class="r335 r">path</span>, <span class="r338 r">writeAccess</span>);
 
            <b>if</b> (<span class="r339 r">key</span> == <b>null</b>)
            {
                <b>return</b>;
            }
 
            <span class="c">// If properties were not specified, get all the values</span>
 
            <b>if</b> (<span class="r336 r">propertyNames</span> == <b>null</b>)
            {
                <span class="r336 r">propertyNames</span> = <b>new</b> <span class="i">Collection</span>&lt;<b>string</b>&gt;();
            }
 
            <b>if</b> (<span class="r336 r">propertyNames</span>.<span class="i">Count</span> == 0 &amp;&amp; <span class="r337 r">getAll</span>)
            {
                <span class="r336 r">propertyNames</span>.<span class="i">Add</span>(<span class="s">&quot;*&quot;</span>);
                <span class="r341 r">expandAll</span> = <b>true</b>;
            }
 
            <b>string</b>[] <span id="r342 rd" class="r342 r">valueNames</span>;
            <b>try</b>
            {
                <span class="r342 r">valueNames</span> = <span class="r339 r">key</span>.<a href="RegistryWrapper.cs.html#06b6f0abd2e99fdb" class="i method">GetValueNames</a>();
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i">IO</span>.<span class="i">IOException</span> <span id="r343 rd" class="r343 r">ioException</span>)
            {
                <span class="c">// An exception occurred while trying to get the key. Write</span>
                <span class="c">// out the error.</span>
 
                <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r343 r">ioException</span>, <span class="r343 r">ioException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#cad1e0e3e13dc1f3" class="i field">ReadError</a>, <span class="r335 r">path</span>));
                <b>return</b>;
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span> <span id="r344 rd" class="r344 r">securityException</span>)
            {
                <span class="c">// An exception occurred while trying to get the key. Write</span>
                <span class="c">// out the error.</span>
 
                <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r344 r">securityException</span>, <span class="r344 r">securityException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r335 r">path</span>));
                <b>return</b>;
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i">UnauthorizedAccessException</span> <span id="r345 rd" class="r345 r">unauthorizedAccessException</span>)
            {
                <span class="c">// An exception occurred while trying to get the key. Write</span>
                <span class="c">// out the error.</span>
 
                <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r345 r">unauthorizedAccessException</span>, <span class="r345 r">unauthorizedAccessException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r335 r">path</span>));
                <b>return</b>;
            }
 
            <b>foreach</b> (<b>string</b> <span id="r346 rd" class="r346 r">requestedValueName</span> <b>in</b> <span class="r336 r">propertyNames</span>)
            {
                <a href="../engine/regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a> <span id="r347 rd" class="r347 r">valueNameMatcher</span> =
                    <a href="../engine/regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../engine/regex.cs.html#03cc3ceece086129" class="i method">Get</a>(
                        <span class="r346 r">requestedValueName</span>,
 
                        <a href="../engine/regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../engine/regex.cs.html#2d0521a6986208d3" class="i field">IgnoreCase</a>);
 
                <b>bool</b> <span id="r348 rd" class="r348 r">hadAMatch</span> = <b>false</b>;
 
                <b>foreach</b> (<b>string</b> <span id="r349 rd" class="r349 r">valueName</span> <b>in</b> <span class="r342 r">valueNames</span>)
                {
                    <b>string</b> <span id="r350 rd" class="r350 r">valueNameToMatch</span> = <span class="r349 r">valueName</span>;
 
                    <span class="c">// Need to convert the default value name to &quot;(default)&quot;</span>
                    <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r349 r">valueName</span>))
                    {
                        <span class="c">// Only do the conversion if the caller isn&#39;t asking for</span>
                        <span class="c">// &quot;&quot; or null.</span>
 
                        <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r346 r">requestedValueName</span>))
                        {
                            <span class="r350 r">valueNameToMatch</span> = <a href="#6b51649572209f2e" class="i property">LocalizedDefaultToken</a>;
                        }
                    }
 
                    <b>if</b> (
                        <span class="r341 r">expandAll</span> ||
                        ((!<a href="ProviderBase.cs.html#70e6bb9df8f94746" class="i property">Context</a>.<a href="CoreCommandContext.cs.html#b9edf955d3776935" class="i property">SuppressWildcardExpansion</a>) &amp;&amp; (<span class="r347 r">valueNameMatcher</span>.<a href="../engine/regex.cs.html#02e7d1c913f3c256" class="i method">IsMatch</a>(<span class="r350 r">valueNameToMatch</span>))) ||
                       ((<a href="ProviderBase.cs.html#70e6bb9df8f94746" class="i property">Context</a>.<a href="CoreCommandContext.cs.html#b9edf955d3776935" class="i property">SuppressWildcardExpansion</a>) &amp;&amp; (<b>string</b>.<span class="i">Equals</span>(<span class="r350 r">valueNameToMatch</span>, <span class="r346 r">requestedValueName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))))
                    {
                        <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r350 r">valueNameToMatch</span>))
                        {
                            <span class="c">// If the value name is empty then using &quot;(default)&quot;</span>
                            <span class="c">// as the property name when adding the note, as</span>
                            <span class="c">// PSObject does not allow an empty propertyName</span>
 
                            <span class="r350 r">valueNameToMatch</span> = <a href="#6b51649572209f2e" class="i property">LocalizedDefaultToken</a>;
                        }
 
                        <span class="r348 r">hadAMatch</span> = <b>true</b>;
                        <span class="r340 r">filteredCollection</span>.<span class="i">Add</span>(<span class="r349 r">valueName</span>);
                    }
                }
 
                <a href="#15d573055757335d" class="i method">WriteErrorIfPerfectMatchNotFound</a>(<span class="r348 r">hadAMatch</span>, <span class="r335 r">path</span>, <span class="r346 r">requestedValueName</span>);
            }
        }
 
        <b>private void</b> <a id="15d573055757335d" href="../R/15d573055757335d.html" target="n" data-glyph="76,1" class="i method">WriteErrorIfPerfectMatchNotFound</a>(<b>bool</b> <span id="r351 rd" class="r351 r">hadAMatch</span>, <b>string</b> <span id="r352 rd" class="r352 r">path</span>, <b>string</b> <span id="r353 rd" class="r353 r">requestedValueName</span>)
        {
            <b>if</b> (!<span class="r351 r">hadAMatch</span> &amp;&amp; !<a href="../engine/regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../engine/regex.cs.html#f9cf207fdd565080" class="i method">ContainsWildcardCharacters</a>(<span class="r353 r">requestedValueName</span>))
            {
                <span class="c">// we did not have any match and the requested name did not have</span>
                <span class="c">// any globbing characters (perfect match attempted)</span>
                <span class="c">// we need to write an error</span>
 
                <b>string</b> <span id="r354 rd" class="r354 r">formatString</span> = <span class="i">RegistryProviderStrings</span>.<span class="i">PropertyNotAtPath</span>;
                <span class="i">Exception</span> <span id="r355 rd" class="r355 r">e</span> =
                    <b>new</b> <span class="t">PSArgumentException</span>(
                        <b>string</b>.<span class="i">Format</span>(
                            <span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>,
                            <span class="r354 r">formatString</span>,
                            <span class="r353 r">requestedValueName</span>,
                            <span class="r352 r">path</span>),
                        (<span class="i">Exception</span>)<b>null</b>);
                <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(
                    <span class="r355 r">e</span>,
                    <span class="r355 r">e</span>.<span class="i">GetType</span>().<span class="i">FullName</span>,
                    <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#846d2b572f2c4820" class="i field">InvalidArgument</a>,
                    <span class="r353 r">requestedValueName</span>));
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> IT resets the a registry key value to its default.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r356 r">key</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Key whose value has to be reset.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r357 r">valueName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Name of the value to reset.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Default value the key was set to.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private object</b> <a id="e39de18f966df5fc" href="../R/e39de18f966df5fc.html" target="n" data-glyph="76,1" class="i method">ResetRegistryKeyValue</a>(<a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r356 rd" class="r356 r">key</span>, <b>string</b> <span id="r357 rd" class="r357 r">valueName</span>)
        {
            <span class="i">RegistryValueKind</span> <span id="r358 rd" class="r358 r">valueKind</span> = <span class="r356 r">key</span>.<span class="i">GetValueKind</span>(<span class="r357 r">valueName</span>);
            <b>object</b> <span id="r359 rd" class="r359 r">defaultValue</span> = <b>null</b>;
 
            <b>switch</b> (<span class="r358 r">valueKind</span>)
            {
                <span class="c">// NOTICE: we assume that an unknown type is treated as</span>
                <span class="c">// the same as a binary blob</span>
                <b>case</b> <span class="i">RegistryValueKind</span>.<span class="i">Binary</span>:
                <b>case</b> <span class="i">RegistryValueKind</span>.<span class="i">Unknown</span>:
                    {
                        <span class="r359 r">defaultValue</span> = <span class="i">Array</span>.<span class="i">Empty</span>&lt;<b>byte</b>&gt;();
                    }
 
                    <b>break</b>;
                <b>case</b> <span class="i">RegistryValueKind</span>.<span class="i">DWord</span>:
                    {
                        <span class="r359 r">defaultValue</span> = (<b>int</b>)0;
                    }
 
                    <b>break</b>;
                <b>case</b> <span class="i">RegistryValueKind</span>.<span class="i">ExpandString</span>:
                <b>case</b> <span class="i">RegistryValueKind</span>.<span class="i">String</span>:
                    {
                        <span class="r359 r">defaultValue</span> = <b>string</b>.<span class="i">Empty</span>;
                    }
 
                    <b>break</b>;
                <b>case</b> <span class="i">RegistryValueKind</span>.<span class="i">MultiString</span>:
                    {
                        <span class="r359 r">defaultValue</span> = <span class="i">Array</span>.<span class="i">Empty</span>&lt;<b>string</b>&gt;();
                    }
 
                    <b>break</b>;
                <b>case</b> <span class="i">RegistryValueKind</span>.<span class="i">QWord</span>:
                    {
                        <span class="r359 r">defaultValue</span> = (<b>long</b>)0;
                    }
 
                    <b>break</b>;
            }
 
            <b>try</b>
            {
                <span class="r356 r">key</span>.<span class="i">SetValue</span>(<span class="r357 r">valueName</span>, <span class="r359 r">defaultValue</span>, <span class="r358 r">valueKind</span>);
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i">IO</span>.<span class="i">IOException</span> <span id="r360 rd" class="r360 r">ioException</span>)
            {
                <span class="c">// An exception occurred while trying to set the value. Write</span>
                <span class="c">// out the error.</span>
 
                <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r360 r">ioException</span>, <span class="r360 r">ioException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#0c2f4b9c74e5b7c2" class="i field">WriteError</a>, <span class="r357 r">valueName</span>));
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span> <span id="r361 rd" class="r361 r">securityException</span>)
            {
                <span class="c">// An exception occurred while trying to set the value. Write</span>
                <span class="c">// out the error.</span>
 
                <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r361 r">securityException</span>, <span class="r361 r">securityException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r357 r">valueName</span>));
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i">UnauthorizedAccessException</span> <span id="r362 rd" class="r362 r">unauthorizedAccessException</span>)
            {
                <span class="c">// An exception occurred while trying to get the key. Write</span>
                <span class="c">// out the error.</span>
 
                <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r362 r">unauthorizedAccessException</span>, <span class="r362 r">unauthorizedAccessException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r357 r">valueName</span>));
            }
 
            <b>return</b> <span class="r359 r">defaultValue</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Checks if the given path is the top container path (the one containing the hives)</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r363 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> path to check</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> true if the path is empty, a \ or a /, else false</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static bool</b> <a id="f94bb031403ae9d4" href="../R/f94bb031403ae9d4.html" target="n" data-glyph="76,1" class="i method">IsHiveContainer</a>(<b>string</b> <span id="r363 rd" class="r363 r">path</span>)
        {
            <b>bool</b> <span id="r364 rd" class="r364 r">result</span> = <b>false</b>;
            <b>if</b> (<span class="r363 r">path</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r363 r">path</span>));
            }
 
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r363 r">path</span>) ||
                <b>string</b>.<span class="i">Equals</span>(<span class="r363 r">path</span>, <span class="s">&quot;\\&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) ||
                <b>string</b>.<span class="i">Equals</span>(<span class="r363 r">path</span>, <span class="s">&quot;/&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="r364 r">result</span> = <b>true</b>;
            }
 
            <b>return</b> <span class="r364 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Checks the container. if the container is the hive container (Registry::\)</span>
        <span class="c">///</span><span class="c"> it throws an exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r365 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Path to check.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">False if the operation is not allowed.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="3da3273886675e19" href="../R/3da3273886675e19.html" target="n" data-glyph="76,1" class="i method">CheckOperationNotAllowedOnHiveContainer</a>(<b>string</b> <span id="r365 rd" class="r365 r">path</span>)
        {
            <b>if</b> (<a href="#f94bb031403ae9d4" class="i method">IsHiveContainer</a>(<span class="r365 r">path</span>))
            {
                <b>string</b> <span id="r366 rd" class="r366 r">message</span> = <span class="i">RegistryProviderStrings</span>.<span class="i">ContainerInvalidOperationTemplate</span>;
 
                <span class="i">InvalidOperationException</span> <span id="r367 rd" class="r367 r">ex</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r366 r">message</span>);
                <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r367 r">ex</span>, <span class="s">&quot;InvalidContainer&quot;</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#846d2b572f2c4820" class="i field">InvalidArgument</a>, <span class="r365 r">path</span>));
                <b>return</b> <b>false</b>;
            }
 
            <b>return</b> <b>true</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Checks the container. if the container is the hive container (Registry::\)</span>
        <span class="c">///</span><span class="c"> it throws an exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r368 r">sourcePath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Source path to check.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r369 r">destinationPath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Destination path to check.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="05d7c22d7ca3ac09" href="../R/05d7c22d7ca3ac09.html" target="n" data-glyph="76,1" class="i method">CheckOperationNotAllowedOnHiveContainer</a>(<b>string</b> <span id="r368 rd" class="r368 r">sourcePath</span>, <b>string</b> <span id="r369 rd" class="r369 r">destinationPath</span>)
        {
            <b>if</b> (<a href="#f94bb031403ae9d4" class="i method">IsHiveContainer</a>(<span class="r368 r">sourcePath</span>))
            {
                <b>string</b> <span id="r370 rd" class="r370 r">message</span> = <span class="i">RegistryProviderStrings</span>.<span class="i">SourceContainerInvalidOperationTemplate</span>;
                <span class="i">InvalidOperationException</span> <span id="r371 rd" class="r371 r">ex</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r370 r">message</span>);
                <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r371 r">ex</span>, <span class="s">&quot;InvalidContainer&quot;</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#846d2b572f2c4820" class="i field">InvalidArgument</a>, <span class="r368 r">sourcePath</span>));
                <b>return</b> <b>false</b>;
            }
 
            <b>if</b> (<a href="#f94bb031403ae9d4" class="i method">IsHiveContainer</a>(<span class="r369 r">destinationPath</span>))
            {
                <b>string</b> <span id="r372 rd" class="r372 r">message</span> =
                <span class="i">RegistryProviderStrings</span>.<span class="i">DestinationContainerInvalidOperationTemplate</span>;
                <span class="i">InvalidOperationException</span> <span id="r373 rd" class="r373 r">ex</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r372 r">message</span>);
                <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r373 r">ex</span>, <span class="s">&quot;InvalidContainer&quot;</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#846d2b572f2c4820" class="i field">InvalidArgument</a>, <span class="r369 r">destinationPath</span>));
                <b>return</b> <b>false</b>;
            }
 
            <b>return</b> <b>true</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the appropriate hive root name for the specified path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r374 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to get the hive root name from.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A registry key for the hive root specified by the path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private</b> <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <a id="94f0806b961a628c" href="../R/94f0806b961a628c.html" target="n" data-glyph="76,1" class="i method">GetHiveRoot</a>(<b>string</b> <span id="r374 rd" class="r374 r">path</span>)
        {
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r374 r">path</span>))
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fed5f40dc0075d41" class="i method">NewArgumentException</a>(<b>nameof</b>(<span class="r374 r">path</span>));
            }
 
            <b>if</b> (<a href="ProviderBase.cs.html#a0b0091d7add888d" class="i method">TransactionAvailable</a>())
            {
                <b>for</b> (<b>int</b> <span id="r375 rd" class="r375 r">k</span> = 0; <span class="r375 r">k</span> &lt; <a href="#025afee5c708a379" class="i field">s_wellKnownHivesTx</a>.<span class="i">Length</span>; <span class="r375 r">k</span>++)
                {
                    <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<span class="r374 r">path</span>, <a href="#7045e589383555d5" class="i field">s_hiveNames</a>[<span class="r375 r">k</span>], <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) ||
                        <b>string</b>.<span class="i">Equals</span>(<span class="r374 r">path</span>, <a href="#268495a3c021fe9e" class="i field">s_hiveShortNames</a>[<span class="r375 r">k</span>], <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                    {
                        <b>using</b> (<a href="ProviderBase.cs.html#6612d8bf5c6d28d7" class="i property">CurrentPSTransaction</a>)
                        {
                            <b>return</b> <b>new</b> <a href="RegistryWrapper.cs.html#32230c8e08e8dc1d" class="t constructor">TransactedRegistryWrapper</a>(<a href="#025afee5c708a379" class="i field">s_wellKnownHivesTx</a>[<span class="r375 r">k</span>], <a href="../P/92d0bdbab09c8afa.html#92d0bdbab09c8afa" class="k">this</a>);
                        }
                    }
                }
            }
            <b>else</b>
            {
                <b>for</b> (<b>int</b> <span id="r376 rd" class="r376 r">k</span> = 0; <span class="r376 r">k</span> &lt; <a href="#f66b1f5979b44963" class="i field">s_wellKnownHives</a>.<span class="i">Length</span>; <span class="r376 r">k</span>++)
                {
                    <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<span class="r374 r">path</span>, <a href="#7045e589383555d5" class="i field">s_hiveNames</a>[<span class="r376 r">k</span>], <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) ||
                        <b>string</b>.<span class="i">Equals</span>(<span class="r374 r">path</span>, <a href="#268495a3c021fe9e" class="i field">s_hiveShortNames</a>[<span class="r376 r">k</span>], <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                        <b>return</b> <b>new</b> <a href="RegistryWrapper.cs.html#cd6313b99ebb5bad" class="t constructor">RegistryWrapper</a>(<a href="#f66b1f5979b44963" class="i field">s_wellKnownHives</a>[<span class="r376 r">k</span>]);
                }
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates the parent for the keypath specified by </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r377 r">path</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r377 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">RegistryKey path.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> True if key is created or already exist,False otherwise.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This method wont call ShouldProcess. Callers should do this before</span>
        <span class="c">///</span><span class="c"> calling this method.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="e2c024a073823c46" href="../R/e2c024a073823c46.html" target="n" data-glyph="76,1" class="i method">CreateIntermediateKeys</a>(<b>string</b> <span id="r377 rd" class="r377 r">path</span>)
        {
            <b>bool</b> <span id="r378 rd" class="r378 r">result</span> = <b>false</b>;
 
            <span class="c">// Check input.</span>
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r377 r">path</span>))
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fed5f40dc0075d41" class="i method">NewArgumentException</a>(<b>nameof</b>(<span class="r377 r">path</span>));
            }
 
            <b>try</b>
            {
                <span class="c">// 1. Normalize path ( for &quot;//&quot;,&quot;.&quot; etc )</span>
                <span class="c">// 2. Open the root</span>
                <span class="c">// 3. Create subkey</span>
 
                <span class="r377 r">path</span> = <a href="#0971305882b81414" class="i method">NormalizePath</a>(<span class="r377 r">path</span>);
 
                <b>int</b> <span id="r379 rd" class="r379 r">index</span> = <span class="r377 r">path</span>.<span class="i">IndexOf</span>(<span class="s">&#39;\\&#39;</span>);
                <b>if</b> (<span class="r379 r">index</span> == 0)
                {
                    <span class="c">// The user may precede a path with \</span>
                    <span class="r377 r">path</span> = <span class="r377 r">path</span>.<span class="i">Substring</span>(1);
                    <span class="r379 r">index</span> = <span class="r377 r">path</span>.<span class="i">IndexOf</span>(<span class="s">&#39;\\&#39;</span>);
                }
 
                <b>if</b> (<span class="r379 r">index</span> == -1)
                {
                    <span class="c">// we are at root..there is no subkey to create</span>
                    <span class="c">// just return</span>
 
                    <b>return</b> <b>true</b>;
                }
 
                <b>string</b> <span id="r380 rd" class="r380 r">keyRoot</span> = <span class="r377 r">path</span>.<span class="i">Substring</span>(0, <span class="r379 r">index</span>);
 
                <span class="c">// NormalizePath will trim &quot;\&quot; at the end. So there is always something</span>
                <span class="c">// after index. Asserting just in case..</span>
                <span class="i n">Dbg</span>.<a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r379 r">index</span> + 1 &lt; <span class="r377 r">path</span>.<span class="i">Length</span>, <span class="s">&quot;Bad path&quot;</span>);
                <b>string</b> <span id="r381 rd" class="r381 r">remainingPath</span> = <span class="r377 r">path</span>.<span class="i">Substring</span>(<span class="r379 r">index</span> + 1);
 
                <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r382 rd" class="r382 r">rootKey</span> = <a href="#94f0806b961a628c" class="i method">GetHiveRoot</a>(<span class="r380 r">keyRoot</span>);
 
                <b>if</b> (<span class="r381 r">remainingPath</span>.<span class="i">Length</span> == 0 || <span class="r382 r">rootKey</span> == <b>null</b>)
                {
                    <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fed5f40dc0075d41" class="i method">NewArgumentException</a>(<b>nameof</b>(<span class="r377 r">path</span>));
                }
 
                <span class="c">// Create new subkey..and close</span>
                <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r383 rd" class="r383 r">subKey</span> = <span class="r382 r">rootKey</span>.<a href="RegistryWrapper.cs.html#ebdaef77a73f3b70" class="i method">CreateSubKey</a>(<span class="r381 r">remainingPath</span>);
 
                <b>if</b> (<span class="r383 r">subKey</span> != <b>null</b>)
                {
                    <span class="r383 r">subKey</span>.<a href="RegistryWrapper.cs.html#7c1978c037f5b66c" class="i method">Close</a>();
                }
                <b>else</b>
                {
                    <span class="c">// SubKey is null</span>
                    <span class="c">// Unable to create intermediate keys</span>
                    <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fed5f40dc0075d41" class="i method">NewArgumentException</a>(<b>nameof</b>(<span class="r377 r">path</span>));
                }
 
                <span class="r378 r">result</span> = <b>true</b>;
            }
            <b>catch</b> (<span class="i">ArgumentException</span> <span id="r384 rd" class="r384 r">argumentException</span>)
            {
                <span class="c">// An exception occurred while trying to get the key. Write</span>
                <span class="c">// out the error.</span>
                <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r384 r">argumentException</span>, <span class="r384 r">argumentException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#7650567b7604bddc" class="i field">OpenError</a>, <span class="r377 r">path</span>));
                <b>return</b> <span class="r378 r">result</span>;
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i">IO</span>.<span class="i">IOException</span> <span id="r385 rd" class="r385 r">ioException</span>)
            {
                <span class="c">// An exception occurred while trying to get the key. Write</span>
                <span class="c">// out the error.</span>
 
                <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r385 r">ioException</span>, <span class="r385 r">ioException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#7650567b7604bddc" class="i field">OpenError</a>, <span class="r377 r">path</span>));
                <b>return</b> <span class="r378 r">result</span>;
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span> <span id="r386 rd" class="r386 r">securityException</span>)
            {
                <span class="c">// An exception occurred while trying to get the key. Write</span>
                <span class="c">// out the error.</span>
 
                <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r386 r">securityException</span>, <span class="r386 r">securityException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r377 r">path</span>));
                <b>return</b> <span class="r378 r">result</span>;
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i">UnauthorizedAccessException</span> <span id="r387 rd" class="r387 r">unauthorizedAccessException</span>)
            {
                <span class="c">// An exception occurred while trying to get the key. Write</span>
                <span class="c">// out the error.</span>
 
                <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r387 r">unauthorizedAccessException</span>, <span class="r387 r">unauthorizedAccessException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r377 r">path</span>));
                <b>return</b> <span class="r378 r">result</span>;
            }
            <b>catch</b> (<span class="i">NotSupportedException</span> <span id="r388 rd" class="r388 r">notSupportedException</span>)
            {
                <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r388 r">notSupportedException</span>, <span class="r388 r">notSupportedException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>, <span class="r377 r">path</span>));
            }
 
            <b>return</b> <span class="r378 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A private helper method that retrieves a RegistryKey for the specified</span>
        <span class="c">///</span><span class="c"> path and if an exception is thrown retrieving the key, an error is written</span>
        <span class="c">///</span><span class="c"> and null is returned.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r389 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to the registry key to retrieve.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r390 r">writeAccess</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If write access is required the key then this should be true. If false,</span>
        <span class="c">///</span><span class="c"> the key will be opened with read access only.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The RegistryKey associated with the specified path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private</b> <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <a id="65df19fb203b78a1" href="../R/65df19fb203b78a1.html" target="n" data-glyph="76,1" class="i method">GetRegkeyForPathWriteIfError</a>(<b>string</b> <span id="r389 rd" class="r389 r">path</span>, <b>bool</b> <span id="r390 rd" class="r390 r">writeAccess</span>)
        {
            <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r391 rd" class="r391 r">result</span> = <b>null</b>;
            <b>try</b>
            {
                <span class="r391 r">result</span> = <a href="#be7cff769479eaa7" class="i method">GetRegkeyForPath</a>(<span class="r389 r">path</span>, <span class="r390 r">writeAccess</span>);
 
                <b>if</b> (<span class="r391 r">result</span> == <b>null</b>)
                {
                    <span class="c">// The key was not found, write out an error.</span>
 
                    <span class="i">ArgumentException</span> <span id="r392 rd" class="r392 r">exception</span> =
                        <b>new</b> <span class="i">ArgumentException</span>(
                        <span class="i">RegistryProviderStrings</span>.<span class="i">KeyDoesNotExist</span>);
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r392 r">exception</span>, <span class="r392 r">exception</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#846d2b572f2c4820" class="i field">InvalidArgument</a>, <span class="r389 r">path</span>));
 
                    <b>return</b> <b>null</b>;
                }
            }
            <b>catch</b> (<span class="i">ArgumentException</span> <span id="r393 rd" class="r393 r">argumentException</span>)
            {
                <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r393 r">argumentException</span>, <span class="r393 r">argumentException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#7650567b7604bddc" class="i field">OpenError</a>, <span class="r389 r">path</span>));
                <b>return</b> <span class="r391 r">result</span>;
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i">IO</span>.<span class="i">IOException</span> <span id="r394 rd" class="r394 r">ioException</span>)
            {
                <span class="c">// An exception occurred while trying to get the key. Write</span>
                <span class="c">// out the error.</span>
 
                <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r394 r">ioException</span>, <span class="r394 r">ioException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#7650567b7604bddc" class="i field">OpenError</a>, <span class="r389 r">path</span>));
                <b>return</b> <span class="r391 r">result</span>;
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span> <span id="r395 rd" class="r395 r">securityException</span>)
            {
                <span class="c">// An exception occurred while trying to get the key. Write</span>
                <span class="c">// out the error.</span>
 
                <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r395 r">securityException</span>, <span class="r395 r">securityException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r389 r">path</span>));
                <b>return</b> <span class="r391 r">result</span>;
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i">UnauthorizedAccessException</span> <span id="r396 rd" class="r396 r">unauthorizedAccessException</span>)
            {
                <span class="c">// An exception occurred while trying to get the key. Write</span>
                <span class="c">// out the error.</span>
 
                <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r396 r">unauthorizedAccessException</span>, <span class="r396 r">unauthorizedAccessException</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r389 r">path</span>));
                <b>return</b> <span class="r391 r">result</span>;
            }
 
            <b>return</b> <span class="r391 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A private helper method that retrieves a RegistryKey for the specified</span>
        <span class="c">///</span><span class="c"> path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r397 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to the registry key to retrieve.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r398 r">writeAccess</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If write access is required the key then this should be true. If false,</span>
        <span class="c">///</span><span class="c"> the key will be opened with read access only.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The RegistryKey associated with the specified path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private</b> <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <a id="be7cff769479eaa7" href="../R/be7cff769479eaa7.html" target="n" data-glyph="76,1" class="i method">GetRegkeyForPath</a>(<b>string</b> <span id="r397 rd" class="r397 r">path</span>, <b>bool</b> <span id="r398 rd" class="r398 r">writeAccess</span>)
        {
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r397 r">path</span>))
            {
                <span class="c">// The key was not found, write out an error.</span>
 
                <span class="i">ArgumentException</span> <span id="r399 rd" class="r399 r">exception</span> =
                    <b>new</b> <span class="i">ArgumentException</span>(
                    <span class="i">RegistryProviderStrings</span>.<span class="i">KeyDoesNotExist</span>);
                <b>throw</b> <span class="r399 r">exception</span>;
            }
 
            <span class="c">// Making sure to obey the StopProcessing.</span>
            <b>if</b> (<a href="ProviderBase.cs.html#7f198513b75d23b5" class="i property">Stopping</a>)
            {
                <b>return</b> <b>null</b>;
            }
 
            <a href="#c78d8c98bad069ff" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#451d38bf8c2b6b94" class="i method">WriteLine</a>(<span class="s">&quot;writeAccess = {0}&quot;</span>, <span class="r398 r">writeAccess</span>);
 
            <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r400 rd" class="r400 r">result</span> = <b>null</b>;
 
            <b>do</b> <span class="c">// false loop</span>
            {
                <b>int</b> <span id="r401 rd" class="r401 r">index</span> = <span class="r397 r">path</span>.<span class="i">IndexOf</span>(<span class="s">&#39;\\&#39;</span>);
 
                <b>if</b> (<span class="r401 r">index</span> == 0)
                {
                    <span class="c">// The user may proceed a path with \</span>
 
                    <span class="r397 r">path</span> = <span class="r397 r">path</span>.<span class="i">Substring</span>(1);
                    <span class="r401 r">index</span> = <span class="r397 r">path</span>.<span class="i">IndexOf</span>(<span class="s">&#39;\\&#39;</span>);
                }
 
                <b>if</b> (<span class="r401 r">index</span> == -1)
                {
                    <span class="r400 r">result</span> = <a href="#94f0806b961a628c" class="i method">GetHiveRoot</a>(<span class="r397 r">path</span>);
                    <b>break</b>;
                }
 
                <b>string</b> <span id="r402 rd" class="r402 r">keyRoot</span> = <span class="r397 r">path</span>.<span class="i">Substring</span>(0, <span class="r401 r">index</span>);
                <b>string</b> <span id="r403 rd" class="r403 r">remainingPath</span> = <span class="r397 r">path</span>.<span class="i">Substring</span>(<span class="r401 r">index</span> + 1);
 
                <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r404 rd" class="r404 r">resultRoot</span> = <a href="#94f0806b961a628c" class="i method">GetHiveRoot</a>(<span class="r402 r">keyRoot</span>);
 
                <b>if</b> (<span class="r403 r">remainingPath</span>.<span class="i">Length</span> == 0 || <span class="r404 r">resultRoot</span> == <b>null</b>)
                {
                    <span class="r400 r">result</span> = <span class="r404 r">resultRoot</span>;
                    <b>break</b>;
                }
 
                <b>try</b>
                {
                    <span class="r400 r">result</span> = <span class="r404 r">resultRoot</span>.<a href="RegistryWrapper.cs.html#1aec76ace230d7a7" class="i method">OpenSubKey</a>(<span class="r403 r">remainingPath</span>, <span class="r398 r">writeAccess</span>);
                }
                <b>catch</b> (<span class="i">NotSupportedException</span> <span id="r405 rd" class="r405 r">e</span>)
                {
                    <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r405 r">e</span>, <span class="r405 r">e</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>, <span class="r397 r">path</span>));
                }
 
                <span class="c">// If we could not open the key, see if we can find the subkey that matches.</span>
                <b>if</b> (<span class="r400 r">result</span> == <b>null</b>)
                {
                    <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r406 rd" class="r406 r">currentKey</span> = <span class="r404 r">resultRoot</span>;
                    <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r407 rd" class="r407 r">tempKey</span> = <b>null</b>;
 
                    <span class="c">// While there is still more to process</span>
                    <b>while</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r403 r">remainingPath</span>))
                    {
                        <b>bool</b> <span id="r408 rd" class="r408 r">foundSubkey</span> = <b>false</b>;
 
                        <b>foreach</b> (<b>string</b> <span id="r409 rd" class="r409 r">subKey</span> <b>in</b> <span class="r406 r">currentKey</span>.<a href="RegistryWrapper.cs.html#2c4d41c8498d8435" class="i method">GetSubKeyNames</a>())
                        {
                            <b>string</b> <span id="r410 rd" class="r410 r">normalizedSubkey</span> = <span class="r409 r">subKey</span>;
 
                            <span class="c">// Check if the remaining path starts with the subkey name</span>
                            <b>if</b> (!<span class="r403 r">remainingPath</span>.<span class="i">Equals</span>(<span class="r409 r">subKey</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) &amp;&amp;
                                !<span class="r403 r">remainingPath</span>.<span class="i">StartsWith</span>(<span class="r409 r">subKey</span> + <a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                            {
                                <span class="c">// Actually normalize the subkey and then check again</span>
                                <span class="r410 r">normalizedSubkey</span> = <a href="#0971305882b81414" class="i method">NormalizePath</a>(<span class="r409 r">subKey</span>);
 
                                <b>if</b> (!<span class="r403 r">remainingPath</span>.<span class="i">Equals</span>(<span class="r410 r">normalizedSubkey</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) &amp;&amp;
                                    !<span class="r403 r">remainingPath</span>.<span class="i">StartsWith</span>(<span class="r410 r">normalizedSubkey</span> + <a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                                {
                                    <b>continue</b>;
                                }
                            }
 
                            <span class="r407 r">tempKey</span> = <span class="r406 r">currentKey</span>.<a href="RegistryWrapper.cs.html#1aec76ace230d7a7" class="i method">OpenSubKey</a>(<span class="r409 r">subKey</span>, <span class="r398 r">writeAccess</span>);
                            <span class="r406 r">currentKey</span>.<a href="RegistryWrapper.cs.html#7c1978c037f5b66c" class="i method">Close</a>();
                            <span class="r406 r">currentKey</span> = <span class="r407 r">tempKey</span>;
 
                            <span class="r408 r">foundSubkey</span> = <b>true</b>;
 
                            <span class="r403 r">remainingPath</span> = <span class="r403 r">remainingPath</span>.<span class="i">Equals</span>(<span class="r410 r">normalizedSubkey</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)
                                                ? <b>string</b>.<span class="i">Empty</span>
                                                : <span class="r403 r">remainingPath</span>.<span class="i">Substring</span>((<span class="r410 r">normalizedSubkey</span> + <a href="../engine/SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../engine/SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a>).<span class="i">Length</span>);
 
                            <b>break</b>;
                        }
 
                        <b>if</b> (!<span class="r408 r">foundSubkey</span>)
                        {
                            <b>return</b> <b>null</b>;
                        }
                    }
 
                    <b>return</b> <span class="r406 r">currentKey</span>;
                }
            } <b>while</b> (<b>false</b>);
 
            <b>return</b> <span class="r400 r">result</span>;
        }
 
        <span class="c">// NB: The HKEY_DYN_DATA hive is left out of the following lists because</span>
        <span class="c">// it is only available on Win98/ME and we do not support that platform.</span>
 
        <b>private static readonly string</b>[] <a id="7045e589383555d5" href="../R/7045e589383555d5.html" target="n" data-glyph="46,1" class="i field">s_hiveNames</a> = <b>new</b> <b>string</b>[] {
            <span class="s">&quot;HKEY_LOCAL_MACHINE&quot;</span>,
            <span class="s">&quot;HKEY_CURRENT_USER&quot;</span>,
            <span class="s">&quot;HKEY_CLASSES_ROOT&quot;</span>,
            <span class="s">&quot;HKEY_CURRENT_CONFIG&quot;</span>,
            <span class="s">&quot;HKEY_USERS&quot;</span>,
            <span class="s">&quot;HKEY_PERFORMANCE_DATA&quot;</span>
        };
 
        <b>private static readonly string</b>[] <a id="268495a3c021fe9e" href="../R/268495a3c021fe9e.html" target="n" data-glyph="46,1" class="i field">s_hiveShortNames</a> = <b>new</b> <b>string</b>[] {
            <span class="s">&quot;HKLM&quot;</span>,
            <span class="s">&quot;HKCU&quot;</span>,
            <span class="s">&quot;HKCR&quot;</span>,
            <span class="s">&quot;HKCC&quot;</span>,
            <span class="s">&quot;HKU&quot;</span>,
            <span class="s">&quot;HKPD&quot;</span>
        };
 
        <b>private static readonly</b> <span class="i">RegistryKey</span>[] <a id="f66b1f5979b44963" href="../R/f66b1f5979b44963.html" target="n" data-glyph="46,1" class="i field">s_wellKnownHives</a> = <b>new</b> <span class="i">RegistryKey</span>[] {
            <span class="i">Registry</span>.<span class="i">LocalMachine</span>,
            <span class="i">Registry</span>.<span class="i">CurrentUser</span>,
            <span class="i">Registry</span>.<span class="i">ClassesRoot</span>,
            <span class="i">Registry</span>.<span class="i">CurrentConfig</span>,
            <span class="i">Registry</span>.<span class="i">Users</span>,
            <span class="i">Registry</span>.<span class="i">PerformanceData</span>
        };
 
        <b>private static readonly</b> <a href="../CoreCLR/CorePsStub.cs.html#c653e56b410e12c1" class="t t">TransactedRegistryKey</a>[] <a id="025afee5c708a379" href="../R/025afee5c708a379.html" target="n" data-glyph="46,1" class="i field">s_wellKnownHivesTx</a> = <b>new</b> <a href="../CoreCLR/CorePsStub.cs.html#c653e56b410e12c1" class="t t">TransactedRegistryKey</a>[] {
            <a href="../CoreCLR/CorePsStub.cs.html#3fee81b749402c36" class="t t">TransactedRegistry</a>.<a href="../CoreCLR/CorePsStub.cs.html#7a9c731337123c11" class="i field">LocalMachine</a>,
            <a href="../CoreCLR/CorePsStub.cs.html#3fee81b749402c36" class="t t">TransactedRegistry</a>.<a href="../CoreCLR/CorePsStub.cs.html#cec0301a4f4bc63d" class="i field">CurrentUser</a>,
            <a href="../CoreCLR/CorePsStub.cs.html#3fee81b749402c36" class="t t">TransactedRegistry</a>.<a href="../CoreCLR/CorePsStub.cs.html#016022f2463394b9" class="i field">ClassesRoot</a>,
            <a href="../CoreCLR/CorePsStub.cs.html#3fee81b749402c36" class="t t">TransactedRegistry</a>.<a href="../CoreCLR/CorePsStub.cs.html#8b36e4006a02bab7" class="i field">CurrentConfig</a>,
            <a href="../CoreCLR/CorePsStub.cs.html#3fee81b749402c36" class="t t">TransactedRegistry</a>.<a href="../CoreCLR/CorePsStub.cs.html#cb1e43316312d487" class="i field">Users</a>
        };
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Sets or creates a registry value on a key.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r411 r">key</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The key to set or create the value on.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r412 r">propertyName</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The name of the value to set or create.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r413 r">value</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The new data for the value.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r414 r">kind</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The RegistryValueKind of the value.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r415 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to the key that the value is being set on.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="4221e5e388824541" href="../R/4221e5e388824541.html" target="n" data-glyph="76,1" class="i method">SetRegistryValue</a>(<a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r411 rd" class="r411 r">key</span>, <b>string</b> <span id="r412 rd" class="r412 r">propertyName</span>, <b>object</b> <span id="r413 rd" class="r413 r">value</span>, <span class="i">RegistryValueKind</span> <span id="r414 rd" class="r414 r">kind</span>, <b>string</b> <span id="r415 rd" class="r415 r">path</span>)
        {
            <a href="#5bcda0bf8b4c76e7" class="i method">SetRegistryValue</a>(<span class="r411 r">key</span>, <span class="r412 r">propertyName</span>, <span class="r413 r">value</span>, <span class="r414 r">kind</span>, <span class="r415 r">path</span>, <b>true</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Sets or creates a registry value on a key.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r416 r">key</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The key to set or create the value on.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r417 r">propertyName</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The name of the value to set or create.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r418 r">value</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The new data for the value.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r419 r">kind</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The RegistryValueKind of the value.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r420 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to the key that the value is being set on.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r421 r">writeResult</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If true, the value that is set will be written out.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="5bcda0bf8b4c76e7" href="../R/5bcda0bf8b4c76e7.html" target="n" data-glyph="76,1" class="i method">SetRegistryValue</a>(
            <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r416 rd" class="r416 r">key</span>,
            <b>string</b> <span id="r417 rd" class="r417 r">propertyName</span>,
            <b>object</b> <span id="r418 rd" class="r418 r">value</span>,
            <span class="i">RegistryValueKind</span> <span id="r419 rd" class="r419 r">kind</span>,
            <b>string</b> <span id="r420 rd" class="r420 r">path</span>,
            <b>bool</b> <span id="r421 rd" class="r421 r">writeResult</span>)
        {
            <span class="i n">Dbg</span>.<a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(
                <span class="r416 r">key</span> != <b>null</b>,
                <span class="s">&quot;Caller should have verified key&quot;</span>);
 
            <b>string</b> <span id="r422 rd" class="r422 r">propertyNameToSet</span> = <a href="#92a550bda7199bdf" class="i method">GetPropertyName</a>(<span class="r417 r">propertyName</span>);
 
            <span class="i">RegistryValueKind</span> <span id="r423 rd" class="r423 r">existingKind</span> = <span class="i">RegistryValueKind</span>.<span class="i">Unknown</span>;
 
            <span class="c">// If user does not specify a kind: get the valuekind if the property</span>
            <span class="c">// already exists</span>
            <b>if</b> (<span class="r419 r">kind</span> == <span class="i">RegistryValueKind</span>.<span class="i">Unknown</span>)
            {
                <span class="r423 r">existingKind</span> = <a href="#8df181194bdde52d" class="i method">GetValueKindForProperty</a>(<span class="r416 r">key</span>, <span class="r422 r">propertyNameToSet</span>);
            }
 
            <span class="c">// try to do a conversion based on the existing kind, if we</span>
            <span class="c">// were able to retrieve one</span>
            <b>if</b> (<span class="r423 r">existingKind</span> != <span class="i">RegistryValueKind</span>.<span class="i">Unknown</span>)
            {
                <b>try</b>
                {
                    <span class="r418 r">value</span> = <a href="#7aad221725c113b5" class="i method">ConvertValueToKind</a>(<span class="r418 r">value</span>, <span class="r423 r">existingKind</span>);
                    <span class="r419 r">kind</span> = <span class="r423 r">existingKind</span>;
                }
                <b>catch</b> (<span class="i">InvalidCastException</span>)
                {
                    <span class="c">// failed attempt, we reset to unknown to let the</span>
                    <span class="c">// default conversion process take over</span>
                    <span class="r423 r">existingKind</span> = <span class="i">RegistryValueKind</span>.<span class="i">Unknown</span>;
                }
            }
 
            <span class="c">// set the kind as defined by the user</span>
            <b>if</b> (<span class="r423 r">existingKind</span> == <span class="i">RegistryValueKind</span>.<span class="i">Unknown</span>)
            {
                <span class="c">// we use to kind passed in, either because we had</span>
                <span class="c">// a valid one or because we failed to retrieve an existing kind to match</span>
                <b>if</b> (<span class="r419 r">kind</span> == <span class="i">RegistryValueKind</span>.<span class="i">Unknown</span>)
                {
                    <span class="c">// set the kind based on value</span>
                    <b>if</b> (<span class="r418 r">value</span> != <b>null</b>)
                    {
                        <span class="r419 r">kind</span> = <a href="#1b4f3b296e6cfdc9" class="i method">GetValueKindFromObject</a>(<span class="r418 r">value</span>);
                    }
                    <b>else</b>
                    {
                        <span class="c">// if no value and unknown kind, then default to empty string</span>
                        <span class="r419 r">kind</span> = <span class="i">RegistryValueKind</span>.<span class="i">String</span>;
                    }
                }
 
                <span class="r418 r">value</span> = <a href="#7aad221725c113b5" class="i method">ConvertValueToKind</a>(<span class="r418 r">value</span>, <span class="r419 r">kind</span>);
            }
 
            <span class="r416 r">key</span>.<span class="i">SetValue</span>(<span class="r422 r">propertyNameToSet</span>, <span class="r418 r">value</span>, <span class="r419 r">kind</span>);
 
            <b>if</b> (<span class="r421 r">writeResult</span>)
            {
                <span class="c">// Now write out the value</span>
                <b>object</b> <span id="r424 rd" class="r424 r">newValue</span> = <span class="r416 r">key</span>.<span class="i">GetValue</span>(<span class="r422 r">propertyNameToSet</span>);
 
                <a href="#7d95e712eb8e02f0" class="i method">WriteWrappedPropertyObject</a>(<span class="r424 r">newValue</span>, <span class="r417 r">propertyName</span>, <span class="r420 r">path</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Helper to wrap property values when sent to the pipeline into an PSObject;</span>
        <span class="c">///</span><span class="c"> it adds the name of the property as a note.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r425 r">value</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The property to be written.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r426 r">propertyName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Name of the property being written.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r427 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The path of the item being written.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="7d95e712eb8e02f0" href="../R/7d95e712eb8e02f0.html" target="n" data-glyph="76,1" class="i method">WriteWrappedPropertyObject</a>(<b>object</b> <span id="r425 rd" class="r425 r">value</span>, <b>string</b> <span id="r426 rd" class="r426 r">propertyName</span>, <b>string</b> <span id="r427 rd" class="r427 r">path</span>)
        {
            <a href="../engine/MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r428 rd" class="r428 r">result</span> = <b>new</b> <a href="../engine/MshObject.cs.html#cbbe437e20e8b8b8" class="t constructor">PSObject</a>();
 
            <b>string</b> <span id="r429 rd" class="r429 r">propertyNameToAdd</span> = <span class="r426 r">propertyName</span>;
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r426 r">propertyName</span>))
            {
                <span class="r429 r">propertyNameToAdd</span> = <a href="#6b51649572209f2e" class="i property">LocalizedDefaultToken</a>;
            }
 
            <span class="r428 r">result</span>.<a href="../engine/MshObject.cs.html#59e9cd1ad57ccd34" class="i property">Properties</a>.<a href="../engine/MshMemberInfo.cs.html#a9e3a2dc56d98237" class="i method">Add</a>(<b>new</b> <a href="../engine/MshMemberInfo.cs.html#f4e5bccf8ccb9f2a" class="t constructor">PSNoteProperty</a>(<span class="r429 r">propertyNameToAdd</span>, <span class="r425 r">value</span>));
 
            <a href="ProviderBase.cs.html#23d43fdf180baa8e" class="i method">WritePropertyObject</a>(<span class="r428 r">result</span>, <span class="r427 r">path</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Uses LanguagePrimitives.ConvertTo to convert the value to the type that is appropriate</span>
        <span class="c">///</span><span class="c"> for the specified RegistryValueKind.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r430 r">value</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The value to convert.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r431 r">kind</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The RegistryValueKind type to convert the value to.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The converted value.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static object</b> <a id="7aad221725c113b5" href="../R/7aad221725c113b5.html" target="n" data-glyph="76,1" class="i method">ConvertValueToKind</a>(<b>object</b> <span id="r430 rd" class="r430 r">value</span>, <span class="i">RegistryValueKind</span> <span id="r431 rd" class="r431 r">kind</span>)
        {
            <b>switch</b> (<span class="r431 r">kind</span>)
            {
                <b>case</b> <span class="i">RegistryValueKind</span>.<span class="i">Binary</span>:
                    <span class="r430 r">value</span> = (<span class="r430 r">value</span> != <b>null</b>)
                        ? (<b>byte</b>[])<a href="../engine/LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">ConvertTo</span>(
                            <span class="r430 r">value</span>,
                            <b>typeof</b>(<b>byte</b>[]),
                            <span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>)
                        : <span class="i">Array</span>.<span class="i">Empty</span>&lt;<b>byte</b>&gt;();
                    <b>break</b>;
 
                <b>case</b> <span class="i">RegistryValueKind</span>.<span class="i">DWord</span>:
                    {
                        <b>if</b> (<span class="r430 r">value</span> != <b>null</b>)
                        {
                            <b>try</b>
                            {
                                <span class="r430 r">value</span> = (<b>int</b>)<a href="../engine/LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">ConvertTo</span>(<span class="r430 r">value</span>, <b>typeof</b>(<b>int</b>), <span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>);
                            }
                            <b>catch</b> (<a href="../engine/ExtendedTypeSystemException.cs.html#d39d66bdddfa507c" class="t t">PSInvalidCastException</a>)
                            {
                                <span class="r430 r">value</span> = (<span class="i">UInt32</span>)<a href="../engine/LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">ConvertTo</span>(<span class="r430 r">value</span>, <b>typeof</b>(<span class="i">UInt32</span>), <span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>);
                            }
                        }
                        <b>else</b>
                        {
                            <span class="r430 r">value</span> = 0;
                        }
                    }
 
                    <b>break</b>;
 
                <b>case</b> <span class="i">RegistryValueKind</span>.<span class="i">ExpandString</span>:
                    <span class="r430 r">value</span> = (<span class="r430 r">value</span> != <b>null</b>)
                        ? (<b>string</b>)<a href="../engine/LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">ConvertTo</span>(
                            <span class="r430 r">value</span>,
                            <b>typeof</b>(<b>string</b>),
                            <span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>)
                        : <b>string</b>.<span class="i">Empty</span>;
                    <b>break</b>;
 
                <b>case</b> <span class="i">RegistryValueKind</span>.<span class="i">MultiString</span>:
                    <span class="r430 r">value</span> = (<span class="r430 r">value</span> != <b>null</b>)
                        ? (<b>string</b>[])<a href="../engine/LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">ConvertTo</span>(
                            <span class="r430 r">value</span>,
                            <b>typeof</b>(<b>string</b>[]),
                            <span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>)
                        : <span class="i">Array</span>.<span class="i">Empty</span>&lt;<b>string</b>&gt;();
                    <b>break</b>;
 
                <b>case</b> <span class="i">RegistryValueKind</span>.<span class="i">QWord</span>:
                    {
                        <b>if</b> (<span class="r430 r">value</span> != <b>null</b>)
                        {
                            <b>try</b>
                            {
                                <span class="r430 r">value</span> = (<b>long</b>)<a href="../engine/LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">ConvertTo</span>(<span class="r430 r">value</span>, <b>typeof</b>(<b>long</b>), <span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>);
                            }
                            <b>catch</b> (<a href="../engine/ExtendedTypeSystemException.cs.html#d39d66bdddfa507c" class="t t">PSInvalidCastException</a>)
                            {
                                <span class="r430 r">value</span> = (<span class="i">UInt64</span>)<a href="../engine/LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">ConvertTo</span>(<span class="r430 r">value</span>, <b>typeof</b>(<span class="i">UInt64</span>), <span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>);
                            }
                        }
                        <b>else</b>
                        {
                            <span class="r430 r">value</span> = 0;
                        }
                    }
 
                    <b>break</b>;
 
                <b>case</b> <span class="i">RegistryValueKind</span>.<span class="i">String</span>:
                    <span class="r430 r">value</span> = (<span class="r430 r">value</span> != <b>null</b>)
                        ? (<b>string</b>)<a href="../engine/LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">ConvertTo</span>(
                            <span class="r430 r">value</span>,
                            <b>typeof</b>(<b>string</b>),
                            <span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>)
                        : <b>string</b>.<span class="i">Empty</span>;
                    <b>break</b>;
 
                    <span class="c">// If kind is Unknown then just leave the value as-is.</span>
            }
 
            <b>return</b> <span class="r430 r">value</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Helper to infer the RegistryValueKind from an object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r432 r">value</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Object whose RegistryValueKind has to be determined.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Corresponding RegistryValueKind.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static</b> <span class="i">RegistryValueKind</span> <a id="1b4f3b296e6cfdc9" href="../R/1b4f3b296e6cfdc9.html" target="n" data-glyph="76,1" class="i method">GetValueKindFromObject</a>(<b>object</b> <span id="r432 rd" class="r432 r">value</span>)
        {
            <b>if</b> (<span class="r432 r">value</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r432 r">value</span>));
            }
 
            <span class="i">RegistryValueKind</span> <span id="r433 rd" class="r433 r">result</span> = <span class="i">RegistryValueKind</span>.<span class="i">Unknown</span>;
 
            <span class="i">Type</span> <span id="r434 rd" class="r434 r">valueType</span> = <span class="r432 r">value</span>.<span class="i">GetType</span>();
            <b>if</b> (<span class="r434 r">valueType</span> == <b>typeof</b>(<b>byte</b>[]))
            {
                <span class="r433 r">result</span> = <span class="i">RegistryValueKind</span>.<span class="i">Binary</span>;
            }
            <b>else</b> <b>if</b> (<span class="r434 r">valueType</span> == <b>typeof</b>(<b>int</b>))
            {
                <span class="r433 r">result</span> = <span class="i">RegistryValueKind</span>.<span class="i">DWord</span>;
            }
 
            <b>if</b> (<span class="r434 r">valueType</span> == <b>typeof</b>(<b>string</b>))
            {
                <span class="r433 r">result</span> = <span class="i">RegistryValueKind</span>.<span class="i">String</span>;
            }
 
            <b>if</b> (<span class="r434 r">valueType</span> == <b>typeof</b>(<b>string</b>[]))
            {
                <span class="r433 r">result</span> = <span class="i">RegistryValueKind</span>.<span class="i">MultiString</span>;
            }
 
            <b>if</b> (<span class="r434 r">valueType</span> == <b>typeof</b>(<b>long</b>))
            {
                <span class="r433 r">result</span> = <span class="i">RegistryValueKind</span>.<span class="i">QWord</span>;
            }
 
            <b>return</b> <span class="r433 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Helper to get RegistryValueKind for a Property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r435 r">key</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">RegistryKey containing property.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r436 r">valueName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Property for which RegistryValueKind is requested.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">RegistryValueKind of the property. If the property does not exit,returns RegistryValueKind.Unknown.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static</b> <span class="i">RegistryValueKind</span> <a id="8df181194bdde52d" href="../R/8df181194bdde52d.html" target="n" data-glyph="76,1" class="i method">GetValueKindForProperty</a>(<a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r435 rd" class="r435 r">key</span>, <b>string</b> <span id="r436 rd" class="r436 r">valueName</span>)
        {
            <b>try</b>
            {
                <b>return</b> <span class="r435 r">key</span>.<span class="i">GetValueKind</span>(<span class="r436 r">valueName</span>);
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i">ArgumentException</span>)
            {
                <span class="c">// RegistryKey that contains the specified value does not exist</span>
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i">IO</span>.<span class="i">IOException</span>)
            {
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span>)
            {
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i">UnauthorizedAccessException</span>)
            {
            }
 
            <b>return</b> <span class="i">RegistryValueKind</span>.<span class="i">Unknown</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Helper to read back an existing registry key value.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r437 r">key</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Key to read the value from.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r438 r">valueName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Name of the value to read.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Value of the key, null if it could not retrieve</span>
        <span class="c">///</span><span class="c"> it because known exceptions were thrown, else an exception is percolated up</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static object</b> <a id="d94f15e5a20da89d" href="../R/d94f15e5a20da89d.html" target="n" data-glyph="76,1" class="i method">ReadExistingKeyValue</a>(<a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r437 rd" class="r437 r">key</span>, <b>string</b> <span id="r438 rd" class="r438 r">valueName</span>)
        {
            <b>try</b>
            {
                <span class="c">// Since SetValue can munge the data to a specified</span>
                <span class="c">// type (RegistryValueKind), retrieve the value again</span>
                <span class="c">// to output it in the correct form to the user.</span>
 
                <b>return</b> <span class="r437 r">key</span>.<span class="i">GetValue</span>(<span class="r438 r">valueName</span>, <b>null</b>, <span class="i">RegistryValueOptions</span>.<span class="i">DoNotExpandEnvironmentNames</span>);
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i">IO</span>.<span class="i">IOException</span>)
            {
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span>)
            {
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i">UnauthorizedAccessException</span>)
            {
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Wraps a registry item in a PSObject and sets the TreatAs to</span>
        <span class="c">///</span><span class="c"> Microsoft.Win32.RegistryKey. This way values will be presented</span>
        <span class="c">///</span><span class="c"> in the same format as keys.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r439 r">key</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The registry key to be written out.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r440 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to the item being written out.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="b1dbe0e69487f77f" href="../R/b1dbe0e69487f77f.html" target="n" data-glyph="76,1" class="i method">WriteRegistryItemObject</a>(
            <a href="RegistryWrapper.cs.html#7f29e38690d775d9" class="t t">IRegistryWrapper</a> <span id="r439 rd" class="r439 r">key</span>,
            <b>string</b> <span id="r440 rd" class="r440 r">path</span>)
        {
            <b>if</b> (<span class="r439 r">key</span> == <b>null</b>)
            {
                <span class="i n">Dbg</span>.<a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(
                    <span class="r439 r">key</span> != <b>null</b>,
                    <span class="s">&quot;The RegistryProvider should never attempt to write out a null value&quot;</span>);
 
                <span class="c">// Don&#39;t error, but don&#39;t write out anything either.</span>
                <b>return</b>;
            }
 
            <span class="c">// Escape any wildcard characters in the path</span>
            <span class="r440 r">path</span> = <a href="#26aed69c2c9d86d0" class="i method">EscapeSpecialChars</a>(<span class="r440 r">path</span>);
 
            <span class="c">// Wrap the key in an PSObject</span>
            <a href="../engine/MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r441 rd" class="r441 r">outputObject</span> = <a href="../engine/MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../engine/MshObject.cs.html#e81a321a846beda7" class="i method">AsPSObject</a>(<span class="r439 r">key</span>.<a href="RegistryWrapper.cs.html#c5a25a5f7e49bd26" class="i property">RegistryKey</a>);
 
            <span class="c">// Add the registry values to the PSObject</span>
            <b>string</b>[] <span id="r442 rd" class="r442 r">valueNames</span> = <span class="r439 r">key</span>.<a href="RegistryWrapper.cs.html#06b6f0abd2e99fdb" class="i method">GetValueNames</a>();
 
            <b>for</b> (<b>int</b> <span id="r443 rd" class="r443 r">index</span> = 0; <span class="r443 r">index</span> &lt; <span class="r442 r">valueNames</span>.<span class="i">Length</span>; ++<span class="r443 r">index</span>)
            {
                <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r442 r">valueNames</span>[<span class="r443 r">index</span>]))
                {
                    <span class="c">// The first unnamed value becomes the default value</span>
                    <span class="r442 r">valueNames</span>[<span class="r443 r">index</span>] = <a href="#6b51649572209f2e" class="i property">LocalizedDefaultToken</a>;
                    <b>break</b>;
                }
            }
 
            <span class="r441 r">outputObject</span>.<a href="../engine/MshObject.cs.html#3391974db863bbc1" class="i method">AddOrSetProperty</a>(<span class="s">&quot;Property&quot;</span>, <span class="r442 r">valueNames</span>);
 
            <a href="ProviderBase.cs.html#ed0f1f879dd50c77" class="i method">WriteItemObject</a>(<span class="r441 r">outputObject</span>, <span class="r440 r">path</span>, <b>true</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Takes a string and tries to parse it into a RegistryValueKind enum</span>
        <span class="c">///</span><span class="c"> type.</span>
        <span class="c">///</span><span class="c"> If the conversion fails, WriteError() is called.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r444 r">type</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The type as specified by the user that should be parsed into a RegistryValueKind enum.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r445 r">kind</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Output for the RegistryValueKind for the string.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> true if the conversion succeeded</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="38e317bebf0af6b3" href="../R/38e317bebf0af6b3.html" target="n" data-glyph="76,1" class="i method">ParseKind</a>(<b>string</b> <span id="r444 rd" class="r444 r">type</span>, <b>out</b> <span class="i">RegistryValueKind</span> <span id="r445 rd" class="r445 r">kind</span>)
        {
            <span class="r445 r">kind</span> = <span class="i">RegistryValueKind</span>.<span class="i">Unknown</span>;
 
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r444 r">type</span>))
            {
                <b>return</b> <b>true</b>;
            }
 
            <b>bool</b> <span id="r446 rd" class="r446 r">success</span> = <b>true</b>;
            <span class="i">Exception</span> <span id="r447 rd" class="r447 r">innerException</span> = <b>null</b>;
            <b>try</b>
            {
                <span class="c">// Convert the parameter to a RegistryValueKind</span>
                <span class="r445 r">kind</span> = (<span class="i">RegistryValueKind</span>)<span class="i">Enum</span>.<span class="i">Parse</span>(<b>typeof</b>(<span class="i">RegistryValueKind</span>), <span class="r444 r">type</span>, <b>true</b>);
            }
            <b>catch</b> (<span class="i">InvalidCastException</span> <span id="r448 rd" class="r448 r">invalidCast</span>)
            {
                <span class="r447 r">innerException</span> = <span class="r448 r">invalidCast</span>;
            }
            <b>catch</b> (<span class="i">ArgumentException</span> <span id="r449 rd" class="r449 r">argException</span>)
            {
                <span class="r447 r">innerException</span> = <span class="r449 r">argException</span>;
            }
 
            <b>if</b> (<span class="r447 r">innerException</span> != <b>null</b>)
            {
                <span class="r446 r">success</span> = <b>false</b>;
 
                <b>string</b> <span id="r450 rd" class="r450 r">formatString</span> =
                    <span class="i">RegistryProviderStrings</span>.<span class="i">TypeParameterBindingFailure</span>;
                <span class="i">Exception</span> <span id="r451 rd" class="r451 r">e</span> =
                    <b>new</b> <span class="i">ArgumentException</span>(
                        <b>string</b>.<span class="i">Format</span>(
                            <span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>,
                            <span class="r450 r">formatString</span>,
                            <span class="r444 r">type</span>,
                            <b>typeof</b>(<span class="i">RegistryValueKind</span>).<span class="i">FullName</span>),
                        <span class="r447 r">innerException</span>);
                <a href="ProviderBase.cs.html#83bb4484e6f0cc5d" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(
                    <span class="r451 r">e</span>,
                    <span class="r451 r">e</span>.<span class="i">GetType</span>().<span class="i">FullName</span>,
                    <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#846d2b572f2c4820" class="i field">InvalidArgument</a>,
                    <span class="r444 r">type</span>));
            }
 
            <b>return</b> <span class="r446 r">success</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the default value name token from the resource.</span>
        <span class="c">///</span><span class="c"> In English that token is &quot;(default)&quot; without the quotes.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This should not be localized as it will break scripts.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A string containing the default value name.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static string</b> <a id="6b51649572209f2e" href="../R/6b51649572209f2e.html" target="n" data-glyph="106,1" class="i property">LocalizedDefaultToken</a> =&gt; <span class="s">&quot;(default)&quot;</span>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Converts an empty or null userEnteredPropertyName to the localized</span>
        <span class="c">///</span><span class="c"> string for the default property name.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r452 r">userEnteredPropertyName</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The property name to convert.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If userEnteredPropertyName is null or empty, the localized default</span>
        <span class="c">///</span><span class="c"> property name is returned, else the userEnteredPropertyName is returned.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private string</b> <a id="92a550bda7199bdf" href="../R/92a550bda7199bdf.html" target="n" data-glyph="76,1" class="i method">GetPropertyName</a>(<b>string</b> <span id="r452 rd" class="r452 r">userEnteredPropertyName</span>)
        {
            <b>string</b> <span id="r453 rd" class="r453 r">result</span> = <span class="r452 r">userEnteredPropertyName</span>;
 
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r452 r">userEnteredPropertyName</span>))
            {
                <b>var</b> <span id="r454 rd" class="r454 r">stringComparer</span> = <a href="ProviderBase.cs.html#be8557754a3bdef0" class="i property">Host</a>.<a href="../engine/hostifaces/MshHost.cs.html#d531244924cf2614" class="i property">CurrentCulture</a>.<span class="i">CompareInfo</span>;
 
                <b>if</b> (<span class="r454 r">stringComparer</span>.<span class="i">Compare</span>(
                        <span class="r452 r">userEnteredPropertyName</span>,
                        <a href="#6b51649572209f2e" class="i property">LocalizedDefaultToken</a>,
                        <span class="i">CompareOptions</span>.<span class="i">IgnoreCase</span>) == 0)
                {
                    <span class="r453 r">result</span> = <b>null</b>;
                }
            }
 
            <b>return</b> <span class="r453 r">result</span>;
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Private members
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Defines dynamic parameters for the registry provider.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public class</b> <a id="4fe5568fafb46b4c" href="../R/4fe5568fafb46b4c.html" target="n" data-glyph="0,0" class="t t"><span id="73086392e071afd4">RegistryProviderSetItemDynamicParameter</span></a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the Type parameter as a dynamic parameter for</span>
        <span class="c">///</span><span class="c"> the registry provider&#39;s SetItem method.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The only acceptable values for this parameter are those found</span>
        <span class="c">///</span><span class="c"> in the RegistryValueKind enum</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="../engine/Attributes.cs.html#aded474eaec9cde8" class="i property">ValueFromPipelineByPropertyName</a> = <b>true</b>)]
        <b>public</b> <span class="i">RegistryValueKind</span> <a id="e98a47a65659cb0e" href="../R/e98a47a65659cb0e.html" target="n" data-glyph="102,1" class="i property">Type</a> { <b>get</b>; <b>set</b>; } = <span class="i">RegistryValueKind</span>.<span class="i">Unknown</span>;
    }
}
<span class="k preprocess">#</span><span class="k preprocess">endif</span> <span class="c">// !UNIX</span>
</pre></td></tr></table></div></body></html>
