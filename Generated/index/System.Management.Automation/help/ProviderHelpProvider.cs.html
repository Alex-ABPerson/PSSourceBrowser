<!DOCTYPE html>
<html><head><title>ProviderHelpProvider.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(427);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#System.Management.Automation/help/ProviderHelpProvider.cs" target="_top">help\ProviderHelpProvider.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#System.Management.Automation" target="_top">src\System.Management.Automation\System.Management.Automation.csproj</a> (System.Management.Automation)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">ObjectModel</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Globalization</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Reflection</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Xml</span>;
 
<b>namespace</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Class ProviderHelpProvider implement the help provider for commands.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Provider Help information are stored in &#39;help.xml&#39; files. Location of these files</span>
    <span class="c">///</span><span class="c"> can be found from CommandDiscovery.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
    <b>internal class</b> <a id="8e879a50f51e143f" href="../R/8e879a50f51e143f.html" target="n" data-glyph="2,0" class="t t">ProviderHelpProvider</a> : <a href="HelpProviderWithCache.cs.html#0636d0d6fc2b7961" class="t t">HelpProviderWithCache</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Constructor for HelpProvider.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a id="d76c35c2e318ade8" href="../R/d76c35c2e318ade8.html" target="n" data-glyph="74,1" class="t constructor">ProviderHelpProvider</a>(<a href="HelpSystem.cs.html#c115cfdd76399004" class="t t">HelpSystem</a> <span id="r0 rd" class="r0 r">helpSystem</span>) : <a href="HelpProviderWithCache.cs.html#6b18a26581ef8e2b" class="k">base</a>(<span class="r0 r">helpSystem</span>)
        {
            <a href="#c154a54c411c6217" class="i field">_sessionState</a> = <span class="r0 r">helpSystem</span>.<a href="HelpSystem.cs.html#a61b4bce06593834" class="i property">ExecutionContext</a>.<a href="../engine/ExecutionContext.cs.html#4502619a6e4808ee" class="i property">SessionState</a>;
        }
 
        <b>private readonly</b> <a href="../engine/SessionStatePublic.cs.html#0a202aa6b2d52930" class="t t">SessionState</a> <a id="c154a54c411c6217" href="../R/c154a54c411c6217.html" target="n" data-glyph="46,1" class="i field">_sessionState</a>;
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Common Properties
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Name of this help provider.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span><span class="c">Name of this help provider.</span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        <b>internal override string</b> <a id="acb257651fb5626c" href="../R/acb257651fb5626c.html" target="n" data-glyph="104,1" class="i property">Name</a>
        {
            <b>get</b>
            {
                <b>return</b> <span class="s">&quot;Provider Help Provider&quot;</span>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Help category of this provider.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span><span class="c">Help category of this provider</span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        <b>internal override</b> <a href="HelpSystem.cs.html#5ad0a796ad0d8ceb" class="t t">HelpCategory</a> <a id="450b2e532bcb122b" href="../R/450b2e532bcb122b.html" target="n" data-glyph="104,1" class="i property">HelpCategory</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="HelpSystem.cs.html#5ad0a796ad0d8ceb" class="t t">HelpCategory</a>.<a href="HelpSystem.cs.html#645bba4656668151" class="i field">Provider</a>;
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Help Provider Interface
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Do exact match help based on the target.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">helpRequest</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Help request object.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal override</b> <span class="i">IEnumerable</span>&lt;<a href="HelpInfo.cs.html#d64eccc845958c22" class="t t">HelpInfo</a>&gt; <a id="8bbfe4d1e7bb0af9" href="../R/8bbfe4d1e7bb0af9.html" target="n" data-glyph="74,1" class="i method">ExactMatchHelp</a>(<a href="HelpRequest.cs.html#761f9f174720770b" class="t t">HelpRequest</a> <span id="r1 rd" class="r1 r">helpRequest</span>)
        {
            <span class="i">Collection</span>&lt;<a href="../engine/DataStoreAdapterProvider.cs.html#dd4e1f2f8e73a1dd" class="t t">ProviderInfo</a>&gt; <span id="r2 rd" class="r2 r">matchingProviders</span> = <b>null</b>;
 
            <b>try</b>
            {
                <span class="r2 r">matchingProviders</span> = <a href="#c154a54c411c6217" class="i field">_sessionState</a>.<a href="../engine/SessionStatePublic.cs.html#e315bf3657b55810" class="i property">Provider</a>.<a href="../engine/ProviderInterfaces.cs.html#f2400523e48d6273" class="i method">Get</a>(<span class="r1 r">helpRequest</span>.<a href="HelpRequest.cs.html#fb17dcc446c6c966" class="i property">Target</a>);
            }
            <b>catch</b> (<a href="../utils/SessionStateExceptions.cs.html#a58038dc730da896" class="t t">ProviderNotFoundException</a> <span id="r3 rd" class="r3 r">e</span>)
            {
                <span class="c">// We distinguish two cases here,</span>
                <span class="c">//      a. If the &quot;Provider&quot; is the only category to search for in this case,</span>
                <span class="c">//         an error will be written.</span>
                <span class="c">//      b. Otherwise, no errors will be written since in end user&#39;s mind,</span>
                <span class="c">//         he may mean to search for provider help.</span>
                <b>if</b> (<a href="#8e879a50f51e143f" class="k">this</a>.<a href="HelpProvider.cs.html#892ebe4ed17c7e10" class="i property">HelpSystem</a>.<a href="HelpSystem.cs.html#87b14dcb18febf2e" class="i property">LastHelpCategory</a> == <a href="HelpSystem.cs.html#5ad0a796ad0d8ceb" class="t t">HelpCategory</a>.<a href="HelpSystem.cs.html#645bba4656668151" class="i field">Provider</a>)
                {
                    <a href="../engine/ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r4 rd" class="r4 r">errorRecord</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r3 r">e</span>, <span class="s">&quot;ProviderLoadError&quot;</span>, <a href="../engine/ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../engine/ErrorPackage.cs.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <b>null</b>);
                    <span class="r4 r">errorRecord</span>.<a href="../engine/ErrorPackage.cs.html#4e9df045b6372ce0" class="i property">ErrorDetails</a> = <b>new</b> <span class="t">ErrorDetails</span>(<b>typeof</b>(<a href="#8e879a50f51e143f" class="t t">ProviderHelpProvider</a>).<span class="i">Assembly</span>, <span class="s">&quot;HelpErrors&quot;</span>, <span class="s">&quot;ProviderLoadError&quot;</span>, <span class="r1 r">helpRequest</span>.<a href="HelpRequest.cs.html#fb17dcc446c6c966" class="i property">Target</a>, <span class="r3 r">e</span>.<span class="i">Message</span>);
                    <a href="#8e879a50f51e143f" class="k">this</a>.<a href="HelpProvider.cs.html#892ebe4ed17c7e10" class="i property">HelpSystem</a>.<a href="HelpSystem.cs.html#600b66256f838b9f" class="i property">LastErrors</a>.<span class="i">Add</span>(<span class="r4 r">errorRecord</span>);
                }
            }
 
            <b>if</b> (<span class="r2 r">matchingProviders</span> != <b>null</b>)
            {
                <b>foreach</b> (<a href="../engine/DataStoreAdapterProvider.cs.html#dd4e1f2f8e73a1dd" class="t t">ProviderInfo</a> <span id="r5 rd" class="r5 r">providerInfo</span> <b>in</b> <span class="r2 r">matchingProviders</span>)
                {
                    <b>try</b>
                    {
                        <a href="#8adf275b489d44a1" class="i method">LoadHelpFile</a>(<span class="r5 r">providerInfo</span>);
                    }
                    <b>catch</b> (<span class="i">IOException</span> <span id="r6 rd" class="r6 r">ioException</span>)
                    {
                        <span class="i">ReportHelpFileError</span>(<span class="r6 r">ioException</span>, <span class="r1 r">helpRequest</span>.<a href="HelpRequest.cs.html#fb17dcc446c6c966" class="i property">Target</a>, <span class="r5 r">providerInfo</span>.<a href="../engine/DataStoreAdapterProvider.cs.html#f3d7084f8a70f287" class="i property">HelpFile</a>);
                    }
                    <b>catch</b> (<span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span> <span id="r7 rd" class="r7 r">securityException</span>)
                    {
                        <span class="i">ReportHelpFileError</span>(<span class="r7 r">securityException</span>, <span class="r1 r">helpRequest</span>.<a href="HelpRequest.cs.html#fb17dcc446c6c966" class="i property">Target</a>, <span class="r5 r">providerInfo</span>.<a href="../engine/DataStoreAdapterProvider.cs.html#f3d7084f8a70f287" class="i property">HelpFile</a>);
                    }
                    <b>catch</b> (<span class="i">XmlException</span> <span id="r8 rd" class="r8 r">xmlException</span>)
                    {
                        <span class="i">ReportHelpFileError</span>(<span class="r8 r">xmlException</span>, <span class="r1 r">helpRequest</span>.<a href="HelpRequest.cs.html#fb17dcc446c6c966" class="i property">Target</a>, <span class="r5 r">providerInfo</span>.<a href="../engine/DataStoreAdapterProvider.cs.html#f3d7084f8a70f287" class="i property">HelpFile</a>);
                    }
 
                    <a href="HelpInfo.cs.html#d64eccc845958c22" class="t t">HelpInfo</a> <span id="r9 rd" class="r9 r">helpInfo</span> = <span class="i">GetCache</span>(<span class="r5 r">providerInfo</span>.<a href="../engine/DataStoreAdapterProvider.cs.html#85735ca1e339b2fc" class="i property">PSSnapInName</a> + <span class="s">&quot;\\&quot;</span> + <span class="r5 r">providerInfo</span>.<a href="../engine/DataStoreAdapterProvider.cs.html#2837d805ea30ef5c" class="i property">Name</a>);
 
                    <b>if</b> (<span class="r9 r">helpInfo</span> != <b>null</b>)
                    {
                        <b>yield</b> <b>return</b> <span class="r9 r">helpInfo</span>;
                    }
                }
            }
        }
 
        <b>private static string</b> <a id="33a8b9f9780332ca" href="../R/33a8b9f9780332ca.html" target="n" data-glyph="76,1" class="i method">GetProviderAssemblyPath</a>(<a href="../engine/DataStoreAdapterProvider.cs.html#dd4e1f2f8e73a1dd" class="t t">ProviderInfo</a> <span id="r10 rd" class="r10 r">providerInfo</span>)
        {
            <b>if</b> (<span class="r10 r">providerInfo</span> == <b>null</b>)
                <b>return</b> <b>null</b>;
 
            <b>if</b> (<span class="r10 r">providerInfo</span>.<a href="../engine/DataStoreAdapterProvider.cs.html#3801e8e136516894" class="i property">ImplementingType</a> == <b>null</b>)
                <b>return</b> <b>null</b>;
 
            <b>return</b> <span class="i">Path</span>.<span class="i">GetDirectoryName</span>(<span class="r10 r">providerInfo</span>.<a href="../engine/DataStoreAdapterProvider.cs.html#3801e8e136516894" class="i property">ImplementingType</a>.<span class="i">Assembly</span>.<span class="i">Location</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This is a hashtable to track which help files are loaded already.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> This will avoid one help file getting loaded again and again.</span>
        <span class="c">///</span><span class="c"> (Which should not happen unless some provider is pointing</span>
        <span class="c">///</span><span class="c"> to a help file that actually doesn&#39;t contain the help for it).</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private readonly</b> <span class="i">Hashtable</span> <a id="e23b95eeba3b4e44" href="../R/e23b95eeba3b4e44.html" target="n" data-glyph="46,1" class="i field">_helpFiles</a> = <b>new</b> <span class="i">Hashtable</span>();
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Load help file provided.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This will load providerHelpInfo from help file into help cache.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r11 r">providerInfo</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">ProviderInfo for which to locate help.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="8adf275b489d44a1" href="../R/8adf275b489d44a1.html" target="n" data-glyph="76,1" class="i method">LoadHelpFile</a>(<a href="../engine/DataStoreAdapterProvider.cs.html#dd4e1f2f8e73a1dd" class="t t">ProviderInfo</a> <span id="r11 rd" class="r11 r">providerInfo</span>)
        {
            <b>if</b> (<span class="r11 r">providerInfo</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r11 r">providerInfo</span>));
            }
 
            <b>string</b> <span id="r12 rd" class="r12 r">helpFile</span> = <span class="r11 r">providerInfo</span>.<a href="../engine/DataStoreAdapterProvider.cs.html#f3d7084f8a70f287" class="i property">HelpFile</a>;
 
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r12 r">helpFile</span>) || <a href="#e23b95eeba3b4e44" class="i field">_helpFiles</a>.<span class="i">Contains</span>(<span class="r12 r">helpFile</span>))
            {
                <b>return</b>;
            }
 
            <b>string</b> <span id="r13 rd" class="r13 r">helpFileToLoad</span> = <span class="r12 r">helpFile</span>;
 
            <span class="c">// Get the mshsnapinfo object for this cmdlet.</span>
            <a href="../singleshell/config/MshSnapinInfo.cs.html#571fb5b01a41502f" class="t t">PSSnapInInfo</a> <span id="r14 rd" class="r14 r">mshSnapInInfo</span> = <span class="r11 r">providerInfo</span>.<a href="../engine/DataStoreAdapterProvider.cs.html#d188d4dbe198a219" class="i property">PSSnapIn</a>;
 
            <span class="c">// Search fallback</span>
            <span class="c">// 1. If PSSnapInInfo exists, then always look in the application base</span>
            <span class="c">//    of the mshsnapin</span>
            <span class="c">// Otherwise,</span>
            <span class="c">//    Look in the default search path and cmdlet assembly path</span>
            <span class="i">Collection</span>&lt;<b>string</b>&gt; <span id="r15 rd" class="r15 r">searchPaths</span> = <b>new</b> <span class="i">Collection</span>&lt;<b>string</b>&gt;();
            <b>if</b> (<span class="r14 r">mshSnapInInfo</span> != <b>null</b>)
            {
                <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<span class="i">Assert</span>(!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r14 r">mshSnapInInfo</span>.<a href="../singleshell/config/MshSnapinInfo.cs.html#dc0461df9f1a5d5a" class="i property">ApplicationBase</a>),
                    <span class="s">&quot;Application Base is null or empty.&quot;</span>);
                <span class="c">// not minishell case..</span>
                <span class="c">// we have to search only in the application base for a mshsnapin...</span>
                <span class="c">// if you create an absolute path for helpfile, then MUIFileSearcher</span>
                <span class="c">// will look only in that path.</span>
                <span class="r13 r">helpFileToLoad</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r14 r">mshSnapInInfo</span>.<a href="../singleshell/config/MshSnapinInfo.cs.html#dc0461df9f1a5d5a" class="i property">ApplicationBase</a>, <span class="r12 r">helpFile</span>);
            }
            <b>else</b> <b>if</b> ((<span class="r11 r">providerInfo</span>.<a href="../engine/DataStoreAdapterProvider.cs.html#f736cdfc2ade06bf" class="i property">Module</a> != <b>null</b>) &amp;&amp; (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r11 r">providerInfo</span>.<a href="../engine/DataStoreAdapterProvider.cs.html#f736cdfc2ade06bf" class="i property">Module</a>.<a href="../engine/Modules/PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>)))
            {
                <span class="r13 r">helpFileToLoad</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r11 r">providerInfo</span>.<a href="../engine/DataStoreAdapterProvider.cs.html#f736cdfc2ade06bf" class="i property">Module</a>.<a href="../engine/Modules/PSModuleInfo.cs.html#3c412fbb7362d7c7" class="i property">ModuleBase</a>, <span class="r12 r">helpFile</span>);
            }
            <b>else</b>
            {
                <span class="r15 r">searchPaths</span>.<span class="i">Add</span>(<a href="HelpProvider.cs.html#eb6486f58989f2cf" class="i method">GetDefaultShellSearchPath</a>());
                <span class="r15 r">searchPaths</span>.<span class="i">Add</span>(<a href="#33a8b9f9780332ca" class="i method">GetProviderAssemblyPath</a>(<span class="r11 r">providerInfo</span>));
            }
 
            <b>string</b> <span id="r16 rd" class="r16 r">location</span> = <a href="MUIFileSearcher.cs.html#b4d5f2ac8ec9ddb2" class="t t">MUIFileSearcher</a>.<a href="MUIFileSearcher.cs.html#8c1adea116d9b741" class="i method">LocateFile</a>(<span class="r13 r">helpFileToLoad</span>, <span class="r15 r">searchPaths</span>);
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r16 r">location</span>))
                <b>throw</b> <b>new</b> <span class="i">FileNotFoundException</span>(<span class="r12 r">helpFile</span>);
 
            <span class="i">XmlDocument</span> <span id="r17 rd" class="r17 r">doc</span> = <a href="../engine/serialization.cs.html#758c46d6a86d6840" class="t t">InternalDeserializer</a>.<a href="../engine/serialization.cs.html#ee2ec715b80d2059" class="i method">LoadUnsafeXmlDocument</a>(
                <b>new</b> <span class="i">FileInfo</span>(<span class="r16 r">location</span>),
                <b>false</b>, <span class="c">/* ignore whitespace, comments, etc. */</span>
                <b>null</b>); <span class="c">/* default maxCharactersInDocument */</span>
 
            <span class="c">// Add this file into _helpFiles hashtable to prevent it to be loaded again.</span>
            <a href="#e23b95eeba3b4e44" class="i field">_helpFiles</a>[<span class="r12 r">helpFile</span>] = 0;
 
            <span class="i">XmlNode</span> <span id="r18 rd" class="r18 r">helpItemsNode</span> = <b>null</b>;
 
            <b>if</b> (<span class="r17 r">doc</span>.<span class="i">HasChildNodes</span>)
            {
                <b>for</b> (<b>int</b> <span id="r19 rd" class="r19 r">i</span> = 0; <span class="r19 r">i</span> &lt; <span class="r17 r">doc</span>.<span class="i">ChildNodes</span>.<span class="i">Count</span>; <span class="r19 r">i</span>++)
                {
                    <span class="i">XmlNode</span> <span id="r20 rd" class="r20 r">node</span> = <span class="r17 r">doc</span>.<span class="i">ChildNodes</span>[<span class="r19 r">i</span>];
                    <b>if</b> (<span class="r20 r">node</span>.<span class="i">NodeType</span> == <span class="i">XmlNodeType</span>.<span class="i">Element</span> &amp;&amp; <b>string</b>.<span class="i">Equals</span>(<span class="r20 r">node</span>.<span class="i">Name</span>, <span class="s">&quot;helpItems&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                    {
                        <span class="r18 r">helpItemsNode</span> = <span class="r20 r">node</span>;
                        <b>break</b>;
                    }
                }
            }
 
            <b>if</b> (<span class="r18 r">helpItemsNode</span> == <b>null</b>)
                <b>return</b>;
 
            <b>using</b> (<a href="#8e879a50f51e143f" class="k">this</a>.<a href="HelpProvider.cs.html#892ebe4ed17c7e10" class="i property">HelpSystem</a>.<a href="HelpSystem.cs.html#396dc3a6c97f13cf" class="i method">Trace</a>(<span class="r16 r">location</span>))
            {
                <b>if</b> (<span class="r18 r">helpItemsNode</span>.<span class="i">HasChildNodes</span>)
                {
                    <b>for</b> (<b>int</b> <span id="r21 rd" class="r21 r">i</span> = 0; <span class="r21 r">i</span> &lt; <span class="r18 r">helpItemsNode</span>.<span class="i">ChildNodes</span>.<span class="i">Count</span>; <span class="r21 r">i</span>++)
                    {
                        <span class="i">XmlNode</span> <span id="r22 rd" class="r22 r">node</span> = <span class="r18 r">helpItemsNode</span>.<span class="i">ChildNodes</span>[<span class="r21 r">i</span>];
                        <b>if</b> (<span class="r22 r">node</span>.<span class="i">NodeType</span> == <span class="i">XmlNodeType</span>.<span class="i">Element</span> &amp;&amp; <b>string</b>.<span class="i">Equals</span>(<span class="r22 r">node</span>.<span class="i">Name</span>, <span class="s">&quot;providerHelp&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                        {
                            <a href="HelpInfo.cs.html#d64eccc845958c22" class="t t">HelpInfo</a> <span id="r23 rd" class="r23 r">helpInfo</span> = <a href="ProviderHelpInfo.cs.html#baf2c623edfa3540" class="t t">ProviderHelpInfo</a>.<a href="ProviderHelpInfo.cs.html#61e364f1d899b26e" class="i method">Load</a>(<span class="r22 r">node</span>);
 
                            <b>if</b> (<span class="r23 r">helpInfo</span> != <b>null</b>)
                            {
                                <a href="#8e879a50f51e143f" class="k">this</a>.<a href="HelpProvider.cs.html#892ebe4ed17c7e10" class="i property">HelpSystem</a>.<a href="HelpSystem.cs.html#4201251702e3040d" class="i method">TraceErrors</a>(<span class="r23 r">helpInfo</span>.<a href="HelpInfo.cs.html#96f0ac6c0dee6ce3" class="i property">Errors</a>);
                                <span class="c">// Add snapin qualified type name for this command..</span>
                                <span class="c">// this will enable customizations of the help object.</span>
                                <span class="r23 r">helpInfo</span>.<a href="HelpInfo.cs.html#d097355e320548de" class="i property">FullHelp</a>.<a href="../engine/MshObject.cs.html#86c0a84d554979ba" class="i property">TypeNames</a>.<span class="i">Insert</span>(0, <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                                    <span class="s">&quot;ProviderHelpInfo#{0}#{1}&quot;</span>, <span class="r11 r">providerInfo</span>.<a href="../engine/DataStoreAdapterProvider.cs.html#85735ca1e339b2fc" class="i property">PSSnapInName</a>, <span class="r23 r">helpInfo</span>.<a href="HelpInfo.cs.html#aa468d431e2dc4d7" class="i property">Name</a>));
 
                                <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r11 r">providerInfo</span>.<a href="../engine/DataStoreAdapterProvider.cs.html#85735ca1e339b2fc" class="i property">PSSnapInName</a>))
                                {
                                    <span class="r23 r">helpInfo</span>.<a href="HelpInfo.cs.html#d097355e320548de" class="i property">FullHelp</a>.<a href="../engine/MshObject.cs.html#59e9cd1ad57ccd34" class="i property">Properties</a>.<a href="../engine/MshMemberInfo.cs.html#a9e3a2dc56d98237" class="i method">Add</a>(<b>new</b> <a href="../engine/MshMemberInfo.cs.html#f4e5bccf8ccb9f2a" class="t constructor">PSNoteProperty</a>(<span class="s">&quot;PSSnapIn&quot;</span>, <span class="r11 r">providerInfo</span>.<a href="../engine/DataStoreAdapterProvider.cs.html#d188d4dbe198a219" class="i property">PSSnapIn</a>));
                                    <span class="r23 r">helpInfo</span>.<a href="HelpInfo.cs.html#d097355e320548de" class="i property">FullHelp</a>.<a href="../engine/MshObject.cs.html#86c0a84d554979ba" class="i property">TypeNames</a>.<span class="i">Insert</span>(1, <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                                        <span class="s">&quot;ProviderHelpInfo#{0}&quot;</span>, <span class="r11 r">providerInfo</span>.<a href="../engine/DataStoreAdapterProvider.cs.html#85735ca1e339b2fc" class="i property">PSSnapInName</a>));
                                }
 
                                <span class="i">AddCache</span>(<span class="r11 r">providerInfo</span>.<a href="../engine/DataStoreAdapterProvider.cs.html#85735ca1e339b2fc" class="i property">PSSnapInName</a> + <span class="s">&quot;\\&quot;</span> + <span class="r23 r">helpInfo</span>.<a href="HelpInfo.cs.html#aa468d431e2dc4d7" class="i property">Name</a>, <span class="r23 r">helpInfo</span>);
                            }
                        }
                    }
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Search for provider help based on a search target.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r24 r">helpRequest</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Help request object.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r25 r">searchOnlyContent</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If true, searches for pattern in the help content. Individual</span>
        <span class="c">///</span><span class="c"> provider can decide which content to search in.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> If false, searches for pattern in the command names.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal override</b> <span class="i">IEnumerable</span>&lt;<a href="HelpInfo.cs.html#d64eccc845958c22" class="t t">HelpInfo</a>&gt; <a id="1ef46662b9a55535" href="../R/1ef46662b9a55535.html" target="n" data-glyph="74,1" class="i method">SearchHelp</a>(<a href="HelpRequest.cs.html#761f9f174720770b" class="t t">HelpRequest</a> <span id="r24 rd" class="r24 r">helpRequest</span>, <b>bool</b> <span id="r25 rd" class="r25 r">searchOnlyContent</span>)
        {
            <b>int</b> <span id="r26 rd" class="r26 r">countOfHelpInfoObjectsFound</span> = 0;
            <b>string</b> <span id="r27 rd" class="r27 r">target</span> = <span class="r24 r">helpRequest</span>.<a href="HelpRequest.cs.html#fb17dcc446c6c966" class="i property">Target</a>;
            <b>string</b> <span id="r28 rd" class="r28 r">pattern</span> = <span class="r27 r">target</span>;
            <span class="c">// this will be used only when searchOnlyContent == true</span>
            <a href="../engine/regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a> <span id="r29 rd" class="r29 r">wildCardPattern</span> = <b>null</b>;
 
            <b>bool</b> <span id="r30 rd" class="r30 r">decoratedSearch</span> = !<a href="../engine/regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../engine/regex.cs.html#f9cf207fdd565080" class="i method">ContainsWildcardCharacters</a>(<span class="r27 r">target</span>);
 
            <b>if</b> (!<span class="r25 r">searchOnlyContent</span>)
            {
                <b>if</b> (<span class="r30 r">decoratedSearch</span>)
                {
                    <span class="r28 r">pattern</span> += <span class="s">&quot;*&quot;</span>;
                }
            }
            <b>else</b>
            {
                <b>string</b> <span id="r31 rd" class="r31 r">searchTarget</span> = <span class="r24 r">helpRequest</span>.<a href="HelpRequest.cs.html#fb17dcc446c6c966" class="i property">Target</a>;
                <b>if</b> (<span class="r30 r">decoratedSearch</span>)
                {
                    <span class="r31 r">searchTarget</span> = <span class="s">&quot;*&quot;</span> + <span class="r24 r">helpRequest</span>.<a href="HelpRequest.cs.html#fb17dcc446c6c966" class="i property">Target</a> + <span class="s">&quot;*&quot;</span>;
                }
 
                <span class="r29 r">wildCardPattern</span> = <a href="../engine/regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../engine/regex.cs.html#03cc3ceece086129" class="i method">Get</a>(<span class="r31 r">searchTarget</span>, <a href="../engine/regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../engine/regex.cs.html#e7978967739ff542" class="i field">Compiled</a> | <a href="../engine/regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../engine/regex.cs.html#2d0521a6986208d3" class="i field">IgnoreCase</a>);
                <span class="c">// search in all providers</span>
                <span class="r28 r">pattern</span> = <span class="s">&quot;*&quot;</span>;
            }
 
            <a href="../engine/MshSnapinQualifiedName.cs.html#93cb5bb27e91d97d" class="t t">PSSnapinQualifiedName</a> <span id="r32 rd" class="r32 r">snapinQualifiedNameForPattern</span> =
                <a href="../engine/MshSnapinQualifiedName.cs.html#93cb5bb27e91d97d" class="t t">PSSnapinQualifiedName</a>.<span class="i">GetInstance</span>(<span class="r28 r">pattern</span>);
 
            <b>if</b> (<span class="r32 r">snapinQualifiedNameForPattern</span> == <b>null</b>)
            {
                <b>yield</b> <b>break</b>;
            }
 
            <b>foreach</b> (<a href="../engine/DataStoreAdapterProvider.cs.html#dd4e1f2f8e73a1dd" class="t t">ProviderInfo</a> <span id="r33 rd" class="r33 r">providerInfo</span> <b>in</b> <a href="#c154a54c411c6217" class="i field">_sessionState</a>.<a href="../engine/SessionStatePublic.cs.html#e315bf3657b55810" class="i property">Provider</a>.<a href="../engine/ProviderInterfaces.cs.html#306af73c62cd676c" class="i method">GetAll</a>())
            {
                <b>if</b> (<span class="r33 r">providerInfo</span>.<a href="../engine/DataStoreAdapterProvider.cs.html#dd27b4541726d211" class="i method">IsMatch</a>(<span class="r28 r">pattern</span>))
                {
                    <b>try</b>
                    {
                        <a href="#8adf275b489d44a1" class="i method">LoadHelpFile</a>(<span class="r33 r">providerInfo</span>);
                    }
                    <b>catch</b> (<span class="i">IOException</span> <span id="r34 rd" class="r34 r">ioException</span>)
                    {
                        <b>if</b> (!<span class="r30 r">decoratedSearch</span>)
                        {
                            <span class="i">ReportHelpFileError</span>(<span class="r34 r">ioException</span>, <span class="r33 r">providerInfo</span>.<a href="../engine/DataStoreAdapterProvider.cs.html#2837d805ea30ef5c" class="i property">Name</a>, <span class="r33 r">providerInfo</span>.<a href="../engine/DataStoreAdapterProvider.cs.html#f3d7084f8a70f287" class="i property">HelpFile</a>);
                        }
                    }
                    <b>catch</b> (<span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span> <span id="r35 rd" class="r35 r">securityException</span>)
                    {
                        <b>if</b> (!<span class="r30 r">decoratedSearch</span>)
                        {
                            <span class="i">ReportHelpFileError</span>(<span class="r35 r">securityException</span>, <span class="r33 r">providerInfo</span>.<a href="../engine/DataStoreAdapterProvider.cs.html#2837d805ea30ef5c" class="i property">Name</a>, <span class="r33 r">providerInfo</span>.<a href="../engine/DataStoreAdapterProvider.cs.html#f3d7084f8a70f287" class="i property">HelpFile</a>);
                        }
                    }
                    <b>catch</b> (<span class="i">XmlException</span> <span id="r36 rd" class="r36 r">xmlException</span>)
                    {
                        <b>if</b> (!<span class="r30 r">decoratedSearch</span>)
                        {
                            <span class="i">ReportHelpFileError</span>(<span class="r36 r">xmlException</span>, <span class="r33 r">providerInfo</span>.<a href="../engine/DataStoreAdapterProvider.cs.html#2837d805ea30ef5c" class="i property">Name</a>, <span class="r33 r">providerInfo</span>.<a href="../engine/DataStoreAdapterProvider.cs.html#f3d7084f8a70f287" class="i property">HelpFile</a>);
                        }
                    }
 
                    <a href="HelpInfo.cs.html#d64eccc845958c22" class="t t">HelpInfo</a> <span id="r37 rd" class="r37 r">helpInfo</span> = <span class="i">GetCache</span>(<span class="r33 r">providerInfo</span>.<a href="../engine/DataStoreAdapterProvider.cs.html#85735ca1e339b2fc" class="i property">PSSnapInName</a> + <span class="s">&quot;\\&quot;</span> + <span class="r33 r">providerInfo</span>.<a href="../engine/DataStoreAdapterProvider.cs.html#2837d805ea30ef5c" class="i property">Name</a>);
 
                    <b>if</b> (<span class="r37 r">helpInfo</span> != <b>null</b>)
                    {
                        <b>if</b> (<span class="r25 r">searchOnlyContent</span>)
                        {
                            <span class="c">// ignore help objects that do not have pattern in its help</span>
                            <span class="c">// content.</span>
                            <b>if</b> (!<span class="r37 r">helpInfo</span>.<a href="HelpInfo.cs.html#30487b4832e23e6a" class="i method">MatchPatternInContent</a>(<span class="r29 r">wildCardPattern</span>))
                            {
                                <b>continue</b>;
                            }
                        }
 
                        <span class="r26 r">countOfHelpInfoObjectsFound</span>++;
                        <b>yield</b> <b>return</b> <span class="r37 r">helpInfo</span>;
 
                        <b>if</b> (<span class="r26 r">countOfHelpInfoObjectsFound</span> &gt;= <span class="r24 r">helpRequest</span>.<a href="HelpRequest.cs.html#26eaafae9a0d4749" class="i property">MaxResults</a> &amp;&amp; <span class="r24 r">helpRequest</span>.<a href="HelpRequest.cs.html#26eaafae9a0d4749" class="i property">MaxResults</a> &gt; 0)
                            <b>yield</b> <b>break</b>;
                    }
                }
            }
        }
 
        <b>internal override</b> <span class="i">IEnumerable</span>&lt;<a href="HelpInfo.cs.html#d64eccc845958c22" class="t t">HelpInfo</a>&gt; <a id="da1a7fc183bc5068" href="../R/da1a7fc183bc5068.html" target="n" data-glyph="74,1" class="i method">ProcessForwardedHelp</a>(<a href="HelpInfo.cs.html#d64eccc845958c22" class="t t">HelpInfo</a> <span id="r38 rd" class="r38 r">helpInfo</span>, <a href="HelpRequest.cs.html#761f9f174720770b" class="t t">HelpRequest</a> <span id="r39 rd" class="r39 r">helpRequest</span>)
        {
            <a href="ProviderCommandHelpInfo.cs.html#f7fd94caf3e33056" class="t t">ProviderCommandHelpInfo</a> <span id="r40 rd" class="r40 r">providerCommandHelpInfo</span> = <b>new</b> <a href="ProviderCommandHelpInfo.cs.html#5d63f09e7947446d" class="t constructor">ProviderCommandHelpInfo</a>(
                <span class="r38 r">helpInfo</span>, <span class="r39 r">helpRequest</span>.<a href="HelpRequest.cs.html#953d844df2595ba0" class="i property">ProviderContext</a>);
            <b>yield</b> <b>return</b> <span class="r40 r">providerCommandHelpInfo</span>;
        }
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">V2</span>
<span class="e">        /// &lt;summary&gt;
        /// Process a helpInfo forwarded from other providers (normally commandHelpProvider)
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        /// For command help info, this will
        ///     1. check whether provider-specific commandlet help exists.
        ///     2. merge found provider-specific help with commandlet help provided.
        /// &lt;/remarks&gt;
        /// &lt;param name=&quot;helpInfo&quot;&gt;HelpInfo forwarded in.&lt;/param&gt;
        /// &lt;param name=&quot;helpRequest&quot;&gt;Help request object.&lt;/param&gt;
        /// &lt;returns&gt;The help info object after processing.&lt;/returns&gt;
        override internal HelpInfo ProcessForwardedHelp(HelpInfo helpInfo, HelpRequest helpRequest)
        {
            if (helpInfo == null)
                return null;
 
            if (helpInfo.HelpCategory != HelpCategory.Command)
            {
                return helpInfo;
            }
 
            string providerName = helpRequest.Provider;
            if (string.IsNullOrEmpty(providerName))
            {
                providerName = this._sessionState.Path.CurrentLocation.Provider.Name;
            }
 
            HelpRequest providerHelpRequest = helpRequest.Clone();
            providerHelpRequest.Target = providerName;
 
            ProviderHelpInfo providerHelpInfo = (ProviderHelpInfo)this.ExactMatchHelp(providerHelpRequest);
 
            if (providerHelpInfo == null)
                return null;
 
            CommandHelpInfo commandHelpInfo = (CommandHelpInfo)helpInfo;
 
            CommandHelpInfo result = commandHelpInfo.MergeProviderSpecificHelp(providerHelpInfo.GetCmdletHelp(commandHelpInfo.Name), providerHelpInfo.GetDynamicParameterHelp(helpRequest.DynamicParameters));
 
            // Reset ForwardHelpCategory for the helpinfo to be returned so that it will not be forwarded back again.
            result.ForwardHelpCategory = HelpCategory.None;
 
            return result;
        }
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This will reset the help cache. Normally this corresponds to a</span>
        <span class="c">///</span><span class="c"> help culture change.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal override void</b> <a id="f1d2cc5e489696f6" href="../R/f1d2cc5e489696f6.html" target="n" data-glyph="74,1" class="i method">Reset</a>()
        {
            <a href="HelpProviderWithCache.cs.html#0636d0d6fc2b7961" class="k">base</a>.<a href="HelpProviderWithCache.cs.html#9f788f7aeff56931" class="i method">Reset</a>();
 
            <a href="#e23b95eeba3b4e44" class="i field">_helpFiles</a>.<span class="i">Clear</span>();
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
    }
}
</pre></td></tr></table></div></body></html>
