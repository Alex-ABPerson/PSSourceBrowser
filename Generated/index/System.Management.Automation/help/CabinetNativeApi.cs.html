<!DOCTYPE html>
<html><head><title>CabinetNativeApi.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(687);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#System.Management.Automation/help/CabinetNativeApi.cs" target="_top">help\CabinetNativeApi.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#System.Management.Automation" target="_top">src\System.Management.Automation\System.Management.Automation.csproj</a> (System.Management.Automation)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>.<span class="i">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Runtime</span>.<span class="i">InteropServices</span>;
 
<b>using</b> <span class="i n">Microsoft</span>.<span class="i">Win32</span>.<span class="i">SafeHandles</span>;
 
<b>namespace</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Internal</span>
{
    <b>internal class</b> <a id="a198ffb17d970ce9" href="../R/a198ffb17d970ce9.html" target="n" data-glyph="2,0" class="t t">CabinetExtractor</a> : <a href="CabinetAPI.cs.html#b9055edeb1565f83" class="t t">ICabinetExtractor</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> GC handle which prevents garbage collector from collecting this delegate.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private</b> <a href="#8b08ec1a3ea0cdc7" class="t t">CabinetNativeApi</a>.<a href="#f8b01872392fceb8" class="t t">FdiAllocDelegate</a> <a id="97a220d5f697928d" href="../R/97a220d5f697928d.html" target="n" data-glyph="46,1" class="i field">_allocDelegate</a>;
        <b>private</b> <span class="i">GCHandle</span> <a id="953c194d1783e1f3" href="../R/953c194d1783e1f3.html" target="n" data-glyph="46,1" class="i field">_fdiAllocHandle</a>;
        <b>private</b> <a href="#8b08ec1a3ea0cdc7" class="t t">CabinetNativeApi</a>.<a href="#b83f2844157046f3" class="t t">FdiFreeDelegate</a> <a id="004d8644a4719690" href="../R/004d8644a4719690.html" target="n" data-glyph="46,1" class="i field">_freeDelegate</a>;
        <b>private</b> <span class="i">GCHandle</span> <a id="d7d5324a64eed11f" href="../R/d7d5324a64eed11f.html" target="n" data-glyph="46,1" class="i field">_fdiFreeHandle</a>;
        <b>private</b> <a href="#8b08ec1a3ea0cdc7" class="t t">CabinetNativeApi</a>.<a href="#b86c56316acd970a" class="t t">FdiOpenDelegate</a> <a id="d718e403041426e4" href="../R/d718e403041426e4.html" target="n" data-glyph="46,1" class="i field">_openDelegate</a>;
        <b>private</b> <span class="i">GCHandle</span> <a id="00555767f41a4242" href="../R/00555767f41a4242.html" target="n" data-glyph="46,1" class="i field">_fdiOpenHandle</a>;
        <b>private</b> <a href="#8b08ec1a3ea0cdc7" class="t t">CabinetNativeApi</a>.<a href="#050a98b039fc861b" class="t t">FdiReadDelegate</a> <a id="ec20d987905a3345" href="../R/ec20d987905a3345.html" target="n" data-glyph="46,1" class="i field">_readDelegate</a>;
        <b>private</b> <span class="i">GCHandle</span> <a id="872737a2fa89b46c" href="../R/872737a2fa89b46c.html" target="n" data-glyph="46,1" class="i field">_fdiReadHandle</a>;
        <b>private</b> <a href="#8b08ec1a3ea0cdc7" class="t t">CabinetNativeApi</a>.<a href="#6a6fab8a00957d5a" class="t t">FdiWriteDelegate</a> <a id="e246d0e23ddfd625" href="../R/e246d0e23ddfd625.html" target="n" data-glyph="46,1" class="i field">_writeDelegate</a>;
        <b>private</b> <span class="i">GCHandle</span> <a id="299dbb2620382db3" href="../R/299dbb2620382db3.html" target="n" data-glyph="46,1" class="i field">_fdiWriteHandle</a>;
        <b>private</b> <a href="#8b08ec1a3ea0cdc7" class="t t">CabinetNativeApi</a>.<a href="#4cf424962021c8da" class="t t">FdiCloseDelegate</a> <a id="77c196026a420ed6" href="../R/77c196026a420ed6.html" target="n" data-glyph="46,1" class="i field">_closeDelegate</a>;
        <b>private</b> <span class="i">GCHandle</span> <a id="845414f4c711f827" href="../R/845414f4c711f827.html" target="n" data-glyph="46,1" class="i field">_fdiCloseHandle</a>;
        <b>private</b> <a href="#8b08ec1a3ea0cdc7" class="t t">CabinetNativeApi</a>.<a href="#a29011d0cb4729c0" class="t t">FdiSeekDelegate</a> <a id="6f92c8da06f694c9" href="../R/6f92c8da06f694c9.html" target="n" data-glyph="46,1" class="i field">_seekDelegate</a>;
        <b>private</b> <span class="i">GCHandle</span> <a id="97de24f6be742f02" href="../R/97de24f6be742f02.html" target="n" data-glyph="46,1" class="i field">_fdiSeekHandle</a>;
        <b>private</b> <a href="#8b08ec1a3ea0cdc7" class="t t">CabinetNativeApi</a>.<a href="#847a152db0816faa" class="t t">FdiNotifyDelegate</a> <a id="a7f17ee241ee85e0" href="../R/a7f17ee241ee85e0.html" target="n" data-glyph="46,1" class="i field">_notifyDelegate</a>;
        <b>private</b> <span class="i">GCHandle</span> <a id="055c4ac504e19cc3" href="../R/055c4ac504e19cc3.html" target="n" data-glyph="46,1" class="i field">_fdiNotifyHandle</a>;
 
        <b>internal</b> <a href="#8b08ec1a3ea0cdc7" class="t t">CabinetNativeApi</a>.<a href="#1ad99c13b1129f63" class="t t">FdiContextHandle</a> <a id="03505ef480d5452e" href="../R/03505ef480d5452e.html" target="n" data-glyph="44,1" class="i field">fdiContext</a>; <span class="c">// HFDI</span>
 
        <b>internal</b> <a id="a3d8f21159803e7f" href="../R/a3d8f21159803e7f.html" target="n" data-glyph="74,1" class="t constructor">CabinetExtractor</a>()
        {
            <a href="#8b08ec1a3ea0cdc7" class="t t">CabinetNativeApi</a>.<a href="#d1764e8e4eff9b08" class="t t">FdiERF</a> <span id="r0 rd" class="r0 r">err</span> = <b>new</b> <a href="#8b08ec1a3ea0cdc7" class="t t">CabinetNativeApi</a>.<span class="t">FdiERF</span>();
 
            <a href="#5e09cbc4dc90e5a7" class="i method">populateDelegates</a>();
 
            <span class="c">// marshal the delegate to a unmanaged function pointer so that AppDomain reference is stored correctly.</span>
            <a href="#03505ef480d5452e" class="i field">fdiContext</a> = <a href="#8b08ec1a3ea0cdc7" class="t t">CabinetNativeApi</a>.<span class="i">FDICreate</span>(
                <span class="i">Marshal</span>.<span class="i">GetFunctionPointerForDelegate</span>(<a href="#97a220d5f697928d" class="i field">_allocDelegate</a>),
                <span class="i">Marshal</span>.<span class="i">GetFunctionPointerForDelegate</span>(<a href="#004d8644a4719690" class="i field">_freeDelegate</a>),
                <span class="i">Marshal</span>.<span class="i">GetFunctionPointerForDelegate</span>(<a href="#d718e403041426e4" class="i field">_openDelegate</a>),
                <span class="i">Marshal</span>.<span class="i">GetFunctionPointerForDelegate</span>(<a href="#ec20d987905a3345" class="i field">_readDelegate</a>),
                <span class="i">Marshal</span>.<span class="i">GetFunctionPointerForDelegate</span>(<a href="#e246d0e23ddfd625" class="i field">_writeDelegate</a>),
                <span class="i">Marshal</span>.<span class="i">GetFunctionPointerForDelegate</span>(<a href="#77c196026a420ed6" class="i field">_closeDelegate</a>),
                <span class="i">Marshal</span>.<span class="i">GetFunctionPointerForDelegate</span>(<a href="#6f92c8da06f694c9" class="i field">_seekDelegate</a>),
                <a href="#8b08ec1a3ea0cdc7" class="t t">CabinetNativeApi</a>.<a href="#a956476322dbaa07" class="t t">FdiCreateCpuType</a>.<a href="#6a1da6230cc0ae6c" class="i field">Cpu80386</a>,
                <span class="r0 r">err</span>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> IDisposable Methods
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Flag: Has Dispose already been called?</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="5bc86226d1b7c5c7" href="../R/5bc86226d1b7c5c7.html" target="n" data-glyph="46,1" class="i field">_disposed</a> = <b>false</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Protected implementation of Dispose pattern.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">disposing</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="73f1ff6a3e2f58f8" href="../R/73f1ff6a3e2f58f8.html" target="n" data-glyph="75,1" class="i method">Dispose</a>(<b>bool</b> <span id="r1 rd" class="r1 r">disposing</span>)
        {
            <b>if</b> (<a href="#5bc86226d1b7c5c7" class="i field">_disposed</a>)
            {
                <b>return</b>;
            }
 
            <span class="c">// Free managed objects within &#39;if (disposing)&#39; if needed</span>
            <b>if</b> (<a href="#03505ef480d5452e" class="i field">fdiContext</a> != <b>null</b>)
            {
                <a href="#03505ef480d5452e" class="i field">fdiContext</a>.<span class="i">Dispose</span>();
            }
            <span class="c">// Free unmanaged objects here</span>
            <a href="#a198ffb17d970ce9" class="k">this</a>.<a href="#3142084efb2eaf0e" class="i method">CleanUpDelegates</a>();
 
            <a href="#5bc86226d1b7c5c7" class="i field">_disposed</a> = <b>true</b>;
 
            <span class="c">// Call base class implementation in case it has resources to release</span>
            <a href="CabinetAPI.cs.html#b9055edeb1565f83" class="k">base</a>.<a href="CabinetAPI.cs.html#31fe8daed62992b9" class="i method">Dispose</a>(<span class="r1 r">disposing</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Finalizes an instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#a198ffb17d970ce9" class="t t">CabinetExtractor</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        ~<a id="77dfb9422a215de7" href="../R/../../0000000000.html" target="n" data-glyph="75,1" class="t method">CabinetExtractor</a>()
        {
            <a href="#73f1ff6a3e2f58f8" class="i method">Dispose</a>(<b>false</b>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <b>internal override bool</b> <a id="123d159f29affef6" href="../R/123d159f29affef6.html" target="n" data-glyph="74,1" class="i method">Extract</a>(<b>string</b> <span id="r2 rd" class="r2 r">cabinetName</span>, <b>string</b> <span id="r3 rd" class="r3 r">srcPath</span>, <b>string</b> <span id="r4 rd" class="r4 r">destPath</span>)
        {
            <span class="i">IntPtr</span> <span id="r5 rd" class="r5 r">nativeDestPath</span> = <span class="i">Marshal</span>.<span class="i">StringToHGlobalAnsi</span>(<span class="r4 r">destPath</span>);
 
            <b>bool</b> <span id="r6 rd" class="r6 r">result</span> = <a href="#8b08ec1a3ea0cdc7" class="t t">CabinetNativeApi</a>.<span class="i">FDICopy</span>(
                <a href="#03505ef480d5452e" class="i field">fdiContext</a>,
                <span class="r2 r">cabinetName</span>,
                <span class="r3 r">srcPath</span>,
                0,                    <span class="c">// Not used</span>
                <span class="i">Marshal</span>.<span class="i">GetFunctionPointerForDelegate</span>(<a href="#a7f17ee241ee85e0" class="i field">_notifyDelegate</a>),
                <span class="i">IntPtr</span>.<span class="i">Zero</span>,
                <span class="r5 r">nativeDestPath</span>);
 
            <span class="i">Marshal</span>.<span class="i">FreeHGlobal</span>(<span class="r5 r">nativeDestPath</span>);
 
            <b>return</b> <span class="r6 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates delegates for the FDI* operation functions.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private void</b> <a id="5e09cbc4dc90e5a7" href="../R/5e09cbc4dc90e5a7.html" target="n" data-glyph="76,1" class="i method">populateDelegates</a>()
        {
            <span class="c">// if a delegate is re-located by a garbage collection, it will not affect</span>
            <span class="c">// the underlaying managed callback, so Alloc is used to add a reference</span>
            <span class="c">// to the delegate, allowing relocation of the delegate, but preventing</span>
            <span class="c">// disposal. Using GCHandle without pinning reduces fragmentation potential</span>
            <span class="c">// of the managed heap.</span>
            <a href="#97a220d5f697928d" class="i field">_allocDelegate</a> = <b>new</b> <a href="#8b08ec1a3ea0cdc7" class="t t">CabinetNativeApi</a>.<span class="t">FdiAllocDelegate</span>(<a href="#8b08ec1a3ea0cdc7" class="t t">CabinetNativeApi</a>.<a href="#33defafe9fb07b35" class="i method">FdiAlloc</a>);
            <a href="#953c194d1783e1f3" class="i field">_fdiAllocHandle</a> = <span class="i">GCHandle</span>.<span class="i">Alloc</span>(<a href="#97a220d5f697928d" class="i field">_allocDelegate</a>);
 
            <a href="#004d8644a4719690" class="i field">_freeDelegate</a> = <b>new</b> <a href="#8b08ec1a3ea0cdc7" class="t t">CabinetNativeApi</a>.<span class="t">FdiFreeDelegate</span>(<a href="#8b08ec1a3ea0cdc7" class="t t">CabinetNativeApi</a>.<a href="#5aa5dfa311dd2054" class="i method">FdiFree</a>);
            <a href="#d7d5324a64eed11f" class="i field">_fdiFreeHandle</a> = <span class="i">GCHandle</span>.<span class="i">Alloc</span>(<a href="#004d8644a4719690" class="i field">_freeDelegate</a>);
 
            <a href="#d718e403041426e4" class="i field">_openDelegate</a> = <b>new</b> <a href="#8b08ec1a3ea0cdc7" class="t t">CabinetNativeApi</a>.<span class="t">FdiOpenDelegate</span>(<a href="#8b08ec1a3ea0cdc7" class="t t">CabinetNativeApi</a>.<a href="#ce587c1cf0e912dd" class="i method">FdiOpen</a>);
            <a href="#00555767f41a4242" class="i field">_fdiOpenHandle</a> = <span class="i">GCHandle</span>.<span class="i">Alloc</span>(<a href="#d718e403041426e4" class="i field">_openDelegate</a>);
 
            <a href="#ec20d987905a3345" class="i field">_readDelegate</a> = <b>new</b> <a href="#8b08ec1a3ea0cdc7" class="t t">CabinetNativeApi</a>.<span class="t">FdiReadDelegate</span>(<a href="#8b08ec1a3ea0cdc7" class="t t">CabinetNativeApi</a>.<a href="#4da9ebf1babff374" class="i method">FdiRead</a>);
            <a href="#872737a2fa89b46c" class="i field">_fdiReadHandle</a> = <span class="i">GCHandle</span>.<span class="i">Alloc</span>(<a href="#ec20d987905a3345" class="i field">_readDelegate</a>);
 
            <a href="#e246d0e23ddfd625" class="i field">_writeDelegate</a> = <b>new</b> <a href="#8b08ec1a3ea0cdc7" class="t t">CabinetNativeApi</a>.<span class="t">FdiWriteDelegate</span>(<a href="#8b08ec1a3ea0cdc7" class="t t">CabinetNativeApi</a>.<a href="#67f6fa44177e8bc2" class="i method">FdiWrite</a>);
            <a href="#299dbb2620382db3" class="i field">_fdiWriteHandle</a> = <span class="i">GCHandle</span>.<span class="i">Alloc</span>(<a href="#e246d0e23ddfd625" class="i field">_writeDelegate</a>);
 
            <a href="#77c196026a420ed6" class="i field">_closeDelegate</a> = <b>new</b> <a href="#8b08ec1a3ea0cdc7" class="t t">CabinetNativeApi</a>.<span class="t">FdiCloseDelegate</span>(<a href="#8b08ec1a3ea0cdc7" class="t t">CabinetNativeApi</a>.<a href="#bbe4b0bff8bc0ce6" class="i method">FdiClose</a>);
            <a href="#845414f4c711f827" class="i field">_fdiCloseHandle</a> = <span class="i">GCHandle</span>.<span class="i">Alloc</span>(<a href="#77c196026a420ed6" class="i field">_closeDelegate</a>);
 
            <a href="#6f92c8da06f694c9" class="i field">_seekDelegate</a> = <b>new</b> <a href="#8b08ec1a3ea0cdc7" class="t t">CabinetNativeApi</a>.<span class="t">FdiSeekDelegate</span>(<a href="#8b08ec1a3ea0cdc7" class="t t">CabinetNativeApi</a>.<a href="#5a1de068daba4d53" class="i method">FdiSeek</a>);
            <a href="#97de24f6be742f02" class="i field">_fdiSeekHandle</a> = <span class="i">GCHandle</span>.<span class="i">Alloc</span>(<a href="#6f92c8da06f694c9" class="i field">_seekDelegate</a>);
 
            <a href="#a7f17ee241ee85e0" class="i field">_notifyDelegate</a> = <b>new</b> <a href="#8b08ec1a3ea0cdc7" class="t t">CabinetNativeApi</a>.<span class="t">FdiNotifyDelegate</span>(<a href="#8b08ec1a3ea0cdc7" class="t t">CabinetNativeApi</a>.<a href="#44917a956c0a4320" class="i method">FdiNotify</a>);
            <a href="#055c4ac504e19cc3" class="i field">_fdiNotifyHandle</a> = <span class="i">GCHandle</span>.<span class="i">Alloc</span>(<a href="#a7f17ee241ee85e0" class="i field">_notifyDelegate</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Frees all the delegate handles.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private void</b> <a id="3142084efb2eaf0e" href="../R/3142084efb2eaf0e.html" target="n" data-glyph="76,1" class="i method">CleanUpDelegates</a>()
        {
            <span class="c">// Free GCHandles so that the memory they point to may be unpinned (garbage collected)</span>
            <b>if</b> (<a href="#953c194d1783e1f3" class="i field">_fdiAllocHandle</a>.<span class="i">IsAllocated</span>)
            {
                <a href="#953c194d1783e1f3" class="i field">_fdiAllocHandle</a>.<span class="i">Free</span>();
                <a href="#d7d5324a64eed11f" class="i field">_fdiFreeHandle</a>.<span class="i">Free</span>();
                <a href="#00555767f41a4242" class="i field">_fdiOpenHandle</a>.<span class="i">Free</span>();
                <a href="#872737a2fa89b46c" class="i field">_fdiReadHandle</a>.<span class="i">Free</span>();
                <a href="#299dbb2620382db3" class="i field">_fdiWriteHandle</a>.<span class="i">Free</span>();
                <a href="#845414f4c711f827" class="i field">_fdiCloseHandle</a>.<span class="i">Free</span>();
                <a href="#97de24f6be742f02" class="i field">_fdiSeekHandle</a>.<span class="i">Free</span>();
                <a href="#055c4ac504e19cc3" class="i field">_fdiNotifyHandle</a>.<span class="i">Free</span>();
            }
        }
    }
 
    <span class="c">// CabinetExtractor loader implementation</span>
    <b>internal class</b> <a id="22675a86b4b646ff" href="../R/22675a86b4b646ff.html" target="n" data-glyph="2,0" class="t t"><span id="5aac1e83e2e87ca7">CabinetExtractorLoader</span></a> : <a href="CabinetAPI.cs.html#0cc7de20ac306352" class="t t">ICabinetExtractorLoader</a>
    {
        <b>private static</b> <a href="#a198ffb17d970ce9" class="t t">CabinetExtractor</a> <a id="4c06b3c5136b89ad" href="../R/4c06b3c5136b89ad.html" target="n" data-glyph="46,1" class="i field">s_extractorInstance</a>;
        <b>private static</b> <a href="#22675a86b4b646ff" class="t t">CabinetExtractorLoader</a> <a id="e065d801e4882b66" href="../R/e065d801e4882b66.html" target="n" data-glyph="46,1" class="i field">s_instance</a>;
        <b>private static double</b> <a id="348d8e41c66bfa05" href="../R/348d8e41c66bfa05.html" target="n" data-glyph="46,1" class="i field">s_created</a> = 0;
 
        <b>internal static</b> <a href="#22675a86b4b646ff" class="t t">CabinetExtractorLoader</a> <a id="caf1f9cc05d06e4e" href="../R/caf1f9cc05d06e4e.html" target="n" data-glyph="74,1" class="i method">GetInstance</a>()
        {
            <b>if</b> (<span class="i n">System</span>.<span class="i">Threading</span>.<span class="i">Interlocked</span>.<span class="i">CompareExchange</span>(<b>ref</b> <a href="#348d8e41c66bfa05" class="i field">s_created</a>, 1, 0) == 0)
            {
                <a href="#e065d801e4882b66" class="i field">s_instance</a> = <b>new</b> <span class="t">CabinetExtractorLoader</span>();
                <a href="#4c06b3c5136b89ad" class="i field">s_extractorInstance</a> = <b>new</b> <a href="#a3d8f21159803e7f" class="t constructor">CabinetExtractor</a>();
            }
 
            <b>return</b> <a href="#e065d801e4882b66" class="i field">s_instance</a>;
        }
 
        <b>internal override</b> <a href="CabinetAPI.cs.html#b9055edeb1565f83" class="t t">ICabinetExtractor</a> <a id="4280e30219391cbe" href="../R/4280e30219391cbe.html" target="n" data-glyph="74,1" class="i method">GetCabinetExtractor</a>()
        {
            <b>return</b> <a href="#4c06b3c5136b89ad" class="i field">s_extractorInstance</a>;
        }
    }
 
    <b>internal static class</b> <a id="8b08ec1a3ea0cdc7" href="../R/8b08ec1a3ea0cdc7.html" target="n" data-glyph="2,0" class="t t">CabinetNativeApi</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Delegates and function definitions
 
        [<span class="i">UnmanagedFunctionPointer</span>(<span class="i">CallingConvention</span>.<span class="i">Cdecl</span>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Ansi</span>)]
        <b>internal delegate</b> <span class="i">IntPtr</span> <a id="f8b01872392fceb8" href="../R/f8b01872392fceb8.html" target="n" data-glyph="14,1" class="t t"><span id="f9744cfa0921d73d">FdiAllocDelegate</span></a>(<b>int</b> <span id="r7 rd" class="r7 r">size</span>);
 
        <b>internal static</b> <span class="i">IntPtr</span> <a id="33defafe9fb07b35" href="../R/33defafe9fb07b35.html" target="n" data-glyph="74,1" class="i method">FdiAlloc</a>(<b>int</b> <span id="r8 rd" class="r8 r">size</span>)
        {
            <b>try</b>
            {
                <b>return</b> <span class="i">Marshal</span>.<span class="i">AllocHGlobal</span>(<span class="r8 r">size</span>);
            }
            <b>catch</b> (<span class="i">OutOfMemoryException</span>)
            {
                <b>return</b> <span class="i">IntPtr</span>.<span class="i">Zero</span>;
            }
        }
 
        [<span class="i">UnmanagedFunctionPointer</span>(<span class="i">CallingConvention</span>.<span class="i">Cdecl</span>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Ansi</span>)]
        <b>internal delegate void</b> <a id="b83f2844157046f3" href="../R/b83f2844157046f3.html" target="n" data-glyph="14,1" class="t t"><span id="ceabc0892c6c1557">FdiFreeDelegate</span></a>(<span class="i">IntPtr</span> <span id="r9 rd" class="r9 r">memblock</span>);
 
        <b>internal static void</b> <a id="5aa5dfa311dd2054" href="../R/5aa5dfa311dd2054.html" target="n" data-glyph="74,1" class="i method">FdiFree</a>(<span class="i">IntPtr</span> <span id="r10 rd" class="r10 r">memblock</span>)
        {
            <span class="i">Marshal</span>.<span class="i">FreeHGlobal</span>(<span class="r10 r">memblock</span>);
        }
 
        [<span class="i">UnmanagedFunctionPointer</span>(<span class="i">CallingConvention</span>.<span class="i">Cdecl</span>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Ansi</span>)]
        <b>internal delegate</b> <span class="i">IntPtr</span> <a id="b86c56316acd970a" href="../R/b86c56316acd970a.html" target="n" data-glyph="14,1" class="t t"><span id="3535878df4e94650">FdiOpenDelegate</span></a>(
            [<span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">LPStr</span>)] <b>string</b> <span id="r11 rd" class="r11 r">filename</span>,
            <b>int</b> <span id="r12 rd" class="r12 r">oflag</span>,
            <b>int</b> <span id="r13 rd" class="r13 r">pmode</span>);
 
        <b>internal static</b> <span class="i">IntPtr</span> <a id="ce587c1cf0e912dd" href="../R/ce587c1cf0e912dd.html" target="n" data-glyph="74,1" class="i method">FdiOpen</a>(<b>string</b> <span id="r14 rd" class="r14 r">filename</span>, <b>int</b> <span id="r15 rd" class="r15 r">oflag</span>, <b>int</b> <span id="r16 rd" class="r16 r">pmode</span>)
        {
            <span class="i">FileMode</span> <span id="r17 rd" class="r17 r">mode</span> = <a href="#8b08ec1a3ea0cdc7" class="t t">CabinetNativeApi</a>.<a href="#44267cfbe3ea1f77" class="i method">ConvertOpflagToFileMode</a>(<span class="r15 r">oflag</span>);
 
            <span class="i">FileAccess</span> <span id="r18 rd" class="r18 r">access</span> = <a href="#8b08ec1a3ea0cdc7" class="t t">CabinetNativeApi</a>.<a href="#e5f83af8a8f4b9c7" class="i method">ConvertPermissionModeToFileAccess</a>(<span class="r16 r">pmode</span>);
            <span class="i">FileShare</span> <span id="r19 rd" class="r19 r">share</span> = <a href="#8b08ec1a3ea0cdc7" class="t t">CabinetNativeApi</a>.<a href="#88fbec5f885c0f43" class="i method">ConvertPermissionModeToFileShare</a>(<span class="r16 r">pmode</span>);
 
            <span class="c">// This method is used for opening the cab file as well as saving the extracted files.</span>
            <span class="c">// When we are opening the cab file we only need read permissions.</span>
            <span class="c">// We force read permissions so that non-elevated users can extract cab files.</span>
            <b>if</b> (<span class="r17 r">mode</span> == <span class="i">FileMode</span>.<span class="i">Open</span> || <span class="r17 r">mode</span> == <span class="i">FileMode</span>.<span class="i">OpenOrCreate</span>)
            {
                <span class="r18 r">access</span> = <span class="i">FileAccess</span>.<span class="i">Read</span>;
                <span class="r19 r">share</span> = <span class="i">FileShare</span>.<span class="i">Read</span>;
            }
 
            <b>try</b>
            {
                <span class="i">FileStream</span> <span id="r20 rd" class="r20 r">stream</span> = <b>new</b> <span class="i">FileStream</span>(<span class="r14 r">filename</span>, <span class="r17 r">mode</span>, <span class="r18 r">access</span>, <span class="r19 r">share</span>);
 
                <b>if</b> (<span class="r20 r">stream</span> == <b>null</b>)
                {
                    <b>return</b> <b>new</b> <span class="i">IntPtr</span>(-1);
                }
 
                <b>return</b> <span class="i">GCHandle</span>.<span class="i">ToIntPtr</span>(<span class="i">GCHandle</span>.<span class="i">Alloc</span>(<span class="r20 r">stream</span>));
            }
            <b>catch</b> (<span class="i">IOException</span>)
            {
                <b>return</b> <b>new</b> <span class="i">IntPtr</span>(-1);
            }
        }
 
        [<span class="i">UnmanagedFunctionPointer</span>(<span class="i">CallingConvention</span>.<span class="i">Cdecl</span>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Ansi</span>)]
        <b>internal delegate int</b> <a id="050a98b039fc861b" href="../R/050a98b039fc861b.html" target="n" data-glyph="14,1" class="t t"><span id="622e7cc4ecc5eac5">FdiReadDelegate</span></a>(
            <span class="i">IntPtr</span> <span id="r21 rd" class="r21 r">fp</span>,
            [<span class="i">In</span>, <span class="i">Out</span>]
            [<span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">LPArray</span>, <span class="i">SizeParamIndex</span> = 2, <span class="i">ArraySubType</span> = <span class="i">UnmanagedType</span>.<span class="i">U1</span>)]
            <b>byte</b>[] <span id="r22 rd" class="r22 r">buffer</span>,
            <b>int</b> <span id="r23 rd" class="r23 r">count</span>);
 
        <b>internal static int</b> <a id="4da9ebf1babff374" href="../R/4da9ebf1babff374.html" target="n" data-glyph="74,1" class="i method">FdiRead</a>(<span class="i">IntPtr</span> <span id="r24 rd" class="r24 r">fp</span>, <b>byte</b>[] <span id="r25 rd" class="r25 r">buffer</span>, <b>int</b> <span id="r26 rd" class="r26 r">count</span>)
        {
            <span class="i">GCHandle</span> <span id="r27 rd" class="r27 r">handle</span> = <span class="i">GCHandle</span>.<span class="i">FromIntPtr</span>(<span class="r24 r">fp</span>);
            <span class="i">FileStream</span> <span id="r28 rd" class="r28 r">stream</span> = (<span class="i">FileStream</span>)<span class="r27 r">handle</span>.<span class="i">Target</span>;
 
            <b>int</b> <span id="r29 rd" class="r29 r">numCharactersRead</span> = 0;
            <b>try</b>
            {
                <span class="r29 r">numCharactersRead</span> = <span class="r28 r">stream</span>.<span class="i">Read</span>(<span class="r25 r">buffer</span>, 0, <span class="r26 r">count</span>);
            }
            <b>catch</b> (<span class="i">ArgumentNullException</span>) { <span class="r29 r">numCharactersRead</span> = -1; }
            <b>catch</b> (<span class="i">ArgumentOutOfRangeException</span>) { <span class="r29 r">numCharactersRead</span> = -1; }
            <b>catch</b> (<span class="i">NotSupportedException</span>) { <span class="r29 r">numCharactersRead</span> = -1; }
            <b>catch</b> (<span class="i">IOException</span>) { <span class="r29 r">numCharactersRead</span> = -1; }
            <b>catch</b> (<span class="i">ArgumentException</span>) { <span class="r29 r">numCharactersRead</span> = -1; }
            <b>catch</b> (<span class="i">ObjectDisposedException</span>) { <span class="r29 r">numCharactersRead</span> = -1; }
 
            <b>return</b> <span class="r29 r">numCharactersRead</span>;
        }
 
        [<span class="i">UnmanagedFunctionPointer</span>(<span class="i">CallingConvention</span>.<span class="i">Cdecl</span>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Ansi</span>)]
        <b>internal delegate int</b> <a id="6a6fab8a00957d5a" href="../R/6a6fab8a00957d5a.html" target="n" data-glyph="14,1" class="t t"><span id="421eafddbec6e491">FdiWriteDelegate</span></a>(
            <span class="i">IntPtr</span> <span id="r30 rd" class="r30 r">fp</span>,
            [<span class="i">In</span>]
            [<span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">LPArray</span>, <span class="i">SizeParamIndex</span> = 2, <span class="i">ArraySubType</span> = <span class="i">UnmanagedType</span>.<span class="i">U1</span>)]
            <b>byte</b>[] <span id="r31 rd" class="r31 r">buffer</span>,
            <b>int</b> <span id="r32 rd" class="r32 r">count</span>);
 
        <b>internal static int</b> <a id="67f6fa44177e8bc2" href="../R/67f6fa44177e8bc2.html" target="n" data-glyph="74,1" class="i method">FdiWrite</a>(<span class="i">IntPtr</span> <span id="r33 rd" class="r33 r">fp</span>, <b>byte</b>[] <span id="r34 rd" class="r34 r">buffer</span>, <b>int</b> <span id="r35 rd" class="r35 r">count</span>)
        {
            <span class="i">GCHandle</span> <span id="r36 rd" class="r36 r">handle</span> = <span class="i">GCHandle</span>.<span class="i">FromIntPtr</span>(<span class="r33 r">fp</span>);
            <span class="i">FileStream</span> <span id="r37 rd" class="r37 r">stream</span> = (<span class="i">FileStream</span>)<span class="r36 r">handle</span>.<span class="i">Target</span>;
 
            <b>int</b> <span id="r38 rd" class="r38 r">numCharactersWritten</span> = 0;
            <b>try</b>
            {
                <span class="r37 r">stream</span>.<span class="i">Write</span>(<span class="r34 r">buffer</span>, 0, <span class="r35 r">count</span>);
                <span class="r38 r">numCharactersWritten</span> = <span class="r35 r">count</span>; <span class="c">// Write doesn&#39;t return the number of bytes written. Per MSDN, if it succeeds, it will have written count bytes.</span>
            }
            <b>catch</b> (<span class="i">ArgumentNullException</span>) { <span class="r38 r">numCharactersWritten</span> = -1; }
            <b>catch</b> (<span class="i">ArgumentOutOfRangeException</span>) { <span class="r38 r">numCharactersWritten</span> = -1; }
            <b>catch</b> (<span class="i">NotSupportedException</span>) { <span class="r38 r">numCharactersWritten</span> = -1; }
            <b>catch</b> (<span class="i">IOException</span>) { <span class="r38 r">numCharactersWritten</span> = -1; }
            <b>catch</b> (<span class="i">ArgumentException</span>) { <span class="r38 r">numCharactersWritten</span> = -1; }
            <b>catch</b> (<span class="i">ObjectDisposedException</span>) { <span class="r38 r">numCharactersWritten</span> = -1; }
 
            <b>return</b> <span class="r38 r">numCharactersWritten</span>;
        }
 
        [<span class="i">UnmanagedFunctionPointer</span>(<span class="i">CallingConvention</span>.<span class="i">Cdecl</span>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Ansi</span>)]
        <b>internal delegate int</b> <a id="4cf424962021c8da" href="../R/4cf424962021c8da.html" target="n" data-glyph="14,1" class="t t"><span id="d8e77e845e21f8a7">FdiCloseDelegate</span></a>(<span class="i">IntPtr</span> <span id="r39 rd" class="r39 r">fp</span>);
 
        <b>internal static int</b> <a id="bbe4b0bff8bc0ce6" href="../R/bbe4b0bff8bc0ce6.html" target="n" data-glyph="74,1" class="i method">FdiClose</a>(<span class="i">IntPtr</span> <span id="r40 rd" class="r40 r">fp</span>)
        {
            <span class="i">GCHandle</span> <span id="r41 rd" class="r41 r">handle</span> = <span class="i">GCHandle</span>.<span class="i">FromIntPtr</span>(<span class="r40 r">fp</span>);
            <span class="i">FileStream</span> <span id="r42 rd" class="r42 r">stream</span> = (<span class="i">FileStream</span>)<span class="r41 r">handle</span>.<span class="i">Target</span>;
 
            <b>if</b> (<span class="r42 r">stream</span> == <b>null</b>)
            {
                <b>return</b> -1;
            }
            <b>else</b>
            {
                <span class="r42 r">stream</span>.<span class="i">Dispose</span>();
                <b>return</b> 0;
            }
        }
 
        [<span class="i">UnmanagedFunctionPointer</span>(<span class="i">CallingConvention</span>.<span class="i">Cdecl</span>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Ansi</span>)]
        <b>internal delegate int</b> <a id="a29011d0cb4729c0" href="../R/a29011d0cb4729c0.html" target="n" data-glyph="14,1" class="t t"><span id="79e1043eba68a19a">FdiSeekDelegate</span></a>(<span class="i">IntPtr</span> <span id="r43 rd" class="r43 r">fp</span>, <b>int</b> <span id="r44 rd" class="r44 r">offset</span>, <b>int</b> <span id="r45 rd" class="r45 r">origin</span>);
 
        <b>internal static int</b> <a id="5a1de068daba4d53" href="../R/5a1de068daba4d53.html" target="n" data-glyph="74,1" class="i method">FdiSeek</a>(<span class="i">IntPtr</span> <span id="r46 rd" class="r46 r">fp</span>, <b>int</b> <span id="r47 rd" class="r47 r">offset</span>, <b>int</b> <span id="r48 rd" class="r48 r">origin</span>)
        {
            <span class="i">GCHandle</span> <span id="r49 rd" class="r49 r">handle</span> = <span class="i">GCHandle</span>.<span class="i">FromIntPtr</span>(<span class="r46 r">fp</span>);
            <span class="i">FileStream</span> <span id="r50 rd" class="r50 r">stream</span> = (<span class="i">FileStream</span>)<span class="r49 r">handle</span>.<span class="i">Target</span>;
 
            <span class="i">SeekOrigin</span> <span id="r51 rd" class="r51 r">seekOrigin</span> = <a href="#8b08ec1a3ea0cdc7" class="t t">CabinetNativeApi</a>.<a href="#28208e19e68d3d4a" class="i method">ConvertOriginToSeekOrigin</a>(<span class="r48 r">origin</span>);
            <b>long</b> <span id="r52 rd" class="r52 r">status</span> = 0;
            <b>try</b>
            {
                <span class="r52 r">status</span> = <span class="r50 r">stream</span>.<span class="i">Seek</span>(<span class="r47 r">offset</span>, <span class="r51 r">seekOrigin</span>);
            }
            <b>catch</b> (<span class="i">NotSupportedException</span>) { <span class="r52 r">status</span> = -1; }
            <b>catch</b> (<span class="i">IOException</span>) { <span class="r52 r">status</span> = -1; }
            <b>catch</b> (<span class="i">ArgumentException</span>) { <span class="r52 r">status</span> = -1; }
            <b>catch</b> (<span class="i">ObjectDisposedException</span>) { <span class="r52 r">status</span> = -1; }
 
            <b>return</b> (<b>int</b>)<span class="r52 r">status</span>;
        }
 
        [<span class="i">UnmanagedFunctionPointer</span>(<span class="i">CallingConvention</span>.<span class="i">Cdecl</span>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Ansi</span>)]
        <b>internal delegate</b> <span class="i">IntPtr</span> <a id="847a152db0816faa" href="../R/847a152db0816faa.html" target="n" data-glyph="14,1" class="t t"><span id="d1ae4d5920b3bb1d">FdiNotifyDelegate</span></a>(<a href="#09a92f1bdcf5b82f" class="t t">FdiNotificationType</a> <span id="r53 rd" class="r53 r">fdint</span>, <a href="#6fbd5fb02788d66b" class="t t">FdiNotification</a> <span id="r54 rd" class="r54 r">fdin</span>);
 
        <span class="c">// Handles FDI notification</span>
        <b>internal static</b> <span class="i">IntPtr</span> <a id="44917a956c0a4320" href="../R/44917a956c0a4320.html" target="n" data-glyph="74,1" class="i method">FdiNotify</a>(<a href="#09a92f1bdcf5b82f" class="t t">FdiNotificationType</a> <span id="r55 rd" class="r55 r">fdint</span>, <a href="#6fbd5fb02788d66b" class="t t">FdiNotification</a> <span id="r56 rd" class="r56 r">fdin</span>)
        {
            <b>switch</b> (<span class="r55 r">fdint</span>)
            {
                <b>case</b> <a href="#09a92f1bdcf5b82f" class="t t">FdiNotificationType</a>.<a href="#be6588d86730ed99" class="i field">FdintCOPY_FILE</a>:
                    {
                        <span class="c">// TODO: Should I catch exceptions for the new functions?</span>
 
                        <span class="c">// Copy target directory</span>
                        <b>string</b> <span id="r57 rd" class="r57 r">destPath</span> = <span class="i">Marshal</span>.<span class="i">PtrToStringAnsi</span>(<span class="r56 r">fdin</span>.<a href="#fe9c91afc56af0b4" class="i field">pv</a>);
 
                        <span class="c">// Split the path to a filename and path</span>
                        <b>string</b> <span id="r58 rd" class="r58 r">fileName</span> = <span class="i">Path</span>.<span class="i">GetFileName</span>(<span class="r56 r">fdin</span>.<a href="#abbd9436806d5adb" class="i field">psz1</a>);
                        <b>string</b> <span id="r59 rd" class="r59 r">remainingPsz1Path</span> = <span class="i">Path</span>.<span class="i">GetDirectoryName</span>(<span class="r56 r">fdin</span>.<a href="#abbd9436806d5adb" class="i field">psz1</a>);
                        <span class="r57 r">destPath</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r57 r">destPath</span>, <span class="r59 r">remainingPsz1Path</span>);
 
                        <span class="i">Directory</span>.<span class="i">CreateDirectory</span>(<span class="r57 r">destPath</span>); <span class="c">// Creates all intermediate directories if necessary.</span>
 
                        <span class="c">// Create the file</span>
                        <b>string</b> <span id="r60 rd" class="r60 r">absoluteFilePath</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r57 r">destPath</span>, <span class="r58 r">fileName</span>);
                        <b>return</b> <a href="#8b08ec1a3ea0cdc7" class="t t">CabinetNativeApi</a>.<a href="#ce587c1cf0e912dd" class="i method">FdiOpen</a>(<span class="r60 r">absoluteFilePath</span>, (<b>int</b>)<a href="#a5b4757ac17bc3e8" class="t t">OpFlags</a>.<a href="#491dd1e923f07017" class="i field">Create</a>, (<b>int</b>)(<a href="#6ef98664243d2306" class="t t">PermissionMode</a>.<a href="#e7f5105d73876e46" class="i field">Read</a> | <a href="#6ef98664243d2306" class="t t">PermissionMode</a>.<a href="#a2312bdcc391141e" class="i field">Write</a>)); <span class="c">// TODO: OK to ignore _O_SEQUENTIAL, WrOnly, and _O_BINARY?</span>
                    }
                <b>case</b> <a href="#09a92f1bdcf5b82f" class="t t">FdiNotificationType</a>.<a href="#072c282d759fc7df" class="i field">FdintCLOSE_FILE_INFO</a>:
                    {
                        <span class="c">// Close the file</span>
                        <a href="#8b08ec1a3ea0cdc7" class="t t">CabinetNativeApi</a>.<a href="#bbe4b0bff8bc0ce6" class="i method">FdiClose</a>(<span class="r56 r">fdin</span>.<a href="#c4fa482f00e9b57b" class="i field">hf</a>);
 
                        <span class="c">// Set the file attributes</span>
                        <b>string</b> <span id="r61 rd" class="r61 r">destPath</span> = <span class="i">Marshal</span>.<span class="i">PtrToStringAnsi</span>(<span class="r56 r">fdin</span>.<a href="#fe9c91afc56af0b4" class="i field">pv</a>);
                        <b>string</b> <span id="r62 rd" class="r62 r">absoluteFilePath</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r61 r">destPath</span>, <span class="r56 r">fdin</span>.<a href="#abbd9436806d5adb" class="i field">psz1</a>);
 
                        <span class="i">IntPtr</span> <span id="r63 rd" class="r63 r">hFile</span> = <a href="../utils/PlatformInvokes.cs.html#efe149a5eeb6ff14" class="t t">PlatformInvokes</a>.<span class="i">CreateFile</span>(
                            <span class="r62 r">absoluteFilePath</span>,
                            <a href="../utils/PlatformInvokes.cs.html#efe149a5eeb6ff14" class="t t">PlatformInvokes</a>.<a href="../utils/PlatformInvokes.cs.html#c917bb5b57f8b6c2" class="t t">FileDesiredAccess</a>.<a href="../utils/PlatformInvokes.cs.html#d889a0388da600f1" class="i field">GenericRead</a> | <a href="../utils/PlatformInvokes.cs.html#efe149a5eeb6ff14" class="t t">PlatformInvokes</a>.<a href="../utils/PlatformInvokes.cs.html#c917bb5b57f8b6c2" class="t t">FileDesiredAccess</a>.<a href="../utils/PlatformInvokes.cs.html#02c401ccae577128" class="i field">GenericWrite</a>,
                            <a href="../utils/PlatformInvokes.cs.html#efe149a5eeb6ff14" class="t t">PlatformInvokes</a>.<a href="../utils/PlatformInvokes.cs.html#d9f96aadec6ee14b" class="t t">FileShareMode</a>.<a href="../utils/PlatformInvokes.cs.html#8d33044cbf7c58e2" class="i field">Read</a>,
                            <span class="i">IntPtr</span>.<span class="i">Zero</span>,
                            <a href="../utils/PlatformInvokes.cs.html#efe149a5eeb6ff14" class="t t">PlatformInvokes</a>.<a href="../utils/PlatformInvokes.cs.html#717d3430f9a0894c" class="t t">FileCreationDisposition</a>.<a href="../utils/PlatformInvokes.cs.html#e210b61821e30e4e" class="i field">OpenExisting</a>,
                            <a href="../utils/PlatformInvokes.cs.html#efe149a5eeb6ff14" class="t t">PlatformInvokes</a>.<a href="../utils/PlatformInvokes.cs.html#8a072c352540d495" class="t t">FileAttributes</a>.<a href="../utils/PlatformInvokes.cs.html#f65a9e13c0f7838d" class="i field">Normal</a>,
                            <span class="i">IntPtr</span>.<span class="i">Zero</span>);
 
                        <b>if</b> (<span class="r63 r">hFile</span> != <span class="i">IntPtr</span>.<span class="i">Zero</span>)
                        {
                            <a href="../utils/PlatformInvokes.cs.html#efe149a5eeb6ff14" class="t t">PlatformInvokes</a>.<a href="../utils/PlatformInvokes.cs.html#03e0d8d8ae4cbe62" class="t t">FILETIME</a> <span id="r64 rd" class="r64 r">ftFile</span> = <b>new</b> <a href="../utils/PlatformInvokes.cs.html#efe149a5eeb6ff14" class="t t">PlatformInvokes</a>.<a href="../utils/PlatformInvokes.cs.html#d0ab374e1e043ea8" class="t constructor">FILETIME</a>();
                            <b>if</b> (<a href="../utils/PlatformInvokes.cs.html#efe149a5eeb6ff14" class="t t">PlatformInvokes</a>.<a href="../utils/PlatformInvokes.cs.html#c6f3e103728f336b" class="i method">DosDateTimeToFileTime</a>(<span class="r56 r">fdin</span>.<a href="#25ab45d5f0ef58fb" class="i field">date</a>, <span class="r56 r">fdin</span>.<a href="#afc54dc239806d45" class="i field">time</a>, <span class="r64 r">ftFile</span>))
                            {
                                <a href="../utils/PlatformInvokes.cs.html#efe149a5eeb6ff14" class="t t">PlatformInvokes</a>.<a href="../utils/PlatformInvokes.cs.html#03e0d8d8ae4cbe62" class="t t">FILETIME</a> <span id="r65 rd" class="r65 r">ftLocal</span> = <b>new</b> <a href="../utils/PlatformInvokes.cs.html#efe149a5eeb6ff14" class="t t">PlatformInvokes</a>.<a href="../utils/PlatformInvokes.cs.html#d0ab374e1e043ea8" class="t constructor">FILETIME</a>();
                                <b>if</b> (<a href="../utils/PlatformInvokes.cs.html#efe149a5eeb6ff14" class="t t">PlatformInvokes</a>.<a href="../utils/PlatformInvokes.cs.html#a6eda48e7da1db04" class="i method">LocalFileTimeToFileTime</a>(<span class="r64 r">ftFile</span>, <span class="r65 r">ftLocal</span>))
                                {
                                    <a href="../utils/PlatformInvokes.cs.html#efe149a5eeb6ff14" class="t t">PlatformInvokes</a>.<a href="../utils/PlatformInvokes.cs.html#3411b76e4b090854" class="i method">SetFileTime</a>(<span class="r63 r">hFile</span>, <span class="r65 r">ftLocal</span>, <b>null</b>, <span class="r65 r">ftLocal</span>);
                                }
                            }
 
                            <a href="../utils/PlatformInvokes.cs.html#efe149a5eeb6ff14" class="t t">PlatformInvokes</a>.<a href="../utils/PlatformInvokes.cs.html#f1253a9f9c110d3f" class="i method">CloseHandle</a>(<span class="r63 r">hFile</span>);
                        }
 
                        <a href="../utils/PlatformInvokes.cs.html#efe149a5eeb6ff14" class="t t">PlatformInvokes</a>.<span class="i">SetFileAttributesW</span>(
                            <span class="r62 r">absoluteFilePath</span>,
                            (<a href="../utils/PlatformInvokes.cs.html#efe149a5eeb6ff14" class="t t">PlatformInvokes</a>.<a href="../utils/PlatformInvokes.cs.html#8a072c352540d495" class="t t">FileAttributes</a>)<span class="r56 r">fdin</span>.<a href="#6c09ec82f9a34130" class="i field">attribs</a> &amp; (<a href="../utils/PlatformInvokes.cs.html#efe149a5eeb6ff14" class="t t">PlatformInvokes</a>.<a href="../utils/PlatformInvokes.cs.html#8a072c352540d495" class="t t">FileAttributes</a>.<a href="../utils/PlatformInvokes.cs.html#2ce9f93e88a7f4a4" class="i field">ReadOnly</a> | <a href="../utils/PlatformInvokes.cs.html#efe149a5eeb6ff14" class="t t">PlatformInvokes</a>.<a href="../utils/PlatformInvokes.cs.html#8a072c352540d495" class="t t">FileAttributes</a>.<a href="../utils/PlatformInvokes.cs.html#081c333a362b82a1" class="i field">Hidden</a> | <a href="../utils/PlatformInvokes.cs.html#efe149a5eeb6ff14" class="t t">PlatformInvokes</a>.<a href="../utils/PlatformInvokes.cs.html#8a072c352540d495" class="t t">FileAttributes</a>.<a href="../utils/PlatformInvokes.cs.html#a9183c45ede6b7e0" class="i field">System</a> | <a href="../utils/PlatformInvokes.cs.html#efe149a5eeb6ff14" class="t t">PlatformInvokes</a>.<a href="../utils/PlatformInvokes.cs.html#8a072c352540d495" class="t t">FileAttributes</a>.<a href="../utils/PlatformInvokes.cs.html#3d4ce0cf4dfe4253" class="i field">Archive</a>));
 
                        <span class="c">// Call notification function</span>
                        <b>return</b> <b>new</b> <span class="i">IntPtr</span>(1);
                    }
            }
 
            <b>return</b> <b>new</b> <span class="i">IntPtr</span>(0);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Helper methods for non-trivial conversions
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Converts an unmanaged define into a known managed value.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r66 r">origin</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Defined in stdio.h.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The appropriate System.IO.SeekOrigin value.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static</b> <span class="i">SeekOrigin</span> <a id="28208e19e68d3d4a" href="../R/28208e19e68d3d4a.html" target="n" data-glyph="74,1" class="i method">ConvertOriginToSeekOrigin</a>(<b>int</b> <span id="r66 rd" class="r66 r">origin</span>)
        {
            <b>switch</b> (<span class="r66 r">origin</span>)
            {
                <b>case</b> 0x0: <span class="c">// SEEK_SET</span>
                    <b>return</b> <span class="i">SeekOrigin</span>.<span class="i">Begin</span>;
                <b>case</b> 0x1: <span class="c">// SEEK_CUR</span>
                    <b>return</b> <span class="i">SeekOrigin</span>.<span class="i">Current</span>;
                <b>case</b> 0x2: <span class="c">// SEEK_END</span>
                    <b>return</b> <span class="i">SeekOrigin</span>.<span class="i">End</span>;
                <b>default</b>:
                    <b>return</b> <span class="i">SeekOrigin</span>.<span class="i">Current</span>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Converts an unmanaged define into a known managed type.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r67 r">oflag</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Operation mode defined in fcntl.h.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The appropriate System.IO.FileMode type.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static</b> <span class="i">FileMode</span> <a id="44267cfbe3ea1f77" href="../R/44267cfbe3ea1f77.html" target="n" data-glyph="74,1" class="i method">ConvertOpflagToFileMode</a>(<b>int</b> <span id="r67 rd" class="r67 r">oflag</span>)
        {
            <span class="c">// Note: This is not done in a switch because the order of tests matters.</span>
 
            <b>if</b> ((<span class="r67 r">oflag</span> &amp; (<b>int</b>)(<a href="#a5b4757ac17bc3e8" class="t t">OpFlags</a>.<a href="#491dd1e923f07017" class="i field">Create</a> | <a href="#a5b4757ac17bc3e8" class="t t">OpFlags</a>.<a href="#3d18e60378ccc4a7" class="i field">Excl</a>)) == (<b>int</b>)(<a href="#a5b4757ac17bc3e8" class="t t">OpFlags</a>.<a href="#491dd1e923f07017" class="i field">Create</a> | <a href="#a5b4757ac17bc3e8" class="t t">OpFlags</a>.<a href="#3d18e60378ccc4a7" class="i field">Excl</a>))
            {
                <b>return</b> <span class="i">FileMode</span>.<span class="i">CreateNew</span>;
            }
            <b>else</b> <b>if</b> ((<span class="r67 r">oflag</span> &amp; (<b>int</b>)(<a href="#a5b4757ac17bc3e8" class="t t">OpFlags</a>.<a href="#491dd1e923f07017" class="i field">Create</a> | <a href="#a5b4757ac17bc3e8" class="t t">OpFlags</a>.<a href="#03246f35b24e26df" class="i field">Truncate</a>)) == (<b>int</b>)(<a href="#a5b4757ac17bc3e8" class="t t">OpFlags</a>.<a href="#491dd1e923f07017" class="i field">Create</a> | <a href="#a5b4757ac17bc3e8" class="t t">OpFlags</a>.<a href="#03246f35b24e26df" class="i field">Truncate</a>))
            {
                <b>return</b> <span class="i">FileMode</span>.<span class="i">OpenOrCreate</span>;
            }
            <b>else</b> <b>if</b> ((<span class="r67 r">oflag</span> &amp; (<b>int</b>)<a href="#a5b4757ac17bc3e8" class="t t">OpFlags</a>.<a href="#c85842005bdc09e4" class="i field">Append</a>) != 0)
            {
                <b>return</b> <span class="i">FileMode</span>.<span class="i">Append</span>;
            }
            <b>else</b> <b>if</b> ((<span class="r67 r">oflag</span> &amp; (<b>int</b>)<a href="#a5b4757ac17bc3e8" class="t t">OpFlags</a>.<a href="#491dd1e923f07017" class="i field">Create</a>) != 0)
            {
                <b>return</b> <span class="i">FileMode</span>.<span class="i">Create</span>;
            }
            <b>else</b> <b>if</b> ((<span class="r67 r">oflag</span> &amp; (<b>int</b>)<a href="#a5b4757ac17bc3e8" class="t t">OpFlags</a>.<a href="#35cfd17c4e3938ae" class="i field">RdWr</a>) != 0)
            {
                <b>return</b> <span class="i">FileMode</span>.<span class="i">Open</span>;
            }
            <b>else</b> <b>if</b> ((<span class="r67 r">oflag</span> &amp; (<b>int</b>)<a href="#a5b4757ac17bc3e8" class="t t">OpFlags</a>.<a href="#03246f35b24e26df" class="i field">Truncate</a>) != 0)
            {
                <b>return</b> <span class="i">FileMode</span>.<span class="i">Truncate</span>;
            }
            <b>else</b>
            {
                <b>return</b> <span class="i">FileMode</span>.<span class="i">OpenOrCreate</span>; <span class="c">// This seemed the safest way to handled unrecognized types</span>
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Converts an unmanaged define into a known managed type.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r68 r">pmode</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Permission mode defined in stat.h.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The appropriate System.IO.FileAccess type.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static</b> <span class="i">FileAccess</span> <a id="e5f83af8a8f4b9c7" href="../R/e5f83af8a8f4b9c7.html" target="n" data-glyph="74,1" class="i method">ConvertPermissionModeToFileAccess</a>(<b>int</b> <span id="r68 rd" class="r68 r">pmode</span>)
        {
            <span class="c">// Note: This is not done in a switch because the order of tests matters.</span>
 
            <b>if</b> ((<span class="r68 r">pmode</span> &amp; (<b>int</b>)(<a href="#6ef98664243d2306" class="t t">PermissionMode</a>.<a href="#e7f5105d73876e46" class="i field">Read</a> | <a href="#6ef98664243d2306" class="t t">PermissionMode</a>.<a href="#a2312bdcc391141e" class="i field">Write</a>)) == (<b>int</b>)(<a href="#6ef98664243d2306" class="t t">PermissionMode</a>.<a href="#e7f5105d73876e46" class="i field">Read</a> | <a href="#6ef98664243d2306" class="t t">PermissionMode</a>.<a href="#a2312bdcc391141e" class="i field">Write</a>))
            {
                <b>return</b> <span class="i">FileAccess</span>.<span class="i">ReadWrite</span>;
            }
            <b>else</b> <b>if</b> ((<span class="r68 r">pmode</span> &amp; (<b>int</b>)<a href="#6ef98664243d2306" class="t t">PermissionMode</a>.<a href="#e7f5105d73876e46" class="i field">Read</a>) != 0)
            {
                <b>return</b> <span class="i">FileAccess</span>.<span class="i">Read</span>;
            }
            <b>else</b> <b>if</b> ((<span class="r68 r">pmode</span> &amp; (<b>int</b>)<a href="#6ef98664243d2306" class="t t">PermissionMode</a>.<a href="#a2312bdcc391141e" class="i field">Write</a>) != 0)
            {
                <b>return</b> <span class="i">FileAccess</span>.<span class="i">Write</span>;
            }
            <b>else</b>
            {
                <b>return</b> <span class="i">FileAccess</span>.<span class="i">Read</span>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Converts an unmanaged define into a known managed type.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r69 r">pmode</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Permission mode defined in stat.h.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The appropriate System.IO.FileShare type.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static</b> <span class="i">FileShare</span> <a id="88fbec5f885c0f43" href="../R/88fbec5f885c0f43.html" target="n" data-glyph="74,1" class="i method">ConvertPermissionModeToFileShare</a>(<b>int</b> <span id="r69 rd" class="r69 r">pmode</span>)
        {
            <span class="c">// Note: This is not done in a switch because the order of tests matters.</span>
 
            <b>if</b> ((<span class="r69 r">pmode</span> &amp; (<b>int</b>)(<a href="#6ef98664243d2306" class="t t">PermissionMode</a>.<a href="#e7f5105d73876e46" class="i field">Read</a> | <a href="#6ef98664243d2306" class="t t">PermissionMode</a>.<a href="#a2312bdcc391141e" class="i field">Write</a>)) == (<b>int</b>)(<a href="#6ef98664243d2306" class="t t">PermissionMode</a>.<a href="#e7f5105d73876e46" class="i field">Read</a> | <a href="#6ef98664243d2306" class="t t">PermissionMode</a>.<a href="#a2312bdcc391141e" class="i field">Write</a>))
            {
                <b>return</b> <span class="i">FileShare</span>.<span class="i">ReadWrite</span>;
            }
            <b>else</b> <b>if</b> ((<span class="r69 r">pmode</span> &amp; (<b>int</b>)<a href="#6ef98664243d2306" class="t t">PermissionMode</a>.<a href="#e7f5105d73876e46" class="i field">Read</a>) != 0)
            {
                <b>return</b> <span class="i">FileShare</span>.<span class="i">Read</span>;
            }
            <b>else</b> <b>if</b> ((<span class="r69 r">pmode</span> &amp; (<b>int</b>)<a href="#6ef98664243d2306" class="t t">PermissionMode</a>.<a href="#a2312bdcc391141e" class="i field">Write</a>) != 0)
            {
                <b>return</b> <span class="i">FileShare</span>.<span class="i">Write</span>;
            }
            <b>else</b>
            {
                <b>return</b> <span class="i">FileShare</span>.<span class="i">Read</span>;
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> IO classes, structures, and enums
 
        [<span class="i">FlagsAttribute</span>]
        <b>internal enum</b> <a id="6ef98664243d2306" href="../R/6ef98664243d2306.html" target="n" data-glyph="20,1" class="t t"><span id="606ac916fb91d6f0">PermissionMode</span></a> : <b>int</b>
        {
            <a id="0fb48feac27098de" href="../R/../../0000000000.html" target="n" data-glyph="24,2" class="i field">None</a> = 0x0000,
            <a id="a2312bdcc391141e" href="../R/a2312bdcc391141e.html" target="n" data-glyph="24,2" class="i field">Write</a> = 0x0080,
            <a id="e7f5105d73876e46" href="../R/e7f5105d73876e46.html" target="n" data-glyph="24,2" class="i field">Read</a> = 0x0100
        }
 
        [<span class="i">FlagsAttribute</span>]
        <b>internal enum</b> <a id="a5b4757ac17bc3e8" href="../R/a5b4757ac17bc3e8.html" target="n" data-glyph="20,1" class="t t"><span id="f77563ffe2e2483a">OpFlags</span></a> : <b>int</b>
        {
            <a id="4709d8ff9c5cd5d9" href="../R/../../0000000000.html" target="n" data-glyph="24,2" class="i field">RdOnly</a> = 0x0000,
            <a id="944dea1e3c6dc842" href="../R/../../0000000000.html" target="n" data-glyph="24,2" class="i field">WrOnly</a> = 0x0001,
            <a id="35cfd17c4e3938ae" href="../R/35cfd17c4e3938ae.html" target="n" data-glyph="24,2" class="i field">RdWr</a> = 0x0002,
            <a id="c85842005bdc09e4" href="../R/c85842005bdc09e4.html" target="n" data-glyph="24,2" class="i field">Append</a> = 0x0008,
            <a id="491dd1e923f07017" href="../R/491dd1e923f07017.html" target="n" data-glyph="24,2" class="i field">Create</a> = 0x0100,
            <a id="03246f35b24e26df" href="../R/03246f35b24e26df.html" target="n" data-glyph="24,2" class="i field">Truncate</a> = 0x0200,
            <a id="3d18e60378ccc4a7" href="../R/3d18e60378ccc4a7.html" target="n" data-glyph="24,2" class="i field">Excl</a> = 0x0400
        }
 
        <b>internal enum</b> <a id="a956476322dbaa07" href="../R/a956476322dbaa07.html" target="n" data-glyph="20,1" class="t t"><span id="12b70de1b9e9e7b3">FdiCreateCpuType</span></a> : <b>int</b>
        {
            <a id="f56c91d4788a3d98" href="../R/../../0000000000.html" target="n" data-glyph="24,2" class="i field">CpuUnknown</a> = -1,
            <a id="48c98f3d764af5f6" href="../R/../../0000000000.html" target="n" data-glyph="24,2" class="i field">Cpu80286</a> = 0,
            <a id="6a1da6230cc0ae6c" href="../R/6a1da6230cc0ae6c.html" target="n" data-glyph="24,2" class="i field">Cpu80386</a> = 1
        }
 
        [<span class="i">StructLayout</span>(<span class="i">LayoutKind</span>.<span class="i">Sequential</span>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Ansi</span>)]
        <b>internal class</b> <a id="6fbd5fb02788d66b" href="../R/6fbd5fb02788d66b.html" target="n" data-glyph="2,1" class="t t"><span id="eb5a0a2039145db8">FdiNotification</span></a>
        {
            <b>internal int</b> <a id="f095633b5f69053b" href="../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">cb</a>; <span class="c">// LONG</span>
            <b>internal string</b> <a id="abbd9436806d5adb" href="../R/abbd9436806d5adb.html" target="n" data-glyph="44,2" class="i field">psz1</a>; <span class="c">// char FAR *</span>
            <b>internal string</b> <a id="f43269de2ab72598" href="../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">psz2</a>; <span class="c">// char FAR *</span>
            <b>internal string</b> <a id="e558b371bf388b8a" href="../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">psz3</a>; <span class="c">// char FAR *</span>
            <b>internal</b> <span class="i">IntPtr</span> <a id="fe9c91afc56af0b4" href="../R/fe9c91afc56af0b4.html" target="n" data-glyph="44,2" class="i field">pv</a>; <span class="c">// void FAR * // In this case, it is the destination path</span>
            <b>internal</b> <span class="i">IntPtr</span> <a id="c4fa482f00e9b57b" href="../R/c4fa482f00e9b57b.html" target="n" data-glyph="44,2" class="i field">hf</a>; <span class="c">// INT_PTR</span>
            <b>internal short</b> <a id="25ab45d5f0ef58fb" href="../R/25ab45d5f0ef58fb.html" target="n" data-glyph="44,2" class="i field">date</a>; <span class="c">// USHORT</span>
            <b>internal short</b> <a id="afc54dc239806d45" href="../R/afc54dc239806d45.html" target="n" data-glyph="44,2" class="i field">time</a>; <span class="c">// USHORT</span>
            <b>internal short</b> <a id="6c09ec82f9a34130" href="../R/6c09ec82f9a34130.html" target="n" data-glyph="44,2" class="i field">attribs</a>; <span class="c">// USHORT</span>
            <b>internal short</b> <a id="b10a674959d147f5" href="../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">setID</a>; <span class="c">// USHORT</span>
            <b>internal short</b> <a id="56033ed0ef12c8d1" href="../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">iCabinet</a>; <span class="c">// USHORT</span>
            <b>internal short</b> <a id="560d83c8d16a18a1" href="../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">iFolder</a>; <span class="c">// USHORT</span>
            <b>internal int</b> <a id="a58d9447b6404eb1" href="../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">fdie</a>; <span class="c">// FDIERROR</span>
        }
 
        <b>internal enum</b> <a id="09a92f1bdcf5b82f" href="../R/09a92f1bdcf5b82f.html" target="n" data-glyph="20,1" class="t t"><span id="a1efc8654a412322">FdiNotificationType</span></a> : <b>int</b>
        {
            <a id="0f534bac7ba64d1d" href="../R/../../0000000000.html" target="n" data-glyph="24,2" class="i field">FdintCABINET_INFO</a> = 0x0,
            <a id="cba7e85f4a40dd03" href="../R/../../0000000000.html" target="n" data-glyph="24,2" class="i field">FdintPARTIAL_FILE</a> = 0x1,
            <a id="be6588d86730ed99" href="../R/be6588d86730ed99.html" target="n" data-glyph="24,2" class="i field">FdintCOPY_FILE</a> = 0x2,
            <a id="072c282d759fc7df" href="../R/072c282d759fc7df.html" target="n" data-glyph="24,2" class="i field">FdintCLOSE_FILE_INFO</a> = 0x3,
            <a id="e08ab41551c2a1ca" href="../R/../../0000000000.html" target="n" data-glyph="24,2" class="i field">FdintNEXT_CABINET</a> = 0x4,
            <a id="ff53bc246ca12056" href="../R/../../0000000000.html" target="n" data-glyph="24,2" class="i field">FdintENUMERATE</a> = 0x5
        }
 
        [<span class="i">StructLayout</span>(<span class="i">LayoutKind</span>.<span class="i">Sequential</span>)]
        <b>internal class</b> <a id="d1764e8e4eff9b08" href="../R/d1764e8e4eff9b08.html" target="n" data-glyph="2,1" class="t t"><span id="fb95c12433faf2c6">FdiERF</span></a>
        {
            <b>internal int</b> <a id="7177a6cd1f8cac07" href="../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">erfOper</a>;
            <b>internal int</b> <a id="54792637e15fb71d" href="../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">erfType</a>;
            <b>internal bool</b> <a id="5efee79b29c736a6" href="../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">fError</a>;
        }
 
        <b>internal sealed class</b> <a id="1ad99c13b1129f63" href="../R/1ad99c13b1129f63.html" target="n" data-glyph="2,1" class="t t">FdiContextHandle</a> : <span class="i">SafeHandleZeroOrMinusOneIsInvalid</span>
        {
            <b>private</b> <a id="a845e1cf225ee85a" href="../R/../../0000000000.html" target="n" data-glyph="76,2" class="t constructor">FdiContextHandle</a>()
                : <b>base</b>(<b>true</b>)
            {
            }
 
            <b>protected override bool</b> <a id="1d83ca58cc058074" href="../R/../../0000000000.html" target="n" data-glyph="75,2" class="i method">ReleaseHandle</a>()
            {
                <b>return</b> <a href="#8b08ec1a3ea0cdc7" class="t t">CabinetNativeApi</a>.<span class="i">FDIDestroy</span>(<a href="#1ad99c13b1129f63" class="k">this</a>.<span class="i">handle</span>);
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> PInvoke Definitions
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates an FDI context.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r70 r">pfnalloc</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">_In_ PFNALLOC - Memory allocation delegate.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r71 r">pfnfree</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">_In_ PFNFREE - Memory free delegate.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r72 r">pfnopen</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">_In_ PFNOPEN - File open delegate.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r73 r">pfnread</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">_In_ PFNREAD - File read delegate.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r74 r">pfnwrite</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">_In_ PFNWRITE - File write delegate.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r75 r">pfnclose</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">_In_ PFNCLOSE - File close delegate.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r76 r">pfnseek</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">_In_ PFNSEEK - File seek delegate.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r77 r">cpuType</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">_In_ int - CPU type.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r78 r">erf</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">_Inout_ PERF - Error structure containing error information.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        [<span class="i">DllImport</span>(<span class="s">&quot;cabinet.dll&quot;</span>, <span class="i">ExactSpelling</span> = <b>true</b>, <span class="i">CallingConvention</span> = <span class="i">CallingConvention</span>.<span class="i">Cdecl</span>, <span class="i">SetLastError</span> = <b>true</b>)]
        <b>internal static extern</b> <a href="#1ad99c13b1129f63" class="t t">FdiContextHandle</a> <a id="8b1fb7fd8259db42" href="../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">FDICreate</a>(
            <span class="i">IntPtr</span> <span id="r70 rd" class="r70 r">pfnalloc</span>,
            <span class="i">IntPtr</span> <span id="r71 rd" class="r71 r">pfnfree</span>,
            <span class="i">IntPtr</span> <span id="r72 rd" class="r72 r">pfnopen</span>,
            <span class="i">IntPtr</span> <span id="r73 rd" class="r73 r">pfnread</span>,
            <span class="i">IntPtr</span> <span id="r74 rd" class="r74 r">pfnwrite</span>,
            <span class="i">IntPtr</span> <span id="r75 rd" class="r75 r">pfnclose</span>,
            <span class="i">IntPtr</span> <span id="r76 rd" class="r76 r">pfnseek</span>,
            <a href="#8b08ec1a3ea0cdc7" class="t t">CabinetNativeApi</a>.<a href="#a956476322dbaa07" class="t t">FdiCreateCpuType</a> <span id="r77 rd" class="r77 r">cpuType</span>,
            <a href="#d1764e8e4eff9b08" class="t t">FdiERF</a> <span id="r78 rd" class="r78 r">erf</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Extracts files from cabinets.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r79 r">hfdi</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">_In_ HFDI - A valid FDI context handle returned by FDICreate.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r80 r">pszCabinet</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">_In_ LPSTR - The name of the cabinet file.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r81 r">pszCabPath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">_In_ LPSTR - The path to the cabinet file excluding the file name.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r82 r">flags</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">_In_ int - Not defined.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r83 r">pfnfdin</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">_In_ PFNFDINOTIFY - Pointer to the notification callback delegate.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r84 r">pfnfdid</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">_In_ PFNFDIDECRYPT - Not used.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r85 r">pvUser</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">_In_opt_ void FAR * - Path string passed to the notification function.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        [<span class="i">DllImport</span>(<span class="s">&quot;cabinet.dll&quot;</span>, <span class="i">ExactSpelling</span> = <b>true</b>, <span class="i">CallingConvention</span> = <span class="i">CallingConvention</span>.<span class="i">Cdecl</span>, <span class="i">SetLastError</span> = <b>true</b>, <span class="i">BestFitMapping</span> = <b>false</b>)]
        <b>internal static extern bool</b> <a id="73d159b387a23b49" href="../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">FDICopy</a>(
            <a href="#1ad99c13b1129f63" class="t t">FdiContextHandle</a> <span id="r79 rd" class="r79 r">hfdi</span>,
            [<span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">LPStr</span>)] <b>string</b> <span id="r80 rd" class="r80 r">pszCabinet</span>,
            [<span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">LPStr</span>)] <b>string</b> <span id="r81 rd" class="r81 r">pszCabPath</span>,
            <b>int</b> <span id="r82 rd" class="r82 r">flags</span>,
            <span class="i">IntPtr</span> <span id="r83 rd" class="r83 r">pfnfdin</span>,
            <span class="i">IntPtr</span> <span id="r84 rd" class="r84 r">pfnfdid</span>,
            <span class="i">IntPtr</span> <span id="r85 rd" class="r85 r">pvUser</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Deletes an open FDI context.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r86 r">hfdi</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">_In_ HFDI - The FDI context handle to destroy.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        [<span class="i">DllImport</span>(<span class="s">&quot;cabinet.dll&quot;</span>, <span class="i">ExactSpelling</span> = <b>true</b>, <span class="i">CallingConvention</span> = <span class="i">CallingConvention</span>.<span class="i">Cdecl</span>, <span class="i">SetLastError</span> = <b>true</b>)]
        <b>internal static extern bool</b> <a id="8749fc5b130f4a50" href="../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">FDIDestroy</a>(
            <span class="i">IntPtr</span> <span id="r86 rd" class="r86 r">hfdi</span>);
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
    }
}
</pre></td></tr></table></div></body></html>
